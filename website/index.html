<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Asciidoctor 1.5.2"><meta name="description" content="Stardog is the world's leading Enterprise Knowledge Graph."><meta name="author" content="The Manual"><title>Stardog 5</title><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,400italic|Anonymous+Pro:400,400italic" rel="stylesheet" type="text/css"><link data-embed rel="stylesheet" href="./stardog.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css"><link rel="icon" type="image/x-icon" href="favicon.png"></head><body class="book toc2 toc-right"><div id="header"><h1>Stardog 5</h1><div class="details"><span id="author" class="author">The Manual</span><br><span id="revnumber">version 5.0.0beta</span></div><div id="toc" class="toc2"><div id="toctitle">5.0.0beta—31 March 2017</div><ul class="sectlevel0"><li><a href="#_introduction">Introduction</a><ul class="sectlevel1"><li><a href="#_downloading_support">Downloading &amp; Support</a></li><li><a href="#_contributing">Contributing</a></li></ul></li><li><a href="#_enterprise_support">Enterprise Support</a><ul class="sectlevel1"><li><a href="#_real_time_support">Real-time Support</a></li><li><a href="#_private_maven_repositories">Private Maven Repositories</a></li><li><a href="#_private_docker_repositories">Private Docker Repositories</a></li><li><a href="#_priority_bug_fixes">Priority Bug Fixes</a></li><li><a href="#_priority_feature_releases">Priority Feature Releases</a></li></ul></li><li><a href="#_quick_start_guide">Quick Start Guide</a><ul class="sectlevel1"><li><a href="#_requirements">Requirements</a></li><li><a href="#_insecurity">Insecurity</a></li><li><a href="#_upgrading_to_stardog_4">Upgrading to Stardog 4</a></li><li><a href="#_linux_and_osx">Linux and OSX</a></li><li><a href="#_windows">Windows</a></li></ul></li><li><a href="#_using_stardog">Using Stardog</a><ul class="sectlevel1"><li><a href="#_querying">Querying</a></li><li><a href="#_traversing">Traversing</a></li><li><a href="#_updating">Updating</a></li><li><a href="#_versioning">Versioning</a></li><li><a href="#_exporting">Exporting</a></li><li><a href="#_searching">Searching</a></li><li><a href="#_obfuscating">Obfuscating</a></li><li><a href="#_browsing">Browsing</a></li><li><a href="#_namespacing">Namespacing</a></li><li><a href="#_naming">Naming</a></li><li><a href="#_man_pages">Man Pages</a></li></ul></li><li><a href="#_administering_stardog">Administering Stardog</a><ul class="sectlevel1"><li><a href="#_command_line_interface">Command Line Interface</a></li><li><a href="#_server_admin">Server Admin</a></li><li><a href="#_database_admin">Database Admin</a></li><li><a href="#_capacity_planning">Capacity Planning</a></li><li><a href="#_using_stardog_on_windows">Using Stardog on Windows</a></li></ul></li><li><a href="#_virtual_graphs">Virtual Graphs</a><ul class="sectlevel1"><li><a href="#_structured_data">Structured Data</a></li><li><a href="#_unstructured_data">Unstructured Data</a></li></ul></li><li><a href="#_high_availability_cluster">High Availability Cluster</a><ul class="sectlevel1"><li><a href="#_guarantees">Guarantees</a></li><li><a href="#_single_server_migration">Single Server Migration</a></li><li><a href="#_configuration">Configuration</a></li><li><a href="#_installation">Installation</a></li><li><a href="#_shutdown">Shutdown</a></li><li><a href="#_configuration_issues">Configuration Issues</a></li><li><a href="#_management">Management</a></li></ul></li><li><a href="#_search">Search</a><ul class="sectlevel1"><li><a href="#_indexing_strategy">Indexing Strategy</a></li><li><a href="#_maintaining_search_indexes">Maintaining Search Indexes</a></li><li><a href="#_integration_with_sparql">Integration with SPARQL</a></li><li><a href="#_search_syntax">Search Syntax</a></li></ul></li><li><a href="#_owl_rule_reasoning">OWL &amp; Rule Reasoning</a><ul class="sectlevel1"><li><a href="#_reasoning_types">Reasoning Types</a></li><li><a href="#_using_reasoning">Using Reasoning</a></li><li><a href="#_explaining_reasoning_results">Explaining Reasoning Results</a></li><li><a href="#_user_defined_rule_reasoning">User-defined Rule Reasoning</a></li><li><a href="#_special_predicates">Special Predicates</a></li><li><a href="#_query_rewriting">Query Rewriting</a></li><li><a href="#_same_as_reasoning">Same As Reasoning</a></li><li><a href="#_removing_unwanted_inferences">Removing Unwanted Inferences</a></li><li><a href="#_performance_hints">Performance Hints</a></li><li><a href="#_not_seeing_expected_results">Not Seeing Expected Results?</a></li><li><a href="#_known_issues">Known Issues</a></li><li><a href="#_terminology">Terminology</a></li></ul></li><li><a href="#_validating_constraints">Validating Constraints</a><ul class="sectlevel1"><li><a href="#_getting_started_with_icv">Getting Started with ICV</a></li><li><a href="#_icv_owl_2_reasoning">ICV &amp; OWL 2 Reasoning</a></li><li><a href="#_using_icv_from_cli">Using ICV from CLI</a></li><li><a href="#_icv_guard_mode">ICV Guard Mode</a></li><li><a href="#_explaining_icv_violations">Explaining ICV Violations</a></li><li><a href="#_repairing_icv_violations">Repairing ICV Violations</a></li><li><a href="#_icv_examples">ICV Examples</a></li><li><a href="#_using_icv_programmatically">Using ICV Programmatically</a></li><li><a href="#_terminology_2">Terminology</a></li></ul></li><li><a href="#_geospatial_query">Geospatial Query</a><ul class="sectlevel1"><li><a href="#_enabling_geospatial_support">Enabling Geospatial Support</a></li><li><a href="#_geospatial_data">Geospatial Data</a></li><li><a href="#_sparql_integration">SPARQL Integration</a></li><li><a href="#_enhanced_polygons">Enhanced Polygons</a></li></ul></li><li><a href="#_property_graphs">Property Graphs</a><ul class="sectlevel1"><li><a href="#_motivation_implementation">Motivation &amp; Implementation</a></li><li><a href="#_stardog_gremlin_console">Stardog &amp; Gremlin Console</a></li><li><a href="#_stardog_gremlin_server">Stardog &amp; Gremlin Server</a></li></ul></li><li><a href="#_security">Security</a><ul class="sectlevel1"><li><a href="#_resources">Resources</a></li><li><a href="#_permissions">Permissions</a></li><li><a href="#_default_security_configuration">Default Security Configuration</a></li><li><a href="#_named_graph_security">Named Graph Security</a></li><li><a href="#_enterprise_authentication">Enterprise Authentication</a></li><li><a href="#_managing_stardog_securely">Managing Stardog Securely</a></li><li><a href="#_deploying_stardog_securely">Deploying Stardog Securely</a></li></ul></li><li><a href="#_programming_stardog">Programming Stardog</a><ul class="sectlevel1"><li><a href="#_sample_code">Sample Code</a></li></ul></li><li><a href="#_java_programming">Java Programming</a><ul class="sectlevel1"><li><a href="#_snarl_protocol_buffers">SNARL Protocol Buffers</a></li><li><a href="#_examples_3">Examples</a></li><li><a href="#_using_sesame">Using Sesame</a></li><li><a href="#_using_jena">Using Jena</a></li><li><a href="#_client_server_stardog">Client-Server Stardog</a></li><li><a href="#_connection_pooling">Connection Pooling</a></li><li><a href="#_api_deprecation">API Deprecation</a></li><li><a href="#_using_maven">Using Maven</a></li></ul></li><li><a href="#_network_programming">Network Programming</a><ul class="sectlevel1"><li><a href="#_sparql_protocol">SPARQL Protocol</a></li><li><a href="#_stardog_resources">Stardog Resources</a></li><li><a href="#_admin_resources">Admin Resources</a></li></ul></li><li><a href="#_javascript_programming">Javascript Programming</a><ul class="sectlevel1"><li><a href="#_stardog_js">stardog.js</a></li></ul></li><li><a href="#_clojure_programming">Clojure Programming</a><ul class="sectlevel1"><li><a href="#_installation_4">Installation</a></li><li><a href="#_overview">Overview</a></li><li><a href="#_api_overview">API Overview</a></li><li><a href="#_examples_4">Examples</a></li></ul></li><li><a href="#__net_programming">.Net Programming</a><ul class="sectlevel1"><li><a href="#_dotnetrdf_documentation">dotNetRDF Documentation</a></li></ul></li><li><a href="#_spring_programming">Spring Programming</a><ul class="sectlevel1"><li><a href="#_overview_2">Overview</a></li><li><a href="#_basic_spring">Basic Spring</a></li><li><a href="#_spring_batch">Spring Batch</a></li></ul></li><li><a href="#_groovy_programming">Groovy Programming</a><ul class="sectlevel1"><li><a href="#_overview_3">Overview</a></li><li><a href="#_examples_5">Examples</a></li></ul></li><li><a href="#_snarl_migration_guide">SNARL Migration Guide</a><ul class="sectlevel1"><li><a href="#_stardog_4">Stardog 4</a></li><li><a href="#_stardog_3">Stardog 3</a></li><li><a href="#_stardog_2">Stardog 2</a></li></ul></li><li><a href="#_understanding_stardog">Understanding Stardog</a><ul class="sectlevel1"><li><a href="#_faq">FAQ</a></li><li><a href="#_benchmark_results">Benchmark Results</a></li><li><a href="#_compatibility_policies">Compatibility Policies</a></li><li><a href="#_known_issues_2">Known Issues</a></li><li><a href="#_glossary">Glossary</a></li></ul></li><li><a href="#_appendix">Appendix</a><ul class="sectlevel1"><li><a href="#_sparql_query_functions">SPARQL Query Functions</a></li><li><a href="#_milestones">Milestones</a></li><li><a href="#_previous_versions_of_docs">Previous Versions of Docs</a></li></ul></li></ul></div></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="imageblock" style="float: right"><div class="content"><img src="optimized-img//stardog5.png" alt="Stardog Logo" width="300" height="204"></div></div><div class="paragraph"><p>Stardog is the world&#8217;s leading <strong>Enterprise Knowledge Graph</strong>.</p></div><div class="paragraph"><p>Stardog makes it fast and easy to turn enterprise data into knowledge.</p></div><div class="sidebarblock"><div class="content"><div class="title">What&#8217;s New in Stardog 5</div><div class="ulist checklist"><ul class="checklist"><li><p>&#10003; <a href="#Graviton">Push Button Cloud Deployment</a></p></li><li><p>&#10003; Query, Geospatial, &amp; Search Performance</p></li><li><p>&#10003; Pauseless, Native Memory Management</p></li><li><p>&#10003; <a href="#VEGA">Next-gen Virtual Graph Engine</a></p></li><li><p>&#10003; Query Hints</p></li><li><p>&#10003; HA Cluster Improvements</p></li><li><p>&#10003; Pivotal Cloud Foundry Support</p></li><li><p>&#10003; Tableau Web Data Connector</p></li></ul></div></div></div><div class="paragraph"><p>Check out the <a href="#_quick_start_guide">Quick Start Guide</a> to get Stardog installed and running in five easy steps.</p></div></div></div><h1 id="_introduction" class="sect0"><a class="link" href="#_introduction">Introduction</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph"><p>Stardog <strong>5.0.0beta</strong> (<strong>31 March 2017</strong>) supports the <a href="http://www.w3.org/RDF/">RDF graph data model</a>; <a href="http://www.w3.org/TR/sparql11-overview/">SPARQL</a> query language; <a href="https://github.com/tinkerpop/blueprints/wiki/Property-Graph-Model">property graph model</a> and <a href="http://tinkerpop.incubator.apache.org/docs/3.0.2-incubating/#_on_gremlin_language_variants">Gremlin graph traversal language</a>; HTTP and SNARL protocols for remote access and control; <a href="http://www.w3.org/TR/owl2-overview/">OWL 2</a> and user-defined rules for inference and data analytics; virtual graphs; geospatial query answering; and programmatic interaction via several languages and network interfaces.</p></div><div class="paragraph"><p>Stardog is made by hand with skill, taste, and a point of view in DC, Boston, Heidelberg, Madison, Moscow, Hanalei, Houston, South Dakota, Porto, Manchester, PA, Columbia, MO, and Pittsburgh. 🌟🐶</p></div><div class="imageblock"><div class="content"><img src="optimized-img//map.jpg" alt="Where Stardog is Made" width="750" height="357"></div></div><div class="paragraph"><p>To learn more about where we&#8217;ve been and where we&#8217;re headed, consult the <a href="/release-notes/">RELEASE NOTES</a> and <a href="#_milestones">milestones</a>.</p></div></div></div><div class="sect1"><h2 id="_downloading_support"><a class="link" href="#_downloading_support">Downloading &amp; Support</a></h2><div class="sectionbody"><div class="paragraph"><p><a href="http://stardog.com/#download">Download</a> Stardog to get started. The <a href="https://community.stardog.com/">Stardog support forum</a> is the place to report bugs, ask questions, etc.</p></div></div></div><div class="sect1"><h2 id="_contributing"><a class="link" href="#_contributing">Contributing</a></h2><div class="sectionbody"><div class="paragraph"><p>There are several open source components of Stardog; feel free to submit pull requests: <a href="https://github.com/complexible/stardog-docs">stardog-docs</a>, <a href="https://github.com/complexible/stardog.js">stardog.js</a>, <a href="https://github.com/complexible/stardog-groovy">stardog-groovy</a>, <a href="https://github.com/complexible/stardog-spring">stardog-spring</a>, <a href="https://github.com/antoniogarrote/stardog-rb">stardog.rb</a>, and <a href="https://github.com/complexible/stardog-clj">stardog-clj</a>. Many thanks to Stardog customers, users, contributors, testers, etc. You know who you are, and so do we. Thank you!<span class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</span> You can also help by <a href="https://github.com/Complexible/stardog-docs/tree/master/src/doc">editing these docs on Github</a> if you spot a problem.</p></div></div></div><h1 id="_enterprise_support" class="sect0"><a class="link" href="#_enterprise_support">Enterprise Support</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/premium-support.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>Customers of Stardog&#8217;s Enterprise Premium Support have access to the following capabilities and services. Enterprise Premium Support is available as of Stardog 3 release. <a href="mailto:sales@complexible.com">Email</a> for details.</p></div></div></div><div class="sect1"><h2 id="_real_time_support"><a class="link" href="#_real_time_support">Real-time Support</a></h2><div class="sectionbody"><div class="paragraph"><p>Get access to the core Stardog development team in real-time via voice or chat. Let us help you get the most from Stardog, 24/7. Our core team has more semantic graph application and tool development experience than any other team on the planet. Other vendors shunt you off to inexperienced level one techs. We&#8217;ve never done that and never will.</p></div></div></div><div class="sect1"><h2 id="_private_maven_repositories"><a class="link" href="#_private_maven_repositories">Private Maven Repositories</a></h2><div class="sectionbody"><div class="paragraph"><p>See <a href="#_using_maven">Using Maven</a> for details; this includes a per-customer, private Maven repository, CDN-powered, for 24/7 builds, updates, and feature releases.</p></div><div class="paragraph"><p>We&#8217;re also tying Maven and Docker together, providing private Docker repositories for customers, which allows us to build out clusters, custom configurations, best practices, and devops tips-and-tricks into custom Docker images&#8230;&#8203;so that you don&#8217;t have to.</p></div></div></div><div class="sect1"><h2 id="_private_docker_repositories"><a class="link" href="#_private_docker_repositories">Private Docker Repositories</a></h2><div class="sectionbody"><div class="paragraph"><p>Docker-based deliverables not only shortens your development and devops cycles but keeps you up-to-date with the latest-greatest versions of Stardog, including security fixes, performance hot fixes, and deployment best practices and configurations.</p></div></div></div><div class="sect1"><h2 id="_priority_bug_fixes"><a class="link" href="#_priority_bug_fixes">Priority Bug Fixes</a></h2><div class="sectionbody"><div class="paragraph"><p>With Maven and Docker in place, we&#8217;ve got a software delivery mechanism ready to push priority bug fixes into your enterprise as soon as they&#8217;re ready. We&#8217;ve averaged one Stardog release every two weeks since 2012. Enterprise Premium Support customers can now take advantage of our development pace in a controlled fashion.</p></div></div></div><div class="sect1"><h2 id="_priority_feature_releases"><a class="link" href="#_priority_feature_releases">Priority Feature Releases</a></h2><div class="sectionbody"><div class="paragraph"><p>We hate holding new features in a feature branch, especially for mundane business reasons; we want to release new stuff as soon as possible to our customers. With Enterprise Premium Support, we can maintain a disruptive pace of innovation without disrupting <strong>you</strong>.</p></div></div></div><h1 id="_quick_start_guide" class="sect0"><a class="link" href="#_quick_start_guide">Quick Start Guide</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/qsg.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div></div></div><div class="sect1"><h2 id="_requirements"><a class="link" href="#_requirements">Requirements</a></h2><div class="sectionbody"><div class="paragraph"><p>It just doesn&#8217;t get any easier than this: <strong>Stardog runs on Java 8</strong>. Stardog runs best on, but does not require, a 64-bit JVM that supports <code>sun.misc.Unsafe</code>.</p></div></div></div><div class="sect1"><h2 id="_insecurity"><a class="link" href="#_insecurity">Insecurity</a></h2><div class="sectionbody"><div class="paragraph"><p>We optimize Stardog out-of-the-box for ease and simplicity. You should take additional steps to secure it before production deployment. It&#8217;s easy and it&#8217;s smart, so just do it. In case that&#8217;s not blunt enough:</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Stardog ships with an <strong>insecure</strong> but usable default setting: the super user is <code>admin</code> and the <code>admin</code> password is "admin". This is fine until it isn&#8217;t, at which point you should read the <a href="#_security">Security</a> section.</td></tr></table></div></div></div><div class="sect1"><h2 id="_upgrading_to_stardog_4"><a class="link" href="#_upgrading_to_stardog_4">Upgrading to Stardog 4</a></h2><div class="sectionbody"><div class="paragraph"><p>If you are upgrading to Stardog 4 from any previous version, please see <a href="#_stardog_4">Stardog 4</a> in <a href="#_snarl_migration_guide">SNARL Migration Guide</a> for details about auto-migrating pre-4.0 indexes.</p></div></div></div><div class="sect1"><h2 id="_linux_and_osx"><a class="link" href="#_linux_and_osx">Linux and OSX</a></h2><div class="sectionbody"><div class="olist arabic"><ol class="arabic"><li><p>Tell Stardog where its home directory (where databases and other files will be stored) is</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ export STARDOG_HOME=/data/stardog</code></pre></div></div><div class="paragraph"><p>If you&#8217;re using some weird Unix shell that doesn&#8217;t create environment variables in this way, adjust accordingly. <strong>If <code>STARDOG_HOME</code> isn&#8217;t defined, Stardog will use the Java <code>user.dir</code> property value.</strong></p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">You should consider the <a href="#_upgrading_stardog_server">upgrade process</a> when setting <code>STARDOG_HOME</code> for production or other serious usage. In particular, you probably don&#8217;t want to set the directory where you install Stardog as <code>STARDOG_HOME</code> as that makes upgrading less easy. Set <code>STARDOG_HOME</code> to some other location.</td></tr></table></div></li><li><p>Copy the <code>stardog-license-key.bin</code> into the right place:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ cp stardog-license-key.bin $STARDOG_HOME</code></pre></div></div><div class="paragraph"><p>Of course <code>stardog-license-key.bin</code> has to be readable by the Stardog process.</p></div><div class="paragraph"><p><strong>Stardog won&#8217;t run without a valid <code>stardog-license-key.bin</code> in <code>STARDOG_HOME</code>.</strong></p></div></li><li><p>Start the Stardog server. By default the server will expose SNARL and HTTP interfaces on port 5820.<span class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</span></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin server start</code></pre></div></div></li><li><p>Create a database with an input file:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin db create -n myDB data.ttl</code></pre></div></div></li><li><p>Query the database:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog query myDB "SELECT DISTINCT ?s WHERE { ?s ?p ?o } LIMIT 10"</code></pre></div></div><div class="paragraph"><p>You can use the Web Console to search or query the new database you created by visiting <a href="http://localhost:5820/myDB" class="bare">http://localhost:5820/myDB</a> in your browser.</p></div></li></ol></div><div class="paragraph"><p><strong>Now go have a drink: you&#8217;ve earned it.</strong></p></div></div></div><div class="sect1"><h2 id="_windows"><a class="link" href="#_windows">Windows</a></h2><div class="sectionbody"><div class="paragraph"><p>Windows&#8230;&#8203;really? Okay, but don&#8217;t blame us if this hurts&#8230;&#8203;The following steps are carried out using the Windows command prompt which you can find under <span class="menuseq"><span class="menu">Start</span>&#160;&#9656; <span class="submenu">Programs</span>&#160;&#9656; <span class="submenu">Accessories</span>&#160;&#9656; <span class="menuitem">Command Prompts</span></span> or <span class="menuseq"><span class="menu">Start</span>&#160;&#9656; <span class="submenu">Run</span>&#160;&#9656; <span class="menuitem"><code>cmd</code></span></span>.</p></div><div class="paragraph"><p>First, tell Stardog where its home directory (where databases and other files will be stored) is:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">&gt; set STARDOG_HOME=C:\data\stardog</code></pre></div></div><div class="paragraph"><p>Second, copy the <code>stardog-license-key.bin</code> into the right place:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">&gt; COPY /B stardog-license-key.bin %STARDOG_HOME%</code></pre></div></div><div class="paragraph"><p>The <code>/B</code> is required to perform a binary copy or the license file may get corrupted. Of course <code>stardog-license-key.bin</code> has to be readable by the Stardog process. Finally, Stardog won&#8217;t run without a valid <code>stardog-license-key.bin</code> in <code>STARDOG_HOME</code>.</p></div><div class="paragraph"><p>Third, start the Stardog server. By default the server will expose SNARL and HTTP interfaces on port 5820.<span class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</span></p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">&gt; stardog-admin.bat server start</code></pre></div></div><div class="paragraph"><p>This will start the server in the current command prompt, you should leave this window open and open a new command prompt window to continue.</p></div><div class="paragraph"><p>Fourth, create a database with some input file:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">&gt; stardog-admin.bat db create -n myDB data.ttl</code></pre></div></div><div class="paragraph"><p>Fifth, query the database:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">&gt; stardog.bat query myDB "SELECT DISTINCT ?s WHERE { ?s ?p ?o } LIMIT 10"</code></pre></div></div><div class="paragraph"><p>You can use the Web Console to search or query the new database you created by hitting <a href="http://localhost:5820/myDB" class="bare">http://localhost:5820/myDB</a> in your browser.</p></div><div class="paragraph"><p><strong>You should drink the whole bottle, brave Windows user!</strong></p></div></div></div><h1 id="_using_stardog" class="sect0"><a class="link" href="#_using_stardog">Using Stardog</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/using.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>Stardog supports <a href="http://www.cambridgesemantics.com/semantic-university/sparql-by-example">SPARQL</a>, the W3C standard for <a href="#_querying">querying</a> RDF graphs, as well as a range of other capabilities, including <a href="#_updating">updating</a>, <a href="#_versioning">versioning</a> <a href="#_exporting">exporting</a>, <a href="#_searching">searching</a>, <a href="#_obfuscating">obfuscating</a>, and <a href="#_browsing">browsing</a> graph data.</p></div></div></div><div class="sect1"><h2 id="_querying"><a class="link" href="#_querying">Querying</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog supports SPARQL 1.1 and also the <a href="http://www.w3.org/TR/2012/CR-sparql11-entailment-20121108/">OWL 2 Direct Semantics entailment regime</a>.</p></div><div class="paragraph"><p>To execute a SPARQL query against a Stardog database, use the <code>query</code> subcommand with a query string, a query file, or the name of a stored query:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog query myDb "select * where { ?s ?p ?o }"</code></pre></div></div><div class="paragraph"><p>Detailed information on using the query command in Stardog can be found on its <a href="man/query-execute.html"><code>man</code> page</a>. See <a href="#_managing_stored_queries">Managing Stored Queries</a> section for configuration, usage, and details of stored queries.</p></div><div class="sect2"><h3 id="_describe"><a class="link" href="#_describe">DESCRIBE</a></h3><div class="paragraph"><p>SPARQL&#8217;s <code>DESCRIBE</code> keyword is deliberately underspecified. In Stardog a <code>DESCRIBE &lt;theResource&gt;</code> query retrieves the predicates and objects for all the triples for which <code>&lt;theResource&gt;</code> is the subject. There are, of course, about seventeen thousand other ways to implement <code>DESCRIBE</code>; we&#8217;ve implemented four or five of them and may expose them to users in a future release of Stardog <em>based on user feedback and requests</em>.</p></div></div><div class="sect2"><h3 id="_query_functions"><a class="link" href="#_query_functions">Query Functions</a></h3><div class="paragraph"><p>Stardog supports all of the functions in SPARQL, as well as some others from XPath and SWRL. Any of these functions can be used in queries or rules. Some functions appear in multiple namespaces, but all of the namespaces will work.</p></div><div class="paragraph"><p>See <a href="#_sparql_query_functions">SPARQL Query Functions</a> for the complete list.</p></div></div><div class="sect2"><h3 id="_federated_queries"><a class="link" href="#_federated_queries">Federated Queries</a></h3><div class="paragraph"><p>In Stardog 3.0 we added support for the <a href="http://www.w3.org/TR/sparql11-federated-query/">SERVICE</a> keyword<span class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</span> which allows users to query distributed RDF via SPARQL-compliant data sources. You can use this to federate queries between several Stardog database or Stardog and other public endpoints.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Stardog doesn&#8217;t support variables for the service URL (<code>SERVICE ?serviceURL</code>).</td></tr></table></div><div class="paragraph"><p>Stardog ships with a default <code>Service</code> implementation which uses SPARQL Protocol to send the service fragment to the remote endpoint and retrieve the results. Any endpoint that conforms to the SPARQL protocol can be used.</p></div><div class="paragraph"><p>The Stardog SPARQL endpoint is <code><a href="http://&lt;server&gt;:&lt;port&gt;/{db}/query" class="bare">http://&lt;server&gt;:&lt;port&gt;/{db}/query</a></code>.</p></div><div class="sect3"><h4 id="_http_authentication"><a class="link" href="#_http_authentication">HTTP Authentication</a></h4><div class="paragraph"><p>Stardog requires authentication. If the endpoint you&#8217;re referencing with the <code>SERVICE</code> keyword requires HTTP authentication, credentials are stored in a <a href="#_using_a_password_file">password file</a> called <code>services.sdpass</code> located in <code>STARDOG_HOME</code> directory. The default <code>Service</code> implementation assumes HTTP BASIC authentication; for services that use DIGEST auth, or a different authentication mechanism altogether, you&#8217;ll need to implement a custom <code>Service</code> implementation.</p></div></div></div><div class="sect2"><h3 id="_querying_rdbms_via_virtual_graphs"><a class="link" href="#_querying_rdbms_via_virtual_graphs">Querying RDBMS via Virtual Graphs</a></h3><div class="paragraph"><p>Sometimes enterprise information belongs to or in a Stardog graph but for various reasons the upstream or canonical data source should not be disturbed, consolidated, or decommissioned. In those (and other) cases it makes sense to use Stardog&#8217;s R2RML<span class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</span> mapping feature to create virtual graphs, that is, mappings between a Stardog graph and external data sources such that Stardog will query the external data sources&#8212;&#8203;by rewriting SPARQL to SQL automatically&#8212;&#8203;as if they were actually materialized in Stardog.</p></div><div class="paragraph"><p>See the <a href="#_virtual_graphs">Virtual Graphs</a> chapter for configuration and usage.</p></div></div><div class="sect2"><h3 id="_querying_geospatial_data"><a class="link" href="#_querying_geospatial_data">Querying Geospatial Data</a></h3><div class="paragraph"><p>This works more or less like any SPARQL query, as long as the right geospatial vocabulary is used in the data.</p></div><div class="paragraph"><p>See the <a href="#_geospatial_query">Geospatial Query</a> chapter for configuration and usage.</p></div></div></div></div><div class="sect1"><h2 id="_traversing"><a class="link" href="#_traversing">Traversing</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog supports graph traversals via Gremlin Console and TinkerPop 3 APIs. You can write Gremlin traversals against TP3 APIs in many different languages. But the easiest way to use Gremlin with Stardog is via the <a href="#_stardog_gremlin_console">Gremin Console</a>.</p></div></div></div><div class="sect1"><h2 id="_updating"><a class="link" href="#_updating">Updating</a></h2><div class="sectionbody"><div class="paragraph"><p>There are many ways to update the data in a Stardog database; two of the most commonly used methods are the CLI and SPARQL Update queries, each of which are discussed below.</p></div><div class="sect2"><h3 id="_sparql_update"><a class="link" href="#_sparql_update">SPARQL Update</a></h3><div class="paragraph"><p>SPARQL 1.1 Update can be used to insert RDF into or delete RDF from a Stardog database using SPARQL query forms <code>INSERT</code> and <code>DELETE</code>, respectively.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-SPARQL" data-lang="SPARQL">PREFIX dc: &lt;http://purl.org/dc/elements/1.1/&gt;
PREFIX ns: &lt;http://example.org/ns#&gt;
INSERT DATA
{ GRAPH &lt;http://example/bookStore&gt; { &lt;http://example/book1&gt;  ns:price  42 } }</code></pre></div></div><div class="paragraph"><p>An example of deleting RDF:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-SPARQL" data-lang="SPARQL">PREFIX dc: &lt;http://purl.org/dc/elements/1.1/&gt;

DELETE DATA
{
  &lt;http://example/book2&gt; dc:title "David Copperfield" ;
                         dc:creator "Edmund Wells" .
}</code></pre></div></div><div class="paragraph"><p>Or they can be combined with <code>WHERE</code> clauses:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-SPARQL" data-lang="SPARQL">PREFIX foaf:  &lt;http://xmlns.com/foaf/0.1/&gt;

WITH &lt;http://example/addresses&gt;
DELETE { ?person foaf:givenName 'Bill' }
INSERT { ?person foaf:givenName 'William' }
WHERE
  { ?person foaf:givenName 'Bill' }</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Per the SPARQL Update spec, Stardog treats Update queries as implicitly transactional and atomic. Since Stardog does not support nested transactions, it will not (currently) support an Update query in an open transaction.<span class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</span></td></tr></table></div></div><div class="sect2"><h3 id="_adding_data_with_the_cli"><a class="link" href="#_adding_data_with_the_cli">Adding Data with the CLI</a></h3><div class="paragraph"><p>As of Stardog 5.0.0beta, the most efficient way to load data into Stardog is at database creation time. See the <a href="#_creating_a_database">Creating a Database</a> section for bulk loading data at database creation time. To add data to an existing Stardog database, use the <a href="man/data-add.html"><code>add</code></a> command:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog data add myDatabase 1.rdf 2.rdf 3.rdf</code></pre></div></div><div class="paragraph"><p>The optional arguments are <code>-f</code> (or <code>--format</code>) to specify the RDF serialization type of the files to be loaded; if you specify the wrong type, <code>add</code> will fail. If you don&#8217;t specify a type, Stardog will try to determine the type on its own based on the file extension. For example, the files that have names ending with '.ttl' will be parsed with Turtle syntax. If you specify a type, then all the files being loaded must of that same type.</p></div><div class="paragraph"><p>If you want to add data to a named graph, specify it via the <code>--named-graph</code> or <code>-g</code> options.</p></div></div><div class="sect2"><h3 id="_removing_data_with_the_cli"><a class="link" href="#_removing_data_with_the_cli">Removing Data with the CLI</a></h3><div class="paragraph"><p>To remove data, use <a href="/man/data-remove.html"><code>remove</code></a> with the following input(s):</p></div><div class="olist arabic"><ol class="arabic"><li><p>one Named Graph, <em>or</em></p></li><li><p>one or more files containing RDF (in some recognized serialization format, i.e., RDF/XML, Turtle, Trig), <em>or</em></p></li><li><p>one Named Graph and one or more RDF files.</p></li></ol></div><div class="paragraph"><p>For example,</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog data remove -g http://foo myDatabase</code></pre></div></div><div class="paragraph"><p>will remove the named graph <code>http://foo</code> and all its triples from <code>myDatabase</code>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog data remove myDatabase 1.rdf</code></pre></div></div><div class="paragraph"><p>will remove the triples in <code>1.rdf</code> from (the default graph of) <code>myDatabase</code>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog data remove -g http://foo -f TURTLE myDatabase 2.rdf 3.rdf</code></pre></div></div><div class="paragraph"><p>will remove the triples in the Turtle files <code>2.rdf</code> and <code>3.rdf</code> from the named graph <code>http://foo</code> of <code>myDatabase</code>.</p></div></div><div class="sect2"><h3 id="_how_stardog_handles_rdf_parsing"><a class="link" href="#_how_stardog_handles_rdf_parsing">How Stardog Handles RDF Parsing</a></h3><div class="paragraph"><p>RDF parsing in Stardog is strict: it requires typed RDF literals to match their explicit datatypes, URIs to be well-formed, etc. In some cases, strict parsing isn&#8217;t ideal—it may be disabled using the <code>strict.parsing</code> <a href="#_configuration_options">configuration option</a>.</p></div><div class="paragraph"><p>However, even with strict parsing disabled, Stardog&#8217;s RDF parser may encounter parse errors from which it cannot recover. And loading data in lax mode may lead to unexpected SPARQL query results. For example, malformed literals (<code>"2.5"^^xsd:int</code>) used in filter evaluation may lead to undesired results.</p></div></div></div></div><div class="sect1"><h2 id="_versioning"><a class="link" href="#_versioning">Versioning</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog supports graph change management capability that lets users track changes between revisions of a Stardog database, add comments and other metadata to the revisions, extract diffs between those revisions, tag revisions with labels, and query over the revision history of the database using SPARQL.</p></div><div class="paragraph"><p>For a more complete tutorial on using Stardog versioning, see <a href="https://github.com/Complexible/stardog-examples/blob/master/examples/cli/versioning/README.md">the stardog-examples repo</a>.</p></div><div class="paragraph"><p>Versioning support for a database is disabled by default but can be enabled at any time by setting the configuration option <code>versioning.enabled</code> to true. For example, you can create a database with versioning support as follows:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db create -o versioning.enabled=true -n myDb</code></pre></div></div><div class="paragraph"><p>This option can also be set after database creation using the <code>stardog-admin metadata set</code> command.</p></div><div class="paragraph"><p>The following examples give a <strong>very brief overview</strong> of this capability; see the <a href="#_man_pages">Man Pages</a> for all the details.</p></div><div class="sect2"><h3 id="_committing_changes"><a class="link" href="#_committing_changes">Committing Changes</a></h3><div class="paragraph"><p>Commit a new version by adding and removing triples specified in files. Different from the <code>data add/remove</code> commands, <code>commit</code> allows one to add and remove triples in one commit and to associate a commit message.</p></div><div class="paragraph"><p>To commit changes:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog vcs commit --add add_file1.ttl add_file2.ttl --remove remove_file.ttl -m "This is an example commit" myDb</code></pre></div></div><div class="paragraph"><p>It is also possible to run an update query with a commit message:</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Removals are performed before additions and queries are executed last.</td></tr></table></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog vcs commit --query update.sparql -m "This is another commit" myDb</code></pre></div></div><div class="paragraph"><p>If the database is updated through the regular <code>data add</code>, <code>data remove</code>, or <code>query</code> commands when versioning is enabled, a corresponding version will be created but the commit message will be empty.</p></div></div><div class="sect2"><h3 id="_viewing_revisions"><a class="link" href="#_viewing_revisions">Viewing Revisions</a></h3><div class="paragraph"><p>To see all revisions (commits) in a database:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog vcs list myDb
$ stardog vcs list --committer userName myDb</code></pre></div></div><div class="paragraph"><p>The output can be tweaked using <code>--after</code>, <code>--before</code>, and <code>--committer</code>.</p></div></div><div class="sect2"><h3 id="_reverting_revisions"><a class="link" href="#_reverting_revisions">Reverting Revisions</a></h3><div class="paragraph"><p>You can revert specific revisions, ranges, etc.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog vcs revert myDb
$ stardog vcs revert myDb de44369d-cc7b-4244-a3fb-3f6e271420b0</code></pre></div></div></div><div class="sect2"><h3 id="_viewing_diffs"><a class="link" href="#_viewing_diffs">Viewing Diffs</a></h3><div class="paragraph"><p>You can also see the differences between revisions; by default, between the head version and its previous versions or the changes in a specific commit, respectively:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog vcs diff myDb
$ stardog vcs diff myDb de44369d-cc7b-4244-a3fb-3f6e271420b0</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Diffs are represented as SPARQL Update queries so that they may be used as a kind of graph patch.</td></tr></table></div></div><div class="sect2"><h3 id="_using_tags"><a class="link" href="#_using_tags">Using Tags</a></h3><div class="paragraph"><p>You can also create, drop, list tags, i.e., named revisions:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog vcs tag --list myDb</code></pre></div></div></div><div class="sect2"><h3 id="_querying_the_revision_history"><a class="link" href="#_querying_the_revision_history">Querying the Revision History</a></h3><div class="paragraph"><p>The revision history of the database is represented as RDF using an extended version of the W3C PROV vocabulary and can be queried using SPARQL.<span class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</span> The following query retrieves all the versions:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-SPARQL" data-lang="SPARQL">SELECT ?author ?msg ?date {
  ?v a vcs:Version ;
     rdfs:comment ?msg ;
     prov:wasAttributedTo / rdfs:label ?author ;
     prov:generatedAtTime ?date
}</code></pre></div></div><div class="paragraph"><p>You can execute versioning queries using the <code>vcs query</code> command:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog vcs query myDb versioning-query.sparql</code></pre></div></div><div class="paragraph"><p>Queries executed by <code>vcs query</code> only query the versioning history and automatically recognizes the <code>vcs</code> and <code>prov</code> namespaces. If you would like to query the current state of the database along with the version history then you can run a regular query using a special versioning <code>SERVICE</code>. The following query finds the instances of <code>foaf:Person</code> class that has been modified in the last 24 hours:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-SPARQL" data-lang="SPARQL">PREFIX prov: &lt;http://www.w3.org/ns/prov#&gt;
PREFIX vcs: &lt;tag:stardog:api:versioning:&gt;

SELECT DISTINCT ?x ?date {
  ?x a foaf:Person

  SERVICE vcs:service {
    ?v a vcs:Version;
       prov:generatedAtTime ?date;
       vcs:updates/(vcs:additions|vcs:removals) ?update
    GRAPH ?update {
      ?x ?p ?o
    }
    FILTER (NOW() - ?date &lt; 'PT24H'^^xsd:dayTimeDuration)
  }
}
ORDER BY DESC(?date)</code></pre></div></div><div class="paragraph"><p>You can run this query using the regular query command:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog query myDb versioning-mixed-query.sparql</code></pre></div></div><div class="paragraph"><p>Note that, in this query the namespaces <code>vcs</code> and <code>prov</code> have been declared explicitly in the query. If you <a href="#_namespacing">register these namespaces</a> to your database then you can omit these declarations.</p></div><div class="paragraph"><p>For more details about the Stardog versioning representation, see <a href="https://github.com/Complexible/stardog-examples/blob/master/examples/cli/versioning/README.md">the stardog-examples repo</a>.</p></div></div></div></div><div class="sect1"><h2 id="_exporting"><a class="link" href="#_exporting">Exporting</a></h2><div class="sectionbody"><div class="paragraph"><p>To export data from a Stardog database back to RDF, <a href="/man/data-export.html"><code>export</code></a> is used by specifying</p></div><div class="olist arabic"><ol class="arabic"><li><p>the name of the database to export</p></li><li><p>optionally, the URIs of the named graphs to export if you wish to export specific named graphs only. Keywords <code>DEFAULT</code> and <code>ALL</code> can be used as values of the <code>--named-graph</code> parameter to export the default graph and all graphs, respectively</p></li><li><p>the export format: <code>N-TRIPLES, RDF/XML, TURTLE, TRIG</code>. The default is <code>N-TRIPLES</code>. <code>TRIG</code> must be used when exporting the entire database if the database contains triples inside named graphs</p></li><li><p>a file to export to</p></li></ol></div><div class="paragraph"><p>For example,</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog data export --format TURTLE myDatabase myDatabase_output.ttl

$ stardog data export --named-graph http://example.org/context myDatabase myDatabase_output.nt</code></pre></div></div></div></div><div class="sect1"><h2 id="_searching"><a class="link" href="#_searching">Searching</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog includes an RDF-aware semantic search capability: it will index RDF literals and supports information retrieval-style queries over indexed data. See <a href="#_managing_search">Managing Search</a> for more details.</p></div><div class="sect2"><h3 id="_searching_with_the_command_line"><a class="link" href="#_searching_with_the_command_line">Searching with the Command Line</a></h3><div class="paragraph"><p>First, check out the <a href="/man/query-search.html"><code>search</code> man page</a>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog help query search</code></pre></div></div><div class="paragraph"><p>Okay, now let&#8217;s do a search over the O&#8217;Reilly book catalog in RDF for everything mentioning "html":</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog query search -q "html" -l 10 catalog</code></pre></div></div><div class="paragraph"><p>The results?</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">+-------+-------+---------------------------------------------------+
| Index | Score |                        Hit                        |
+-------+-------+---------------------------------------------------+
| 1     | 6.422 | urn:x-domain:oreilly.com:product:9780596002251.IP |
| 2     | 6.422 | urn:x-domain:oreilly.com:product:9780596002961.IP |
| 3     | 6.422 | urn:x-domain:oreilly.com:product:9780596003166.IP |
| 4     | 6.422 | urn:x-domain:oreilly.com:product:9780596101978.IP |
| 5     | 6.422 | urn:x-domain:oreilly.com:product:9780596154066.IP |
| 6     | 6.422 | urn:x-domain:oreilly.com:product:9780596157616.IP |
| 7     | 6.422 | urn:x-domain:oreilly.com:product:9780596527273.IP |
| 8     | 6.422 | urn:x-domain:oreilly.com:product:9780596527402.IP |
| 9     | 6.422 | urn:x-domain:oreilly.com:product:9780596805876.IP |
| 10    | 6.422 | urn:x-domain:oreilly.com:product:9781565924949.IP |
+-------+-------+---------------------------------------------------+</code></pre></div></div><div class="paragraph"><p>See <a href="#Full-Text Search">[Full-Text Search]</a> for more details.</p></div></div></div></div><div class="sect1"><h2 id="_obfuscating"><a class="link" href="#_obfuscating">Obfuscating</a></h2><div class="sectionbody"><div class="paragraph"><p>When sharing sensitive RDF data with others, you might want to (selectively) obfuscate it so that sensitive bits are not present, but non-sensitive bits remain. For example, this feature can be used to submit Stardog bug reports using sensitive data.</p></div><div class="paragraph"><p>Data obfuscation works much the same way as the <code>export</code> command and supports the same set of arguments:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog data obfuscate myDatabase obfDatabase.ttl</code></pre></div></div><div class="paragraph"><p>By default, all URIs, bnodes, and string literals in the database will be obfuscated using the SHA256 message digest algorithm. Non-string typed literals (numbers, dates, etc.) are left unchanged as well as URIs from built-in namespaces (<code>RDF</code>, <code>RDFS</code>, and <code>OWL</code>). It&#8217;s possible to customize obfuscation by providing a configuration file.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog data obfuscate --config obfConfig.ttl myDatabase  obfDatabase.ttl</code></pre></div></div><div class="paragraph"><p>The configuration specifies which URIs and strings will be obfuscated by defining inclusion and exclusion filters. See the example configuration file in the <a href="https://github.com/Complexible/stardog-examples/blob/master/config/obfuscation.ttl">stardog-examples Github repo.</a></p></div><div class="paragraph"><p>Once the data is obfuscated, queries written against the original data will no longer work. Stardog provides query obfuscation capability, too, so that queries can be executed against the obfuscated data. If a custom configuration file is used to obfuscate the data, then the same configuration should be used for obfuscating the queries as well:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog query obfuscate --config obfConfig.ttl myDatabase myQuery.sparql &gt; obfQuery.ttl</code></pre></div></div></div></div><div class="sect1"><h2 id="_browsing"><a class="link" href="#_browsing">Browsing</a></h2><div class="sectionbody"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/console.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>The Stardog Web Console is a responsive web app for the Stardog Server and for every Stardog database that makes administration and interaction with data quick and easy; you can access it at <code><a href="http://foo:5820" class="bare">http://foo:5820</a></code> where <code>foo</code> is the name of the machine where Stardog is running.</p></div><div class="sect2"><h3 id="_a_screenshot_tour"><a class="link" href="#_a_screenshot_tour">A Screenshot Tour&#8230;&#8203;</a></h3><div class="paragraph"><p>Seriously, this is a lot more fun if you just <a href="http://stardog.com/">download</a> the damn thing and hit it with a browser!</p></div><div class="sect3"><h4 id="_web_console"><a class="link" href="#_web_console">Web Console</a></h4><div class="imageblock"><div class="content"><img src="optimized-img//webconsole_main.png" alt="Main" width="1388" height="1296"></div></div></div><div class="sect3"><h4 id="_browsing_the_graph"><a class="link" href="#_browsing_the_graph">Browsing the Graph</a></h4><div class="imageblock"><div class="content"><img src="optimized-img//webconsole_browse.png" alt="Browsing" width="1388" height="1380"></div></div></div><div class="sect3"><h4 id="_managing_a_database"><a class="link" href="#_managing_a_database">Managing a Database</a></h4><div class="paragraph"><p><span class="image"><img src="optimized-img//webconsole_db.png" alt="Managing" width="1388" height="1296"></span></p></div></div><div class="sect3"><h4 id="_searching_the_graph"><a class="link" href="#_searching_the_graph">Searching the Graph</a></h4><div class="paragraph"><p><span class="image"><img src="optimized-img//webconsole_search.png" alt="Searching" width="1388" height="1296"></span></p></div></div></div></div></div><div class="sect1"><h2 id="_namespacing"><a class="link" href="#_namespacing">Namespacing</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog allows users to store and manage custom namespace prefix bindings for each database. These stored namespaces allow users to omit prefix declarations in Turtle files and SPARQL queries. <a href="#_namespace_prefix_bindings">Namespace Prefix Bindings</a> section describes how to manage these namespace prefixes in detail.</p></div><div class="paragraph"><p>Stored namespaces allow one to use Stardog without declaring a single namespace prefix. Stardog will use its default namespace (<code><a href="http://api.stardog.com/" class="bare">http://api.stardog.com/</a></code>) behind the scenes so that everything will still be valid RDF, but users won&#8217;t need to deal with namespaces manually. Stardog will act <strong>as if</strong> there are no namespaces, which in some cases is exactly what you want!</p></div><div class="paragraph"><p>For example, let&#8217;s assume we have some data that does not contain any namespace declarations:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">:Alice a :Person ;
       :knows :Bob .</code></pre></div></div><div class="paragraph"><p>We can create a database using this file directly:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db create -n mydb data.ttl</code></pre></div></div><div class="paragraph"><p>We can also add this file to the database after it is created. After the data is loaded, we can then execute SPARQL queries without prefix declarations:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog query mydb "SELECT * { ?person a :Person }"
+--------+
| person |
+--------+
| :Alice |
+--------+

Query returned 1 results in 00:00:00.111</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Once we export the data from this database, the default (i.e., in-built) prefix declarations will be printed, but otherwise we will get the same serialization as in the original data file:</td></tr></table></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog data export mydb
@prefix : &lt;http://api.stardog.com/&gt; .
@prefix owl: &lt;http://www.w3.org/2002/07/owl#&gt; .
@prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
@prefix stardog: &lt;tag:stardog:api:&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .

:Alice a :Person ;
       :knows :Bob .</code></pre></div></div></div></div><div class="sect1"><h2 id="_naming"><a class="link" href="#_naming">Naming</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog includes aliases for several commonly used sets of named graphs. These non-standard extensions are provided for convenience and can be used wherever named graph IRIs are expected. This includes SPARQL queries &amp; updates, property graph operations and configuration values. Following is a list of special named graph IRIs.</p></div><table class="tableblock frame-all grid-all spread"><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Named Graph IRI</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Refers to</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag:stardog:api:context:default</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">the default (no) context graph</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag:stardog:api:context:all</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">all contexts, including the default (no) context graph</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag:stardog:api:context:named</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">all named graphs, excluding the default graph</p></td></tr></tbody></table></div></div><div class="sect1"><h2 id="_man_pages"><a class="link" href="#_man_pages">Man Pages</a></h2><div class="sectionbody"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/manpages.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>Stardog command-line interface is comprehensively documented in <code>man</code> pages that ship with Stardog. Those <code>man</code> pages are reproduced here in HTML as a convenience to the reader.</p></div><div class="sect2"><h3 id="_stardog_cli"><a class="link" href="#_stardog_cli">Stardog CLI</a></h3><div class="olist arabic"><ol class="arabic"><li><p><a href="/man/data-add.html"><code>data add</code></a>, <a href="/man/data-export.html"><code>data export</code></a>, <a href="/man/data-obfuscate.html"><code>data obfuscate</code></a>, <a href="/man/data-remove.html"><code>data remove</code></a>, <a href="/man/data-size.html"><code>data size</code></a></p></li><li><p><a href="/man/doc-count.html"><code>doc count</code></a>, <a href="/man/doc-delete.html"><code>doc delete</code></a>, <a href="/man/doc-get.html"><code>doc get</code></a>, <a href="/man/doc-put.html"><code>doc put</code></a></p></li><li><p><a href="/man/icv-convert.html"><code>icv convert</code></a>, <a href="/man/icv-explain.html"><code>icv explain</code></a>, <a href="/man/icv-export.html"><code>icv export</code></a>, <a href="/man/icv-fix.html"><code>icv fix</code></a>, <a href="/man/icv-validate.html"><code>icv validate</code></a></p></li><li><p><a href="/man/namespace-add.html"><code>namespace add</code></a>, <a href="/man/namespace-import.html"><code>namespace import</code></a>, <a href="/man/namespace-list.html"><code>namespace list</code></a>, <a href="/man/namespace-remove.html"><code>namespace remove</code></a></p></li><li><p><a href="/man/query-execute.html"><code>query execute</code></a>, <a href="/man/query-explain.html"><code>query explain</code></a>, <a href="/man/query-obfuscate.html"><code>query obfuscate</code></a>, <a href="/man/query-search.html"><code>query search</code></a></p></li><li><p><a href="/man/reasoning-consistency.html"><code>reasoning consistency</code></a>, <a href="/man/reasoning-explain.html"><code>reasoning explain</code></a>, <a href="/man/reasoning-schema.html"><code>reasoning schema</code></a>, <a href="/man/reasoning-undo.html"><code>reasoning undo</code></a></p></li><li><p><a href="/man/vcs-commit.html"><code>vcs commit</code></a>, <a href="/man/vcs-diff.html"><code>vcs diff</code></a>, <a href="/man/vcs-list.html"><code>vcs list</code></a>, <a href="/man/vcs-query.html"><code>vcs query</code></a>, <a href="/man/vcs-revert.html"><code>vcs revert</code></a>, <a href="/man/vcs-tag.html"><code>vcs tag</code></a></p></li></ol></div></div><div class="sect2"><h3 id="_stardog_admin_cli"><a class="link" href="#_stardog_admin_cli">Stardog Admin CLI</a></h3><div class="olist arabic"><ol class="arabic"><li><p><a href="/man/db-backup.html"><code>db backup</code></a>, <a href="/man/db-copy.html"><code>db copy</code></a>, <a href="/man/db-create.html"><code>db create</code></a>, <a href="/man/db-drop.html"><code>db drop</code></a>, <a href="/man/db-list.html"><code>db list</code></a>, <a href="/man/db-offline.html"><code>db offline</code></a> <a href="/man/db-online.html"><code>db online</code></a> <a href="/man/db-optimize.html"><code>db optimize</code></a>, <a href="/man/db-repair.html"><code>db repair</code></a>, <a href="/man/db-restore.html"><code>db restore</code></a>, <a href="/man/db-status.html"><code>db status</code></a></p></li><li><p><a href="/man/icv-add.html"><code>icv add</code></a>, <a href="/man/icv-drop.html"><code>icv drop</code></a>, <a href="/man/icv-remove.html"><code>icv remove</code></a></p></li><li><p><a href="/man/license-info.html"><code>license info</code></a></p></li><li><p><a href="/man/log-print.html"><code>log print</code></a></p></li><li><p><a href="/man/metadata-get.html"><code>metadata get</code></a>, <a href="/man/metadata-set.html"><code>metadata set</code></a></p></li><li><p><a href="/man/query-kill.html"><code>query kill</code></a>, <a href="/man/query-list.html"><code>query list</code></a>, <a href="/man/query-status.html"><code>query status</code></a></p></li><li><p><a href="/man/role-add.html"><code>role add</code></a>, <a href="/man/role-grant.html"><code>role grant</code></a>, <a href="/man/role-list.html"><code>role list</code></a>, <a href="/man/role-permission.html"><code>role permission</code></a>, <a href="/man/role-remove.html"><code>role remove</code></a>, <a href="/man/role-revoke.html"><code>role revoke</code></a></p></li><li><p><a href="/man/server-start.html"><code>server start</code></a>, <a href="/man/server-status.html"><code>server status</code></a>, <a href="/man/server-stop.html"><code>server stop</code></a></p></li><li><p><a href="/man/stored-add.html"><code>stored add</code></a>, <a href="/man/stored-list.html"><code>stored list</code></a>, <a href="/man/stored-remove.html"><code>stored remove</code></a></p></li><li><p><a href="/man/user-add.html"><code>user add</code></a>, <a href="/man/user-addrole.html"><code>user addrole</code></a>, <a href="/man/user-disable.html"><code>user disable</code></a>, <a href="/man/user-enable.html"><code>user enable</code></a>, <a href="/man/user-grant.html"><code>user grant</code></a>, <a href="/man/user-list.html"><code>user list</code></a>, <a href="/man/user-passwd.html"><code>user passwd</code></a>, <a href="/man/user-permission.html"><code>user permission</code></a>, <a href="/man/user-remove.html"><code>user remove</code></a>, <a href="/man/user-removerole.html"><code>user removerole</code></a>, <a href="/man/user-revoke.html"><code>user revoke</code></a></p></li><li><p><a href="/man/virtual-add.html"><code>virtual add</code></a>, <a href="/man/virtual-import.html"><code>virtual import</code></a>, <a href="/man/virtual-list.html"><code>virtual list</code></a>, <a href="/man/virtual-mappings.html"><code>virtual mappings</code></a>, <a href="/man/virtual-options.html"><code>virtual options</code></a>, <a href="/man/virtual-remove.html"><code>virtual remove</code></a></p></li></ol></div></div><div class="sect2"><h3 id="_installing_man_pages_locally"><a class="link" href="#_installing_man_pages_locally">Installing Man Pages Locally</a></h3><div class="paragraph"><p>To install the man pages locally in your Unix-like environment:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ cp docs/man/man1/* /usr/local/share/man1
$ cp docs/man/man8/* /usr/local/share/man8
$ mandb
$ man stardog-admin-server-start</code></pre></div></div></div></div></div><h1 id="_administering_stardog" class="sect0"><a class="link" href="#_administering_stardog">Administering Stardog</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/admin.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>In this chapter we describe the administration of Stardog Server and Stardog databases, including the various command-line programs, configuration options, etc.</p></div><div class="paragraph"><p>Security is an important part of Stardog administration; it&#8217;s discussed separately (<a href="#_security">Security</a>).</p></div></div></div><div class="sect1"><h2 id="_command_line_interface"><a class="link" href="#_command_line_interface">Command Line Interface</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog&#8217;s command-line interface (CLI) comes in two parts:</p></div><div class="olist arabic"><ol class="arabic"><li><p><code>stardog-admin</code>: administrative client</p></li><li><p><code>stardog</code>: a user&#8217;s client</p></li></ol></div><div class="paragraph"><p>The admin and user&#8217;s tools operate on local or remote databases, using either HTTP or SNARL protocols. Both of these CLI tools are Unix-only, are self-documenting, and the help output of these tools is their canonical documentation.<span class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</span></p></div><div class="sect2"><h3 id="_help"><a class="link" href="#_help">Help</a></h3><div class="paragraph"><p>To use the Stardog CLI tools, you can start by asking them to display help:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">stardog help</code></pre></div></div><div class="paragraph"><p>Or:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin help</code></pre></div></div><div class="paragraph"><p>These work too:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog
$ stardog-admin</code></pre></div></div></div><div class="sect2"><h3 id="_security_considerations"><a class="link" href="#_security_considerations">Security Considerations</a></h3><div class="paragraph"><p>We divide administrative functionality into two CLI programs for reasons of security: <code>stardog-admin</code> will need, in production environments, to have considerably tighter access restrictions than <code>stardog</code>.</p></div><div class="admonitionblock caution"><table><tr><td class="icon"><div class="title">Caution</div></td><td class="content">For usability, Stardog provides a default user "admin" and password "admin" in <code>stardog-admin</code> commands if no user or password are given. This is obviously <strong>insecure</strong>; before any serious use of Stardog is contemplated, read the <a href="#_security">Security</a> section at least twice, and then&#8212;&#8203;minimally&#8212;&#8203;change the administrative password to something we haven&#8217;t published on the interwebs!</td></tr></table></div></div><div class="sect2"><h3 id="_command_groups"><a class="link" href="#_command_groups">Command Groups</a></h3><div class="paragraph"><p>The CLI tools use "command groups" to make CLI subcommands easier to find. To print help for a particular command group, just ask for help:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog help [command_group_name]</code></pre></div></div><div class="paragraph"><p>The command groups and their subcommands:</p></div><div class="ulist"><ul><li><p><strong>data: </strong>add, remove, export;</p></li><li><p><strong>query: </strong>search, execute, explain, status;</p></li><li><p><strong>reasoning:</strong> explain, consistency;</p></li><li><p><strong>namespace:</strong> add, list, remove;</p></li><li><p><strong>server: </strong>start, stop;</p></li><li><p><strong>metadata: </strong>get, set;</p></li><li><p><strong>user: </strong>add, drop, edit, grant, list, permission, revoke, passwd;</p></li><li><p><strong>role: </strong>add, drop, grant, list, permission, revoke;</p></li><li><p><strong>db: </strong>backup, copy, create, drop, migrate, optimize, list, online, offline, repair, restore, status;</p></li><li><p><strong>virtual: </strong>add, import, list, mappings, options, remove.</p></li></ul></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">See the <a href="#_man_pages">man pages</a> for the canonical list of commands.</td></tr></table></div><div class="paragraph"><p>The main help command for either CLI tool will print a listing of the command groups:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code>usage: stardog &lt;command&gt; [ &lt;args&gt; ]

The most commonly used stardog commands are:
    data        Commands which can modify or dump the contents of a database
    help        Display help information
    icv         Commands for working with Stardog Integrity Constraint support
    namespace   Commands which work with the namespaces defined for a database
    query       Commands which query a Stardog database
    reasoning   Commands which use the reasoning capabilities of a Stardog database
    version     Prints information about this version of Stardog

See 'stardog help' for more information on a specific command.</code></pre></div></div><div class="paragraph"><p>To get more information about a particular command, simply issue the help command for it including its command group:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog help query execute</code></pre></div></div><div class="paragraph"><p>Finally, everything here about command groups, commands, and online help works for <code>stardog-admin</code>, too:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog reasoning consistency -u myUsername -p myPassword -r myDB

$ stardog-admin db migrate -u myUsername -p myPassword myDb</code></pre></div></div></div><div class="sect2"><h3 id="_autocomplete"><a class="link" href="#_autocomplete">Autocomplete</a></h3><div class="paragraph"><p>Stardog also supports CLI autocomplete via <code>bash</code> autocompletion. To install autocomplete for bash shell, you&#8217;ll first want to make sure bash completion is installed:</p></div><div class="sect3"><h4 id="_homebrew"><a class="link" href="#_homebrew">Homebrew</a></h4><div class="paragraph"><p>To install:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ brew install bash-completion</code></pre></div></div><div class="paragraph"><p>To enable, edit <code>.bash\_profile</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">if [ -f `brew --prefix`/etc/bash_completion ]; then
  . `brew --prefix`/etc/bash_completion
fi</code></pre></div></div></div><div class="sect3"><h4 id="_macports"><a class="link" href="#_macports">MacPorts</a></h4><div class="paragraph"><p>First, you really should be using Homebrew&#8230;&#8203;ya heard?</p></div><div class="paragraph"><p>If not, then:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ sudo port install bash-completion</code></pre></div></div><div class="paragraph"><p>Then, edit <code>.bash\_profile</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">if [ -f /opt/local/etc/bash_completion ]; then
   . /opt/local/etc/bash_completion
fi</code></pre></div></div></div><div class="sect3"><h4 id="_ubuntu"><a class="link" href="#_ubuntu">Ubuntu</a></h4><div class="paragraph"><p>And for our Linux friends:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ sudo apt-get install bash-completion</code></pre></div></div></div><div class="sect3"><h4 id="_fedora"><a class="link" href="#_fedora">Fedora</a></h4><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ sudo yum install bash-completion</code></pre></div></div></div><div class="sect3"><h4 id="_all_platforms"><a class="link" href="#_all_platforms">All Platforms</a></h4><div class="paragraph"><p>Now put the Stardog autocomplete script—<code>stardog-completion.sh</code>—into your <code>bash\_completion.d</code> directory, typically one of <code>/etc/bash_completion.d, /usr/local/etc/bash_completion.d or ~/bash_completion.d.</code></p></div><div class="paragraph"><p>Alternately you can put it anywhere you want, but tell <code>.bash_profile</code> about it:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">source ~/.stardog-completion.sh</code></pre></div></div></div></div><div class="sect2"><h3 id="_how_to_make_a_connection_string"><a class="link" href="#_how_to_make_a_connection_string">How to Make a Connection String</a></h3><div class="paragraph"><p>You need to know how to make a connection string to talk to a Stardog database. A connection string may consist solely of the <strong>database name</strong> in cases where</p></div><div class="olist arabic"><ol class="arabic"><li><p>Stardog is listening on the standard port(s);</p></li><li><p>SNARL is enabled; and</p></li><li><p>the command is invoked on the same machine where the server is running.</p></li></ol></div><div class="paragraph"><p>In other cases, a "fully qualified" connection string, as described below, is required.</p></div><div class="paragraph"><p>Further, the connection string is now assumed to be the first argument of any command that requires a connection string. Some CLI subcommands require a Stardog connection string as an argument to identify the server and database upon which operations are to be performed.</p></div><div class="paragraph"><p>Connection strings are URLs and may either be local to the machine where the CLI is run or they may be on some other remote machine.</p></div><div class="paragraph"><p>There are two URL schemes recognized by Stardog:</p></div><div class="olist arabic"><ol class="arabic"><li><p><code>http://</code></p></li><li><p><code>snarl://</code></p></li></ol></div><div class="paragraph"><p>The former uses Stardog&#8217;s (extended) version of SPARQL Protocol; the latter uses Stardog&#8217;s native data access protocol, called SNARL.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><code>stardog-admin</code> and <code>stardog</code> works with HTTP or SNARL Protocol, interchangeably. SNARL is faster than HTTP in cases where payloads to and from the server are relatively <strong>small</strong>; for payloads that are large, raw transfer time dominates and there isn&#8217;t much or any difference in performance between them.</td></tr></table></div></div><div class="sect2"><h3 id="_example_connection_strings"><a class="link" href="#_example_connection_strings">Example Connection Strings</a></h3><div class="paragraph"><p>To make a connection string, you need to know the URL scheme; the machine name and port Stardog Server is running on; any (optional) URL path to the database;<span class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnote_9" title="View footnote.">9</a>]</span> and the name of the database:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-html" data-lang="html">{scheme}{machineName}:{port}/{databaseName};{connectionOptions}</code></pre></div></div><div class="paragraph"><p>Here are some example connection strings:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-html" data-lang="html">snarl://server/billion-triples-punk
http://localhost:5000/myDatabase
http://169.175.100.5:1111/myOtherDatabase;reasoning=true
snarl://stardog:8888/the_database
snarl://localhost:1024/db1;reasoning=true</code></pre></div></div><div class="paragraph"><p>Using the default ports for SNARL and HTTP protocols simplifies connection strings. <code>connectionOptions</code> are a series of <code>;</code> delimited key-value pairs which themselves are <code>=</code> delimited. Key names must be <strong>lowercase</strong> and their values are case-sensitive. Finally, in the case where the scheme is SNARL, the machine is "localhost", and the port is the default SNARL port, a connection string may consist of the "databaseName" only.</p></div></div></div></div><div class="sect1"><h2 id="_server_admin"><a class="link" href="#_server_admin">Server Admin</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog Server is multi-protocol, supporting SNARL and HTTP; the default port is <strong>5820</strong>. <strong>All administrative functions work over SNARL or HTTP protocols.</strong></p></div><div class="sect2"><h3 id="_upgrading_stardog_server"><a class="link" href="#_upgrading_stardog_server">Upgrading Stardog Server</a></h3><div class="paragraph"><p>The process of installation is pretty simple; see the <a href="#_quick_start_guide">Quick Start Guide</a> for details.</p></div><div class="paragraph"><p>But how do we easily upgrade between versions? The key is judicious use of <code>STARDOG_HOME</code>. Best practice is to keep installation directories for different versions separate and use a <code>STARDOG_HOME</code> in another location for storing databases.<span class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</span> Once you set your <code>STARDOG_HOME</code> environment variable to point to this directory, you can simply stop the old version and start the new version without copying or moving any files. You can also specify the home directory using the <code>--home</code> argument when starting the server.</p></div></div><div class="sect2"><h3 id="_http_snarl_server_unification"><a class="link" href="#_http_snarl_server_unification">HTTP &amp; SNARL Server Unification</a></h3><div class="paragraph"><p>To use any of these commands against a remote server, pass a global <code>--server</code> argument with an HTTP or SNARL URL.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">If you are running <code>stardog-admin</code> on the same machine where Stardog Server is running, and you&#8217;re using the default protocol ports, then you can omit the <code>--server</code> argument and simply pass a database name via <code>-n</code> option. Most of the following commands assume this case for the sake of exposition.</td></tr></table></div></div><div class="sect2"><h3 id="_server_security"><a class="link" href="#_server_security">Server Security</a></h3><div class="paragraph"><p>See the <a href="#_security">Security</a> section for information about Stardog&#8217;s security system, secure deployment patterns, and more.</p></div></div><div class="sect2"><h3 id="_configuring_stardog_server"><a class="link" href="#_configuring_stardog_server">Configuring Stardog Server</a></h3><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">The properties described in this section control the behavior of the Stardog Server (whether HTTP or SNARL protocols are in use); to set properties or other metadata on individual Stardog <strong>databases</strong>, see <a href="#_database_admin">Database Admin</a>.</td></tr></table></div><div class="paragraph"><p>Stardog Server&#8217;s behavior can be configured via the JVM arg <code>stardog.home</code>, which sets Stardog Home, overriding the value of <code>STARDOG_HOME</code> set as an environment variable. Stardog Server&#8217;s behavior can also be configured via a <code>stardog.properties</code>—which is a Java Properties file—file in <code>STARDOG_HOME</code>. To change the behavior of a running Stardog Server, it is necessary to restart it.</p></div><div class="sect3"><h4 id="_configuring_temporary_scratch_space"><a class="link" href="#_configuring_temporary_scratch_space">Configuring Temporary ("Scratch") Space</a></h4><div class="paragraph"><p>Stardog uses the value of the JVM argument <code>java.io.tmpdir</code> to write temporary files for many different operations. If you want to configure temp space to use a particular disk volume or partition, use the <code>java.io.tmpdir</code> JVM argument on Stardog startup.</p></div><div class="paragraph"><p>Bad (or at least very weird) things are guaranteed to happen if this part of the filesystem runs out of (or even very low on) free disk space. Stardog will delete temporary files when they&#8217;re no longer needed. But Stardog admins should configure their monitoring systems to make sure that free disk space is always available, both on <code>java.io.tmpdir</code> and on the disk volume that hosts <code>STARDOG_HOME</code>.<span class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnote_11" title="View footnote.">11</a>]</span></p></div></div><div class="sect3"><h4 id="_stardog_configuration"><a class="link" href="#_stardog_configuration">Stardog Configuration</a></h4><div class="paragraph"><p>The following twiddly knobs for Stardog Server are available in <code>stardog.properties</code>:<span class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnote_12" title="View footnote.">12</a>]</span></p></div><div class="olist arabic"><ol class="arabic"><li><p><code>query.all.graphs</code>: Controls what data Stardog Server evaluates queries against; if <code>true</code>, it will query over the default graph and the union of all named graphs; if <code>false</code> (the default), it will query only over the default graph.</p></li><li><p><code>query.timeout</code>: Sets the upper bound for query execution time that&#8217;s inherited by all databases unless explicitly overriden. See <a href="#Managing Queries">[Managing Queries]</a> section below for details.</p></li><li><p><code>logging.[access,audit].[enabled,type,file]</code>: Controls whether and how Stardog logs server events; described in detail below.</p></li><li><p><code>logging.slow_query.enabled</code>, <code>logging.slow_query.time</code>, <code>logging.slow_query.type</code>: The three slow query logging options are used in the following way. To enable logging of slow queries, set <code>enabled</code> to <code>true</code>. To define what counts as a "slow" query, set <code>time</code> to a time duration value (positive integer plus "h", "m", "s", or "ms" for hours, minutes, seconds, or milliseconds respectively). To determine the type of logging, set <code>type</code> to <code>text</code> (the default) or <code>binary</code>. Note that a <code>logging.slow_query.time</code> that exceeds the value of <code>query.timeout</code> will result in empty log entries.**</p></li><li><p><code>http.max.request.parameters</code>: Default is 1024; any value smaller than <code>Integer.MAX_VALUE</code> may be provided. Useful if you have lots of named graphs and are at risk of blowing out the value of <code>http.max.request.parameters</code>.</p></li><li><p><code>database.connection.timeout</code>: The amount of time a connection to the database can be open, but inactive, before being automatically closed to reclaim the resources. The timeout values specified in the property file should be a positive integer followed by either letter <code>h</code> (for hours), letter <code>m</code> (for minutes), letter <code>s</code> (for seconds), or letters <code>ms</code> (for milliseconds). Example intervals: <code>1h</code> for 1 hour, <code>5m</code> for 5 minutes, <code>90s</code> for 90 seconds, <code>500ms</code> for 500 milliseconds. Default value is <code>1h</code>. <strong>NOTE: setting a very short timeout can have adverse results specially if updates are being performed without commit changes to the server, closing the connection prematurely while using it.</strong></p></li><li><p><code>password.length.min</code>: Sets the password policy for the minimum length of user passwords, the value can&#8217;t be lower than <code>password.length.min</code> or greater than <code>password.length.max</code>. Default: <code>4</code>.</p></li><li><p><code>password.length.max</code>: Sets the password policy for the maximum length of user passwords. Default: <code>1024</code>.</p></li><li><p><code>password.regex</code>: Sets the password policy of accepted chars in user passwords, via a Java regular expression. Default: <code>[\\w@#$%]+</code></p></li><li><p><code>security.named.graphs</code>: Sets named graph security on globally. Default: <code>false</code>.</p></li><li><p><code>spatial.use.jts</code>: Enabled support for JTS in the geospatial module. Default: <code>false</code></p></li></ol></div></div></div><div class="sect2"><h3 id="_starting_stopping_the_server"><a class="link" href="#_starting_stopping_the_server">Starting &amp; Stopping the Server</a></h3><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Unlike the other <code>stardog-admin</code> subcommands, starting the server may only be run locally, i.e., on the same machine the Stardog Server is will run on.</td></tr></table></div><div class="paragraph"><p>The simplest way to start the server—running on the default port, detaching to run as a daemon, and writing <code>stardog.log</code> to the current working directory— is</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin server start</code></pre></div></div><div class="paragraph"><p>To specify parameters:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin server start --require-ssl --port=8080</code></pre></div></div><div class="paragraph"><p>The port can be specified using the property <code>--port</code>. The HTTP interface can be disabled by using the flag <code>--no-http</code> and the SNARL interface via <code>--no-snarl</code>.</p></div><div class="paragraph"><p>To shut the server down:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin server stop</code></pre></div></div><div class="paragraph"><p>If you started Stardog on a port other than the default, or want to shut down a remote server, you can simply use the <code>--server</code> option to specify the location of the server to shutdown.</p></div><div class="paragraph"><p>By default Stardog will bind it&#8217;s server to <code>0.0.0.0</code>. You can specify a different network interface for Stardog to bind to using the <code>--bind</code> property of <code>server start</code>.</p></div></div><div class="sect2"><h3 id="_server_monitoring_with_watchdog_jmx"><a class="link" href="#_server_monitoring_with_watchdog_jmx">Server Monitoring with Watchdog &amp; JMX</a></h3><div class="paragraph"><p>Stardog&#8217;s JMX implementation is called Watchdog. In addition to providing some basic JVM information, Watchdog also exports information about the Stardog DBMS configuration as well as stats for all of the databases within the system, such as the total number of open connections, size, and average query time.</p></div><div class="sect3"><h4 id="_accessing_watchdog"><a class="link" href="#_accessing_watchdog">Accessing Watchdog</a></h4><div class="paragraph"><p>To access Watchdog, you can simply use a tool like VisualVM or JConsole to attach to the process running the JVM, or connect directly to the JMX server. You can also access information from Watchdog in the web console for the database, or by performing a <code>GET</code> on <code>/watchdog</code> which will return a simple JSON object containing the information available via JMX.</p></div></div><div class="sect3"><h4 id="_configuring_watchdog"><a class="link" href="#_configuring_watchdog">Configuring Watchdog</a></h4><div class="paragraph"><p>By default, Watchdog will bind an RMI server for remote access on port <code>5833</code>. If you want to change which port Watchdog binds the remote server to, you can set the property <code>watchdog.port</code> via <code>stardog.properties</code>. If you wish to disable remote access to JMX, you can set <code>watchdog.remote.access</code> to <code>false</code> in <code>stardog.properties</code>. Finally, if you wish to disable Watchdog completely, set <code>watchdog.enabled</code> to <code>false</code> in <code>stardog.properties</code>.</p></div></div></div><div class="sect2"><h3 id="_locking_stardog_home"><a class="link" href="#_locking_stardog_home">Locking Stardog Home</a></h3><div class="paragraph"><p>Stardog Server will lock <code>STARDOG_HOME</code> when it starts to prevent synchronization errors and other nasties if you start more than one Stardog Server with the same <code>STARDOG_HOME</code>. If you need to run more than one Stardog Server instance, choose a different <code>STARDOG_HOME</code> or pass a different value to <code>--home</code>.</p></div></div><div class="sect2"><h3 id="_access_audit_logging"><a class="link" href="#_access_audit_logging">Access &amp; Audit Logging</a></h3><div class="paragraph"><p>See the exemplar <a href="https://github.com/Complexible/stardog-examples/blob/master/config/stardog.properties"><code>stardog.properties</code></a> file for a complete discussion of how access and audit logging work in Stardog Server. Basically, audit logging is a superset of the events in access logging. Access logging covers the most often required logging events; you should consider enabling audit logging if you really need to log <strong>every</strong> server event. Logging generally doesn&#8217;t have much impact on performance; but the safest way to insure that impact is negligible is to log to a separate disk (or to a centralized logging server, etc.).</p></div><div class="paragraph"><p>The important configuration choices are whether logs should be binary or plain text (both based on ProtocolBuffer message formats); the type of logging (audit or access); the logging location (which may be "off disk" or even "off machine") Logging to a centralized logging facility requires a Java plugin that implements the Stardog Server logging interface; see <a href="#_java_programming">Java Programming</a> for more information; and the log rotation policy (file size or time).</p></div><div class="paragraph"><p>Slow query logging is also available. See the <a href="#_managing_running_queries">Managing Running Queries</a> section below.</p></div></div></div></div><div class="sect1"><h2 id="_database_admin"><a class="link" href="#_database_admin">Database Admin</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog is a multi-tenancy system and will happily provide access to multiple, distinct databases.</p></div><div class="sect2"><h3 id="_configuring_a_database"><a class="link" href="#_configuring_a_database">Configuring a Database</a></h3><div class="paragraph"><p>To administer a Stardog database, some config options must be set at creation time; others may be changed subsequently and some may never be changed. All of the config options have sensible defaults (except, obviously, for the database name), so you don&#8217;t have to twiddle any of the knobs till you really need to.</p></div><div class="paragraph"><p>To configure a database, use the <code>metadata-get</code> and <code>metadata-set</code> CLI commands. See <a href="#_man_pages">Man Pages</a> for the details.</p></div></div><div class="sect2"><h3 id="_configuration_options"><a class="link" href="#_configuration_options">Configuration Options</a></h3><table class="tableblock frame-all grid-all spread"><caption class="title">1. Table of Configuration Options</caption><colgroup><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Option</th><th class="tableblock halign-left valign-top">Mutable</th><th class="tableblock halign-left valign-top">Default</th><th class="tableblock halign-left valign-top">API</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>database.archetypes</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#ARCHETYPES">DatabaseOptions.ARCHETYPES</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">The name of one or more database archetypes.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>database.connection.timeout</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>1h</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#CONNECTION_TIMEOUT">DatabaseOptions.CONNECTION_TIMEOUT</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Same as <code>database.connection.timeout</code> described in <a href="#_stardog_configuration">Stardog Configuration</a> but applies only to one database.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>database.name</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#NAME">DatabaseOptions.NAME</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">A database name, the legal value of which is is given by the regular expression <code>[A-Za-z]{1}[A-Za-z0-9_-]</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>database.namespaces</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>rdf, rdfs, xsd, owl, stardog</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#NAMESPACES">DatabaseOptions.NAMESPACES</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Sets the default namespaces for new databases.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>database.online</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#ONLINE">DatabaseOptions.ONLINE</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">The status of the database: online or offline. It may be set so that the database is created initially in online or offline status; subsequently, it can&#8217;t be set directly but only by using the relevant admin commands.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>docs.default.rdf.extractors</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>tika</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/docs/StardocsOptions.html#DOCS_DEFAULT_RDF_EXTRACTORS">StardocsOptions.DOCS_DEFAULT_RDF_EXTRACTORS</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Comma-separated list of names of RDF extractors to use when processing documents when no RDF extractor names are given.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>docs.default.text.extractors</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>tika</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/docs/StardocsOptions.html#DOCS_DEFAULT_TEXT_EXTRACTORS">StardocsOptions.DOCS_DEFAULT_TEXT_EXTRACTORS</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Comma-separated list of names of text extractors to use when processing documents when no text extractor names are given.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>docs.filesystem.uri</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="file:///" class="bare">file:///</a></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/docs/StardocsOptions.html#DOCS_FILESYSTEM_URI">StardocsOptions.DOCS_FILESYSTEM_URI</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">A URI indicating which <code>FileSystem</code> provider to use for document storage. In addition to local storage (<code><a href="file:///" class="bare">file:///</a></code>), documents can be stored on Amazon S3 (<code>s3:///</code>) or document storage can be disabled altogether (<code>none</code>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>docs.path</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>docs/</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/docs/StardocsOptions.html#DOCS_PATH">StardocsOptions.DOCS_PATH</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">The path under which documents will be stored. A relative path is relative to the database directory. S3 storage should specify an absolute path with the bucket name as the first component of the path.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>icv.active.graphs</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/icv/ICVOptions.html#ICV_ACTIVE_GRAPHS">ICVOptions.ICV_ACTIVE_GRAPHS</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Specifies which part of the database, in terms of named graphs, is checked with IC validation. Set to <code>tag:stardog:api:context:all</code> to validate all the named graphs in the database; otherwise, the legal value of <code>icv.active.graphs</code> is a comma-separated list of named graph identifiers.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>icv.consistency.automatic</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/icv/ICVOptions.html#ICV_CONSISTENCY_AUTOMATIC">ICVOptions.ICV_CONSISTENCY_AUTOMATIC</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enables automatic ICV consistency check as part of transactions.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>icv.enabled</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/icv/ICVOptions.html#ICV_ENABLED">ICVOptions.ICV_ENABLED</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Determines whether ICV is active for the database; if true, all database mutations are subject to IC validation (i.e., "guard mode").</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>icv.reasoning.enabled</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/icv/ICVOptions.html#ICV_REASONING_ENABLED">ICVOptions.ICV_REASONING_ENABLED</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Determines if reasoning is used during IC validation.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>index.differential.enable.limit</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>500,000</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/index/IndexOptions.html#DIFF_INDEX_MIN_LIMIT">IndexOptions.DIFF_INDEX_MIN_LIMIT</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Sets the minimum size of the Stardog database before differential indexes are used. The legal value is an integer.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>index.differential.merge.limit</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>20,000</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/index/IndexOptions.html#DIFF_INDEX_MAX_LIMIT">IndexOptions.DIFF_INDEX_MAX_LIMIT</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Sets the size in number of RDF triples before the differential indexes are merged to the main indexes. The legal value is an integer.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>index.literals.canonical</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/index/IndexOptions.html#CANONICAL_LITERALS">IndexOptions.CANONICAL_LITERALS</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enables RDF literal canonicalization.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>index.named.graphs</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/index/IndexOptions.html#INDEX_NAMED_GRAPHS">IndexOptions.INDEX_NAMED_GRAPHS</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enables optimized index support for named graphs; speeds SPARQL query evaluation with named graphs at the cost of some overhead for database loading and index maintenance.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>index.persist</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/index/IndexOptions.html#PERSIST">IndexOptions.PERSIST</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enables persistence for memory index. Without this option memory index data will be lost after a restart. This option has no effect for a disk index as they are always persisted.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>index.persist.sync</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/index/IndexOptions.html#SYNC">IndexOptions.SYNC</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Determines whether memory indexes are synchronously or asynchronously persisted to disk with respect to a transaction.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>index.statistics.update.automatic</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/index/IndexOptions.html#AUTO_STATS_UPDATE">IndexOptions.AUTO_STATS_UPDATE</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Determines whether statistics are maintained automatically.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>index.type</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>disk</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/index/IndexOptions.html#INDEX_TYPE">IndexOptions.INDEX_TYPE</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">The legal value of <code>index.type</code> is the string "disk" or "memory" (case-insensitive).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>preserve.bnode.ids</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#PRESERVE_BNODE_IDS">DatabaseOptions.PRESERVE_BNODE_IDS</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Determines how the Stardog parser handles bnode identifiers that may be present in RDF input. If this property is enabled (i.e., <code>TRUE</code>), parsing and data loading performance are improved; but the other effect is that if distinct input files use (randomly or intentionally) the same bnode identifier, that bnode will point to one and the same node in the database. If you have input files that use explicit bnode identifiers, and multiple files may use the same bnode identifiers, and you don&#8217;t want those bnodes to be smushed into a single node in the database, then this configuration option should be disabled (set to <code>FALSE</code>).</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>query.all.graphs</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#QUERY_ALL_GRAPHS">DatabaseOptions.QUERY_ALL_GRAPHS</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Determines what data the database evaluates queries against; if <code>true</code>, it will query over the default graph and the union of all named graphs; if <code>false</code> (the default), it will query only over the default graph. This database option overrides any global server settings.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>query.plan.reuse</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Always</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#QUERY_PLAN_REUSE">DatabaseOptions.QUERY_PLAN_REUSE</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Option for configuring how Stardog will reuse query plans. Stardog answers queries by first generating an execution plan. Generating an optimal query plan is hard and time-consuming so these plans are cached and reused for structurally equivalent queries; i.e. queries such that one can be transformed into another by replacing constants. This option determines the conditions under which a cached plan will be reused. See <a href="/java/snarl/com/complexible/stardog/QueryPlanReuse.html">QueryPlanReuse</a> for the available values.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>query.timeout</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#QUERY_TIMEOUT">DatabaseOptions.QUERY_TIMEOUT</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Determines max execution time for query evaluation.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>reasoning.consistency.automatic</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/reasoning/ReasoningOptions.html#CONSISTENCY_AUTOMATIC">ReasoningOptions.CONSISTENCY_AUTOMATIC</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enables automatic consistency checking with respect to a transaction.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>reasoning.punning.enabled</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/reasoning/ReasoningOptions.html#PUNNING_ENABLED">ReasoningOptions.PUNNING_ENABLED</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enables punning.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>reasoning.schema.graphs</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/reasoning/ReasoningOptions.html#SCHEMA_GRAPHS">ReasoningOptions.SCHEMA_GRAPHS</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Determines which, if any, named graph or graphs contains the "TBox", i.e., the schema part of the data. The legal value is a comma-separated list of named graph identifiers, including (optionally) the special names, <code>tag:stardog:api:context:default</code> and <code>tag:stardog:api:context:all</code>, which represent the default graph and the union of all named graphs and the default graph, respectively. In the context of database configurations only, Stardog will recognize <code>default</code> and <code>*</code> as short forms of those URIs, respectively.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>reasoning.type</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SL</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Specifies the reasoning type associated with the database; legal values are <code>SL</code>, <code>RL</code>, <code>QL</code>, <code>EL</code>, <code>DL</code>, <code>RDFS</code>, and <code>NONE</code>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>reasoning.approximate</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/reasoning/ReasoningOptions.html#SCHEMA_GRAPHS">ReasoningOptions.APPROXIMATE</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enables approximate reasoning. With this flag enabled Stardog will approximate an axiom that is outside the profile Stardog supports and normally ignored. For example, an equivalent class axiom might be split into two subclass axioms and only one subclass axiom is used.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>search.enabled</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/search/SearchOptions.html#SEARCHABLE">SearchOptions.SEARCHABLE</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enables semantic search for the database.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>search.reindex.mode</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>sync</code></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Determines how search indexes are maintained. The legal value of <code>search.reindex.mode</code> is one of the strings <code>sync</code> or <code>async</code> (case insensitive) or a legal <a href="http://www.quartz-scheduler.org/documentation/quartz-2.1.x/tutorials/crontrigger">Quartz cron expression</a>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>search.wildcard.search.enabled</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/search/SearchOptions.html#LEADING_WILDCARD_SEARCH_ENABLED">SearchOptions.LEADING_WILDCARD_SEARCH_ENABLED</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enable support in Lucene for searches with leading wildcards.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>search.default.limit</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/search/SearchOptions.html#SEARCH_DEFAULT_LIMIT">SearchOptions.SEARCH_DEFAULT_LIMIT</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Specify the default limit on the number of results returned from a full-text search</p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">When <code>transaction.logging</code> is <code>true</code>, it determines whether the rotated log will be deleted or kept in disk.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>spatial.enabled</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/spatial/GeospatialOptions.html#SPATIAL_ENABLED">GeospatialOptions.SPATIAL_ENABLED</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enables geospatial search for the database.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>spatial.precision</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/spatial/GeospatialOptions.html#SPATIAL_PRECISION">GeospatialOptions.SPATIAL_PRECISION</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Specifies the precision used for the indexing of geospatial data. The smaller the value, the less precision.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>strict.parsing</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#STRICT_PARSING">DatabaseOptions.STRICT_PARSING</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Controls whether Stardog parses RDF strictly (<code>true</code>, the default) or loosely (<code>false</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>transaction.isolation</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SNAPSHOT</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#TRANSACTION_ISOLATION">DatabaseOptions.TRANSACTION_ISOLATION</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Configures isolation level for transactions; legal values are SNAPSHOT and SERIALIZABLE.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>transaction.logging</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#TRANSACTION_LOGGING">DatabaseOptions.TRANSACTION_LOGGING</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Enables logged transactions. Logged transactions are activated by default in Cluster mode.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>transaction.logging.rotation.size</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>524288000</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#TRANSACTION_LOGGING">DatabaseOptions.TRANSACTION_LOGGING_ROTATION_SIZE</a></p></td></tr><tr><td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">When <code>transaction.logging</code> is <code>true</code>, it determines the size (in bytes) at which the transaction log will be rotated. Default is 500 MB.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>transaction.logging.rotation.remove</strong></code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/java/snarl/com/complexible/stardog/db/DatabaseOptions.html#TRANSACTION_LOGGING">DatabaseOptions.TRANSACTION_LOGGING_ROTATION_REMOVE</a></p></td></tr></tbody></table><div class="sect3"><h4 id="_a_note_about_database_status"><a class="link" href="#_a_note_about_database_status">A Note About Database Status</a></h4><div class="paragraph"><p>A database must be set to <code>offline</code> status before most configuration parameters may be changed. Hence, the normal routine is to set the database offline, change the parameters, and then set the database to online. All of these operations may be done programmatically from CLI tools, such that they can be scripted in advance to minimize downtime. In a future version, we will allow some properties to be set while the database remains online.</p></div></div></div><div class="sect2"><h3 id="_managing_database_status"><a class="link" href="#_managing_database_status">Managing Database Status</a></h3><div class="paragraph"><p>Databases are either online or offline; this allows database maintenance to be decoupled from server maintenance.</p></div><div class="sect3"><h4 id="_online_and_offline"><a class="link" href="#_online_and_offline">Online and Offline</a></h4><div class="paragraph"><p>Databases are put online or offline synchronously: these operations block until other database activity is completed or terminated. See <code>stardog-admin help db</code> for details.</p></div></div><div class="sect3"><h4 id="_examples"><a class="link" href="#_examples">Examples</a></h4><div class="paragraph"><p>To set a database from offline to online:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db offline myDatabase</code></pre></div></div><div class="paragraph"><p>To set the database online:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db online myDatabase</code></pre></div></div><div class="paragraph"><p>If Stardog Server is shutdown while a database is offline, the database will be offline when the server restarts.</p></div></div></div><div class="sect2"><h3 id="_creating_a_database"><a class="link" href="#_creating_a_database">Creating a Database</a></h3><div class="paragraph"><p>Stardog databases may be created locally or remotely; but, of course, performance is better if data files don&#8217;t have to be transferred over a network during creation and initial loading. See the section below about loading compressed data. All data files, indexes, and server metadata for the new database will be stored in Stardog Home. Stardog won&#8217;t create a database with the same name as an existing database. Stardog database names must conform to the regular expression, <code>[A-Za-z]{1}[A-Za-z0-9_-]</code>.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">There are four reserved words that may not be used for the names of Stardog databases: <code>system</code>, <code>admin</code>, <code>watchdog</code>, and <code>docs</code>.</td></tr></table></div><div class="paragraph"><p>Minimally, the only thing you must know to create a Stardog database is a database <strong>name</strong>; alternately, you may customize some other database parameters and options depending on anticipated workloads, data modeling, and other factors.</p></div><div class="paragraph"><p>See <code>stardog-admin help db create</code> for all the details including examples.</p></div></div><div class="sect2"><h3 id="_database_archetypes"><a class="link" href="#_database_archetypes">Database Archetypes</a></h3><div class="paragraph"><p>Stardog database archetypes are a new feature in 2.0. A database archetype is a named, vendor-defined or user-defined bundle of data and functionality to be applied at database-creation time. Archetypes are primarily for supporting various data standards or tool chain configurations in a simple way.</p></div><div class="paragraph"><p>For example, the SKOS standard from W3C defines an OWL vocabulary for building taxonomies, thesauruses, etc. SKOS is made up by a vocabulary, some constraints, some kinds of reasoning, and (typically) some SPARQL queries. If you are developing an app that uses SKOS, without Stardog&#8217;s SKOS archetype, you are responsible for assembling all that SKOS stuff yourself. Which is tedious, error-prone, and not very rewarding&#8212;&#8203;even when it&#8217;s done right the first time.</p></div><div class="paragraph"><p>Rather than putting that burden on Stardog users, we&#8217;ve created database archetypes as a mechanism to collect these "bundles of stuff" which, as a developer, you can then simply attach to a particular database.</p></div><div class="paragraph"><p>The last point to make is that archetypes are composable: you can mix-and-match them at database creation time as needed.</p></div><div class="paragraph"><p>Stardog supports two database archetypes out-of-the-box: <a href="http://www.w3.org/TR/prov-overview/">PROV</a> and <a href="http://www.w3.org/2004/02/skos/">SKOS</a>.</p></div><div class="sect3"><h4 id="_skos_archetype"><a class="link" href="#_skos_archetype">SKOS Archetype</a></h4><div class="paragraph"><p>The SKOS archetype is for databases that will contain SKOS data, and includes the SKOS schema, SKOS constraints using Stardog&#8217;s Integrity Constraint Validation, and some namespace-prefix bindings.</p></div></div><div class="sect3"><h4 id="_prov_archetype"><a class="link" href="#_prov_archetype">PROV Archetype</a></h4><div class="paragraph"><p>The PROV archetype is for databases that will contain PROV data, and includes the SKOS schema, SKOS constraints using Stardog&#8217;s Integrity Constraint Validation, and some namespace-prefix bindings.</p></div><div class="paragraph"><p>Archetypes are composable, so you can use more of them and they are intended to be used alongside <strong>your domain data</strong>, which may include as many other schemas, ontologies, etc. as are required.</p></div></div><div class="sect3"><h4 id="_user_defined_archetypes"><a class="link" href="#_user_defined_archetypes">User-defined Archetypes</a></h4><div class="paragraph"><p>Please see the <a href="https://github.com/Complexible/stardog-examples/blob/master/examples/foaf/readme.md">Stardog Examples repository</a> on Github for an example that shows how to create your own Stardog archetype.</p></div></div></div><div class="sect2"><h3 id="_database_creation_templates"><a class="link" href="#_database_creation_templates">Database Creation Templates</a></h3><div class="paragraph"><p>As a boon to the overworked admin or devops peeps, Stardog Server supports database creation templates: you can pass a Java Properties file with config values set and with the values (typically just the database name) that are unique to a specific database passed in CLI parameters.</p></div><div class="sect3"><h4 id="_examples_2"><a class="link" href="#_examples_2">Examples</a></h4><div class="paragraph"><p>To create a new database with the default options by simply providing a name and a set of initial datasets to load:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db create -n myDb input.ttl another_file.rdf moredata.rdf.gz</code></pre></div></div><div class="paragraph"><p>Datasets can be loaded later as well. To create (in this case, an empty) database from a template file:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db create -c database.properties</code></pre></div></div><div class="paragraph"><p>At a minimum, the configuration file must have a value for <code>database.name</code> option.</p></div><div class="paragraph"><p>If you only want to change only a few configuration options you can directly provide the values for these options in the CLI args as follows:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db create -n db -o icv.enabled=true icv.reasoning.enabled=true -- input.ttl</code></pre></div></div><div class="paragraph"><p>Note that &#8220;--&#8221; is used in this case when &#8220;-o&#8221; is the last option to delimit the value for &#8220;-o&#8221; from the files to be bulk loaded.</p></div><div class="paragraph"><p>Please refer to the CLI help for more details of the <code>db create</code> command.</p></div></div></div><div class="sect2"><h3 id="_database_create_options"><a class="link" href="#_database_create_options">Database Create Options</a></h3><table class="tableblock frame-all grid-all spread"><caption class="title">2. Table of Options for Stardog&#8217;s <code>create</code> command</caption><colgroup><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Name</th><th class="tableblock halign-left valign-top">Description</th><th class="tableblock halign-left valign-top">Arg values</th><th class="tableblock halign-left valign-top">Default</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>--name</code>, <code>-n</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Required, the name of the database to create</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>--copy-server-side</code>,</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Flag to specify whether or not bulk loaded files should be first copied to the server</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>--type</code>, <code>-t</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the kind of database indexes: memory or disk</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>M</code>, <code>D</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">disk</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>--index-triples-only</code>, <code>-i</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the database&#8217;s indexes should be optimized for RDF triples only</p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td></tr></tbody></table></div><div class="sect2"><h3 id="_repairing_a_database"><a class="link" href="#_repairing_a_database">Repairing a Database</a></h3><div class="paragraph"><p>If an I/O error or an index exception occurs while querying a DB, the DB might be corrupted and repaired with the repair command. If the errors occur during executing admin commands, then the system DB might have been corrupted. System database corruptions can also cause other problems including authorization errors.</p></div><div class="paragraph"><p>This command needs exclusive access to your Stardog home directory and therefore requires the Stardog Server not to be running. This also means that the command can only be run on the machine where the Stardog home directory is located, and you will not be able to start the Stardog Server while this command is running.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">The repair process can take considerable time for large databases.</td></tr></table></div><div class="paragraph"><p>If the built-in Stardog system database is corrupted, then you can use the database name <code>system</code> as the repair argument. To repair the database myDB:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db repair myDB</code></pre></div></div><div class="paragraph"><p>To repair the system database:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db repair system</code></pre></div></div></div><div class="sect2"><h3 id="_backing_up_and_restoring"><a class="link" href="#_backing_up_and_restoring">Backing Up and Restoring</a></h3><div class="paragraph"><p>Stardog includes both physical and logical backup utilities; logical backups are accomplished using the <code>export</code> CLI command. Physical backups and restores are accomplished using <code>stardog-admin db backup</code> and <code>stardog-admin db restore</code> commands, respectively.</p></div><div class="paragraph"><p>These tools perform physical backups, including database metadata, rather than logical backups via some RDF serialization. They are <strong>native</strong> Stardog backups and can only be restored with Stardog tools. Backup may be accomplished while a database is online; backup is performed in a read transaction: reads and writes may continue, but writes performed during the backup are not reflected in the backup.</p></div><div class="paragraph"><p>See the man pages for <a href="/man/db-backup.html"><code>backup</code></a> and <a href="/man/db-restore.html"><code>restore</code></a> for details.</p></div><div class="sect3"><h4 id="_backup"><a class="link" href="#_backup">Backup</a></h4><div class="paragraph"><p><code>stardog-admin db backup</code> assumes a default location for its output, namely, <code>$STARDOG_HOME/.backup</code>; that default may be overriden by passing a <code>-t</code> or <code>--to</code> argument. Backup sets are stored in the backup directory by database name and then in date-versioned subdirectories for each backup volume. Of course you can use a variety of OS-specific options to accomplish remote backups over some network or data protocol; those options are left as an exercise for the admin.</p></div><div class="paragraph"><p>To backup a Stardog database called <code>foobar</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db backup foobar</code></pre></div></div><div class="paragraph"><p>To perform a remote backup, for example, pass in a specific directory that may be mounted in the current OS namespace via some network protocol, thus:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db backup --to /my/network/share/stardog-backups foobar</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Stardog&#8217;s backup/restore approach is optimized for minimizing the amount of time it takes to backup a database; the tradeoff is with restore performance.</td></tr></table></div></div><div class="sect3"><h4 id="_restore"><a class="link" href="#_restore">Restore</a></h4><div class="paragraph"><p>To restore a Stardog database from a Stardog backup volume, simply pass a fully-qualified path to the volume in question. The location of the backup should be the full path to the backup, not the location of the backup directory as specified in your Stardog configuration. There is no need to specify the name of the database to restore.</p></div><div class="paragraph"><p>To restore a database from its backup:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db restore $STARDOG_HOME/.backups/myDb/2012-06-21</code></pre></div></div><div class="sect4"><h5 id="_one_time_database_migrations_for_backup"><a class="link" href="#_one_time_database_migrations_for_backup">One-time Database Migrations for Backup</a></h5><div class="paragraph"><p>The backup system cannot directly backup databases created in versions before 2.1. These databases must be explicitly migrated in order to use the new backup system; this is a one-time operation per database and is accomplished by running</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db migrate foobar</code></pre></div></div><div class="paragraph"><p>in order to migrate a database called <code>foobar</code>. Again, this is a one-time operation only and all databases created with 2.1 (or later) do not require it.</p></div></div></div></div><div class="sect2"><h3 id="_namespace_prefix_bindings"><a class="link" href="#_namespace_prefix_bindings">Namespace Prefix Bindings</a></h3><div class="paragraph"><p>SPARQL queries can be verbose; but at least the <code>PREFIX</code> declarations in the prologue of each query are easy to screw up! Stardog allows database administrators to persist and manage custom namespace prefix bindings:</p></div><div class="olist arabic"><ol class="arabic"><li><p>At database creation time, if data is loaded to the database that contains namespace prefixes, then those are persisted for the life of the database. Any subsequent queries to the database may simply omit the <code>PREFIX</code> declarations:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog query myDB "select * {?s rdf:type owl:Class}"</code></pre></div></div></li><li><p>To add new bindings, use the <code>namespace</code> subcommand in the CLI:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog namespace add myDb --prefix ex --uri 'http://example.org/test#'</code></pre></div></div></li><li><p>To modify an existing binding, delete the existing one and then add a new one:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog namespace remove myDb --prefix ex</code></pre></div></div></li><li><p>Finally, to see all of the existing namespace prefix bindings:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog namespace list myDB</code></pre></div></div></li></ol></div><div class="paragraph"><p>If no files are used during database creation, or if the files do not define any prefixes (e.g. NTriples), then the "Big Four" default prefixes are stored: <code>RDF, RDFS, XSD</code>, and <code>OWL</code>.</p></div><div class="paragraph"><p>When executing queries in the CLI, the default table format for SPARQL <code>SELECT</code> results will use the bindings as qnames. SPARQL <code>CONSTRUCT</code> query output (including export) will also use the stored prefixes. To reiterate, namespace prefix bindings are <strong>per database</strong>, not global.</p></div></div><div class="sect2"><h3 id="_index_strategies"><a class="link" href="#_index_strategies">Index Strategies</a></h3><div class="paragraph"><p>By default Stardog builds extra indexes for named graphs. These additional indexes are used when SPARQL queries specify datasets using <code>FROM</code> and <code>FROM NAMED</code>. With these additional indexes, better statistics about named graphs are also computed.</p></div><div class="paragraph"><p>Stardog may also be configured to create and to use fewer indexes, if the database is only going to be used to store RDF triples&#8212;&#8203;that is to say, if the database will not be used to store named graph information. In this mode, Stardog will maintain fewer indexes, which will result in faster database creation and faster updates without compromising query answering performance. In such databases, quads (that is: triples with named graphs or contexts specified) may still be added to these database at any time, but query performance may degrade in such cases.</p></div><div class="paragraph"><p>To create a database which indexes only RDF triples, set the option <code>index.named.graphs</code> to <code>false</code> at database creation time. The CLI provides a shorthand option, <code>-i</code> or <code>--index-triples-only</code>, which is equivalent.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">This option can only be set at database creation time and cannot be changed later without rebuilding the database; use this option with care.</td></tr></table></div></div><div class="sect2"><h3 id="_differential_indexes"><a class="link" href="#_differential_indexes">Differential Indexes</a></h3><div class="paragraph"><p>While Stardog is generally biased in favor of read performance, write performance is also important in many applications. In order to increase write performance, Stardog may be used, optionally, with a <strong>differential index</strong>.</p></div><div class="paragraph"><p>Stardog&#8217;s differential index is used to persist additions and removals separately from the main indexes, such that updates to the database can be performed faster. Query answering takes into consideration all the data stored in the main indexes and the differential index; hence, query answers are computed as if all the data is stored in the main indexes.</p></div><div class="paragraph"><p>There is a slight overhead for query answering with differential indexes if the differential index size gets too large. For this reason, the differential index is merged into the main indexes when its size reaches <code>index.differential.merge.limit</code>. There is also no benefit of differential indexes if the main index itself is small. For this reason, the differential index is not used until the main index size reaches <code>index.differential.enable.limit</code>.</p></div><div class="paragraph"><p>In most cases, the default values of the differential index parameters will work fine and doesn&#8217;t need to be changed. The corollary is that you shouldn&#8217;t change this value in a production system till you&#8217;ve tested the effects of a change in a non-production system.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Increasing <code>index.differential.merge.limit</code> will improve the throughput for updates, but there will be longer pauses when the differential index is being merged. Reducing the value of <code>index.differential.merge.limit</code> will make sure there are no long pauses but overall throughput will suffer. The optimal value depends on the average size of a transaction for the application and the frequency of updates.</td></tr></table></div></div><div class="sect2"><h3 id="_loading_compressed_data"><a class="link" href="#_loading_compressed_data">Loading Compressed Data</a></h3><div class="paragraph"><p>Stardog supports loading data from compressed files directly: there&#8217;s no need to uncompress files before loading. Loading compressed data is the recommended way to load large input files. Stardog supports GZIP, BZIP2 and ZIP compressions natively.</p></div><div class="sect3"><h4 id="_gzip_and_bzip2"><a class="link" href="#_gzip_and_bzip2">GZIP and BZIP2</a></h4><div class="paragraph"><p>A file passed to <code>create</code> will be treated as compressed if the file name ends with <code>.gz</code> or <code>.bz2</code>. The RDF format of the file is determined by the penultimate extension. For example, if a file named <code>test.ttl.gz</code> is used as input, Stardog will perform GZIP decompression during loading and parse the file with Turtle parser. All the formats supported by Stardog (RDF/XML, Turtle, Trig, etc.) can be used with compression.</p></div></div><div class="sect3"><h4 id="_zip"><a class="link" href="#_zip">ZIP</a></h4><div class="paragraph"><p>The ZIP support works differently since zipped files can contain multiple files. When an input file name ends with <code>.zip</code>, Stardog performs ZIP decompression and tries to load all the files inside the ZIP file. The RDF format of the files inside the zip is determined by their file names as usual. If there is an unrecognized file extension (e.g. '.txt'), then that file will be skipped.</p></div></div></div><div class="sect2"><h3 id="_dropping_a_database"><a class="link" href="#_dropping_a_database">Dropping a Database</a></h3><div class="paragraph"><p>This command removes a database and all associated files and metadata. This means all files on disk pertaining to the database will be deleted, so only use <code>drop</code> when you&#8217;re certain! Databases must be offline in order to be dropped.</p></div><div class="paragraph"><p>It takes as its only argument a valid database name. For example,</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db drop my_db</code></pre></div></div></div><div class="sect2"><h3 id="_using_integrity_constraint_validation"><a class="link" href="#_using_integrity_constraint_validation">Using Integrity Constraint Validation</a></h3><div class="paragraph"><p>Stardog supports integrity constraint validation as a data quality mechanism via closed world reasoning. Constraints can be specified in OWL, SWRL, and SPARQL. Please see the <a href="#_validating_constraints">Validating Constraints</a> section for more about using ICV in Stardog.</p></div><div class="paragraph"><p>The CLI <code>icv</code> subcommand can be used to add, delete, or drop all constraints from an existing database. It may also be used to validate an existing database with constraints that are passed into the <code>icv</code> subcommand; that is, using different constraints than the ones already associated with the database.</p></div><div class="paragraph"><p>For details of ICV usage, see <code>stardog help icv</code> and <code>stardog-admin help icv</code>. For ICV in transacted mutations of Stardog databases, see the database creation section above.</p></div></div><div class="sect2"><h3 id="_migrating_a_database"><a class="link" href="#_migrating_a_database">Migrating a Database</a></h3><div class="paragraph"><p>The <code>migrate</code> subcommand migrates an older Stardog database to the latest version of Stardog. Its only argument is the name of the database to migrate. <code>migrate</code> won&#8217;t necessarily work between arbitrary Stardog version, so before upgrading check the release notes for a new version carefully to see whether migration is required or possible.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db migrate myDatabase</code></pre></div></div><div class="paragraph"><p>will update <code>myDatabase</code> to the latest database format.</p></div></div><div class="sect2"><h3 id="_getting_database_information"><a class="link" href="#_getting_database_information">Getting Database Information</a></h3><div class="paragraph"><p>You can get some information about a database by running the following command:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin metadata get my_db_name</code></pre></div></div><div class="paragraph"><p>This will return all the metadata stored about the database, including the values of configuration options used for this database instance. If you want to get the value for a specific option then you can run the following command:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin metadata get -o index.named.graphs my_db_name</code></pre></div></div></div><div class="sect2"><h3 id="_managing_stored_queries"><a class="link" href="#_managing_stored_queries">Managing Stored Queries</a></h3><div class="paragraph"><p>Stardog 4.2 added the capability to name and store SPARQL queries for future evaluation by referring to the query&#8217;s name.</p></div><div class="paragraph"><p>Queries of any type can be stored in Stardog and executed directly by using the name of the stored query. Stored queries can be shared with other users, which gives those users the ability to run those queries provided that they have appropriate permissions for a database.</p></div><div class="sect3"><h4 id="_storing_queries"><a class="link" href="#_storing_queries">Storing Queries</a></h4><div class="paragraph"><p>Queries can be stored using the <code>stored add</code> command and specifying a unique name for the stored query:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin stored add -n types "select distinct ?type {?s a ?type}"</code></pre></div></div><div class="paragraph"><p>If a file is used to specify the query string without an explicit <code>-n/--name</code> option then the name of the query file is used for the stored query:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin stored add listProperties.sparql</code></pre></div></div><div class="paragraph"><p>By default, stored queries can be executed over any database. But they can be scoped by providing a specific database name with the <code>-d/--database</code> option. Also, by default, only the user who stored the query can access that stored query. Using the <code>--shared</code> flag will allow other users to execute the stored query.</p></div><div class="paragraph"><p>The following example stores a shared query with a custom name that can be executed over only the database <code>myDb</code>:</p></div><div class="listingblock"><div class="content"><pre>$ stardog-admin stored add --shared -d myDb -n listProperties "select distinct ?p {?s ?p ?o}"</pre></div></div><div class="paragraph"><p>Stored query names must be unique for a Stardog instance. Existing stored queries can be replaced using the <code>--overwrite</code> option in the command.</p></div></div><div class="sect3"><h4 id="_running_stored_queries"><a class="link" href="#_running_stored_queries">Running Stored Queries</a></h4><div class="paragraph"><p>Stored queries can be executed using the regular query execution command by passing the name of the stored query:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog query myDb listProperties</code></pre></div></div><div class="paragraph"><p>Other commands like <code>query explain</code> also accept stored query names.</p></div></div><div class="sect3"><h4 id="_listing_stored_queries"><a class="link" href="#_listing_stored_queries">Listing Stored Queries</a></h4><div class="paragraph"><p>To see all the stored queries, use the <code>stored list</code> subcommand:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin stored list</code></pre></div></div><div class="paragraph"><p>The results are formatted tabularly:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">+--------+-----------------------------------------+
|  Name  |            Query String                 |
+--------+-----------------------------------------+
| graphs | SELECT ?graph (count(*) as ?size)       |
|        | FROM NAMED stardog:context:all          |
|        | WHERE { GRAPH ?graph {?s ?p ?o}}        |
|        | GROUP BY ?graph                         |
|        | ORDER BY desc(?size)                    |
| people | CONSTRUCT WHERE {                       |
|        |    ?person a foaf:Person ;              |
|        |            ?p ?o                        |
|        | }                                       |
| types  | SELECT DISTINCT ?type ?label            |
|        | WHERE {                                 |
|        |    ?s a ?type .                         |
|        |    OPTIONAL { ?type rdfs:label ?label } |
|        | }                                       |
+--------+-----------------------------------------+

3 stored queries</code></pre></div></div><div class="paragraph"><p>Users can only see the queries they&#8217;ve stored and the queries stored by other users that have been <code>--shared</code>. The <code>--verbose</code> option will show more details about the stored queries.</p></div></div><div class="sect3"><h4 id="_removing_stored_queries"><a class="link" href="#_removing_stored_queries">Removing Stored Queries</a></h4><div class="paragraph"><p>Stored queries can be removed using the <code>stored remove</code> command:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin stored remove storedQueryName</code></pre></div></div><div class="paragraph"><p>If you would like to clear all the stored queries then use the <code>-a/--all</code> option:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin stored remove -a</code></pre></div></div></div></div><div class="sect2"><h3 id="_managing_running_queries"><a class="link" href="#_managing_running_queries">Managing Running Queries</a></h3><div class="paragraph"><p>Stardog includes the capability to manage running queries according to configurable policies set at run-time; this capability includes support for <strong>listing</strong> running queries; <strong>deleting</strong> running queries; <strong>reading</strong> the status of a running query; <strong>killing</strong> running queries that exceed a time threshold automatically; and <strong>logging</strong> slow queries for analysis.</p></div><div class="paragraph"><p>Stardog is pre-configured with sensible <strong>server-wide</strong> defaults for query management parameters; these defaults may be overridden or disabled per database, or even per query.</p></div><div class="sect3"><h4 id="_configuring_query_management"><a class="link" href="#_configuring_query_management">Configuring Query Management</a></h4><div class="paragraph"><p>For many uses cases the default configuration will be sufficient. But you may need to tweak the timeout parameter to be longer or shorter, depending on the hardware, data load, queries, throughput, etc. The default configuration has a server-wide query timeout value of <code>query.timeout</code>, which is inherited by all the databases in the server. You can customize the server-wide timeout value and then set per-database custom values, too. Any database without a custom value inherits the server-wide value. To disable query timeout, set <code>query.timeout</code> to <code>0</code>. If individual queries need to set their own timeout, this can be done (by passing a <code>timeout</code> parameter over HTTP or using the <code>--timeout</code> flag on the CLI), but only if the <code>query.timeout.override.enabled</code> property is set to true for the database (true is the default).</p></div></div><div class="sect3"><h4 id="_listing_queries"><a class="link" href="#_listing_queries">Listing Queries</a></h4><div class="paragraph"><p>To see all running queries, use the <code>query list</code> subcommand:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin query list</code></pre></div></div><div class="paragraph"><p>The results are formatted tabularly:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">+----+----------+-------+--------------+
| ID | Database | User  | Elapsed time |
+----+----------+-------+--------------+
| 2  | test     | admin | 00:00:20.165 |
| 3  | test     | admin | 00:00:16.223 |
| 4  | test     | admin | 00:00:08.769 |
+----+----------+-------+--------------+

3 queries running</code></pre></div></div><div class="paragraph"><p>You can see which user owns the query (superuser&#8217;s can see all running queries), as well as the elapsed time and the database against which the query is running. The ID column is the key to deleting queries.</p></div></div><div class="sect3"><h4 id="_deleting_queries"><a class="link" href="#_deleting_queries">Deleting Queries</a></h4><div class="paragraph"><p>To delete a running query, simply pass its ID to the <code>query kill</code> subcommand:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin query kill 3</code></pre></div></div><div class="paragraph"><p>The output confirms the query kill completing successfully:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">Query 3 killed successfully</code></pre></div></div></div><div class="sect3"><h4 id="_automatically_killing_queries"><a class="link" href="#_automatically_killing_queries">Automatically Killing Queries</a></h4><div class="paragraph"><p>For production use, especially when a Stardog database is exposed to arbitrary query input, some of which may not execute in an acceptable time period, the automatic query killing feature is useful. It will protect a Stardog Server from queries that consume too many resources.</p></div><div class="paragraph"><p>Once the execution time of a query exceeds the value of <code>query.timeout</code>, the query will be killed automatically.<span class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnote_13" title="View footnote.">13</a>]</span> The client that submitted the query will receive an error message. The value of <code>query.timeout</code> may be overriden by setting a different value (smaller or longer) in database options. To disable, set to <code>query.timeout</code> to <code>0</code>.</p></div><div class="paragraph"><p>The value of <code>query.timeout</code> is a positive integer concatenated with a letter, interpreted as a time duration: 'h' (for hours), 'm' (for minutes), 's' (for seconds), or 'ms' (for milliseconds). For example, '1h' for 1 hour, '5m' for 5 minutes, '90s' for 90 seconds, and '500ms' for 500 milliseconds.</p></div><div class="paragraph"><p>The default value of <code>query.timeout</code> is five minutes.</p></div></div><div class="sect3"><h4 id="_query_status"><a class="link" href="#_query_status">Query Status</a></h4><div class="paragraph"><p>To see more detail about query in-flight, use the <code>query status</code> subcommand:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin query status 1</code></pre></div></div><div class="paragraph"><p>The resulting output includes query metadata, including the query itself:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">Username: admin
Database: test
Started : 2013-02-06 09:10:45 AM
Elapsed : 00:01:19.187
Query   :
select ?x ?p ?o1 ?y ?o2
   where {
     ?x ?p ?o1.
     ?y ?p ?o2.
     filter (?o1 &gt; ?o2).
    }
order by ?o1
limit 5</code></pre></div></div></div><div class="sect3"><h4 id="_slow_query_logging"><a class="link" href="#_slow_query_logging">Slow Query Logging</a></h4><div class="paragraph"><p>Stardog does not log slow queries in the default configuration because there isn&#8217;t a single value for what counts as a "slow query", which is entirely relative to queries, access patterns, dataset sizes, etc. While slow query logging has very minimal overhead, what counts as a slow query in some context may be quite acceptable in another. See <a href="#_configuring_stardog_server">Configuring Stardog Server</a> above for the details.</p></div></div><div class="sect3"><h4 id="_protocols_and_java_api"><a class="link" href="#_protocols_and_java_api">Protocols and Java API</a></h4><div class="paragraph"><p>For HTTP protocol support, see <a href="http://docs.stardog.apiary.io/">Stardog&#8217;s Apiary</a> docs.</p></div><div class="paragraph"><p>For Java, see the <a href="http://docs.stardog.com/java/snarl/">Javadocs</a>.</p></div></div><div class="sect3"><h4 id="_security_and_query_management"><a class="link" href="#_security_and_query_management">Security and Query Management</a></h4><div class="paragraph"><p>The security model for query management is very simple: any user can kill any running query submitted by that user, and a superuser can kill any running query. The same general restriction is applied to query status; you cannot see status for a query that you do not own, and a superuser can see the status of every query.</p></div></div></div><div class="sect2"><h3 id="_managing_query_performance"><a class="link" href="#_managing_query_performance">Managing Query Performance</a></h3><div class="paragraph"><p>Stardog answers queries in two major phases: determining the query plan and executing that plan to obtain answers from the data. The former is called <em>query planning</em> (or <em>query optimization</em>) and includes all steps required to select the most efficient way to execute the query. How Stardog evaluates a query can only be understood by analyzing the query plan. Query plan analysis is also the main tool for investigating performance issues as well as addressing them, in particular, by re-formulating the query to make it more amenable to optimization.</p></div><div class="sect3"><h4 id="_query_plan_syntax"><a class="link" href="#_query_plan_syntax">Query Plan Syntax</a></h4><div class="paragraph"><p>We will use the following running example to explain query plans in Stardog.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql"> SELECT DISTINCT ?person ?name
 WHERE {
   ?article rdf:type bench:Article .
   ?article dc:creator ?person .
   ?inproc rdf:type bench:Inproceedings .
   ?inproc dc:creator ?person .
   ?person foaf:name ?name
 }</code></pre></div></div><div class="paragraph"><p>This query returns the names of all people who have authored both a journal article and a paper in a conference proceedings. The query plan used by Stardog (in this example, 4.2.2) to evaluate this query is:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript"> Distinct [#812K]
 `─ Projection(?person, ?name) [#812K]
    `─ MergeJoin(?person) [#812K]
       +─ MergeJoin(?person) [#391K]
       │  +─ Sort(?person) [#391K]
       │  │  `─ MergeJoin(?article) [#391K]
       │  │     +─ Scan[POSC](?article, rdf:type, bench:Article) [#208K]
       │  │     `─ Scan[PSOC](?article, dc:creator, ?person) [#898K]
       │  `─ Scan[PSOC](?person, foaf:name, ?name) [#433K]
       `─ Sort(?person) [#503K]
          `─ MergeJoin(?inproc) [#503K]
             +─ Scan[POSC](?inproc, rdf:type, bench:Inproceedings) [#255K]
             `─ Scan[PSOC](?inproc, dc:creator, ?person) [#898K]</code></pre></div></div><div class="paragraph"><p>The plan is arranged in an hierarchical, tree-like structure. The nodes, called <em>operators</em>, represent units of data processing during evaluation. They correspond to evaluations of graphs patterns or solution modifiers as defined in <a href="https://www.w3.org/TR/sparql11-query/#sparqlDefinition">SPARQL 1.1 specification</a>. All operators can be regarded as functions which may take some data as input and produce some data as output. All input and and output data is represented as streams of <a href="https://www.w3.org/TR/sparql11-query/#sparqlSolutions">solutions</a>, that is, sets of bindings of the form <code>x &#8594; value</code> where <code>x</code> is a variable used in the query and <code>value</code> is some RDF term (IRI, blank node, or literal). Examples of operators include scans, joins, filters, unions, etc.</p></div><div class="paragraph"><p>Numbers in square brackets after each node refer to the <em>estimated</em> cardinality of the node, i.e. how many solutions Stardog expects this operator to produce when the query is evaluated. Statistics-based cardinality estimation in Stardog merits a separate blog post, but here are the key points for the purpose of reading query plans:</p></div><div class="olist arabic"><ol class="arabic"><li><p>all estimations are approximate and their accuracy can vary greatly (generally: more precise for bottom nodes, less precise for upper nodes)</p></li><li><p>estimations are only used for selecting the best plan but have no bearing on the actual results of the query</p></li><li><p>in most cases a sub-optimal plan can be explained by inaccurate estimations</p></li></ol></div></div><div class="sect3"><h4 id="_stardog_evaluation_model"><a class="link" href="#_stardog_evaluation_model">Stardog Evaluation Model</a></h4><div class="paragraph"><p>Stardog generally evaluates query plans according to the <a href="https://www.w3.org/TR/sparql11-query/#sparqlAlgebraEval">bottom-up SPARQL semantics</a>. Leaf nodes are evaluated first and without input, and their results are then sent to their parent nodes up the plan. Typical examples of leaf nodes include scans, i.e. evaluations of triple patterns, evaluations of full-text search predicates, and <a href="https://www.w3.org/TR/sparql11-query/#inline-data"><code>VALUES</code></a> operators. They contain all information required to produce output, for example, a triple pattern can be directly evaluated against Stardog indexes. Parent nodes, such as joins, unions, or filters, take solutions as inputs and send their results further towards the root of the tree. The root node in the plan, which is typically one of the <a href="https://www.w3.org/TR/sparql11-query/#solutionModifiers">solution modifiers</a>, produces the final results of the query which are then encoded and sent to the client.</p></div><div class="sect4"><h5 id="_pipelining_and_pipeline_breakers"><a class="link" href="#_pipelining_and_pipeline_breakers">Pipelining And Pipeline Breakers</a></h5><div class="paragraph"><p>Stardog implements the <a href="http://dbms-arch.wikia.com/wiki/Volcano_Model">Volcano model</a>, in which evaluation is as <em>lazy</em> as possible. Each operator does just enough work to produce the next solution. This is important for performance, especially for queries with a <code>LIMIT</code> clause (of which <code>ASK</code> queries are a special case) and also enables Stardog&#8217;s query engine to send the first result(s) as soon as they are available (as opposed to waiting till all results have been computed).</p></div><div class="paragraph"><p>Not all operators can produce output solutions as soon as they get first input solutions from their children nodes. Some need to accumulate intermediate results before sending output. Such operators are called <em>pipeline breakers</em>, and they are often the culprits for performance problems, typically resulting from memory pressure. It is important to be able to spot them in the plan since they can suggest either a way to re-formulate the query to help the planner or a way to make the query more precise by specifying extra constants where they matter.</p></div><div class="paragraph"><p>Here are some important pipeline breakers in the example plan:</p></div><div class="ulist"><ul><li><p><a href="https://en.wikipedia.org/wiki/Hash_join"><code>HashJoin</code></a> algorithms build a hash table for solutions produced by the right operand. Typically all such solutions need to be hashed, either in memory or spilled to disk, before the first output solution is produced by the <code>HashJoin</code> operator.</p></li><li><p><code>Sort</code>: the sort operator builds an intermediate <em>sorted</em> collection of solutions produced by its child node. The main use case for sorting solutions is to prepare data for an operator which can benefit from sorted inputs, such as <code>MergeJoin</code>, <code>Distinct</code>, or <code>GroupBy</code>. Of course all solutions have to be fetched from the child node before the smallest (w.r.t. the sort key) solution can be emitted.</p></li><li><p><code>GroupBy</code>: group-by operators are used for aggregation, e.g. counting or summing results. When evaluating a query like <code>select ?x (count(?y) as ?count) where { &#8230;&#8203; } group by ?x</code> Stardog has to scroll through all solutions to compute the count for every <code>?x</code> key before returning the first result.</p></li></ul></div><div class="paragraph"><p>Other operators can produce output as soon as they get input, most notably the following:</p></div><div class="ulist"><ul><li><p><code>MergeJoin</code>: merge join algorithms do a single zig-zag pass over sorted streams of solutions produced by children nodes and output a solution as soon as the join condition is satisfied.</p></li><li><p><code>DirectHashJoin</code>: contrary to the classical hash join algorithm, this operator does not build a hash table. It utilizes Stardog indexes for look-ups which doesn&#8217;t require extra data structures. This is only possible when the right operand is sorted by the join key, but the left isn&#8217;t, otherwise Stardog would use a merge join.</p></li><li><p><code>Filter</code>: a solution modifier which evaluates the filter condition on each input solution.</p></li><li><p><code>Union</code>: combines streams of children solutions without any extra work, e.g. joining, so there&#8217;s no need for intermediate results.</p></li></ul></div><div class="paragraph"><p>Now, returning to the above query, one can see <code>Sort</code> pipeline breakers in the plan:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">Sort(?person) [#391K]
`─ MergeJoin(?article) [#391K]
   +─ Scan[POSC](?article, rdf:type, bench:Article) [#208K]
   `─ Scan[PSOC](?article, dc:creator, ?person) [#898K]</code></pre></div></div><div class="paragraph"><p>This means that all solutions representing the join of <code>?article rdf:type bench:Article</code> and <code>?article dc:creator ?person</code> will be put in a sequence ordered by the values of <code>?person</code>. Stardog expects to sort <code>391K</code> solutions before they can be further merge-joined with the results of the <code>?person foaf:name ?name</code> pattern. Alternatively the engine could build a hash table instead of sorting solutions; such decisions are made by the optimizer based on a number of factors.</p></div></div></div><div class="sect3"><h4 id="_skipping_intermediate_results"><a class="link" href="#_skipping_intermediate_results">Skipping Intermediate Results</a></h4><div class="paragraph"><p>One tricky part of understanding Stardog query plans is that evaluation of each operator in the plan is usually context-sensitive, i.e. it depends on what other nodes are in the same plan, possibly in a different sub-tree. In particular, the cardinality estimations, even if assumed accurate, only specify how many solutions the operator is expected to produce when evaluated as the root node of a plan.</p></div><div class="paragraph"><p>However, as it is joined with other parts of the plan, the results can be quite different. This is because Stardog employs optimizations to reduce the number of solutions produced by a node by pruning those which are incompatible with other solutions with which they will later be joined.</p></div><div class="paragraph"><p>Consider the following basic graph pattern and the corresponding plan:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">?erdoes rdf:type foaf:Person .
?erdoes foaf:name "Paul Erdoes"^^xsd:string .
?document dc:creator ?erdoes .

MergeJoin(?erdoes) [#10]
+─ MergeJoin(?erdoes) [#1]
│  +─ Scan[POSC](?erdoes, rdf:type, foaf:Person) [#433K]
│  `─ Scan[POSC](?erdoes, foaf:name, "Paul Erdoes") [#1]
`─ Scan[POSC](?document, dc:creator, ?erdoes) [#898K]</code></pre></div></div><div class="paragraph"><p>The pattern matches all documents created by a person named Paul Erdoes. Here the second pattern is very selective (only one entity is expected to have the name "Paul Erdoes"). This information is propagated to the other two scans in the plan via merge joins, which allows them to skip scanning large parts of data indexes.</p></div><div class="paragraph"><p>In other words, the node <code>Scan[POSC](?erdoes, rdf:type, foaf:Person) [#433K]</code> will not produce all <code>433K</code> solutions corresponding to all people in the database and, similarly, <code>Scan[POSC](?document, dc:creator, ?erdoes) [#898K]</code> will not go through all <code>898K</code> document creators.</p></div></div><div class="sect3"><h4 id="_diagnosing_performance_problems"><a class="link" href="#_diagnosing_performance_problems">Diagnosing Performance Problems</a></h4><div class="paragraph"><p>Performance problems may arise because of two reasons:</p></div><div class="olist arabic"><ol class="arabic"><li><p>complexity of the query itself, especially the amount of returned data</p></li><li><p>failure to select a good plan for the query.</p></li></ol></div><div class="paragraph"><p>It is important to distinguish the two. In the former case the best way forward is to make the patterns in <code>WHERE</code> more selective. In the latter case, i.e. when the query returns some modest number of results but takes an unacceptably long time to do so, one needs to look at the plan, identify the bottlenecks (usually pipeline breakers), and reformulate the query or report it to us for further analysis.</p></div><div class="paragraph"><p>Here&#8217;s an example of a very un-selective query:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">SELECT DISTINCT ?name1 ?name2
WHERE {
  ?article1 rdf:type bench:Article .
  ?article2 rdf:type bench:Article .
  ?article1 dc:creator ?author1 .
  ?author1 foaf:name ?name1 .
  ?article2 dc:creator ?author2 .
  ?author2 foaf:name ?name2 .
  ?article1 swrc:journal ?journal .
  ?article2 swrc:journal ?journal
  FILTER (?name1&lt;?name2)
  }</code></pre></div></div><div class="paragraph"><p>The query returns all distinct pairs of authors who published (possibly different) articles in the same journal. It returns more than 18M results from a database of 5M triples. Here&#8217;s the plan:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">Distinct [#17.7M]
`─ Projection(?name1, ?name2) [#17.7M]
   `─ Filter(?name1 &lt; ?name2) [#17.7M]
      `─ HashJoin(?journal) [#35.4M]
         +─ MergeJoin(?author2) [#391K]
         │  +─ Sort(?author2) [#391K]
         │  │  `─ NaryJoin(?article2) [#391K]
         │  │     +─ Scan[POSC](?article2, rdf:type, bench:Article) [#208K]
         │  │     +─ Scan[PSOC](?article2, swrc:journal, ?journal) [#208K]
         │  │     `─ Scan[PSOC](?article2, dc:creator, ?author2) [#898K]
         │  `─ Scan[PSOC](?author2, foaf:name, ?name2) [#433K]
         `─ MergeJoin(?author1) [#391K]
            +─ Sort(?author1) [#391K]
            │  `─ NaryJoin(?article1) [#391K]
            │     +─ Scan[POSC](?article1, rdf:type, bench:Article) [#208K]
            │     +─ Scan[PSOC](?article1, swrc:journal, ?journal) [#208K]
            │     `─ Scan[PSOC](?article1, dc:creator, ?author1) [#898K]
            `─ Scan[PSOC](?author1, foaf:name, ?name1) [#433K]</code></pre></div></div><div class="paragraph"><p>This query requires an expensive join on <code>?journal</code> which is evident from the plan (it&#8217;s a hash join in this case). It produces more than 18M results (Stardog expects 17.7M which is fairly accurate in this case) that need to be filtered and examined for duplicates. Given all this information from the plan, the only reasonable way to address the problem would be to restrict the criteria, e.g. to particular journals, people, time periods, etc.</p></div><div class="paragraph"><p>If a query is well-formulated and selective, but performance is unsatisfactory, one may look closer at the pipeline breakers, e.g. this part of the query plan:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">MergeJoin(?person) [#391K]
+─ Sort(?person) [#391K]
|  `─ MergeJoin(?article) [#391K]
|     +─ Scan[POSC](?article, rdf:type, bench:Article) [#208K]
|     `─ Scan[PSOC](?article, dc:creator, ?person) [#898K]
`─ Scan[PSOC](?person, foaf:name, ?name) [#433K]</code></pre></div></div><div class="paragraph"><p>A reasonable thing to do would be to evaluate the join of <code>?article rdf:type bench:Article</code> and <code>?article dc:creator ?person</code> separately, i.e. as a separate queries, to see if the estimation of <code>391K</code> is reasonably accurate and to get an idea about memory pressure. This is a valuable piece of information for a performance problem report, especially when the data cannot be shared with us. Similar analysis can be done for hash joins.</p></div><div class="paragraph"><p>In addition to pipeline breakers, there could be other clear indicators of performance problems. One of them is the presence of <code>LoopJoin</code> nodes in the plan. Stardog implements the <a href="https://en.wikipedia.org/wiki/Nested_loop_join">nested loop join</a> algorithm which evaluates the join by going through the Cartesian product of its inputs. This is the slowest join algorithm and it is used only as a last resort. It sometimes, but not always, indicates a problem with the query.</p></div><div class="paragraph"><p>Here&#8217;s an example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript"> SELECT DISTINCT ?person ?name
 WHERE {
   ?article rdf:type bench:Article .
   ?article dc:creator ?person .
   ?inproc rdf:type bench:Inproceedings .
   ?inproc dc:creator ?person2 .
   ?person foaf:name ?name .
   ?person2 foaf:name ?name2
   FILTER (?name=?name2)
 }</code></pre></div></div><div class="paragraph"><p>The query is very similar to an earlier query plan we saw but runs much slower. The plan shows why:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">Distinct [#98456.0M]
`─ Projection(?person, ?name) [#98456.0M]
   `─ Filter(?name = ?name2) [#98456.0M]
      `─ LoopJoin(_) [#196912.1M]
         +─ MergeJoin(?person) [#391K]
         │  +─ Sort(?person) [#391K]
         │  │  `─ MergeJoin(?article) [#391K]
         │  │     +─ Scan[POSC](?article, rdf:type, bench:Article) [#208K]
         │  │     `─ Scan[PSOC](?article, dc:creator, ?person) [#898K]
         │  `─ Scan[PSOC](?person, foaf:name, ?name) [#433K]
         `─ MergeJoin(?person2) [#503K]
            +─ Sort(?person2) [#503K]
            │  `─ MergeJoin(?inproc) [#503K]
            │     +─ Scan[POSC](?inproc, rdf:type, bench:Inproceedings) [#255K]
            │     `─ Scan[PSOC](?inproc, dc:creator, ?person2) [#898K]
            `─ Scan[PSOC](?person2, foaf:name, ?name2) [#433K]</code></pre></div></div><div class="paragraph"><p>The loop join near the top of the plan computes the Cartesian product of the arguments which produces almost 200B solutions. This is because there is no shared variable between the parts of the query which correspond to authors of articles and conference proceedings papers, respectively. The filter condition <code>?name = ?name2</code> cannot be transformed into an equi-join because the semantics of <a href="https://www.w3.org/TR/sparql11-query/#OperatorMapping">term equality</a> used in filters is different from the <a href="https://www.w3.org/TR/sparql11-query/#BasicGraphPattern">solution compatibility</a> semantics used for checking join conditions.</p></div><div class="paragraph"><p>The difference manifests itself in the presence of numerical literals, e.g. <code>"1"^^xsd:integer</code> = <code>"1.0"^^xsd:float</code>, where they are different RDF terms. However, as long as all names in the data are strings, one can re-formulate this query by renaming <code>?name2</code> to <code>?name</code> which would enable Stardog to use a more efficient join algorithm.</p></div></div><div class="sect3"><h4 id="_query_plan_operators"><a class="link" href="#_query_plan_operators">Query Plan Operators</a></h4><div class="paragraph"><p>The following operators are used in Stardog query plans:</p></div><div class="ulist"><ul><li><p><code>Scan[Index]</code>: evaluates a triple/quad pattern against Stardog indexes. Indicates the index used, e.g. <code>CSPO</code> or <code>POSC</code>, where <code>S,P,O,C</code> stand for the kind of lexicographic ordering of quads that the index provides. <code>SPOC</code> means that the index is sorted first by *S*ubject, then *P*redicate, *O*bject, and *C*ontext (named graph IRI).</p></li><li><p><code>HashJoin(join key)</code>: hash join algorithm, hashes the right operand. <strong>Pipeline breaker</strong>.</p></li><li><p><code>DirectHashJoin(join key)</code>: a hash join algorithm which directly uses indexes for lookups instead of building a hash table. Not a pipeline breaker.</p></li><li><p><code>MergeJoin(join key)</code>: merge join algorithm, the fastest option for joining two streams of solutions. Requires both operands be sorted on the join key. Not a pipeline breaker.</p></li><li><p><code>LoopJoin</code>: the nested loops join algorithm, the slowest join option. Not a pipeline breaker.</p></li><li><p><code>Sort(sort key)</code>: sorts the argument solutions by the sort key, typically used as a part of a merge join. <strong>Pipeline breaker</strong>.</p></li><li><p><code>Filter(condition)</code>: filters argument solutions according to the condition. Not a pipeline breaker.</p></li><li><p><code>Union</code>: combines streams of argument solutions. If both streams are sorted by the same variable, the result is also sorted by that variable. Not a pipeline breaker.</p></li><li><p><code>PropertyPath</code>: evaluates a <a href="https://www.w3.org/TR/sparql11-query/#propertypaths">property path</a> pattern against Stardog indexes. Not a pipeline breaker.</p></li><li><p><code>GroupBy</code>: groups results of the child operator by values of the group-by expressions (i.e. keys) and aggregates solutions for each key. <strong>Pipeline breaker</strong> (unless the input is sorted by first key).</p></li><li><p><code>Distinct</code>: removes duplicate solutions from the input. Not a pipeline breaker but accumulates solutions in memory as it runs so the memory pressure increases as the number of unique solutions increases.</p></li><li><p><code>VALUES</code>: produces the <a href="https://www.w3.org/TR/sparql11-query/#inline-data">inlined results</a> specified in the query. Not a pipeline breaker.</p></li><li><p><code>Search</code>: evaluates a full-text search predicates against the Lucene index within a Stardog database.</p></li><li><p><code>Projection</code>: projects variables as results of a query or a sub-query. Not a pipeline breaker.</p></li><li><p><code>Bind</code>: evaluates expressions on each argument solution and binds their values to (new) variables. Not a pipeline breaker.</p></li><li><p><code>Empty</code> and <code>Singleton</code>: correspond to the empty solution set and a single empty solution, respectively.</p></li><li><p><code>Type</code>: reasoning operator for evaluating patterns of the form <code>?x rdf:type ?type</code> or <code>:instance rdf:type ?type</code>. Not a pipeline breaker.</p></li><li><p><code>Property</code>: operator for evaluating triple patterns with unbound predicate with reasoning. Not a pipeline breaker.</p></li><li><p><code>Service</code>: SPARQL federation operator which evaluate a pattern against a remote SPARQL endpoint (or a <a href="http://docs.stardog.com/#_structured_data_aka_virtual_graphs">virtual graph</a>).</p></li></ul></div></div></div><div class="sect2"><h3 id="_managing_search"><a class="link" href="#_managing_search">Managing Search</a></h3><div class="paragraph"><p>Stardog&#8217;s search service is described in <a href="#_using_stardog">Using Stardog</a> section.</p></div><div class="paragraph"><p>Full-text support for a database is disabled by default but can be enabled at any time by setting the configuration option <code>search.enabled</code> to true. For example, you can create a database with full-text support as follows:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db create -o search.enabled=true -n myDb</code></pre></div></div><div class="paragraph"><p>There are three modes for rebuilding indexes:</p></div><div class="olist arabic"><ol class="arabic"><li><p><code>sync</code>: Recompute the search index synchronously with a transacted write.</p></li><li><p><code>async</code>: Recompute the search index asynchronously as soon as possible with respect to a transacted write.</p></li><li><p>Scheduled: Use a <a href="http://www.quartz-scheduler.org/documentation/quartz-2.1.x/tutorials/crontrigger">cron expression</a> to specify when the search index should be updated.</p></li></ol></div><div class="paragraph"><p>This is specified when creating a database by setting the property <code>search.reindex.mode</code> to <code>sync</code>, <code>async</code>, or to a valid cron expression. The default is <code>sync</code>. This behavior can be configured by the <code>search.reindex.mode</code> database option.</p></div></div><div class="sect2"><h3 id="_acid_transactions"><a class="link" href="#_acid_transactions">ACID Transactions</a></h3><div class="paragraph"><p>What follows is specific guidance with respect to Stardog&#8217;s transactional semantics and guarantees.<span class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnote_14" title="View footnote.">14</a>]</span></p></div><div class="sect3"><h4 id="_atomicity"><a class="link" href="#_atomicity">Atomicity</a></h4><div class="paragraph"><p>Databases may provide a guarantee of atomicity&#8212;&#8203;groups of database actions (i.e., mutations) are irreducible and indivisible: either all of the changes happen or none of them happens. Stardog&#8217;s transacted writes are atomic. Stardog does not support nested transactions.<span class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnote_15" title="View footnote.">15</a>]</span></p></div></div><div class="sect3"><h4 id="_consistency"><a class="link" href="#_consistency">Consistency</a></h4><div class="paragraph"><p>Data stored should be valid with respect to the data model (in this case, RDF) and to the guarantees offered by the database, as well as to any application-specific integrity constraints that may exist. Stardog&#8217;s transactions are guaranteed not to violate integrity constraints during execution. A transaction that would leave a database in an inconsistent or invalid state is aborted.</p></div><div class="paragraph"><p>See the <a href="#_validating_constraints">Validating Constraints</a> section for a more detailed consideration of Stardog&#8217;s integrity constraint mechanism.</p></div></div><div class="sect3"><h4 id="_isolation"><a class="link" href="#_isolation">Isolation</a></h4><div class="paragraph"><p>A Stardog connection will run in <a href="http://en.wikipedia.org/wiki/Isolation_(database_systems)#Read_committed"><code>READ COMMITTED</code></a> isolation level if it has not started an explicit transaction and will run in <code>READ COMMITTED SNAPSHOT</code> or <code>SERIALIZABLE</code> isolation level depending on the value of the <code>transaction.isolation</code>. In any of these modes, uncommitted changes will only be visible to the connection that made the changes: no other connection can see those values before they are committed. Thus, "dirty reads" can never occur.</p></div><div class="paragraph"><p>The difference between <code>READ COMMITTED</code> and <code>READ COMMITTED SNAPSHOT</code> isolation levels is that in the former case a connection will see updates committed by another connection immediately, whereas in the latter case a connection will see a transactionally consistent snapshot of the data as it existed at the start of the transaction and will not see any updates.</p></div><div class="paragraph"><p>We illustrate the difference between these two levels with the following example where initially the database contains a single triple <code>:x :val 1</code>.</p></div><table class="tableblock frame-all grid-all spread"><caption class="title">3. Table of the difference between RCI and RCSI</caption><colgroup><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Time</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Connection 1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Connection 2</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Connection 3</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>1</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>1</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>1</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>BEGIN TX</strong></code></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT {:x :value 2}<br>DELETE {:x :value ?old}</code></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>2</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>1</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>1</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>BEGIN TX</strong></code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>COMMIT</strong></code></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>2</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>2</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>1</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT {:x :value 3}<br>DELETE {:x :value ?old}</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>9</code></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>COMMIT</strong></code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>3</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>3</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT ?val {?x :val ?val}</code><br>&#8656; <code>3</code></p></td></tr></tbody></table><div class="paragraph"><p>No locks are taken, or any conflict resolution performed, for concurrent transactions in <code>READ COMMITTED SNAPSHOT</code> isolation level. If there are conflicting changes, the latest commit wins which might yield unexpected results in some cases since every transaction reads from a snapshot that was created at the time transaction started.</p></div><div class="paragraph"><p>Consider the following query being executed by two concurrent threads in <code>READ COMMITTED SNAPSHOT</code> isolation level against a database having the triple <code>:counter :val 1</code> initially:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">INSERT { :counter :val ?newValue }
DELETE { :counter :val ?oldValue }
WHERE  { :counter :val ?oldValue
         BIND (?oldValue+1 AS ?newValue) }</code></pre></div></div><div class="paragraph"><p>Since each transaction will read the current value from its snapshot, it is possible that both transactions will read the value <code>1</code> and insert the value <code>2</code> even though we expect the final value to be <code>3</code>.</p></div><div class="paragraph"><p>Isolation level <code>SERIALIZABLE</code> can be used to avoid these situations. In <code>SERIALIZABLE</code> mode an exclusive lock needs to be acquired before a transaction begins. This ensures concurrent updates cannot interfere with each other, but as a result update throughput will decrease since only one transaction can run at a time.</p></div></div><div class="sect3"><h4 id="_durability"><a class="link" href="#_durability">Durability</a></h4><div class="paragraph"><p>By default Stardog&#8217;s transacted writes are durable and no additional actions are required.</p></div></div><div class="sect3"><h4 id="_commit_failure_autorecovery"><a class="link" href="#_commit_failure_autorecovery">Commit Failure Autorecovery</a></h4><div class="paragraph"><p>Stardog&#8217;s transaction framework is largely maintenance free; but there are some rare conditions in which manual intervention may be needed.</p></div><div class="paragraph"><p>Stardog&#8217;s strategy for recovering automatically from (the very unlikely event of) commit failure is as follows:</p></div><div class="olist arabic"><ol class="arabic"><li><p>Stardog will roll back the transaction upon a commit failure;</p></li><li><p>Stardog takes the affected database offline for maintenance;<span class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnote_16" title="View footnote.">16</a>]</span> then</p></li><li><p>Stardog will begin recovery, bringing the recovered database back online once that task is successful so that operations may resume.</p></li></ol></div><div class="paragraph"><p>With an appropriate logging configuration for production usage (at least error-level logging), log messages for the preceding recovery operations will occur. If for whatever reason the database fails to be returned automatically to online status, an administrator may use the CLI tools (i.e., <code>stardog-admin db online</code>) to attempt to online the database.</p></div></div></div><div class="sect2"><h3 id="_optimizing_bulk_data_loading"><a class="link" href="#_optimizing_bulk_data_loading">Optimizing Bulk Data Loading</a></h3><div class="paragraph"><p>Stardog tries hard to do bulk loading at database creation time in the most efficient and scalable way possible. But data loading time can vary widely, depending on factors in the data to be loaded, including the number of unique resources, etc. Here are some tuning tips that may work for you:</p></div><div class="olist arabic"><ol class="arabic"><li><p>Load <a href="#_loading_compressed_data">compressed data</a> since compression minimizes disk access</p></li><li><p>Use a multicore machine since bulk loading is highly parallelized and indexes are built concurrently</p></li><li><p>Load multiple files together at creation time since different files will be parsed and processed concurrently improving the load speed</p></li><li><p>Turn off strict parsing (see <a href="#_configuring_a_database">Configuring a Database</a> for the details).</p></li><li><p>If you are not using named graphs, use <a href="#_database_create_options">triples only indexing</a>.</p></li></ol></div></div></div></div><div class="sect1"><h2 id="_capacity_planning"><a class="link" href="#_capacity_planning">Capacity Planning</a></h2><div class="sectionbody"><div class="paragraph"><p>The primary system resources used by Stardog are CPU, memory, and disk.<span class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnote_17" title="View footnote.">17</a>]</span> Stardog will take advantage of multiple CPUs, cores, and core-based threads in data loading and in throughput-heavy or multi-user loads. And obviously Stardog performance is influenced by the speed of CPUs and cores. But some workloads are bound by main memory or by disk I/O (or both) more than by CPU. In general, use the fastest CPUs you can afford with the largest secondary caches and the most number of cores and core-based threads of execution, especially in multi-user workloads.</p></div><div class="paragraph"><p>The following subsections provides more detailed guidance for the memory and disk resource requirements of Stardog.</p></div><div class="sect2"><h3 id="_memory_usage"><a class="link" href="#_memory_usage">Memory usage</a></h3><div class="paragraph"><p>Stardog uses system memory aggressively and the total system memory available to Stardog is often the most important factor in performance. Stardog uses both JVM memory (heap memory) and also the operating system memory outside the JVM (off heap memory). Having more system memory available is always good; however, increasing JVM memory too close to total system memory is not usually prudent as it may tend to increase Garbage Collection (GC) time in the JVM.</p></div><div class="paragraph"><p>The following table shows recommended JVM memory and system memory requirements for Stardog.<span class="footnote">[<a id="_footnoteref_18" class="footnote" href="#_footnote_18" title="View footnote.">18</a>]</span></p></div><table class="tableblock frame-all grid-all spread"><caption class="title">4. Table of Memory Usage for Capacity Planning</caption><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><thead><tr><th class="tableblock halign-left valign-top"># of Triples</th><th class="tableblock halign-left valign-top">JVM Memory</th><th class="tableblock halign-left valign-top">Off-heap memory</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">100 million</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">3GB</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">3GB</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">1 billion</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">4GB</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">8GB</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">10 billion</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">8GB</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">64GB</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">20 billion</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">16GB</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">128GB</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">50 billion</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">16GB</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">256GB</p></td></tr></tbody></table><div class="paragraph"><p>Out of the box, Stardog CLI sets the maximum JVM memory to 2GB. This setting works fine for most small databases (up to, say, 100 million triples). As the database size increases, we recommend increasing JVM memory. You can increase the JVM memory for Stardog by setting the system property <code>STARDOG_JAVA_ARGS</code> using the standard JVM options. For example, you can set this property to <code>"-Xms4g -Xmx4g -XX:MaxDirectMemorySize=8g"</code> to increase the JVM memory to 4GB and off-heap to 8GB. We recommend setting the minimum heap size (<code>-Xms</code> option) as close to the max heap size (<code>-Xmx</code> option) as possible.</p></div><div class="sect3"><h4 id="_system_memory_and_jvm_memory"><a class="link" href="#_system_memory_and_jvm_memory">System Memory and JVM Memory</a></h4><div class="paragraph"><p>Stardog uses an off-heap, custom memory allocation scheme. Please note that the memory provisioning recommendations above are for two kinds of memory allocations for the JVM in which Stardog will run. The first is for memory that the JVM will manage explicitly (i.e., "JVM memory"); and the second, i.e., "Off-heap memory" is for memory that Stardog will manage explicitly, i.e., off the JVM heap, but for which the JVM should be notified via the <code>MaxDirectMemorySize</code> property. In most cases, this should be somewhat less than the total memory available to the underlying operating system as requirements dictate.</p></div></div></div><div class="sect2"><h3 id="_disk_usage"><a class="link" href="#_disk_usage">Disk usage</a></h3><div class="paragraph"><p>Stardog stores data on disk in a compressed format. The disk space needed for a database depends on many factors besides the number of triples, including the number of unique resources and literals in the data, average length of resource identifiers and literals, and how much the data is compressed. The following table shows typical disk space used by a Stardog database.</p></div><table class="tableblock frame-all grid-all spread"><caption class="title">5. Table of Typical Disk Space Requirements</caption><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top"># of triples</th><th class="tableblock halign-left valign-top">Disk space</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">1 billion</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">70GB to 100GB</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">10 billion</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">700GB to 1TB</p></td></tr></tbody></table><div class="paragraph"><p>These numbers are given for information purposes only; the actual disk usage for a database may be significantly different in practice. Also it is important to note that the amount of disk space needed at creation time for bulk loading data is higher as temporary files will be created. The additional disk space needed at bulk loading time can be 40% to 70% of the final database size.</p></div><div class="paragraph"><p>Disk space used by a database is non-trivially smaller if <a href="#_database_create_options">triples-only indexing</a> is used. Triples-only indexing reduces overall disk space used by 25% on average; however, note the tradeoff: SPARQL queries involving named graphs perform significantly better with quads indexing.</p></div><div class="paragraph"><p>The disk space used by Stardog is additive for multiple databases and there is very little disk space used other than what is required for the databases. To calculate the total disk space needed for multiple databases, one may sum the disk space needed by each database.</p></div></div></div></div><div class="sect1"><h2 id="_using_stardog_on_windows"><a class="link" href="#_using_stardog_on_windows">Using Stardog on Windows</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog provides batch (<code>.bat</code>) files for use on Windows; they provide roughly the same set of functionality provided by the Bash scripts which are used on Unix-like systems. There are, however, a few small differences between the two. When you start a server with <code>server start</code> on Windows, this does not detach to the background, it will run in the current console.</p></div><div class="paragraph"><p>To shut down the server correctly, you should either issue a <code>server stop</code> command from another window or press <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span> (and then <kbd>Y</kbd> when asked to terminate the batch job). Do not under any circumstance close the window without shutting down the server. This will simply kill the process without shutting down Stardog, which could cause your database to be corrupted.</p></div><div class="paragraph"><p>The <code>.bat</code> scripts for Windows support our standard <code>STARDOG_HOME</code> and <code>STARDOG_JAVA_ARGS</code> environment variables which can be used to control where Stardog&#8217;s database is stored and, usually, how much memory is given to Stardog&#8217;s JVM when it starts. By default, the script will use the JVM that is available in the directory from which Stardog is run via the <code>JAVA_HOME</code> environment variable. If this is not set, it will simply execute <code>java</code> from within that directory.</p></div><div class="sect2"><h3 id="_running_stardog_as_a_windows_service"><a class="link" href="#_running_stardog_as_a_windows_service">Running Stardog as a Windows Service</a></h3><div class="paragraph"><p>You can run Stardog as a Windows Service using the following configuration. Please, note, that the following assumes commands are executed from a Command Prompt with administrative privileges.</p></div><div class="sect3"><h4 id="_installing_the_service"><a class="link" href="#_installing_the_service">Installing the Service</a></h4><div class="paragraph"><p>Change the directory to the Stardog installation directory:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bat" data-lang="bat">cd c:\stardog-$VERSION</code></pre></div></div></div><div class="sect3"><h4 id="_configuring_the_service"><a class="link" href="#_configuring_the_service">Configuring the Service</a></h4><div class="paragraph"><p>The default settings with which the service will be installed are</p></div><div class="ulist"><ul><li><p>2048 MB of RAM</p></li><li><p><code>STARDOG_HOME</code> is the same as the installation directory</p></li><li><p>the name of the installed service will be "Stardog Service"</p></li><li><p>Stardog service will write logs to the "logs" directory within the installation directory</p></li></ul></div><div class="paragraph"><p>To change these settings, set appropriate environment variables:</p></div><div class="ulist"><ul><li><p><code>STARDOG_MEMORY</code>: the amount of memory in MB (e.g., set <code>STARDOG_MEMORY</code>=4096)</p></li><li><p><code>STARDOG_HOME</code>: the path to <code>STARDOG_HOME</code> (e.g., set <code>STARDOG_HOME</code>=c:\\stardog-home)</p></li><li><p><code>STARDOG_SERVICE_DISPLAY_NAME</code>: a different name to be displayed in the list of services (e.g., set <code>STARDOG_SERVICE_DISPLAY_NAME</code>=Stardog Service)</p></li><li><p><code>STARDOG_LOG_PATH</code>: a path to a directory where the log files should be written (e.g., set <code>STARDOG_LOG_PATH</code>=c:\\stardog-logs)</p></li></ul></div><div class="paragraph"><p>If you have changed the default administrator password, you also need to modify <code>stop-service.bat</code> and specify the new username and password there (by passing <code>-u</code> and <code>-p</code> parameters in the line that invokes <code>stardog-admin server stop</code>).</p></div></div><div class="sect3"><h4 id="_installing_stardog_as_a_service"><a class="link" href="#_installing_stardog_as_a_service">Installing Stardog as a Service</a></h4><div class="paragraph"><p>Run the <code>install-service.bat</code> script.</p></div><div class="paragraph"><p>At this point the service has been installed, but it is not running. To run it, see the next section or use any Windows mechanism for controlling the services (e.g., type <code>services.msc</code> on the command line).</p></div></div><div class="sect3"><h4 id="_starting_stopping_changing_service_configuration"><a class="link" href="#_starting_stopping_changing_service_configuration">Starting, Stopping, &amp; Changing Service Configuration</a></h4><div class="paragraph"><p>Once the service has been installed, execute <code>stardog-serverw.exe</code>, which will allow you to configure the service (e.g., set whether the service is started automatically or manually), manually start and stop the service, as well as to configure most of the service parameters.</p></div></div><div class="sect3"><h4 id="_uninstalling_the_stardog_service"><a class="link" href="#_uninstalling_the_stardog_service">Uninstalling the Stardog Service</a></h4><div class="paragraph"><p>The service can be uninstalled by running <code>uninstall-service.bat</code> script.</p></div></div></div></div></div><h1 id="_virtual_graphs" class="sect0"><a class="link" href="#_virtual_graphs">Virtual Graphs</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/unifying.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>Stardog is an Enterprise Knowledge Graph platform, which means that it&#8217;s also a data unification platform. Enterprises have lots of data and lots of data sources and almost all of them are locked away in IT silos and stovepipes that impede insight, analysis, reporting, compliance, and operations.</p></div><div class="paragraph"><p>State of the art IT management tells us to <strong>organize data, systems, assets, staffs, schedules, and budgets</strong> vertically to mirror lines of business. But increasingly all the internal and external demands on IT are <strong>horizontal</strong> in nature: the data is organized vertically, but the enterprise increasingly needs to access and understand it horizontally.</p></div></div></div><div class="sect1"><h2 id="_structured_data"><a class="link" href="#_structured_data">Structured Data</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog supports a set of techniques for unifing <strong>structured enterprise data</strong>, chiefly, <strong>Virtual Graphs</strong>: tabular data declaratively mapped into a Stardog database graph and queries by Stardog <em>in situ</em>, typically using SQL. Stardog rewrites (a portion of) SPARQL queries against the Stardog database into SQL, issues that SQL query to an RDBMS, and translates the SQL results into SPARQL results. Virtual Graphs can be used for mapping any tabular data, e.g. CSV, to RDF and Stardog will support mapping other tabular formats to graphs in future releases, including XML, JSON, and enterprise directory services.</p></div><div class="paragraph"><p>A Virtual Graph has three components:</p></div><div class="ulist"><ul><li><p>a unique name</p></li><li><p>configuration options for the data source</p></li><li><p>mappings for the data</p></li></ul></div><div class="paragraph"><p>A virtual graph&#8217;s name must conform to the regular expression <code>[A-Za-z]{1}[A-Za-z0-9_-]</code>. The configuration options include several parameters, primarily JDBC connection parameters. Finally, the mappings define how the tabular data stored in the RDBMS will be represented in RDF. The mappings are defined using the <a href="http://www.w3.org/TR/r2rml/">R2RML</a> mapping language, but a simpler <a href="#_stardog_mapping_syntax">Stardog Mapping Syntax</a> is also supported for serializing R2RML mappings.</p></div><div class="sect2"><h3 id="_supported_rdbmses"><a class="link" href="#_supported_rdbmses">Supported RDBMSes</a></h3><div class="paragraph"><p>Stardog Virtual Graphs supports the following relational database systems; please <a href="#mailto:inquiries@complexible.com">inquire</a> if you need support for another.</p></div><div class="ulist"><ul><li><p>PostgreSQL</p></li><li><p>MySQL</p></li><li><p>Microsoft SQL Server</p></li><li><p>Oracle</p></li><li><p>DB2</p></li><li><p>H2</p></li><li><p>SAP HANA</p></li></ul></div></div><div class="sect2"><h3 id="_managing_virtual_graphs"><a class="link" href="#_managing_virtual_graphs">Managing Virtual Graphs</a></h3><div class="paragraph"><p>In order to query a Virtual Graph it first must be registered with Stardog. Adding a new virtual graph is done via the following command:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin virtual add dept.properties dept.ttl</code></pre></div></div><div class="paragraph"><p>The first argument (<code>dept.properties</code>) is the configuration file for the virtual graph and the second argument ('dept.ttl') is the mappings file. The name of the configuration file is used as the name of the virtual graph, so the above command registers a virtual graph named <code>dept</code>. Configuration files should be in the Java properties file format and provide JDBC connection parameters. A minimal example looks like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">jdbc.url=jdbc\:mysql\://localhost/dept
jdbc.username=admin
jdbc.password=admin
jdbc.driver=com.mysql.jdbc.Driver</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Stardog does not ship with JDBC drivers. You need to manually copy the JAR file containing the driver to the <code>STARDOG/server/dbms/</code> directory so that it will be available to the Stardog server. Server needs to be restarted after the JAR is copied.</td></tr></table></div><div class="paragraph"><p>The credentials for the JDBC connection need to be provided in plain text. An alternative way to provide credentials is to use the <a href="#_using_a_password_file">password file</a> mechanism. The credentials should be stored in a password file called <code>services.sdpass</code> located in <code>STARDOG_HOME</code> directory. The password file entries are in the format <code>hostname:port:database:username:password</code> so for the above example there should be an entry <code>localhost:*:dept:admin:admin</code> in this file. Then the credentials in the configuration file can be omitted.</p></div><div class="paragraph"><p>The configuration file can also contain a property called <code>base</code> to specify a <a href="http://www.w3.org/TR/r2rml/#dfn-base-iri">base URI</a> for resolving relative URIs generated by the mappings (if any). If no value is provided, the base URI will be <code>virtual://myGraph</code> where <code>myGraph</code> is the name of the virtual graph.</p></div><div class="paragraph"><p>The add command by default assumes the mappings are using the <a href="#_stardog_mapping_syntax">Stardog Mapping Syntax</a>. Mappings in standard R2RML syntax can be used by adding the <code>--format r2rml</code> option in the above command. If there are no mappings provided to the add commands then the <a href="http://www.w3.org/TR/rdb-direct-mapping/">R2RML direct mapping</a> is used.</p></div><div class="paragraph"><p>Registered virtual graphs can be listed:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin virtual list
1 virtual graphs
dept</code></pre></div></div><div class="paragraph"><p>The commands <code>virtual mappings</code> and <code>virtual options</code> can be used to retrieve the mappings and configuration options associated with a virtual graph respectively. Registered virtual graphs can be removed using the <code>virtual remove</code> command. See the <a href="#_man_pages">Man Pages</a> for the details of these commands.</p></div></div><div class="sect2"><h3 id="_querying_virtual_graphs"><a class="link" href="#_querying_virtual_graphs">Querying Virtual Graphs</a></h3><div class="paragraph"><p>Querying Virtual Graphs is done by using the <code>GRAPH</code> clause, using a special graph URI in the form <code>virtual://myGraph</code> to query the Virtual Graph named <code>myGraph</code>. The following example shows how to query <code>dept</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT * {
   GRAPH &lt;virtual://dept&gt; {
      ?person a emp:Employee ;
           emp:name "SMITH"
   }
}</code></pre></div></div><div class="paragraph"><p>Virtual graphs are defined globally in Stardog Server. Once they are registered with the server they can be accessed via any Stardog database as allowed by the <a href="#_virtual_graph_security">access rules</a>.</p></div><div class="paragraph"><p>We can query the Stardog database and pull data from a virtual graph in a single query. Suppose we have the <code>dept</code> Virtual Graph, defined as above, that contains employee and department information, and the Stardog database contains data about the interests of people. We can use the following query to combine the information from both sources:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT * {
   GRAPH &lt;virtual://dept&gt; {
      ?person a emp:Employee ;
           emp:name "SMITH"
   }
   ?person foaf:interest ?interest
}</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Query performance will be best if the <code>GRAPH</code> clause for Virtual Graphs is as selective as possible.</td></tr></table></div></div><div class="sect2"><h3 id="_virtual_graph_security"><a class="link" href="#_virtual_graph_security">Virtual Graph Security</a></h3><div class="paragraph"><p>Accessing Virtual Graphs can be controlled similar to regular named graphs as explained in the <a href="#_named_graph_security">Named Graph Security</a> section. If named graph security is not enabled for a database, all registered Virtual Graphs in the server will be accessible through that database. If named graph security is enabled for a database, then users will be able to query only the Virtual Graphs for which they have been granted access.</p></div><div class="paragraph"><p>If the virtual graphs contain any sensitive information, then it is recommended to enable named graph security globally by setting <code>security.named.graphs=true</code> in <code>stardog.properties</code>. Otherwise creating a new database without proper configuration would allow users to access those Virtual Graphs.</p></div></div><div class="sect2"><h3 id="_materializing_virtual_graphs"><a class="link" href="#_materializing_virtual_graphs">Materializing Virtual Graphs</a></h3><div class="paragraph"><p>In some cases you need to <strong>materialize the information stored in RDBMS directly into RDF</strong>. There is a special command <code>virtual import</code> that can be used to import the contents of the RDBMS into Stardog. The command can be used as follows:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin virtual import myDb dept.properties dept.ttl</code></pre></div></div><div class="paragraph"><p>This command adds all the mapped triples from the RDBMS into the default graph. Similar to <code>virtual add</code>, this command assumes <a href="#_stardog_mapping_syntax">Stardog Mapping Syntax</a> by default and can accept R2RML mappings using the <code>--format r2rml</code> option.</p></div><div class="paragraph"><p>It is also possible to specify a target named graph by using the <code>-g</code>/<code>--namedGraph</code> option:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin virtual import -g http://example.com/targetGraph myDb dept.properties dept.ttl</code></pre></div></div><div class="paragraph"><p>This <code>virtual import</code> command is equivalent to the following SPARQL update query:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">ADD &lt;virtual://dept&gt; TO &lt;http://example.com/targetGraph&gt;</code></pre></div></div><div class="paragraph"><p>If the RDBMS contents change over time, and we need to update the materialization results in the future, we can clear the named graph contents and rematerialize again. This can be done by using the <code>--remove-all</code> option in <code>virtual import</code> or with the following SPARQL query:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">COPY &lt;virtual://dept&gt; TO &lt;http://example.com/targetGraph&gt;</code></pre></div></div><div class="paragraph"><p>Query performance over materialized graphs will be better as the data will be indexed locally by Stardog, but materialization may not be practical in cases where frequency of change is very high.</p></div></div><div class="sect2"><h3 id="_csv_as_virtual_graph"><a class="link" href="#_csv_as_virtual_graph">CSV as Virtual Graph</a></h3><div class="paragraph"><p>Mappings can be used to treat CSV files as Virtual Graphs since they represent tabular data similar to RDBMS tables. But unlike RDBMS tables, CSV files are supported only for importing into Stardog. The same import command above can be used to specify a mappings file and an input CSV file:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin virtual import myDB cars.ttl cars.csv</code></pre></div></div><div class="paragraph"><p>If the input file is using different kind of separators, e.g. tab character, a configuration file can be provided</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin virtual import myDB cars.properties cars.ttl cars.tsv</code></pre></div></div><div class="paragraph"><p>The configuration file for CSV files can specify values for the following properties: <code>csv.separator</code> (character for separating fields), <code>csv.quote</code> (character for strings), <code>csv.escape</code> (character for escaping special characters), <code>csv.header</code> (boolean value for specifying whether or not the input file has a header line at the beginning). Note that, whitespace characters in Java properties file need to be escaped so if you want to import tab-separated value files set <code>csv.separator=\t</code> in the configuration file.</p></div></div><div class="sect2"><h3 id="_stardog_mapping_syntax"><a class="link" href="#_stardog_mapping_syntax">Stardog Mapping Syntax</a></h3><div class="paragraph"><p>The Stardog Mapping Syntax (SMS) is an alternative way to serialize R2RML mappings that is much simpler to read and write and has the same expressive power as R2RML. Mappings written in SMS can be converted to R2RML and vice versa. We will use the <a href="http://www.w3.org/TR/r2rml/#example-input-database">example database</a> from the R2RML specification to explain SMS. The SQL schema that corresponds to this example is</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">CREATE TABLE "DEPT" (
      "deptno" INTEGER UNIQUE,
      "dname" VARCHAR(30),
      "loc" VARCHAR(100));
INSERT INTO "DEPT" ("deptno", "dname", "loc")
       VALUES (10, 'APPSERVER', 'NEW YORK');

CREATE TABLE "EMP" (
      "empno" INTEGER PRIMARY KEY,
      "ename" VARCHAR(100),
      "job" VARCHAR(30),
      "deptno" INTEGER REFERENCES "DEPT" ("deptno"),
      "etype" VARCHAR(30));
INSERT INTO "EMP" ("empno", "ename", "job", "deptno", "etype" )
       VALUES (7369, 'SMITH', 'CLERK', 10, 'PART_TIME');</code></pre></div></div><div class="paragraph"><p>Suppose we would like to represent this information in RDF using the same <a href="http://www.w3.org/TR/r2rml/#example-translationtable">translation for job codes</a> as in the original example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">@prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .
@prefix emp: &lt;http://example.com/emp/&gt; .
@prefix dept: &lt;http://example.com/dept/&gt; .

dept:10 a dept:Department ;
    dept:location "NEW YORK" ;
    dept:deptno "10"^^xsd:integer .

emp:7369 a emp:Employee ;
    emp:name "SMITH" ;
    emp:role emp:general-office ;
    emp:department dept:10 .</code></pre></div></div><div class="paragraph"><p>SMS looks very similar to the output RDF representation:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">@prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .
@prefix emp: &lt;http://example.com/emp/&gt; .
@prefix dept: &lt;http://example.com/dept/&gt; .
@prefix sm: &lt;tag:stardog:api:mapping:&gt; .

dept:{"deptno"} a dept:Department ;
    dept:location "{\"loc\"}" ;
    dept:deptno "{\"deptno\"}"^^xsd:integer ;
    sm:map [
      sm:table "DEPT" ;
    ] .

emp:{"empno"} a emp:Employee ;
    emp:name "{\"ename\"}" ;
    emp:role emp:{ROLE} ;
    emp:department dept:{"deptno"} ;
    sm:map [
      sm:query """
        SELECT \"empno\", \"ename\", \"deptno\", (CASE \"job\"
            WHEN 'CLERK' THEN 'general-office'
            WHEN 'NIGHTGUARD' THEN 'security'
            WHEN 'ENGINEER' THEN 'engineering'
        END) AS ROLE FROM \"EMP\"
        """ ;
    ] .</code></pre></div></div><div class="paragraph"><p>SMS is based on Turtle, but it&#8217;s not valid Turtle since it uses the <a href="http://www.w3.org/TR/r2rml/#from-template">URI templates</a> of R2RML&#8212;&#8203;curly braces can appear in URIs. Other than this difference, we can treat an SMS document as a set of RDF triples. SMS documents use the special namespace <code>tag:stardog:api:mapping:</code> that we will represent with the <code>sm</code> prefix below.</p></div><div class="paragraph"><p>Every subject in the SMS document that has a <code>sm:map</code> property maps a single row from the corresponding table/view to one or more triples. If an existing table/view is being mapped, <code>sm:table</code> is used to refer to the table. Alternatively, a SQL query can be provided inline using the <code>sm:query</code> property.</p></div><div class="paragraph"><p>The values generated will be a URI, blank node, or a literal based on the type of the value used in the mapping. The column names referenced between curly braces will be replaced with the corresponding values from the matching row.</p></div><div class="paragraph"><p>SMS can be translated to the standard R2RML syntax. For completeness, we provide the R2RML mappings corresponding to the above example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">@prefix rr: &lt;http://www.w3.org/ns/r2rml#&gt; .
@prefix emp: &lt;http://example.com/emp#&gt; .
@prefix dept: &lt;http://example.com/dept#&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .
@base &lt;http://example.com/base/&gt; .

&lt;DeptTriplesMap&gt;
    a rr:TriplesMap;
    rr:logicalTable [ rr:tableName "DEPT" ];
    rr:subjectMap [ rr:template "http://data.example.com/dept/{\"deptno\"}" ;
                    rr:class dept:Department ];
    rr:predicateObjectMap [
      rr:predicate	  dept:deptno ;
      rr:objectMap    [ rr:column "\"deptno\""; rr:datatype xsd:positiveInteger ]
    ];
    rr:predicateObjectMap [
      rr:predicate	dept:location ;
      rr:objectMap	[ rr:column "\"loc\"" ]
    ].

&lt;EmpTriplesMap&gt;
	a rr:TriplesMap;
    rr:logicalTable [ rr:sqlQuery """
        SELECT "EMP".*, (CASE "job"
            WHEN 'CLERK' THEN 'general-office'
            WHEN 'NIGHTGUARD' THEN 'security'
            WHEN 'ENGINEER' THEN 'engineering'
        END) AS ROLE FROM "EMP"
        """ ];
    rr:subjectMap [
        rr:template "http://data.example.com/employee/{\"empno\"}";
        rr:class emp:Employee
    ];
    rr:predicateObjectMap [
      rr:predicate		emp:name ;
      rr:objectMap    [ rr:column "\"ename\"" ];
    ];
    rr:predicateObjectMap [
        rr:predicate emp:role;
        rr:objectMap [ rr:template "http://data.example.com/roles/{ROLE}" ];
    ];
    rr:predicateObjectMap [
        rr:predicate emp:department;
        rr:objectMap [ rr:template "http://example.com/dept/{\"deptno\"}"; ];
    ].</code></pre></div></div></div></div></div><div class="sect1"><h2 id="_unstructured_data"><a class="link" href="#_unstructured_data">Unstructured Data</a></h2><div class="sectionbody"><div class="paragraph"><p>Unifying unstructured data is, by necessity, a different process from unifying structured or semistructured data. As of 4.2, Stardog includes a document storage subsystem called BITES<span class="footnote">[<a id="_footnoteref_19" class="footnote" href="#_footnote_19" title="View footnote.">19</a>]</span>, which provides configurable storage and processing for unifying unstructured data with the Stardog graph.</p></div><div class="sect2"><h3 id="_background_assumptions"><a class="link" href="#_background_assumptions">Background &amp; Assumptions</a></h3><div class="paragraph"><p>BITES makes some simplfying assumptions in Stardog 5.0.0beta with respect to unstructured data unification--</p></div><div class="ulist"><ul><li><p>Unbounded blobs in the database are a bad idea; Stardog manages documents (any files, actually) in the local filesystem, in AWS S3, or (soon) in HDFS.</p></li><li><p>Documents are the most common kind of enterprise unstructured data.</p></li><li><p>There is no general purpose natural language processing, which means <strong>extraction of structured data from unstructured documents</strong> isn&#8217;t a generally solved problem, which in turns means Stardog users have to define (an optional) workflow for Stardog to call on document ingest.</p></li><li><p>We can&#8217;t train a classifier on data we don&#8217;t have; which, again, means Stardog users have to train classifiers, extractors, entity or relationship learners, etc. on their data. Stardog will unify the results into its graph.</p></li><li><p>Sometimes document context matters, sometimes it doesn&#8217;t; in other words, Stardog (optionally) store and retrieve the original document on demand over REST, but in some cases this isn&#8217;t required or needed.</p></li></ul></div></div><div class="sect2"><h3 id="_basic_usage"><a class="link" href="#_basic_usage">Basic Usage</a></h3><div class="paragraph"><p>See the <a href="#_man_pages">Man Pages</a> for the CLI usage details, including how to interact with the HTTP API for BITES.</p></div></div><div class="sect2"><h3 id="_storage"><a class="link" href="#_storage">Storage</a></h3><div class="paragraph"><p>BITES allows storage and retrieval of documents in the form of files. Stardog treats documents as opaque blobs of data; it defers to the extraction process to make sense of individual documents. Document storage is independent of file and data formats.</p></div><div class="paragraph"><p>Stardog internally stores documents as files. The location of these files defaults to a subdirectory of <code>STARDOG_HOME</code> but this can be overridden. Documents can be stored on local filesystem, or an abstraction thereof, accessible from the Stardog server or on Amazon S3 by setting the <code>docs.filesystem.uri</code> configuration option. The exact location is given by the <code>docs.path</code> configuration option.</p></div></div><div class="sect2"><h3 id="_structured_data_extraction"><a class="link" href="#_structured_data_extraction">Structured Data Extraction</a></h3><div class="paragraph"><p>BITES supports an optional processing stage in which a document is processed to extract an RDF graph to add to the database. The default extractor, based on Apache Tika, collects metadata about the document and asserts this set of RDF statements to a named graph specific to the document. This pipeline is flexible and allows for arbitrary extraction components including NLP and ML methods.</p></div></div><div class="sect2"><h3 id="_text_extraction"><a class="link" href="#_text_extraction">Text Extraction</a></h3><div class="paragraph"><p>The document store is fully integrated with Stardog&#8217;s <a href="#Full-Text Search">[Full-Text Search]</a>. As with RDF extraction, text extraction supports arbitrary file formats and pluggable extractors are able to retrieve the textual contents of a document for indexing. Once a document is added to BITES, its contents can be searched in the same way as other literals using the standard <code>textMatch</code> predicate in SPARQL queries.</p></div></div><div class="sect2"><h3 id="_managing_documents"><a class="link" href="#_managing_documents">Managing Documents</a></h3><div class="paragraph"><p>CRUD operations on documents can be performed from the command line, Java API or HTTP API. Please refer to the <a href="/java/snarl/com/complexible/stardog/docs/StardocsConnection.html">StardocsConnection</a> API for details of using the document store from Java.</p></div><div class="paragraph"><p>The following is an example session showing how to manage documents from the command line:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># We have a document stored in the file `whyfp90.pdf' which we will add to the document store
$ ls -al whyfp90.pdf
-rw-r--r-- 1 user user 200007 Aug 30 09:46 whyfp90.pdf

# We add it to the document store and receive the document's IRI as a return value
$ bin/stardog doc put myDB whyfp90.pdf
Successfully put document in the document store: tag:stardog:api:docs:myDB:whyfp90.pdf

# Alternatively, we can add it with a different name. Repeated calls
# will update the document and refresh extraction results
$ bin/stardog doc put myDB --name why-functional-programming-matters.pdf whyfp90.pdf
Successfully put document in the document store: tag:stardog:api:docs:myDB:why-functional-programming-matters.pdf

# We can subsequently retrieve documents and store them locally
$ bin/stardog doc get myDB whyfp90.pdf
Wrote document 'whyfp90.pdf' to file 'whyfp90.pdf'
# Local files will not be overwritten
$ bin/stardog doc get myDB whyfp90.pdf
File 'whyfp90.pdf' already exists. You must remove it or specify a different filename.

# How many documents are in the document store?
$ bin/stardog doc count myDB
Count: 2 documents

# Removing a document will also clear it's named graph and full-text search index entries
$ bin/stardog doc delete myDB whyfp90.pdf
Successfully executed deletion.</code></pre></div></div></div><div class="sect2"><h3 id="_named_graphs_and_document_queries"><a class="link" href="#_named_graphs_and_document_queries">Named Graphs and Document Queries</a></h3><div class="paragraph"><p>Documents in BITES are identified by IRI. As shown in the command line examples above, the IRI is returned from a document <code>put</code> call. The IRI is a combination of a prefix, the database name, and the document name. The CLI uses the document name to refer to the documents. The RDF index, and therefore SPARQL queries, use the IRIs to refer to the documents. RDF assertions extracted from a document are placed into a named graph identified by the document&#8217;s IRI.</p></div><div class="paragraph"><p>Here we can see the results of querying a document&#8217;s named graph when using the default metadata extractor:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ bin/stardog query execute myDB "select ?p ?o { graph &lt;tag:stardog:api:docs:myDB:whyfp90.pdf&gt; { ?s ?p ?o } }"

+--------------------------------------------+--------------------------------------+
|                     p                      |                  o                   |
+--------------------------------------------+--------------------------------------+
| rdf:type                                   | http://xmlns.com/foaf/0.1/Document   |
| rdf:type                                   | tag:stardog:api:docs:Document        |
| tag:stardog:api:docs:fileSize              | 200007                               |
| http://purl.org/dc/elements/1.1/identifier | "whyfp90.pdf"                        |
| rdfs:label                                 | "whyfp90.pdf"                        |
| http://ns.adobe.com/pdf/1.3/PDFVersion     | "1.3"                                |
| http://ns.adobe.com/xap/1.0/CreatorTool    | "TeX"                                |
| http://ns.adobe.com/xap/1.0/t/pg/NPages    | 23                                   |
| http://purl.org/dc/terms/created           | "2006-05-19T13:42:00Z"^^xsd:dateTime |
| http://purl.org/dc/elements/1.1/format     | "application/pdf; version=1.3"       |
| http://ns.adobe.com/pdf/1.3/encrypted      | "false"                              |
+--------------------------------------------+--------------------------------------+

Query returned 11 results in 00:00:00.045</code></pre></div></div></div><div class="sect2"><h3 id="_custom_extractors"><a class="link" href="#_custom_extractors">Custom Extractors</a></h3><div class="paragraph"><p>The included metadata extractor is intentionally basic, especially when compared to machine learning or text mining algorithms. A custom extractor connects the document store to algorithms tailored specifically to your data. The extractor SPI allows integration of any arbitrary workflow or algorithm from NLP methods like part-of-speech tagging, entity recognition, relationship learning, or sentiment analysis to machine learning models such as document ranking and clustering.</p></div><div class="paragraph"><p>Extracted RDF assertions are stored in a named graph specific to the document, allowing provenance tracking and versatile querying. The extractor must implement the <a href="/java/snarl/com/complexible/stardog/docs/extraction/RDFExtractor.html">RDFExtractor</a> interface. The convenience class <a href="/java/snarl/com/complexible/stardog/docs/extraction/tika/TextProvidingRDFExtractor.html">TextProvidingRDFExtractor</a> is provided which extracts the text from the document before calling the extractor.</p></div><div class="paragraph"><p>The text extractor SPI gives you the opportunity to support arbitrary document formats. Implementations will be given a raw document and be expected to extract a string of text which will be added to the full-text search index. Text extractors should implement the <a href="/java/snarl/com/complexible/stardog/docs/extraction/TextExtractor.html">TextExtractor</a> interface.</p></div><div class="paragraph"><p>Custom extractors are registered with the Java ServiceLoader under the <a href="/java/snarl/com/complexible/stardog/docs/extraction/RDFExtractor.html">RDFExtractor</a> or <a href="/java/snarl/com/complexible/stardog/docs/extraction/TextExtractor.html">TextExtractor</a> class names. Custom extractors can be referred to from the command line or APIs by their fully qualified or "simple" class names.</p></div></div></div></div><h1 id="_high_availability_cluster" class="sect0"><a class="link" href="#_high_availability_cluster">High Availability Cluster</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/cluster.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>In this section we explain how to configure, use, and administer Stardog Cluster for uninterrupted operations. Stardog Cluster is a collection of Stardog Server instances running on one or more virtual or physical machines that, <strong>from the client&#8217;s perspective</strong>, behave like a single Stardog Server instance. To fully achieve this effect requires DNS (i.e., with <code>SRV</code> records) and proxy configuration that&#8217;s left as an exercise for the user. Of course Stardog Cluster should have some different operational properties, the main one of which is high availability. But from the client&#8217;s perspective Stardog Cluster should be indistinguishable from non-clustered Stardog.<span class="footnote">[<a id="_footnoteref_20" class="footnote" href="#_footnote_20" title="View footnote.">20</a>]</span></p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">High Availability requires <strong>at least</strong> three Stardog and three ZooKeeper nodes in the Cluster. ZooKeeper works best, with respect to fault resiliency, with an ensemble size that is an odd-number greater than or equal to three: 3, 5, 7, etc.<span class="footnote">[<a id="_footnoteref_21" class="footnote" href="#_footnote_21" title="View footnote.">21</a>]</span> With respect to performance, larger cluster sizes (Stardog and ZooKeeper) perform better than smaller ones for reads, while larger cluster sizes perform worse for writes. It is responsibility of the administrator to find the right balance.</td></tr></table></div></div></div><div class="sect1"><h2 id="_guarantees"><a class="link" href="#_guarantees">Guarantees</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog Cluster implements an atomic commitment protocol based on <a href="http://en.wikipedia.org/wiki/Two-phase_commit_protocol">two-phase commit (2PC)</a> over a shared replicated memory that&#8217;s provided by Apache ZooKeeper. A cluster is composed of a set of Stardog servers and a ZooKeeper ensemble running together. One of the Stardog servers is the Coordinator and the others are Participants.</p></div><div class="paragraph"><p>In case the Coordinator fails at any point, a new Coordinator will be elected out of the remaining available Participants. Stardog Cluster supports both <code>read</code> (e.g., querying) and <code>write</code> (e.g., adding data) requests. All read and write requests can be handled by any of the nodes in the cluster. When a client commits a transaction (containing a list of <code>write</code> requests), it will be acknowledged by the receiving node only <strong>after every non-failing peer node has committed the transaction</strong>. If a peer node fails during the process of committing a transaction, it will be expelled from the cluster by the Coordinator and put in a temporary <code>failed</code> state. If the Coordinator fails during the process, the transaction will be aborted. At that point the client can retry the transaction and it should succeed with the new cluster coordinator.</p></div><div class="paragraph"><p>Since <code>failed</code> nodes are not used for any subsequent <code>read</code> or <code>write</code> requests, <strong>if a commit is acknowledged, then Stardog Cluster guarantees that the data has been accordingly modified at <strong>every</strong> available node in the cluster</strong>.</p></div><div class="paragraph"><p>While this approach is less performant with respect to write operations than eventual consistency used by other distributed databases, typically those databases offer a much less expressive data model than Stardog, which makes an eventually consistency model more appropriate for those systems (and less so for Stardog). But since Stardog&#8217;s data model is not only richly expressive but rests in part on provably correct semantics, we think that a strong consistency model is worth the cost.<span class="footnote">[<a id="_footnoteref_22" class="footnote" href="#_footnote_22" title="View footnote.">22</a>]</span></p></div></div></div><div class="sect1"><h2 id="_single_server_migration"><a class="link" href="#_single_server_migration">Single Server Migration</a></h2><div class="sectionbody"><div class="paragraph"><p>It is assumed that Stardog nodes in a Stardog Cluster are always going to be used within a cluster context. Therefore, if you want to migrate from a Stardog instance running in single server mode to running in a cluster, it is advised that you create backups of your current databases and then import them to the cluster in order to be able to provide the guarantees explained above. If you simply add a Stardog instance to cluster that was previously running in single server mode, <em>it will sync to the state of the cluster</em>; local data could be removed when syncing with the cluster state.</p></div></div></div><div class="sect1"><h2 id="_configuration"><a class="link" href="#_configuration">Configuration</a></h2><div class="sectionbody"><div class="paragraph"><p>To deploy Stardog Cluster you use <code>stardog-admin</code> commands and some additional configuration. Stardog Cluster depends on Apache ZooKeeper.</p></div><div class="paragraph"><p>You may be able to use <code>stardog-admin cluster generate</code> to bootstrap a cluster configuration and, thus, to ease installation by simply passing a list of hostnames or IP addresses for the cluster&#8217;s nodes.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin cluster generate --output-dir /home/stardog 10.0.0.1 10.0.0.2 10.0.0.3</code></pre></div></div><div class="paragraph"><p>See the <a href="/man/cluster-generate.html">man page</a> for the details.</p></div><div class="paragraph"><p>In a production environment we strongly recommend that each ZooKeeper process runs in a different machine and, if possible, that ZooKeeper has a separate drive for its data directory. If you need a larger cluster, adjust accordingly.</p></div><div class="paragraph"><p>In the following example we will set up a cluster with total of 6 nodes. Zookeeper will be deployed on nodes 1-3 whereas Stardog will be deployed on nodes 4-6.</p></div><div class="olist arabic"><ol class="arabic"><li><p><a href="#_quick_start_guide">Install</a> Stardog 5.0.0beta on each machine in the cluster.</p><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">The best thing to do here, of course, is to use whatever infrastructure you have in place to automate software installation. Adapting Stardog installation to Chef, Puppet, cfengine, etc. is left as an exercise for the reader.</td></tr></table></div></li><li><p>Make sure a valid Stardog license key (whether Developer, Enterprise, or a 30-day eval key) for the size of cluster you&#8217;re creating exists and resides in <code>STARDOG_HOME</code> on each node. You must also have a <code>stardog.properties</code> file with the following information <strong>for each Stardog node in the cluster</strong>:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"># Flag to enable the cluster, without this flag set, the rest of the properties have no effect
pack.enabled=true
# this node's IP address (or hostname) where other Stardog nodes are going to connect
# this value is optional but if provided it should be unique for each Stardog node
pack.node.address=196.69.68.4
# the connection string for ZooKeeper where cluster state is stored
pack.zookeeper.address=196.69.68.1:2180,196.69.68.2:2180,196.69.68.3:2180</code></pre></div></div><div class="paragraph"><p><code>pack.zookeeper.address</code> is a ZooKeeper connection string where cluster stores its state. <code>pack.node.address</code> is not a required property. The local address of the node, by default, is <code>InetAddress.getLocalhost().getAddress()</code>, which should work for many deployments. However if you&#8217;re using an atypical network topology and the default value is not correct, you can provide a value for this property.</p></div></li><li><p>Create the ZooKeeper configuration for each Zookeeper node. This config file is just a standard ZooKeeper configuration file and the same config file can be used for all Zookeeper nodes. The following config file should be sufficient for most cases.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">tickTime=3000
# Make sure this directory exists and
# ZK can write and read to and from it.
dataDir=/data/zookeeperdata/
clientPort=2180
initLimit=5
syncLimit=2
# This is an enumeration of all Zk nodes in
# the cluster and must be identical in
# each node's config.
server.1=196.69.68.1:2888:3888
server.2=196.69.68.2:2888:3888
server.3=196.69.68.3:2888:3888</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">The <code>clientPort</code> specified in <code>zookeeper.properties</code> and the ports used in <code>pack.cluster.address</code> in <code>stardog.properties</code> must be the same.</td></tr></table></div></li><li><p><code>dataDir</code> is where ZooKeeper persists cluster state and where it writes log information about the cluster.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ mkdir /data/zookeeperdata # on node 1
$ mkdir /data/zookeeperdata # on node 2
$ mkdir /data/zookeeperdata # on node 3</code></pre></div></div></li><li><p>ZooKeeper requires a <code>myid</code> file in the <code>dataDir</code> folder to identify itself, you will create that file as follows for <code>node1</code>, <code>node2</code>, and <code>node3</code>, respectively:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ echo 1 &gt; /data/zookeeperdata/myid # on node 1
$ echo 2 &gt; /data/zookeeperdata/myid # on node 2
$ echo 3 &gt; /data/zookeeperdata/myid # on node 3</code></pre></div></div></li></ol></div></div></div><div class="sect1"><h2 id="_installation"><a class="link" href="#_installation">Installation</a></h2><div class="sectionbody"><div class="paragraph"><p>In the next few steps you will use the Stardog Admin CLI commands to deploy Stardog Cluster: that is, ZooKeeper and Stardog itself. We&#8217;ll also configure HAProxy<span class="footnote">[<a id="_footnoteref_23" class="footnote" href="#_footnote_23" title="View footnote.">23</a>]</span> as an example of how to use of Stardog Cluster behind a proxy for load-balancing and fail-over capability.</p></div><div class="olist arabic"><ol class="arabic"><li><p><strong>Start ZooKeeper instances</strong></p><div class="paragraph"><p>First, you need to start ZooKeeper nodes. You can do this using the standard command line tools that come with ZooKeeper. As a convenience, we provide a <code>stardog-admin cluster zkstart</code> subcommand that you can use to start ZooKeeper instances:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin cluster zkstart --home ~/stardog # on node 1
$ ./stardog-admin cluster zkstart --home ~/stardog # on node 2
$ ./stardog-admin cluster zkstart --home ~/stardog # on node 3</code></pre></div></div><div class="paragraph"><p>This uses the <code>zookeeper.properties</code> config file in <code>~/stardog</code> and log its output to <code>~/stardog/zookeeper.log</code>. If your <code>$STARDOG_HOME</code> is set to <code>~/stardog</code>, then you don&#8217;t need to specify the <code>--home</code> option. For more info about the command:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin help cluster zkstart</code></pre></div></div></li><li><p><strong>Start Stardog instances</strong></p><div class="paragraph"><p>Once ZooKeeper is started, you can start Stardog instances:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin server start --home ~/stardog --port 5821 # on node 4
$ ./stardog-admin server start --home ~/stardog --port 5821 # on node 5
$ ./stardog-admin server start --home ~/stardog --port 5821 # on node 6</code></pre></div></div><div class="paragraph"><p><strong>Important:</strong> When starting Stardog instances for the cluster, unlike single server mode, you need to provide the credentials of a superuser that will be used for securing the data stored in ZooKeeper and for intra-cluster communication. Each node should be started with the same superuser credentials. By default, Stardog comes with a superuser <code>admin</code> that has password <code>"admin"</code> and that is the default credentials used by the above command. For a secure installation of Stardog cluster you should change these credentials and restart the cluster with new credentials.</p></div><div class="paragraph"><p>And again, if your <code>$STARDOG_HOME</code> is set to <code>~/stardog</code>, you don&#8217;t need to specify the <code>--home</code> option.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Make sure to allocate roughly twice as much heap for Stardog than you would normally do for single-server operation since there can be an additional overhead involved for replication in the cluster. Also, we start Stardog here on the non-default port (<code>5821</code>) so that you can use a proxy or load-balancer in the same machine which can run on the default port (<code>5820</code>), meaning that Stardog clients can act normally (i.e., use the default port, <code>5820</code>) since they need to interact with HAProxy.</td></tr></table></div></li><li><p><strong>Start HAProxy</strong></p><div class="paragraph"><p>In most Unix-like systems, HAProxy is available via package managers, e.g. in Debian-based systems:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ sudo apt-get update
$ sudo apt-get install haproxy</code></pre></div></div><div class="paragraph"><p>At the time of this writing, this will install HAProxy 1.4. You can refer to the <a href="http://www.haproxy.org/">official site</a> to install a later release.</p></div><div class="paragraph"><p>Place the following configuration in a file (such as <code>haproxy.cfg</code>) in order to point HAProxy to the Stardog Cluster.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text" data-lang="text">global
    daemon
    maxconn 256

defaults
    # you should update these values to something that makes
    # sense for your use case
    timeout connect 5s
    timeout client 1h
    timeout server 1h

# where HAProxy will listen for connections
frontend stardog-in
    option tcpka # keep-alive
    bind *:5820
    default_backend stardogs

# the Stardog servers
backend stardogs
    option tcpka # keep-alive
    # the following line performs a health check
    # HAProxy will check that each node accepts connections and
    # that it's operational within the cluster. Health check
    # requires that Stardog nodes do not use --no-http option
    option httpchk GET /admin/healthcheck
    # replace these IP addresses with the corresponding node address
    # maxconn value can be upgraded if you expect more concurrent
    # connections
    server stardog1 196.69.68.1:5821 maxconn 64 check
    server stardog2 196.69.68.2:5821 maxconn 64 check
    server stardog3 196.69.68.3:5821 maxconn 64 check</code></pre></div></div><div class="paragraph"><p>If you wish to operate the cluster in HTTP-only mode, you can add the <code>mode http</code> to backend settings.</p></div><div class="paragraph"><p>Finally,</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ haproxy -f haproxy.cfg</code></pre></div></div><div class="paragraph"><p>For more info on configuring HAProxy please refer to the <a href="http://www.haproxy.org/#docs">official documentation</a>. In production environments we recommend running multiple proxies to avoid single point of failures, and use DNS solutions for fail-over.</p></div><div class="paragraph"><p>Now Stardog Cluster is running on 3 nodes, one each on 3 machines. Since HAProxy was conveniently configured to use port <code>5820</code> you can execute standard Stardog CLI commands to the Cluster:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin db create -n myDb
$ ./stardog data add myDb /path/to/my/data
$ ./stardog query myDb "select * { ?s ?p ?o } limit 5"</code></pre></div></div></li></ol></div></div></div><div class="sect1"><h2 id="_shutdown"><a class="link" href="#_shutdown">Shutdown</a></h2><div class="sectionbody"><div class="paragraph"><p>In order to shut down the cluster you only need to execute the following command once:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin cluster stop</code></pre></div></div><div class="paragraph"><p>The <code>cluster stop</code> request will cause all available nodes in the cluster to shutdown. If a node was expelled from the cluster due to a failure it would not receive this command and might need to be shutdown manually. In order to shutdown a single node in the cluster use the regular <code>server stop</code> command and be sure to specify the server address:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin --server snarl://localhost:5821 server stop</code></pre></div></div><div class="paragraph"><p>If you send the <code>server stop</code> command to the load balancer then <strong>a random node selected by the load balancer will shutdown.</strong></p></div><div class="paragraph"><p>In addition to the Stardog cluster you still need to shut down ZooKeeper independently. Refer to ZooKeeper documentation for details.</p></div><div class="sidebarblock"><div class="content"><div class="title">Running Stardog Cluster on a Single Machine</div><div class="paragraph"><p>For testing, development, or other purposes it may be advantageous to run Stardog Cluster on a single machine. Of course this won&#8217;t provide much actual high availability, but it may be a reasonable choice in some cases.</p></div><div class="paragraph"><p>The following changes must be made to the multi-machine configuration and installation described previously:</p></div><div class="hdlist"><table><tr><td class="hdlist1">Stardog configuration</td><td class="hdlist2"><div class="ulist"><ul><li><p>different <code>STARDOG_HOME</code> for each node</p></li><li><p>different Stardog port for each node; the easiest setup is if no Stardog listens on port <code>5820</code></p></li><li><p>at least one (but no more than one) proxy on port <code>5820</code></p></li><li><p>different Watchdog port for each node via <code>watchdog.port</code> in <code>stardog.properties</code></p></li></ul></div></td></tr><tr><td class="hdlist1">ZooKeeper configuration</td><td class="hdlist2"><div class="ulist"><ul><li><p>different, that is, non-overlapping port ranges for each node</p></li><li><p>different data directory for each node (e.g., different subdirectories in <code>/data/zookeeperdata</code>)</p></li></ul></div></td></tr></table></div></div></div></div></div><div class="sect1"><h2 id="_configuration_issues"><a class="link" href="#_configuration_issues">Configuration Issues</a></h2><div class="sectionbody"><div class="sect2"><h3 id="_topologies_size"><a class="link" href="#_topologies_size">Topologies &amp; Size</a></h3><div class="paragraph"><p>In the configuration instructions above, we assume a particular Cluster topology, which is to say, for each node <code>n</code> of a cluster, we run Stardog, ZooKeeper, and HAProxy. But this is not the only topology supported by Stardog Cluster. ZooKeeper nodes run independently, so other topologies&#8212;&#8203;three ZooKeeper servers and five Stardog servers are possible&#8212;&#8203;you just have to point Stardog to the corresponding ZooKeeper ensemble.</p></div><div class="paragraph"><p>To add more Stardog Cluster nodes, simply repeat the steps for Stardog on additional machines. Generally, as mentioned above, Stardog Cluster size should be an odd number greater or equal to 3.</p></div><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">ZooKeeper uses a very write heavy protocol; having Stardog and ZooKeeper both writing to the <strong>same</strong> disk can yield contention issues, resulting in timeouts at scale. We recommend at a minimum having the two services writing to separate disks to reduce contention or, ideally, have them run on separate nodes entirely.</td></tr></table></div></div><div class="sect2"><h3 id="_open_file_limits"><a class="link" href="#_open_file_limits">Open File Limits</a></h3><div class="paragraph"><p>If you expect to use Stardog Cluster with heavy concurrent write workloads, then you should probably increase the number of open files that host OS will permit on each Cluster node. You can typically do this on a Linux machine with <code>ulimit -n</code> or some variant thereof. Because nodes communicate between themselves and with ZooKeeper, it&#8217;s important to make sure that there are sufficient file handle resources available.<span class="footnote">[<a id="_footnoteref_24" class="footnote" href="#_footnote_24" title="View footnote.">24</a>]</span></p></div></div><div class="sect2"><h3 id="_connection_session_timeouts"><a class="link" href="#_connection_session_timeouts">Connection/Session Timeouts</a></h3><div class="paragraph"><p>Stardog nodes connect to the ZooKeeper cluster and establishes a <a href="https://zookeeper.apache.org/doc/trunk/zookeeperProgrammers.html#ch_zkSessions">session</a>. The session is kept alive by PING requests sent by the client. If the Stardog node does not send these requests to the ZooKeeper server (due to network issues, node failure, etc.) the session will timeout and the Stardog node will get into a suspended state and it will reject any queries or transactions until it can establish the session again.</p></div><div class="paragraph"><p>If a Stardog node is overloaded then it might fail to send the PING requests to ZooKeeeper server in a timely manner. This usually happens when Stardog&#8217;s memory usage is close to the limit and there are frequent GC pauses. This would cause Stardog nodes to be suspended unnecessarily. In order to prevent this problem make sure Stardog nodes have enough memory allocated and tweak the timeout options.</p></div><div class="paragraph"><p>There are two different configuration options that control timeouts for the ZooKeeper server. The <code>pack.connection.timeout</code> option specifies the max time that Stardog waits to establish a connection to ZooKeeper. The <code>pack.session.timeout</code> option specifies the session timeout explained above. You can set these values in <code>stardog.properties</code> as follows:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">pack.connection.timeout=15s
pack.session.timeout=60s</code></pre></div></div><div class="paragraph"><p>Note that, ZooKeeper has limitations about how these values can be set based on the <code>tickTime</code> value specified in the ZooKeeper configuration file. Session timeout needs to be a minimum of 2 times the <code>tickTime</code> and a maximum of 20 times the <code>tickTime</code>. So a session timeout of <code>60s</code> requires the <code>tickTime</code> to be at least <code>3s</code> (in ZooKepeer configuration file this value should be entered in milliseconds). If the session timeout is not in the allowed range the ZooKeeper will negotiate a new timeout value and Stardog will print a warning about this in the <code>stardog.log</code> file.</p></div></div><div class="sect2"><h3 id="_client_usage"><a class="link" href="#_client_usage">Client Usage</a></h3><div class="paragraph"><p>To use Stardog Cluster with standard Stardog clients and CLI tools in the ordinary way--<code>stardog-admin</code> and <code>stardog</code>--you must have Stardog installed locally. With the provided Stardog binaries in the Stardog Cluster distribution you can query the state of Cluster:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin --server snarl://&lt;ipaddress&gt;:5820/ cluster info</code></pre></div></div><div class="paragraph"><p>where <code>ipaddress</code> is the IP address of any of the nodes in the cluster. This will print the available nodes in the cluster, as well as the roles (participant or coordinator). You can also input the proxy IP address and port to get the same information.</p></div><div class="paragraph"><p>To add or remove data, issue <code>stardog data add</code> or <code>remove</code> commands to any node in the cluster. Queries can be issued to any node in the cluster using the <code>stardog query</code> command. All the <code>stardog-admin</code> features are also available in Cluster, which means you can use any of the commands to create databases, administer users, and the rest of the functionality.</p></div></div></div></div><div class="sect1"><h2 id="_management"><a class="link" href="#_management">Management</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog Cluster may be managed more easily by using <a href="http://github.com/complexible/stardog-release">Stardog Release</a>, a new, open source Stardog Cluster management system. Stardog Release is based on <a href="http://bosh.io">BOSH</a>, "an open source tool chain for release engineering, deploying and lifecycle management of large scale distributed services" from <a href="http://https://run.pivotal.io/">Pivotal Cloud Foundry</a>. Using BOSH, you can manage Stardog Cluster more easily than ever before; with Stardog Release you can install and update Stardog Cluster "on large numbers of VMs over many IaaS platforms with the absolute minimum of configuration changes".</p></div><div class="paragraph"><p>See the <a href="http://github.com/complexible/stardog-release">Stardog Release</a> Github repo for installation, configuration, and usage.</p></div><div class="paragraph"><p>See the <a href="http://bosh.io/docs">BOSH docs</a> for more details.</p></div><div class="sect2"><h3 id="_limitations"><a class="link" href="#_limitations">Limitations</a></h3><div class="paragraph"><p>The notable limitations of Stardog Release as of Stardog 3.1:</p></div><div class="ulist"><ul><li><p>supports AWS and BOSH Lite (local machine) deployments only&#8212;&#8203;if you need OpenStack, vSphere, or vCloud deployment, ping us.</p></li><li><p>VMs only</p></li></ul></div></div></div></div><h1 id="_search" class="sect0"><a class="link" href="#_search">Search</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/search.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>Stardog&#8217;s builtin full-text search system indexes data stored in Stardog for information retrieval queries.</p></div></div></div><div class="sect1"><h2 id="_indexing_strategy"><a class="link" href="#_indexing_strategy">Indexing Strategy</a></h2><div class="sectionbody"><div class="paragraph"><p>The indexing strategy creates a "search document" per RDF literal. Each document consists of the following fields: literal ID; literal value; and contexts. See <a href="#_user_defined_lucene_analyzer">User-defined Lucene Analyzer</a> for details on customizing Stardog&#8217;s search programmatically.</p></div></div></div><div class="sect1"><h2 id="_maintaining_search_indexes"><a class="link" href="#_maintaining_search_indexes">Maintaining Search Indexes</a></h2><div class="sectionbody"><div class="paragraph"><p>See the Admin chapter section on <a href="#_configuration_options">Configuration Options</a> for the details.</p></div></div></div><div class="sect1"><h2 id="_integration_with_sparql"><a class="link" href="#_integration_with_sparql">Integration with SPARQL</a></h2><div class="sectionbody"><div class="paragraph"><p>We use the predicate <code>tag:stardog:api:property:textMatch</code> (or <code>http://jena.hpl.hp.com/ARQ/property#textMatch</code>) to access the search index in a SPARQL query.</p></div><div class="paragraph"><p>The <code>textMatch</code> function has one required argument, the search query in Lucene syntax and it returns, by default top 50, literals matching the query string. For example,</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-SPARQL" data-lang="SPARQL">SELECT DISTINCT ?s ?score
WHERE {
?s ?p ?l.
(?l ?score) &lt;tag:stardog:api:property:textMatch&gt; 'mac'.
}</code></pre></div></div><div class="paragraph"><p>This query selects the top 50 literals which match 'mac'. These literals are then joined with the generic BGP <code>?s ?p ?l</code> to get the resources (<code>?s</code>) that have those literals. Alternatively, you could use <code>?s rdf:type ex:Book</code> if you only wanted to select the books which reference the search criteria; you can include as many other BGPs as you like to enhance your initial search results.</p></div><div class="paragraph"><p>You can change the number of results <code>textMatch</code> returns by providing an optional second argument with the limit:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-SPARQL" data-lang="SPARQL">SELECT DISTINCT ?s ?score
WHERE {
?s ?p ?l.
(?l ?score) &lt;tag:stardog:api:property:textMatch&gt; ('mac' 100).
}</code></pre></div></div><div class="paragraph"><p>Note that, limit in <code>textMatch</code> only limits the number of literals returned and different than the number of total results the query will return. When a <code>LIMIT</code> is specified in the SPARQL query, it does not affect the full-text search, that only restricts the size of the final result set.</p></div><div class="paragraph"><p>Lucene returns a <a href="https://lucene.apache.org/core/5_3_0/core/org/apache/lucene/search/package-summary.html#scoring">score</a> with each match. It is possible to return these scores and define filters based on the score:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-SPARQL" data-lang="SPARQL">SELECT DISTINCT ?s ?score
WHERE {
?s ?p ?l.
(?l ?score) &lt;tag:stardog:api:property:textMatch&gt; ('mac' 0.5 10).
}</code></pre></div></div><div class="paragraph"><p>This query returns 10 matching literals where the score is <strong>greater than</strong> 0.5. Note that, as explained in the <a href="https://lucene.apache.org/core/5_3_0/core/org/apache/lucene/search/package-summary.html#scoring">Lucene documentation</a> scoring is very much dependent on the way documents are indexed and the range of scores might change significantly between different databases.</p></div><div class="sect2"><h3 id="_escaping_characters_in_search"><a class="link" href="#_escaping_characters_in_search">Escaping Characters in Search</a></h3><div class="paragraph"><p>The "/" character must be escaped because Lucene says so. In fact, there are several characters that are part of Lucene&#8217;s query syntax that must be <a href="http://lucene.apache.org/core/5_3_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#Escaping_Special_Characters">escaped</a>.</p></div></div></div></div><div class="sect1"><h2 id="_search_syntax"><a class="link" href="#_search_syntax">Search Syntax</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog search is based on Lucene 5.3.0: we support all of the <a href="http://lucene.apache.org/core/5_3_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package_description">search modifiers</a> that Lucene supports, with the exception of fields.</p></div><div class="ulist"><ul><li><p>wildcards: <code>?</code> and <code>*</code></p></li><li><p>fuzzy: <code>~</code> and <code>~</code> with similarity weights (e.g. <code>foo~0.8</code>)</p></li><li><p>proximities: <code>"semantic web"~5</code></p></li><li><p>term boosting</p></li><li><p>booleans: <code>OR</code>, <code>AND</code>, <code>NOT</code>, +<code>, and `-</code>.</p></li><li><p>grouping</p></li></ul></div><div class="paragraph"><p>For a more detailed discussion, see the <a href="http://lucene.apache.org/core/5_3_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package_description">Lucene docs</a>.</p></div></div></div><h1 id="_owl_rule_reasoning" class="sect0"><a class="link" href="#_owl_rule_reasoning">OWL &amp; Rule Reasoning</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/owl2.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>In this chapter we describe how to use Stardog&#8217;s reasoning capabilities; we address some common problems and known issues. We also describe Stardog&#8217;s approach to query answering with reasoning in some detail, as well as a set of guidelines that contribute to efficient query answering with reasoning. If you are not familiar with the terminology, you can peruse the section on terminology.</p></div><div class="paragraph"><p>The semantics of Stardog&#8217;s reasoning is based in part on the <a href="http://www.w3.org/TR/2010/WD-sparql11-entailment-20100126/#id45013">OWL 2 Direct Semantics Entailment Regime</a>. However, the implementation of Stardog&#8217;s reasoning system is worth understanding as well. For the most part, <strong>Stardog performs reasoning in a lazy and late-binding fashion: it does not materialize inferences; but, rather, reasoning is performed at query time according to a user-specified "reasoning type".</strong> This approach allows for maximum flexibility<span class="footnote">[<a id="_footnoteref_25" class="footnote" href="#_footnote_25" title="View footnote.">25</a>]</span> while maintaining excellent performance. The one exception to this general approach is equality reasoning which is eagerly materialized. See <a href="#_same_as_reasoning">Same As Reasoning</a> for more details.</p></div></div></div><div class="sect1"><h2 id="_reasoning_types"><a class="link" href="#_reasoning_types">Reasoning Types</a></h2><div class="sectionbody"><div class="paragraph"><p>Reasoning can be enabled or disabled using a simple boolean flag&#8212;&#8203;in HTTP, <code>reasoning</code>; in CLI, <code>-r</code> or <code>--reasoning</code>; in the Web Console, a reasoning button in the query panel; and in Java APIs, <a href="http://docs.stardog.com/java/snarl/com/complexible/stardog/api/ConnectionConfiguration.html#reasoning(boolean)">a connection option</a> or <a href="http://docs.stardog.com/java/snarl/com/complexible/stardog/api/Query.html#reasoning(boolean)">a query option</a>:</p></div><div class="hdlist"><table><tr><td class="hdlist1"><code>false</code></td><td class="hdlist2"><p>No axioms or rules are considered; no reasoning is performed.</p></td></tr><tr><td class="hdlist1"><code>true</code></td><td class="hdlist2"><p>Axioms and rules are considered and reasoning is performed according to the value of the <code>reasoning.type</code> database option.</p></td></tr></table></div><div class="paragraph"><p><strong>Reasoning is disabled by default; that is, no reasoning is performed without explicitly setting the reasoning flag to "true"</strong>.</p></div><div class="paragraph"><p>When reasoning is enabled by the boolean flag, the axioms and rules in the database are first filtered according to the value of the <code>reasoning.type</code> database option. The default value of <code>reasoning.type</code> is <code>SL</code> and for the most part users don&#8217;t need to worry too much about which reasoning type is necessary since <code>SL</code> covers all of the OWL 2 profiles as well as user-defined rules via SWRL. However, this value may be set to any other reasoning type that Stardog supports: <code>RDFS</code> is the OWL 2 axioms allowed in <a href="http://www.w3.org/TR/rdf-schema/">RDF Schema</a> (mainly subclasses, subproperties, domain, and ranges); <code>QL</code> for the <a href="http://www.w3.org/TR/owl2-profiles/#OWL_2_QL">OWL 2 QL</a> axioms; <code>RL</code> for the <a href="http://www.w3.org/TR/owl2-profiles/#OWL_2_RL">OWL 2 RL</a> axioms; <code>EL</code> for the <a href="http://www.w3.org/TR/owl2-profiles/#OWL_2_EL">OWL 2 EL</a> axioms; <code>DL</code> for <a href="http://www.w3.org/TR/2012/REC-owl2-syntax-20121211/">OWL 2 DL axioms</a>; and <code>SL</code> for a combination of RDFS, QL, RL, and EL axioms, plus <a href="http://www.w3.org/Submission/SWRL/">SWRL rules</a>. Any axiom outside the selected type will be ignored by the reasoner.</p></div><div class="paragraph"><p>The <code>DL</code> reasoning type behaves significantly different than other types. Stardog normally uses the <a href="#_query_rewriting">Query Rewriting</a> technique for reasoning which scales very well with increasing number of instances; only the schema needs to be kept in memory. But query rewriting cannot handle axioms outside the OWL 2 profiles; however, <code>DL</code> reasoning type can be used so that no axiom or rule is ignored as long as they satisfy <a href="http://www.w3.org/TR/2012/REC-owl2-syntax-20121211/#Global_Restrictions_on_Axioms_in_OWL_2_DL">the OWL 2 DL restrictions</a>. With <code>DL</code> reasoning, both the schema and the instance data need to pulled into memory, which limits its applicability with large number of instances. <code>DL</code> reasoning also requires the database to be logically consistent or no reasoning can be be performed. Finally, <code>DL</code> reasoning requires more computation upfront compared to query rewriting which exhibits a "pay-as-you-go" behavior.</p></div><div class="paragraph"><p>The <code>reasoning.type</code> can also be set to the special value <code>NONE</code> which will filter all axioms and rules thus effectively disables reasoning. This value can be used for the database option to prevent reasoning to be used by any client even though they might enable it with the boolean flag on the client side.</p></div></div></div><div class="sect1"><h2 id="_using_reasoning"><a class="link" href="#_using_reasoning">Using Reasoning</a></h2><div class="sectionbody"><div class="paragraph"><p>In order to perform query evaluation with reasoning, Stardog requires a schema<span class="footnote">[<a id="_footnoteref_26" class="footnote" href="#_footnote_26" title="View footnote.">26</a>]</span> to be present in the database. Since schemas are serialized as RDF, they are loaded into a Stardog database in the same way that any RDF is loaded into a Stardog database. Also, note that, since the schema is just more RDF triples, it may change as needed: it is neither fixed nor compiled in any special way.</p></div><div class="paragraph"><p>The schema may reside in the default graph, in a specific named graph, or in a collection of graphs. <strong>You can tell Stardog where the schema is by setting the <code>reasoning.schema.graphs</code> property to one or more named graph URIs.</strong> If you want the default graph to be considered part of the schema, then you can use the special built-in URI <code>tag:stardog:api:context:default</code>. If you want to use all named graphs (that is, to tell Stardog to look for the schema in every named graph), you can use <code>tag:stardog:api:context:all</code>.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><strong>The default value for this property is to use all graphs, i.e., <code>tag:stardog:api:context:all</code>.</strong></td></tr></table></div><div class="paragraph"><p>This design is intended to support both of Stardog&#8217;s primary use cases:</p></div><div class="olist arabic"><ol class="arabic"><li><p>managing the data that constitutes the schema</p></li><li><p>reasoning with the schema during query evaluation</p></li></ol></div><div class="sect2"><h3 id="_query_answering"><a class="link" href="#_query_answering">Query Answering</a></h3><div class="paragraph"><p>All of Stardog&#8217;s interfaces (API, network, and CLI) support reasoning during query evaluation.</p></div></div><div class="sect2"><h3 id="_command_line"><a class="link" href="#_command_line">Command Line</a></h3><div class="paragraph"><p>In order to evaluate queries in Stardog using reasoning via the command line, we use the reasoning flag:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog query --reasoning myDB "SELECT ?s { ?s a :C } LIMIT 10"</code></pre></div></div></div><div class="sect2"><h3 id="_http"><a class="link" href="#_http">HTTP</a></h3><div class="paragraph"><p>For HTTP, the reasoning flag is specified with the other HTTP request parameters:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ curl -u admin:admin -X GET "http://localhost:5822/myDB/query?reasoning=true&amp;query=..."</code></pre></div></div></div><div class="sect2"><h3 id="_reasoning_connection_api"><a class="link" href="#_reasoning_connection_api">Reasoning Connection API</a></h3><div class="paragraph"><p>In order to use the <code>ReasoningConnection</code> API one needs to enable reasoning. See the <a href="#_java_programming">Java Programming</a> section for details.</p></div><div class="paragraph"><p>Currently, the API has two methods:</p></div><div class="ulist"><ul><li><p><code>isConsistent()</code>, which can be used to check if the database is (logically) consistent with respect to the reasoning type.</p></li><li><p><code>isSatisfiable(URI theURIClass)</code>, which can be used to check if the given class if satisfiable with respect to the database and reasoning type.</p></li></ul></div></div></div></div><div class="sect1"><h2 id="_explaining_reasoning_results"><a class="link" href="#_explaining_reasoning_results">Explaining Reasoning Results</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog can be used to check if the current database logically entails a set of triples; moreover, Stardog can explain why this is so.<span class="footnote">[<a id="_footnoteref_27" class="footnote" href="#_footnote_27" title="View footnote.">27</a>]</span> An explanation of an inference is the minimum set of statements explicitly stored in the database that, together with the schema and any valid inferences, logically justify the inference. Explanations are useful for understanding data, schema, and their interactions, especially when large number of statements interact with each other to infer new statements.</p></div><div class="paragraph"><p>Explanations can be retrieved using the CLI by providing an input file that contains the inferences to be explained:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog reasoning explain myDB inference_to_explain.ttl</code></pre></div></div><div class="paragraph"><p>The output is displayed in a concise syntax designed to be legible; but it can be rendered in any one of the supported RDF syntaxes if desired. Explanations are also accessible through the <a href="#_network_programming">Stardog&#8217;s extended HTTP protocol</a> and <a href="#_java_programming">discussion of SNARL</a>. See the examples in the [stardog-examples Github repo]<a href="https://github.com/Complexible/stardog-examples/" class="bare">https://github.com/Complexible/stardog-examples/</a> for more details about retrieving explanations programmatically.</p></div><div class="sect2"><h3 id="_proof_trees"><a class="link" href="#_proof_trees">Proof Trees</a></h3><div class="paragraph"><p>Proof trees are a hierarchical presentation of multiple explanations (of inferences) to make data, schemas, and rules more intelligible. Proof trees<span class="footnote">[<a id="_footnoteref_28" class="footnote" href="#_footnote_28" title="View footnote.">28</a>]</span> provide an explanation for an inference or an inconsistency as a <strong>hierarchical structure</strong>. Nodes in the proof tree may represent an assertion in a Stardog database. Multiple assertion nodes are grouped under an inferred node.</p></div><div class="sect3"><h4 id="_example"><a class="link" href="#_example">Example</a></h4><div class="paragraph"><p>For example, if we are explaining the inferred triple <code>:Alice rdf:type :Employee</code>, the root of the proof tree will show that inference:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">INFERRED :Alice rdf:type :Employee</code></pre></div></div><div class="paragraph"><p>The children of an inferred node will provide more explanation for that inference:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">INFERRED :Alice rdf:type :Employee
    ASSERTED :Manager rdfs:subClassOf :Employee
    INFERRED :Alice rdf:type :Manager</code></pre></div></div><div class="paragraph"><p>The fully expanded proof tree will show the asserted triples and axioms for every inference:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">INFERRED :Alice rdf:type :Employee
    ASSERTED :Manager rdfs:subClassOf :Employee
    INFERRED :Alice rdf:type :Manager
        ASSERTED :Alice :supervises :Bob
        ASSERTED :supervises rdfs:domain :Manager</code></pre></div></div><div class="paragraph"><p>The CLI explanation command prints the proof tree using indented text; but, using the SNARL API, it is easy to create a tree widget in a GUI to show the explanation tree, such that users can expand and collapse details in the explanation.</p></div><div class="paragraph"><p>Another feature of proof trees is the ability to merge multiple explanations into a single proof tree with multiple branches when explanations have common statements. Consider the following example database:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">#schema
:Manager rdfs:subClassOf :Employee
:ProjectManager rdfs:subClassOf :Manager
:ProjectManager owl:equivalentClass (:manages some :Project)
:supervises rdfs:domain :Manager
:ResearchProject rdfs:subClassOf :Project
:projectID rdfs:domain :Project

#instance data
:Alice :supervises :Bob
:Alice :manages :ProjectX
:ProjectX a :ResearchProject
:ProjectX :projectID "123-45-6789"</code></pre></div></div><div class="paragraph"><p>In this database, there are three different unique explanations for the inference <code>:Alice rdf:type :Employee</code>:</p></div><div class="sect4"><h5 id="_explanation_1"><a class="link" href="#_explanation_1">Explanation 1</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">:Manager rdfs:subClassOf :Employee
:ProjectManager rdfs:subClassOf :Manager
:supervises rdfs:domain :Manager
:Alice :supervises :Bob</code></pre></div></div></div><div class="sect4"><h5 id="_explanation_2"><a class="link" href="#_explanation_2">Explanation 2</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">:Manager rdfs:subClassOf :Employee
:ProjectManager rdfs:subClassOf :Manager
:ProjectManager owl:equivalentClass (:manages some :Project)
:ResearchProject rdfs:subClassOf :Project
:Alice :manages :ProjectX
:ProjectX a :ResearchProject</code></pre></div></div></div><div class="sect4"><h5 id="_explanation_3"><a class="link" href="#_explanation_3">Explanation 3</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">:Manager rdfs:subClassOf :Employee
:ProjectManager rdfs:subClassOf :Manager
:ProjectManager owl:equivalentClass (:manages some :Project)
:projectID rdfs:domain :Project
:Alice :manages :ProjectX
:ProjectX :projectID "123-45-6789"</code></pre></div></div><div class="paragraph"><p>All three explanations have some triples in common; but when explanations are retrieved separately, it is hard to see how these explanations are related. When explanations are merged, we get a single proof tree where alternatives for subtrees of the proof are shown inline. In indented text rendering, the merged tree for the above explanations would look as follows:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">INFERRED :Alice a :Employee
   ASSERTED :Manager rdfs:subClassOf :Employee
   1.1) INFERRED :Alice a :Manager
      ASSERTED :supervises rdfs:domain :Manager
      ASSERTED :Alice :supervises :Bob
   1.2) INFERRED :Alice a :Manager
      ASSERTED :ProjectManager rdfs:subClassOf :Manager
      INFERRED :Alice a :ProjectManager
         ASSERTED :ProjectManager owl:equivalentClass (:manages some :Project)
         ASSERTED :Alice :manages :ProjectX
         2.1) INFERRED :ProjectX a :Project
            ASSERTED :projectID rdfs:domain :Project
            ASSERTED :ProjectX :projectID "123-45-6789"
         2.2) INFERRED :ProjectX a :Project
            ASSERTED :ResearchProject rdfs:subClassOf :Project
            ASSERTED :ProjectX a :ResearchProject</code></pre></div></div><div class="paragraph"><p>In the merged proof tree, alternatives for an explanation are shown with a number id. In the above tree, <code>:Alice a :Manager</code> is the first inference for which we have multiple explanations so it gets the id <code>1</code>. Then each alternative explanation gets an id appended to this (so explanations <code>1.1</code> and <code>1.2</code> are both alternative explanations for inference <code>1</code>). We also have multiple explanations for inference <code>:ProjectX a :Project</code> so its alternatives get ids <code>2.1</code> and <code>2.2</code>.</p></div></div></div></div></div></div><div class="sect1"><h2 id="_user_defined_rule_reasoning"><a class="link" href="#_user_defined_rule_reasoning">User-defined Rule Reasoning</a></h2><div class="sectionbody"><div class="paragraph"><p>Many reasoning problems may be solved with OWL&#8217;s axiom-based approach; but, of course, not all reasoning problems are amenable to this approach. A user-defined rules approach complements the OWL axiom-based approach nicely and increases the expressive power of a reasoning system from the user&#8217;s point of view. Many RDF databases support user-defined rules only. Stardog is the only RDF database that comprehensively supports both axioms and rules. Some problems (and some people) are simply a better fit for a rules-based approach to modeling and reasoning than to an axioms-based approach (and, of course, <em>vice versa</em>).</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">There isn&#8217;t a one-size-fits-all answer to the question "rules or axioms or both?" Use the thing that makes the most sense given the task at hand. This is engineering, not religion.</td></tr></table></div><div class="paragraph"><p>Stardog supports user-defined rule reasoning together with a rich set of built-in functions using the <a href="http://www.w3.org/Submission/SWRL/">SWRL</a> syntax and builtins library. In order to apply SWRL user-defined rules, you must include the rules as part of the database&#8217;s schema: that is, put your rules where your axioms are, i.e., in the schema. Once the rules are part of the schema, they will be used for reasoning automatically when using the <strong>SL</strong> reasoning type.</p></div><div class="paragraph"><p>Assertions implied by the rules <strong>will not</strong> be materialized. Instead, rules are used to expand queries just as regular axioms are used.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">To trigger rules to fire, execute a relevant query&#8212;&#8203;simple and easy as the truth.</td></tr></table></div><div class="sect2"><h3 id="_stardog_rules_syntax"><a class="link" href="#_stardog_rules_syntax">Stardog Rules Syntax</a></h3><div class="paragraph"><p>Stardog supports two different syntaxes for defining rules. The first is native Stardog Rules syntax and is based on SPARQL, so you can re-use what you already know about SPARQL to write rules. <strong>Unless you have specific requirements otherwise, you should use this syntax for user-defined rules in Stardog.</strong> The second is the <strong>de facto</strong> standard RDF/XML syntax for SWRL. It has the advantage of being supported in many tools; but it&#8217;s not fun to read or to write. You probably don&#8217;t want to use it. Better: don&#8217;t use this syntax!</p></div><div class="paragraph"><p>Stardog Rules Syntax is basically SPARQL "basic graph patterns" (BGPs) plus some very explicit new bits (<code>IF-THEN</code>) to denote the head and the body of a rule.<span class="footnote">[<a id="_footnoteref_29" class="footnote" href="#_footnote_29" title="View footnote.">29</a>]</span> You define URI prefixes in the normal way (examples below) and use regular SPARQL variables for rule variables. As you can see, some SPARQL 1.1 syntactic sugar&#8212;&#8203;property paths, especially, but also bnode syntax&#8212;&#8203;make complex Stardog Rules concise and elegant.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Starting in Stardog 3.0, it&#8217;s legal to use any valid Stardog built-in function in Stardog Rules (see rule limitations below for few excpetions).</td></tr></table></div><div class="sect3"><h4 id="_how_to_use_stardog_rules"><a class="link" href="#_how_to_use_stardog_rules">How to Use Stardog Rules</a></h4><div class="paragraph"><p>There are three things to sort out:</p></div><div class="olist arabic"><ol class="arabic"><li><p>Where to put these rules?</p></li><li><p>How to represent these rules?</p></li><li><p>What are the gotchas?</p></li></ol></div><div class="paragraph"><p>First, the rules go into the database, of course; and, in particular, they go into the named graph in which Stardog expects to find the TBox. This setting by default is the "default graph", i.e., unless you&#8217;ve changed the value of <code>reasoning.schema.graphs</code>, you&#8217;re probably going to be fine; that is, just add the rules to the database and it will all work out.<span class="footnote">[<a id="_footnoteref_30" class="footnote" href="#_footnote_30" title="View footnote.">30</a>]</span></p></div><div class="paragraph"><p>Second, you represent the rules with specially constructed RDF triples. Here&#8217;s a kind of template example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">@prefix rule: &lt;tag:stardog:api:rule:&gt; .
[] a rule:SPARQLRule;
   rule:content """
   ...la di dah the rule goes here!
   """.</code></pre></div></div><div class="paragraph"><p>So there&#8217;s a namespace--<code>tag:stardog:api:rule:</code>--that has a predicate, <code>content</code>, and a class, <code>SPARQLRule</code>. The object of this triple contains <strong>one</strong> rule in Stardog Rules syntax. A more realistic example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">@prefix rule: &lt;tag:stardog:api:rule:&gt; .

[] a rule:SPARQLRule ;
  rule:content """
    PREFIX :&lt;urn:test:&gt;
      IF {
            ?r a :Rectangle ;
               :width ?w ;
               :height ?h
            BIND (?w * ?h AS ?area)
          }
      THEN {
              ?r :area ?area
          }""" .</code></pre></div></div><div class="paragraph"><p>That&#8217;s pretty easy. Third, what are the gotchas?</p></div><div class="sect4"><h5 id="_rule_limitations_gotchas"><a class="link" href="#_rule_limitations_gotchas">Rule Limitations &amp; Gotchas</a></h5><div class="olist arabic"><ol class="arabic"><li><p>The RDF serialization of rules in, say, a Turtle file has to use the <code>tag:stardog:api:rule:</code> namespace URI and then whatever prefix, if any, mechanism that&#8217;s valid for that serialization. In the examples here, we use Turtle. Hence, we use <code>@prefix</code>, etc.</p></li><li><p>However, the namespace URIs used <strong>by the rules themselves</strong> can be defined in only two places: the string that contains the rule&#8212;&#8203;in the example above, you can see the default namespace is <code>urn:test:</code>--or in the Stardog database in which the rules are stored. Either place will work; if there are conflicts, the "closest definition wins", that is, if <code>foo:Example</code> is defined in both the rule content and in the Stardog database, the definition in the rule content is the one that Stardog will use.</p></li><li><p>Stardog Rule Syntax has the same expressivity of <a href="https://www.w3.org/Submission/SWRL/">SWRL</a> which means the SPARQL features allowed in rules are limited. Specifically, a triple pattern in a rule should be in one of the following forms:</p><div class="paragraph"><p>a) <strong>term<sub>1</sub></strong> <code>rdf:type</code> <strong>class-uri</strong></p></div><div class="paragraph"><p>b) <strong>term<sub>1</sub></strong> <strong>prop-uri</strong> <strong>term<sub>2</sub></strong></p></div><div class="paragraph"><p>where <strong>class-uri</strong> is a URI referring to a user-defined class and <strong>prop-uri</strong> is a URI referring to a user-defined property.<span class="footnote">[<a id="_footnoteref_31" class="footnote" href="#_footnote_31" title="View footnote.">31</a>]</span></p></div><div class="paragraph"><p>Only type of property paths allowed in rules are inverse paths (<code>^p</code>), sequence paths (<code>p1 / p2</code>) and alternative paths (<code>p1 | p2</code>) but these paths should not violate the above conditions. For example, the property path <code>rdf:type/rdfs:label</code> is not valid because according to the <a href="https://www.w3.org/TR/sparql11-query/#propertypath-syntaxforms">SPARQL spec</a> this would mean the object of a <code>rdf:type</code> triple pattern is a variable and not a user-defined class.</p></div><div class="paragraph"><p>Rule body (<code>IF</code>) and only rule body may optionally contain <code>UNION</code>, <code>BIND</code> or <code>FILTER</code> clauses. However, functions <code>EXISTS</code>, <code>NOT EXISTS</code>, or <code>NOW()</code> cannot be used in rules. User-defined functions (UDF) may be used in rules but if the UDF is not a <a href="https://en.wikipedia.org/wiki/Pure_function">pure function</a> then the results are undefined.</p></div><div class="paragraph"><p>Other SPARQL features are not allowed in rules.</p></div></li><li><p>Having the same predicate both in the rule body (<code>IF</code>) and the rule head (<code>THEN</code>) are supported in a limited way. Cycles are allowed only if the rule body does not contain type triples or filters and the triples in the rule body are linear (i.e. no cycles in the rule body either).</p><div class="paragraph"><p>In other words, a property used in the rule head depends on a property in the rule body and this dependency graph may contain cycles under some limits. One of these is that a rule body should not contain type triples or filters. Tree-like dependencies are always allowed.</p></div><div class="paragraph"><p>Of course the rule body may also contain triple patterns, which constitute a different kind of graph: it should be linear when edge directions are ignored. So no cycles or trees are allowed in this graph pattern. Linear when directions are ignored means that <code>{ ?x :p ?y . ?x :p ?z }</code> is linear but <code>{ ?x :p ?y . ?x :p ?z . ?x :p ?t }</code> is not because there are three edges for the node represented by <code>?x</code>.</p></div><div class="paragraph"><p>The reason for these limits boils down to the fact that recursive rules and axioms are rewritten as SPARQL property paths. This is why rule bodies cannot contain anything but property atoms. Cycles are allowed as long as we can express these as a regular grammar. Another way to think about this is that these rules should be as expressive as OWL property chains and the same restrictions defined for property chains apply here, too.</p></div><div class="paragraph"><p>Let&#8217;s consider some examples.</p></div><div class="paragraph"><p>These rules are acceptable since no cycles appear in dependencies:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF
  { ?x :hasFather ?y . ?y :hasBrother ?z }
THEN
  { ?x :hasUncle ?z }</code></pre></div></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF
  { ?x :hasUncle ?y . ?y :hasWife ?z }
THEN
  { ?x :hasAuntInLaw ?z }</code></pre></div></div><div class="paragraph"><p>These rules are not acceptable since there is a cycle:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF
  { ?x :hasFather ?y . ?y :hasBrother ?z }
THEN
  { ?x :hasUncle ?z }</code></pre></div></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF
  { ?x :hasChild ?y . ?y :hasUncle ?z }
THEN
  { ?x :hasBrother ?z }</code></pre></div></div><div class="paragraph"><p>This kind of cycle is allowed:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF
  { ?x :hasChild ?y . ?y :hasSibling ?z }
THEN
  { ?x :hasChild ?z }</code></pre></div></div></li></ol></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">(3) is a <strong>general</strong> limitation, not specific to Stardog Rules Syntax: recursion or cycles can occur through multiple rules, or it may occur as a result of interaction of rules with other axioms (or just through axioms alone).</td></tr></table></div></div></div><div class="sect3"><h4 id="_stardog_rules_examples"><a class="link" href="#_stardog_rules_examples">Stardog Rules Examples</a></h4><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">PREFIX rule: &lt;tag:stardog:api:rule:&gt;
PREFIX : &lt;urn:test:&gt;
PREFIX gr: &lt;http://purl.org/goodrelations/v1#&gt;

:Product1 gr:hasPriceSpecification [ gr:hasCurrencyValue 100.0 ] .
:Product2 gr:hasPriceSpecification [ gr:hasCurrencyValue 500.0 ] .
:Product3 gr:hasPriceSpecification [ gr:hasCurrencyValue 2000.0 ] .

[] a rule:SPARQLRule ;
   rule:content """
       PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt;
       PREFIX gr: &lt;http://purl.org/goodrelations/v1#&gt;
       PREFIX :&lt;urn:test:&gt;
     IF {
        ?offering gr:hasPriceSpecification ?ps .
        ?ps gr:hasCurrencyValue ?price .
        FILTER (?price &gt;= 200.00).
     }
     THEN {
        ?offering a :ExpensiveProduct .
     }
   """.</code></pre></div></div><div class="paragraph"><p>This example is self-contained: it contains some data (the <code>:Product&#8230;&#8203;</code> triples) and a rule. It also demonstrates the use of SPARQL&#8217;s <code>FILTER</code> to do numerical (and other) comparisons.</p></div><div class="paragraph"><p>Here&#8217;s a more complex example that includes four rules and, again, some data.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">PREFIX rule: &lt;tag:stardog:api:rule:&gt;
PREFIX : &lt;urn:test:&gt;

:c a :Circle ;
   :radius 10 .

:t a :Triangle ;
   :base 4 ;
   :height 10 .

:r a :Rectangle ;
   :width 5 ;
   :height 8 .

:s a :Rectangle ;
   :width 10 ;
   :height 10 .

[] a rule:SPARQLRule ;
   rule:content """
     PREFIX :&lt;urn:test:&gt;
     IF {
        ?r a :Rectangle ;
           :width ?w ;
           :height ?h
        BIND (?w * ?h AS ?area)
     }
     THEN {
         ?r :area ?area
     }""" .

[] a rule:SPARQLRule ;
   rule:content """
     PREFIX :&lt;urn:test:&gt;
     IF {
        ?t a :Triangle ;
           :base ?b ;
           :height ?h
        BIND (?b * ?h / 2 AS ?area)
     }
     THEN {
         ?t :area ?area
     }""" .

[] a rule:SPARQLRule ;
   rule:content """
     PREFIX :&lt;urn:test:&gt;
     PREFIX math: &lt;http://www.w3.org/2005/xpath-functions/math#&gt;
     IF {
          ?c a :Circle ;
             :radius ?r
          BIND (math:pi() * math:pow(?r, 2) AS ?area)
     }
     THEN {
         ?c :area ?area
     }""" .


[] a rule:SPARQLRule ;
   rule:content """
     PREFIX :&lt;urn:test:&gt;
     IF {
          ?r a :Rectangle ;
             :width ?w ;
             :height ?h
          FILTER (?w = ?h)
     }
     THEN {
         ?r a :Square
     }""" .</code></pre></div></div><div class="paragraph"><p>This example also demonstrates how to use SPARQL&#8217;s <code>BIND</code> to introduce intermediate variables and do calculations with or to them.</p></div><div class="paragraph"><p>Let&#8217;s look at some other rules, but just the rule content this time for concision, to see some use of other SPARQL features.</p></div><div class="paragraph"><p>This rule says that a person between 13 and 19 (inclusive) years of age is a teenager:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">PREFIX swrlb: &lt;http://www.w3.org/2003/11/swrlb#&gt;
PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt;

IF {
      ?x a :Person; hasAge ?age.
      FILTER (?age &gt;= 13 &amp;&amp; ?age &lt;= 19)
}
THEN {
      ?x a :Teenager.
}</code></pre></div></div><div class="paragraph"><p>This rule says that a male person with a sibling who is the parent of a female is an "uncle with a niece":</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF {
      ?x a Person; a :Male; :hasSibling ?y;
      ?y :isParentOf ?z;
      ?z a :Female.
}
THEN {
      ?x a :UncleOfNiece.
}</code></pre></div></div><div class="paragraph"><p>We can use SPARQL 1.1 property paths (and bnodes for unnecessary variables (that is, ones that aren&#8217;t used in the <code>THEN</code>)) to render this rule even more concisely:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF {
      ?x a :Person, :Male; :hasSibling/:isParentOf [a :Female]
}
THEN {
      ?x a :UncleOfNiece.
}</code></pre></div></div><div class="paragraph"><p><strong>Aside: that&#8217;s pure awesome.</strong></p></div><div class="paragraph"><p>And of course a person who&#8217;s male and has a niece or nephew is an uncle of his niece(s) and nephew(s):</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF {
     ?x a :Male; :isSiblingOf/:isParentOf ?z
}
THEN {
      ?x :isUncleOf ?z.
}</code></pre></div></div><div class="paragraph"><p>Next rule example: a super user can read all of the things!</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF {
      ?x a :SuperUser.
      ?y a :Resource.
      ?z a &lt;http://www.w3.org/ns/sparql#UUID&gt;.
}
THEN {
      ?z a :Role.
      ?x :hasRole ?z; :readPermission ?y.
}</code></pre></div></div></div></div><div class="sect2"><h3 id="_supported_built_ins"><a class="link" href="#_supported_built_ins">Supported Built-Ins</a></h3><div class="paragraph"><p>Stardog supports a wide variety of functions from SPARQL, XPath, SWRL, and some native Stardog functions, too. All of them may be used in either Stardog Rules syntax or in SWRL syntax. The supported functions are enumerated <a href="#_sparql_query_functions">here</a>.</p></div></div></div></div><div class="sect1"><h2 id="_special_predicates"><a class="link" href="#_special_predicates">Special Predicates</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog supports some builtin predicates with special meaning in order to make queries and rules easier to read and write. These special predicates are primarily syntactic sugar for more complex structures.</p></div><div class="sect2"><h3 id="_direct_strict_subclasses_subproperties_direct_types"><a class="link" href="#_direct_strict_subclasses_subproperties_direct_types">Direct/Strict Subclasses, Subproperties, &amp; Direct Types</a></h3><div class="paragraph"><p>Besides the standard RDF(S) predicates <code>rdf:type</code>, <code>rdfs:subClassOf</code> and <code>rdfs:subPropertyOf</code>, Stardog supports the following special built-in predicates:</p></div><div class="ulist"><ul><li><p><code>sp:directType</code></p></li><li><p><code>sp:directSubClassOf</code></p></li><li><p><code>sp:strictSubClassOf</code></p></li><li><p><code>sp:directSubPropertyOf</code></p></li><li><p><code>sp:strictSubPropertyOf</code></p></li></ul></div><div class="paragraph"><p>Where the <code>sp</code> prefix binds to <code>tag:stardog:api:property:</code>. Stardog also recognizes <code>sesame:directType</code>, <code>sesame:directSubClassOf</code>, and <code>sesame:strictSubClassOf</code> predicates where the prefix <code>sesame</code> binds to <code><a href="http://www.openrdf.org/schema/sesame#" class="bare">http://www.openrdf.org/schema/sesame#</a></code>.</p></div><div class="paragraph"><p>We show what these each of these predicates means by relating them to an equivalent triple pattern; that is, you can just write the predicate rather than the (more unwieldy) triple pattern.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">#c1 is a subclass of c2 but not equivalent to c2

:c1 sp:strictSubClassOf :c2      =&gt;       :c1 rdfs:subClassOf :c2 .
                                          FILTER NOT EXISTS {
                                             :c1 owl:equivalentClass :c2 .
                                          }

#c1 is a strict subclass of c2 and there is no c3 between c1 and c2 in
#the strict subclass hierarchy

:c1 sp:directSubClassOf :c2      =&gt;       :c1 sp:strictSubClassOf :c2 .
                                          FILTER NOT EXISTS {
                                             :c1 sp:strictSubClassOf :c3 .
                                             :c3 sp:strictSubClassOf :c2 .
                                          }

#ind is an instance of c1 but not an instance of any strict subclass of c1

:ind sp:directType :c1           =&gt;       :ind rdf:type :c1 .
                                          FILTER NOT EXISTS {
                                             :ind rdf:type :c2 .
                                             :c2 sp:strictSubClassOf :c1 .
                                          }</code></pre></div></div><div class="paragraph"><p>The predicates <code>sp:directSubPropertyOf</code> and <code>sp:strictSubPropertyOf</code> are defined analogously.</p></div></div><div class="sect2"><h3 id="_new_individuals_with_swrl"><a class="link" href="#_new_individuals_with_swrl">New Individuals with SWRL</a></h3><div class="paragraph"><p>Stardog also supports a special predicate that extends the expressivity of SWRL rules. According to SWRL, you can&#8217;t create new individuals (i.e., new instances of classes) in a SWRL rule.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Don&#8217;t get hung up by the tech vocabulary here&#8230;&#8203;"new individual" just means that you can&#8217;t have a rule that creates a new instance of some RDF or OWL class as a result of the rule firing.</td></tr></table></div><div class="paragraph"><p>This restriction is well-motivated; without it, you can easily create rules that do not terminate, that is, never reach a fixed point. Stardog&#8217;s user-defined rules weakens this restriction in some crucial aspects, subject to the following restrictions, conditions, and warnings.</p></div><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">This special predicate is basically a loaded gun with which you may shoot yourselves in the foot if you aren&#8217;t very careful.</td></tr></table></div><div class="paragraph"><p>So despite the general restriction in SWRL, in Stardog we actually can create new individuals with a rule by using the function <code>UUID()</code> as follows:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF {
    ?p a :Parent .
    BIND (UUID() AS ?parent) .
}
THEN {
    ?parent a :Person .
}</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Alternatively, we can use the predicate <code><a href="http://www.w3.org/ns/sparql#UUID" class="bare">http://www.w3.org/ns/sparql#UUID</a></code> as a unary SWRL built-in.</td></tr></table></div><div class="paragraph"><p>This rule will create a <strong>random</strong> URI for each instance of the class <code>:Parent</code> and also assert that each new instance is an instance of <code>:Person</code>--parents are people, too!</p></div><div class="sect3"><h4 id="_remarks"><a class="link" href="#_remarks">Remarks</a></h4><div class="olist arabic"><ol class="arabic"><li><p>The URIs for the generated individuals are meaningless in the sense that they should not be used in further queries; that is to say, these URIs are not guaranteed by Stardog to be stable.</p></li><li><p>Due to normalization, rules with more than one atom in the head are broken up into several rules.</p></li></ol></div><div class="paragraph"><p>Thus,</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF {
    ?person a :Person .
    BIND (UUID() AS ?parent) .
}
THEN {
    ?parent a :Parent ;
            a :Male .
}</code></pre></div></div><div class="paragraph"><p>will be normalized into two rules:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF {
    ?person a :Person .
    BIND (UUID() AS ?parent) .
}
THEN {
    ?parent a :Parent .
}

IF {
    ?person a :Person .
    BIND (UUID() AS ?parent) .
}
THEN {
    ?parent a :Male .
}</code></pre></div></div><div class="paragraph"><p>As a consequence, instead of stating that the new individual is both an instance of <code>:Male</code> and <code>:Parent</code>, we would create two <strong>different</strong> new individuals and assert that one is male and the other is a parent. If you need to assert various things about the new individual, we recommend the use of extra rules or axioms. In the previous example, we can introduce a new class (<code>:Father</code>) and add the following rule to our schema:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF {
    ?person a :Father .
}
THEN {
    ?parent a :Parent ;
            a :Male .
}</code></pre></div></div><div class="paragraph"><p>And then modify the original rule accordingly:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">IF {
    ?person a :Person .
    BIND (UUID() AS ?parent) .
}
THEN {
    ?parent a :Father .
}</code></pre></div></div></div></div></div></div><div class="sect1"><h2 id="_query_rewriting"><a class="link" href="#_query_rewriting">Query Rewriting</a></h2><div class="sectionbody"><div class="paragraph"><p>Reasoning in Stardog is based (mostly) on a <strong>query rewriting</strong> technique: Stardog rewrites the user&#8217;s query with respect to any schema or rules, and then executes the resulting expanded query (EQ) against the data in the normal way. This process is completely automated and requires no intervention from the user.</p></div><div class="paragraph"><p>As can be seen in Figure 1, the rewriting process involves five different phases.</p></div><div class="imageblock"><div class="content"><img src="optimized-img//blackout.png" alt="Blackout" width="524" height="308"></div><div class="title">1. Figure 1 Query Answering</div></div><div class="imageblock"><div class="content"><img src="optimized-img//blackout-internals.png" alt="Blackout Internals" width="400" height="238"></div><div class="title">2. Figure 2. Query Rewriting</div></div><div class="paragraph"><p>We illustrate the query answering process by means of an example. Consider a Stardog database, MyDB<sub>1</sub>, containing the following schema:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-manchester" data-lang="manchester"> :SeniorManager rdfs:subClassOf :manages some :Manager
 :manages some :Employee rdfs:subClassOf :Manager
 :Manager rdfs:subClassOf :Employee</code></pre></div></div><div class="paragraph"><p>Which says that a senior manager manages at least one manager, that every person that manages an employee is a manager, and that every manager is also an employee.</p></div><div class="paragraph"><p>Let&#8217;s also assume that MyDB<sub>1</sub> contains the following data assertions:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-manchester" data-lang="manchester">:Bill rdf:type :SeniorManager
:Robert rdf:type :Manager
:Ana :manages :Lucy
:Lucy rdf:type :Employee</code></pre></div></div><div class="paragraph"><p>Finally, let&#8217;s say that we want to retrieve the set of all employees. We do this by posing the following query:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT ?employee WHERE { ?employee rdf:type :Employee }</code></pre></div></div><div class="paragraph"><p>To answer this query, Stardog first <strong>rewrites</strong> it using the information in the schema. So the original query is rewritten into four queries:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT ?employee WHERE { ?employee rdf:type :Employee }
SELECT ?employee WHERE { ?employee rdf:type :Manager }
SELECT ?employee WHERE { ?employee rdf:type :SeniorManager }
SELECT ?employee WHERE { ?employee :manages ?x. ?x rdf:type :Employee }</code></pre></div></div><div class="paragraph"><p>Then Stardog executes these queries over the data as if they were written that way to begin with. In fact, Stardog can&#8217;t tell that they weren&#8217;t. Reasoning in Stardog <strong>just is query answering</strong> in nearly every case.</p></div><div class="paragraph"><p>The form of the EQ depends on the reasoning type. For OWL 2 QL, every EQ produced by Stardog is <strong>guaranteed to be expanded into a set of queries</strong>. If the reasoning type is OWL 2 RL or EL, then the EQ <strong>may</strong> (but may not) include a recursive rule. <em><strong>If a recursive rule is included, Stardog&#8217;s answers may be incomplete with respect to the semantics of the reasoning type.</strong></em></p></div><div class="sect2"><h3 id="_why_query_rewriting"><a class="link" href="#_why_query_rewriting">Why Query Rewriting?</a></h3><div class="paragraph"><p>Query rewriting has several advantages over materialization. In materialization, the data gets expanded with respect to the schema, not with respect to any actual query. And it&#8217;s the data&#8212;&#8203;all of the data&#8212;&#8203;that gets expanded, whether any actual query subsequently requires reasoning or not. The schema is used to generate new triples, typically when data is added or removed from the system. However, materialization introduces several thorny issues:</p></div><div class="olist arabic"><ol class="arabic"><li><p><strong>data freshness</strong>. Materialization has to be performed <strong>every time</strong> the data or the schema change. This is particularly unsuitable for applications where the data changes frequently.</p></li><li><p><strong>data size</strong>. Depending on the schema, materialization can significantly increase the size of the data, sometimes dramatically so. The cost of this data size blowup may be applied to <strong>every</strong> query in terms of increased I/O.</p></li><li><p><strong>OWL 2 profile reasoning</strong>. Given the fact that QL, RL, and EL are not comparable with respect to expressive power, an application that requires reasoning with more than one profile would need to maintain different corresponding materialized versions of the data.</p></li><li><p><strong>Resources</strong>. Depending on the size of the original data and the complexity of the schema, materialization may be computationally expensive. And truth maintenance, which materialization requires, is <strong>always</strong> computationally expensive.</p></li></ol></div></div></div></div><div class="sect1"><h2 id="_same_as_reasoning"><a class="link" href="#_same_as_reasoning">Same As Reasoning</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog 3.0 adds full support for OWL 2 <code>sameAs</code> reasoning. However, <code>sameAs</code> reasoning works in a different way than the rest of the reasoning mechanism. The <code>sameAs</code> inferences are computed and indexed eagerly so that these materialized inferences can be used directly at query rewriting time. The <code>sameAs</code> index is updated automatically as the database is modified so the difference is not of much direct concern to users.</p></div><div class="paragraph"><p>In order to use <code>sameAs</code> reasoning, the database configuration option <code>reasoning.sameas</code> should be set either at database creation time or at a later time when the database is offline. This can be done through the Web Console or using the command line as follows:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin db create -o reasoning.sameas=FULL -n myDB</code></pre></div></div><div class="paragraph"><p>There are legal three values for this option:</p></div><div class="ulist"><ul><li><p><code>OFF</code> disables all <code>sameAs</code> inferences, that is, only asserted <code>sameAs</code> triples will be included in query results.<span class="footnote">[<a id="_footnoteref_32" class="footnote" href="#_footnote_32" title="View footnote.">32</a>]</span></p></li><li><p><code>ON</code> computes <code>sameAs</code> inferences using only asserted <code>sameAs</code> triples, considering the reflexivity, symmetry and transitivity of the <code>sameAs</code> relation.</p></li><li><p><code>FULL</code> same as <code>ON</code> but also considers OWL functional properties, inverse functional properties, and <code>hasKey</code> axioms while computing <code>sameAs</code> inferences.</p></li></ul></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">The way <code>sameAs</code> reasoning works differs from the OWL semantics slightly in the sense that Stardog designates one canonical individual for each <code>sameAs</code> equivalence set and only returns the canonical individual. This avoids the combinatorial explosion in query results while providing the data integration benefits.</td></tr></table></div><div class="paragraph"><p>Let&#8217;s see an example showing how <code>sameAs</code> reasoning works. Consider the following database where <code>sameAs</code> reasoning is set to <code>ON</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">dbpedia:Elvis_Presley
    dbpedia-owl:birthPlace dbpedia:Mississippi ;
    owl:sameAs freebase:en.elvis_presley .

nyt:presley_elvis_per
    nyt:associated_article_count 35 ;
    rdfs:label "Elvis Presley" ;
    owl:sameAs dbpedia:Elvis_Presley .

freebase:en.elvis_presley
	freebase:common.topic.official_website &lt;http://www.elvis.com/&gt; .</code></pre></div></div><div class="paragraph"><p>Now consider the following query and its results:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog query --reasoning elvis 'SELECT * { ?s dbpedia-owl:birthPlace ?o; rdfs:label "Elvis Presley" }'</code></pre></div></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">+-----------------------+---------------------+
|           s           |          o          |
+-----------------------+---------------------+
| nyt:presley_elvis_per | dbpedia:Mississippi |
+-----------------------+---------------------+</code></pre></div></div><div class="paragraph"><p>Let&#8217;s unpack this carefully. There are three things to note.</p></div><div class="paragraph"><p>First, the query returns only one result even though there are three different URIs that denote Elvis Presley. Second, the URI returned is fixed but chosen randomly. <strong>Stardog picks one of the URIs as the canonical URI and always returns that and only that canonical URI in the results.</strong> If more <code>sameAs</code> triples are added the chosen canonical individual may change. Third, it is important to point out that even though only one URI is returned, the effect of <code>sameAs</code> reasoning is visible in the results since the <code>rdfs:label</code> and <code>dbpedia-owl:birthPlace</code> properties were asserted about different instances (i.e., different URIs).</p></div><div class="paragraph"><p>Now, you might might be inclined to write queries such as this to get all the properties for a specific URI:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT * {
   nyt:presley_elvis_per owl:sameAs ?elvis .
   ?elvis ?p ?o
}</code></pre></div></div><div class="paragraph"><p>However, this is completely unnecessary; rather, you can write the following query and get the same results since <code>sameAs</code> reasoning would automatically merge the results for you. Therefore, the query</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT * {
   nyt:presley_elvis_per ?p ?o
}</code></pre></div></div><div class="paragraph"><p>would return these results:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">+----------------------------------------+-----------------------+
|                   p                    |           o           |
+----------------------------------------+-----------------------+
| rdfs:label                             | "Elvis Presley"       |
| dbpedia-owl:birthPlace                 | dbpedia:Mississippi   |
| nyt:associated_article_count           | 35                    |
| freebase:common.topic.official_website | http://www.elvis.com/ |
| rdf:type                               | owl:Thing             |
+----------------------------------------+-----------------------+</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">The URI used in the query does not need to be the same one returned in the results. Thus, the following query would return the exact same results, too:</td></tr></table></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT * {
   dbpedia:Elvis_Presley ?p ?o
}</code></pre></div></div><div class="paragraph"><p>The only time Stardog will return a non-canonical URI in the query results is when you explicitly query for the <code>sameAs</code> inferences as in this next example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog query -r elvis 'SELECT * { freebase:en.elvis_presley owl:sameAs ?elvis }'</code></pre></div></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">+---------------------------+
|           elvis           |
+---------------------------+
| dbpedia:Elvis_Presley     |
| freebase:en.elvis_presley |
| nyt:presley_elvis_per     |
+---------------------------+</code></pre></div></div><div class="paragraph"><p>In the <code>FULL</code> <code>sameAs</code> reasoning mode, Stardog will also take other OWL axioms into account when computing <code>sameAs</code> inferences. Consider the following example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">#Everyone has a unique SSN number
:hasSSN a owl:InverseFunctionalProperty , owl:DatatypeProperty .

:JohnDoe :hasSSN "123-45-6789" .
:JDoe :hasSSN "123-45-6789" .

#Nobody can work for more than one company (for the sake of the example)
:worksFor a owl:FunctionalProperty , owl:ObjectProperty ;
	rdfs:domain :Employee ;
	rdfs:range :Company .

:JohnDoe :worksFor :Acme .
:JDoe :worksFor :AcmeInc .

#For each company, there can only be one employee with the same employee ID
:Employee owl:hasKey (:employeeID :worksFor ).

:JohnDoe :employeeID "1234-ABC" .

:JohnD :employeeID "1234-ABC" ;
       :worksFor :AcmeInc .

:JD :employeeID "5678-XYZ" ;
    :worksFor :AcmeInc .

:John :employeeID "1234-ABC" ;
      :worksFor :Emca .</code></pre></div></div><div class="paragraph"><p>For this database, with <code>sameAs</code> reasoning set to <code>FULL</code>, we would get the following answers:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog query -r acme "SELECT * {?x owl:sameAs ?y}"</code></pre></div></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">+----------+----------+
|    x     |    y     |
+----------+----------+
| :JohnDoe | :JohnD   |
| :JDoe    | :JohnD   |
| :Acme    | :AcmeInc |
+----------+----------+</code></pre></div></div><div class="paragraph"><p>We can follow the chain of inferences to understand how these results were computed:</p></div><div class="olist arabic"><ol class="arabic"><li><p><code>:JohnDoe owl:sameAs :JohnD</code> can be computed due to the fact that both have the same SSN numbers and <code>hasSSN</code> property is inverse functional.</p></li><li><p>We can infer <code>:Acme owl:sameAs :AcmeInc</code> since <code>:JohnDoe</code> can work for at most one company.</p></li><li><p><code>:JohnDoe owl:sameAs :JohnD</code> can be inferred using the <code>owl:hasKey</code> definition since both individuals are known to work for the same company and have the same employee ID.</p></li><li><p>No more <code>sameAs</code> inferences can be computed due to the key definition, since other employees either have different IDs or work for other companies.</p></li></ol></div></div></div><div class="sect1"><h2 id="_removing_unwanted_inferences"><a class="link" href="#_removing_unwanted_inferences">Removing Unwanted Inferences</a></h2><div class="sectionbody"><div class="paragraph"><p>Sometimes reasoning can produce unintended inferences. Perhaps there are modeling errors in the schema or incorrect assertions in the data. After an unintended inference is detected, it might be hard to figure out how to fix it, because there might be multiple different reasons for the inference. The <code>reasoning explain</code> command can be used to see the different explanations and the <code>reasoning undo</code> command can be used to generate a SPARQL update query that will remove the minimum amount of triples necessary to remove the unwanted inference:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./reasoning undo myDB ":AcmeInc a :Person"</code></pre></div></div></div></div><div class="sect1"><h2 id="_performance_hints"><a class="link" href="#_performance_hints">Performance Hints</a></h2><div class="sectionbody"><div class="paragraph"><p>The query rewriting approach suggests some guidelines for more efficient query answering.</p></div><div class="sect2"><h3 id="_hierarchies_and_queries"><a class="link" href="#_hierarchies_and_queries">Hierarchies and Queries</a></h3><div class="dlist"><dl><dt class="hdlist1">Avoid unnecessarily deep class/property hierarchies.</dt><dd><p>If you do not need to model several different types of a given class or property in your schema, then don&#8217;t do that! The reason shallow hierarchies are desirable is that the maximal hierarchy depth in the schema partly determines the maximal size of the EQs produced by Stardog. The larger the EQ, the longer it takes to evaluate, generally.</p><div class="paragraph"><p>For example, suppose our schema contains a very thorough and detailed set of subclasses of the class <code>:Employee</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-manchester" data-lang="manchester">:Manager rdfs:subClassOf :Employee
:SeniorManager rdfs:subClassOf :Manager
...

:Supervisor rdfs:subClassOf :Employee
:DepartmentSupervisor rdfs:subClassOf :Supervisor
...

:Secretary rdfs:subClassOf :Employee
...</code></pre></div></div><div class="paragraph"><p>If we wanted to retrieve the set of all employees, Stardog would produce an EQ containing a query of the following form for every subclass <code>:Ci</code> of <code>:Employee</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT ?employee WHERE { ?employee rdf:type :Ci }</code></pre></div></div><div class="paragraph"><p>Thus, <strong>ask the most specific query sufficient for your use case</strong>. Why? More general queries&#8212;&#8203;that is, queries that contain concepts high up in the class hierarchy defined by the schema&#8212;&#8203;will typically yield larger EQs.</p></div></dd></dl></div></div><div class="sect2"><h3 id="_domains_and_ranges"><a class="link" href="#_domains_and_ranges">Domains and Ranges</a></h3><div class="dlist"><dl><dt class="hdlist1">Specify domain and range of the properties in the schema.</dt><dd><p>These types of axiom can improve query performance significantly. Consider the following query asking for people and the employees they manage:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT ?manager ?employee WHERE
  { ?manager :manages ?employee.
    ?employee rdf:type :Employee. }</code></pre></div></div><div class="paragraph"><p>We know that this query would cause a large EQ given a deep hierarchy of <code>:Employee</code> subclasses. However, if we added the following single range axiom:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-manchester" data-lang="manchester">:manages rdfs:range :Employee</code></pre></div></div><div class="paragraph"><p>then the EQ would collapse to</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql"> SELECT ?manager ?employee WHERE { ?manager :manages ?employee }</code></pre></div></div><div class="paragraph"><p>which is considerably easier to evaluate.</p></div></dd></dl></div></div><div class="sect2"><h3 id="_very_large_schemas"><a class="link" href="#_very_large_schemas">Very Large Schemas</a></h3><div class="paragraph"><p>If you are working with a very large schema like SNOMED then there are couple things to note. First of all, Stardog reasoning works by pulling the complete schema into memory. This means you might need to increase the default memory settings for Stardog for a large schema. Stardog performs all schema reasoning upfront and only once but waits until the first reasoning query arrives. With a large schema, this step can be slow but subsequent reasoning queries will be fast. Also note that, Stardog will update schema reasoning results automatically after the database is modified so there will be some processing time spent then.</p></div><div class="paragraph"><p>Reasoning with very expressive schemas can be time consuming and use a lot of memory. To get the best performance out of Stardog with large schemas, limit the expressivity of your schema to <a href="http://www.w3.org/TR/2012/REC-owl2-profiles-20121211/#OWL_2_EL">OWL 2 EL</a>. You can also set the reasoning type of the database to <code>EL</code> and Stardog will automatically filter any axiom outside the EL expressivity. See <a href="#_reasoning_types">Reasoning Types</a> for more details on reasoning types. OWL 2 EL allows range declarations for properties and user-defined datatypes but avoiding these two constructs will further improve schema reasoning performance in Stardog.</p></div></div></div></div><div class="sect1"><h2 id="_not_seeing_expected_results"><a class="link" href="#_not_seeing_expected_results">Not Seeing Expected Results?</a></h2><div class="sectionbody"><div class="paragraph"><p>Here&#8217;s a few things that you might want to consider.</p></div><div class="sect2"><h3 id="_are_variable_types_ambiguous"><a class="link" href="#_are_variable_types_ambiguous">Are variable types ambiguous?</a></h3><div class="paragraph"><p>When a SPARQL query gets executed, each variable is bound to a URI, blank node, or to a literal to form a particular result (a collection of these results is a result set). In the context of reasoning, URIs might represent different entities: individuals, classes, properties, etc. According to the <a href="http://www.w3.org/TR/sparql11-entailment/#OWLDSEnRegime">relevant standard</a>, <strong>every variable in a SPARQL query must bind to at most one of these types of entity</strong>.</p></div><div class="paragraph"><p>Stardog can often figure out the right entity type from the query itself (e.g., given the triple pattern <code>?i ?p "a literal"</code>, we know <code>?p</code> is supposed to bind to a data property); however, sometimes this isn&#8217;t possible (e.g., <code>?s ?p ?o</code>). In case the types can&#8217;t be determined automatically, <strong>Stardog logs a message and evaluates the query by making some assumptions, which may not be what the query writer intended, about the types of variables</strong>.</p></div><div class="paragraph"><p>You can add one or more type triples to the query to resolve these ambiguities.<span class="footnote">[<a id="_footnoteref_33" class="footnote" href="#_footnote_33" title="View footnote.">33</a>]</span></p></div><div class="paragraph"><p>These "type triples" have the form <code>?var a TYPE</code>, where <code>TYPE</code> is a URI representing the type of entity to which the variable <code>?var</code> is supposed to bind: the most common are <code>owl:ObjectProperty</code> or <code>owl:DatatypeProperty</code>; in some cases, you might want <code>owl:NamedIndividual</code>, or <code>owl:Class</code>. For instance, you can use the following query to retrieve all object properties and their characteristics; without the type triple, <code>?s</code> will bind only to individuals:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">    SELECT ?o
    WHERE {
        ?s rdf:type ?o.
        ?s a owl:ObjectProperty.
    }.</code></pre></div></div><div class="paragraph"><p>Since Stardog now knows that <code>?s</code> should bind to an object property, it can now infer that <code>?o</code> binds to property characteristics of <code>?s</code>.</p></div></div><div class="sect2"><h3 id="_is_the_schema_where_you_think_it_is"><a class="link" href="#_is_the_schema_where_you_think_it_is">Is the schema where you think it is?</a></h3><div class="paragraph"><p>Starting in Stardog 3.0, Stardog will extract the schema from <strong>all named graphs and the default graph</strong>.</p></div><div class="paragraph"><p>If you require that the schema only be extracted from one or more specific named graphs, then you must tell Stardog where to find the schema. See database <a href="#_configuration_options">configuration options</a> for details. You can also use the <a href="/man/reasoning-schema.html"><code>reasoning schema</code></a> command to export the contents of the schema to see exactly what is included in the schema that Stardog uses.</p></div></div><div class="sect2"><h3 id="_are_you_using_the_right_reasoning_type"><a class="link" href="#_are_you_using_the_right_reasoning_type">Are you using the right reasoning type?</a></h3><div class="paragraph"><p>Perhaps some of the modeling constructs (a.k.a. axioms) in your database are being ignored. By default, Stardog uses the <code>SL</code> reasoning type. You can find out which axioms are being ignored by looking at the Stardog log file.</p></div></div><div class="sect2"><h3 id="_are_you_using_dl"><a class="link" href="#_are_you_using_dl">Are you using DL?</a></h3><div class="paragraph"><p>Stardog supports full OWL 2 DL reasoning but only for data that fits into main memory.</p></div></div><div class="sect2"><h3 id="_are_you_using_swrl"><a class="link" href="#_are_you_using_swrl">Are you using SWRL?</a></h3><div class="paragraph"><p>SWRL rules&#8212;&#8203;whether using SWRL syntax or Stardog Rules Syntax&#8212;&#8203;are only taken into account using the <strong>SL</strong> reasoning type.</p></div></div><div class="sect2"><h3 id="_do_you_know_what_to_expect"><a class="link" href="#_do_you_know_what_to_expect">Do you know what to expect?</a></h3><div class="paragraph"><p>The <a href="http://www.w3.org/TR/owl2-primer/">OWL 2 primer</a> is a good place to start.</p></div></div></div></div><div class="sect1"><h2 id="_known_issues"><a class="link" href="#_known_issues">Known Issues</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog 5.0.0beta does not</p></div><div class="ulist"><ul><li><p>Follow ontology <code>owl:imports</code> statements automatically; any imported OWL ontologies that are required must be loaded into a Stardog database in the normal way.</p></li><li><p>Handle recursive queries. If recursion is necessary to answer the query with respect to the schema, results will be sound (<em>no wrong answers</em>) but potentially incomplete (<em>some correct answers not returned</em>) with respect to the requested reasoning type.</p></li></ul></div></div></div><div class="sect1"><h2 id="_terminology"><a class="link" href="#_terminology">Terminology</a></h2><div class="sectionbody"><div class="paragraph"><p>This chapter uses the following terms of art.</p></div><div class="sect2"><h3 id="_databases"><a class="link" href="#_databases">Databases</a></h3><div class="paragraph"><p>A <strong>database</strong> (DB), a.k.a. ontology, is composed of two different parts: the schema or <strong>Terminological Box</strong> (TBox) and the data or <strong>Assertional Box</strong> (ABox). Analogus to relational databases, the TBox can be thought of as the schema, and the ABox as the data. In other words, the TBox is a set of <strong>axioms</strong>, whereas the ABox is a set of <strong>assertions</strong>.</p></div><div class="paragraph"><p>As we explain in <a href="#_owl_2_profiles">OWL 2 Profiles</a>, the kinds of assertion and axiom that one might use for a particular database are determined by the fragment of OWL 2 to which you&#8217;d like to adhere. In general, you should choose the OWL 2 profile that most closely fits the data modeling needs of your application.</p></div><div class="paragraph"><p>The most common data assertions are class and property assertions. Class assertions are used to state that a particular individual is an instance of a given class. Property assertions are used to state that two particular individuals (or an individual and a literal) are related via a given property. For example, suppose we have a DB MyDB<sub>2</sub> that contains the following data assertions. We use the usual standard prefixes for RDF(S) and OWL.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">:complexible rdf:type :Company
:complexible :maintains :Stardog</code></pre></div></div><div class="paragraph"><p>Which says that <code>:complexible</code> is a company, and that <code>:complexible</code> maintains <code>:Stardog</code>.</p></div><div class="paragraph"><p>The most common schema axioms are subclass axioms. Subclass axioms are used to state that every instance of a particular class is also an instance of another class. For example, suppose that MyDB<sub>2</sub> contains the following TBox axiom:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">:Company rdfs:subClassOf :Organization</code></pre></div></div><div class="paragraph"><p>stating that companies are a type of organization.</p></div></div><div class="sect2"><h3 id="_queries"><a class="link" href="#_queries">Queries</a></h3><div class="paragraph"><p>When reasoning is enabled, Stardog executes SPARQL queries depending on the type of Basic Graph Patterns they contain. A BGP is said to be an "ABox BGP" if it is of one of the following forms:</p></div><div class="ulist"><ul><li><p><strong>term<sub>1</sub></strong> <code>rdf:type</code> <strong>uri</strong></p></li><li><p><strong>term<sub>1</sub></strong> <strong>uri</strong> <strong>term<sub>2</sub></strong></p></li><li><p><strong>term<sub>1</sub></strong> <code>owl:differentFrom</code> <strong>term<sub>2</sub></strong></p></li><li><p><strong>term<sub>1</sub></strong> <code>owl:sameAs</code> <strong>term<sub>2</sub></strong></p></li></ul></div><div class="paragraph"><p>A BGP is said to be a TBox BGP if it is of one of the following forms:</p></div><div class="ulist"><ul><li><p><strong>term<sub>1</sub></strong> <code>rdfs:subClassOf</code> <strong>term<sub>2</sub></strong></p></li><li><p><strong>term<sub>1</sub></strong> <code>owl:disjointWith</code> <strong>term<sub>2</sub></strong></p></li><li><p><strong>term<sub>1</sub></strong> <code>owl:equivalentClass</code> <strong>term<sub>2</sub></strong></p></li><li><p><strong>term<sub>1</sub></strong> <code>rdfs:subPropertyOf</code> <strong>term<sub>2</sub></strong></p></li><li><p><strong>term<sub>1</sub></strong> <code>owl:equivalentProperty</code> <strong>term<sub>2</sub></strong></p></li><li><p><strong>term<sub>1</sub></strong> <code>owl:inverseOf</code> <strong>term<sub>2</sub></strong></p></li><li><p><strong>term<sub>1</sub></strong> <code>owl:propertyDisjointWith</code> <strong>term<sub>2</sub></strong></p></li><li><p><strong>term<sub>1</sub></strong> <code>rdfs:domain</code> <strong>term<sub>2</sub></strong></p></li><li><p><strong>term<sub>1</sub></strong> <code>rdfs:range</code> <strong>term<sub>2</sub></strong></p></li></ul></div><div class="paragraph"><p>A BGP is said to be a Hybrid BGP if it is of one of the following forms:</p></div><div class="ulist"><ul><li><p><strong>term<sub>1</sub></strong> <code>rdf:type</code> <strong>?var</strong></p></li><li><p><strong>term<sub>1</sub></strong> <strong>?var</strong> <strong>term<sub>2</sub></strong></p></li></ul></div><div class="paragraph"><p>where <strong>term</strong> (possibly with subscripts) is either an URI or variable; <strong>uri</strong> is a URI; and <strong>?var</strong> is a variable.</p></div><div class="paragraph"><p>When executing a query, ABox BGPs are handled by Stardog. TBox BGPs are executed by Pellet embedded in Stardog. Hybrid BGPs by a combination of both.</p></div></div><div class="sect2"><h3 id="_reasoning"><a class="link" href="#_reasoning">Reasoning</a></h3><div class="paragraph"><p>Intuitively, reasoning with a DB means to make implicit knowledge explicit. There are two main use cases for reasoning: to infer implicit knowledge and to discover modeling errors.</p></div><div class="paragraph"><p>With respect to the first use case, recall that MyDB<sub>2</sub> contains the following assertion and axiom:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl"> :complexible rdf:type :Company
 :Company rdfs:subClassOf :Organization</code></pre></div></div><div class="paragraph"><p>From this DB, we can use Stardog in order to <strong>infer</strong> that <code>:complexible</code> is an organization:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">:complexible rdf:type :Organization</code></pre></div></div><div class="paragraph"><p>Using reasoning in order to infer implicit knowledge in the context of an enterprise application can lead to simpler queries. Let us suppose, for example, that MyDB<sub>2</sub> contains a complex class hierarchy including several types of organization (including company). Let us further suppose that our application requires to use Stardog in order to get the list of all considered organizations. If Stardog were used <strong>with reasoning</strong>, then we would need only issue the following simple query:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT ?org WHERE { ?org rdf:type :Organization}</code></pre></div></div><div class="paragraph"><p>In contrast, if we were using Stardog <strong>with no reasoning</strong>, then we would have to issue a more complex query that considers all possible types of organization, thus coupling queries to domain knowledge in a tight way:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">SELECT ?org WHERE
              { { ?org rdf:type :Organization } UNION
              { ?org rdf:type :Company } UNION
...
}</code></pre></div></div><div class="paragraph"><p>Which of these queries seems more loosely coupled and more resilient to change?</p></div><div class="paragraph"><p>Stardog can also be used in order to discover modeling errors in a DB. The most common modeling errors are <strong>unsatisfiable</strong> classes and <strong>inconsistent</strong> DBs.</p></div><div class="paragraph"><p>An unsatisfiable class is simply a class that cannot have any instances. Say, for example, that we added the following axioms to MyDB<sub>2</sub>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl"> :Company owl:disjointWith :Organization
 :LLC owl:equivalentClass :Company and :Organization</code></pre></div></div><div class="paragraph"><p>stating that companies cannot be organizations and vice versa, and that an LLC is a company and an organization. The disjointness axiom causes the class <code>:LLC</code> to be unsatisfiable because, for the DB to be free of any logical contradiction, there can be no instances of <code>:LLC</code>.</p></div><div class="paragraph"><p>Asserting (or inferring) that an unsatisfiable class has an instance, causes the DB to be <strong>inconsistent</strong>. In the particular case of MyDB<sub>2</sub>, we know that <code>:complexible</code> is a company <strong>and</strong> an organization; therefore, we also know that it is an instance of <code>:LLC</code>, and as <code>:LLC</code> is known to be unsatisfiable, we have that MyDB<sub>2</sub> is inconsistent.</p></div><div class="paragraph"><p>Using reasoning in order to discover modeling errors in the context of an enterprise application is useful in order to maintain a correct contradiction-free model of the domain. In our example, we discovered that <code>:LLC</code> is unsatisfiable and MyDB<sub>2</sub> is inconsistent, which leads us to believe that there is a modeling error in our DB. In this case, it is easy to see that the problem is the disjointness axiom between <code>:Company</code> and <code>:Organization</code>.</p></div></div><div class="sect2"><h3 id="_owl_2_profiles"><a class="link" href="#_owl_2_profiles">OWL 2 Profiles</a></h3><div class="paragraph"><p>As explained in the <a href="http://www.w3.org/TR/owl2-profiles/">OWL 2 Web Ontology Language Profiles Specification</a>, an OWL 2 profile is a reduced version of OWL 2 that trades some expressive power for efficiency of reasoning. There are three OWL 2 profiles, each of which achieves efficiency differently.</p></div><div class="ulist"><ul><li><p><a href="http://www.w3.org/TR/owl2-profiles/#OWL_2_QL">OWL 2 QL</a> is aimed at applications that use very large volumes of instance data, and where query answering is the most important reasoning task. The expressive power of the profile is necessarily limited; however, it includes most of the main features of conceptual models such as UML class diagrams and ER diagrams.</p></li><li><p><a href="http://www.w3.org/TR/owl2-profiles/#OWL_2_EL">OWL 2 EL</a> is particularly useful in applications employing ontologies that contain very large numbers of properties and classes. This profile captures the expressive power used by many such ontologies and is a subset of OWL 2 for which the basic reasoning problems can be performed in time that is polynomial with respect to the size of the ontology.</p></li><li><p><a href="http://www.w3.org/TR/owl2-profiles/#OWL_2_RL">OWL 2 RL</a> is aimed at applications that require scalable reasoning without sacrificing too much expressive power. It is designed to accommodate OWL 2 applications that can trade the full expressivity of the language for efficiency, as well as RDF(S) applications that need some added expressivity.</p></li></ul></div><div class="paragraph"><p>Each profile restricts the kinds of axiom and assertion that can be used in a DB. Colloquially, QL is the least expressive of the profiles, followed by RL and EL; however, strictly speaking, no profile is more expressive than any other as they provide incomparable sets of constructs.</p></div><div class="paragraph"><p>Stardog supports the three profiles of OWL 2. Notably, since TBox BGPs are handled completely by Pellet, Stardog supports reasoning for the whole of OWL 2 for queries containing TBox BGPs only.</p></div></div></div></div><h1 id="_validating_constraints" class="sect0"><a class="link" href="#_validating_constraints">Validating Constraints</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/icv.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>Stardog Integrity Constraint Validation ("ICV") validates RDF data stored in a Stardog database according to data rules (i.e., "constraints") described by users and that make sense for their domain, application, and data. These constraints may be written in SPARQL, OWL, or SWRL. This chapter explains how to use ICV.</p></div><div class="paragraph"><p>The use of high-level languages (OWL 2, SWRL, and SPARQL) to validate RDF data using <strong>closed world semantics</strong> is one of Stardog&#8217;s unique capabilities. Using high level languages like OWL, SWRL, and SPARQL as schema or constraint languages for RDF and Linked Data has several advantages:</p></div><div class="ulist"><ul><li><p>Unifying the domain model with data quality rules</p></li><li><p>Aligning the domain model and data quality rules with the integration model and language (i.e., RDF)</p></li><li><p>Being able to query the domain model, data quality rules, integration model, mapping rules, etc with SPARQL</p></li><li><p>Being able to use automated reasoning about all of these things to insure logical consistency, explain errors and problems, etc.</p></li></ul></div><div class="paragraph"><p>If you are also interested in theory and background, please see the <a href="icv/icv-specification.html">ICV specification</a>, which has all the formal details.</p></div></div></div><div class="sect1"><h2 id="_getting_started_with_icv"><a class="link" href="#_getting_started_with_icv">Getting Started with ICV</a></h2><div class="sectionbody"><div class="paragraph"><p>See the <a href="https://github.com/Complexible/stardog-examples/tree/master/examples/cli/icv">extended ICV tutorial</a> in the stardog-examples repo on Github for more details.</p></div></div></div><div class="sect1"><h2 id="_icv_owl_2_reasoning"><a class="link" href="#_icv_owl_2_reasoning">ICV &amp; OWL 2 Reasoning</a></h2><div class="sectionbody"><div class="paragraph"><p><strong>An integrity constraint may be satisfied or violated in either of two ways: by an explicit statement in a Stardog database or by a statement that&#8217;s been validly inferred by Stardog.</strong></p></div><div class="paragraph"><p>When ICV is enabled for a Stardog database, it has to be enabled with respect to a reasoning type or level. The valid choices of reasoning type are any type or kind of reasoning supported by Stardog. See <a href="#_owl_rule_reasoning">OWL &amp; Rule Reasoning</a> for the details.</p></div><div class="paragraph"><p>So ICV is performed with three inputs:</p></div><div class="olist arabic"><ol class="arabic"><li><p>a Stardog database,</p></li><li><p>a set of constraints, and</p></li><li><p>a reasoning type (which may be, of course, no reasoning).</p></li></ol></div><div class="paragraph"><p>This is the case because domain modelers, ontology developers, or integrity constraint authors must consider the interactions between explicit and inferred statements and how these are accounted for in integrity constraints.</p></div></div></div><div class="sect1"><h2 id="_using_icv_from_cli"><a class="link" href="#_using_icv_from_cli">Using ICV from CLI</a></h2><div class="sectionbody"><div class="paragraph"><p>To add constraints to a database:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin icv add myDb constraints.rdf</code></pre></div></div><div class="paragraph"><p>To drop all constraints from a database:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin icv drop myDb</code></pre></div></div><div class="paragraph"><p>To remove one or more specific constraints from a database:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin icv remove myDb constraints.rdf</code></pre></div></div><div class="paragraph"><p>To convert new or existing constraints into SPARQL queries for export:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog icv convert myDb constraints.rdf</code></pre></div></div><div class="paragraph"><p>To explain a constraint violation:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog explain --contexts http://example.org/context1 http://example.org/context2</code></pre></div></div><div class="paragraph"><p>To export constraints:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog icv export myDb constraints.rdf</code></pre></div></div><div class="paragraph"><p>To validate a database (or some named graphs) with respect to constraints:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog icv validate --contexts http://example.org/context1 http://example.org/context2</code></pre></div></div></div></div><div class="sect1"><h2 id="_icv_guard_mode"><a class="link" href="#_icv_guard_mode">ICV Guard Mode</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog will also apply constraints as part of its transactional cycle and fail transactions that violate constraints. We call this "guard mode". It must be enabled explicitly in the database configuration options. Using the command line, these steps are as follows:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./stardog-admin db offline --timeout 0 myDb #take the database offline
$ ./stardog-admin metadata set -o icv.enabled=true myDb #enable ICV
$ ./stardog-admin db online myDb #put the database online</code></pre></div></div><div class="paragraph"><p>In the Web Console you can set the database offline, click <b class="button">Edit</b>, change the "ICV Enable" value, click <b class="button">Save</b> and set the database online again.</p></div><div class="paragraph"><p>Once guard mode is enabled, modifications of the database (via SPARQL Update or any other method), whether adds or deletes, that violate the integrity constraints will cause the transaction to fail.</p></div></div></div><div class="sect1"><h2 id="_explaining_icv_violations"><a class="link" href="#_explaining_icv_violations">Explaining ICV Violations</a></h2><div class="sectionbody"><div class="paragraph"><p>ICV violations can be explained using Stardog&#8217;s <a href="#_proof_trees">Proof Trees</a>. The following command will explain the IC violations for constraints stored in the database:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog icv explain --reasoning "myDB"</code></pre></div></div><div class="paragraph"><p>The command is flexible to change the number of violations displayed, and to explain violations for external constraints by passing the file with constraints as an additional argument:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog icv explain --reasoning --limit 2 "myDB" constraints.ttl</code></pre></div></div><div class="sect2"><h3 id="_security_note"><a class="link" href="#_security_note">Security Note</a></h3><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">There is a security implication in this design that may not be obvious. Changing the reasoning type associated with a database and integrity constraint validation may have serious security implications with respect to a Stardog database and, thus, may only be performed by a user role with sufficient privileges for that action.</td></tr></table></div></div></div></div><div class="sect1"><h2 id="_repairing_icv_violations"><a class="link" href="#_repairing_icv_violations">Repairing ICV Violations</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog 3.0 adds support for automatic repair of some kinds of integrity violation. This can be accomplished programmatically via API, as well as via CLI using the <code>icv fix</code> subcommand.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog help icv fix</code></pre></div></div><div class="paragraph"><p>Repair plans are emitted as a sequence of SPARQL Update queries, which means they can be applied to any system that understands SPARQL Update. If you pass <code>--execute</code> the repair plan will be applied immediately.</p></div><div class="paragraph"><p><code>icv fix</code> will repair violations of all constraints in the database; if you&#8217;d prefer to fix the violations for only some constraints, you can pass those constraints as an additional argument. Although a possible (but trivial) fix for any violation is to remove one or more constraints, <code>icv fix</code> does not suggest that kind of repair, even though it may be appropriate in some cases.</p></div></div></div><div class="sect1"><h2 id="_icv_examples"><a class="link" href="#_icv_examples">ICV Examples</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog ICV has a <a href="/icv/icv-specification.html">formal semantics</a>. But let&#8217;s just look at some examples instead; these examples use OWL 2 Manchester syntax, and they assume a simple data schema, which is available as an <a href="/icv/company.owl">OWL ontology</a> and as a <a href="/icv/ClassDiagram.png">UML diagram</a>. The examples assume that the default namespace is <code><a href="http://example.com/company.owl#" class="bare">http://example.com/company.owl#</a></code> and that <code>xsd:</code> is bound to the standard, <code><a href="http://www.w3.org/2001/XMLSchema#" class="bare">http://www.w3.org/2001/XMLSchema#</a></code>.</p></div><div class="paragraph"><p><a href="https://gist.github.com/1333767">Reference Java code</a> is available for each of the following examples and is also distributed with Stardog.</p></div><div class="sect2"><h3 id="_subsumption_constraints"><a class="link" href="#_subsumption_constraints">Subsumption Constraints</a></h3><div class="paragraph"><p>This kind of constraint guarantees certain subclass and superclass (i.e., subsumption) relationships exist between instances.</p></div><div class="sect3"><h4 id="_managers_must_be_employees"><a class="link" href="#_managers_must_be_employees">Managers must be employees.</a></h4><div class="sect4"><h5 id="_constraint"><a class="link" href="#_constraint">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Manager rdfs:subClassOf :Employee</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_invalid"><a class="link" href="#_database_a_invalid">Database A (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Alice a :Manager .</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_valid"><a class="link" href="#_database_b_valid">Database B (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Alice a :Manager , :Employee .</code></pre></div></div><div class="paragraph"><p>This constraint says that if an RDF individual is an instance of <code>Manager</code>, then it must also be an instance of <code>Employee</code>. In A, the only instance of <code>Manager</code>, namely <code>Alice</code>, is not an instance of <code>Employee</code>; therefore, A is invalid. In B, <code>Alice</code> is an instance of Database both <code>Manager</code> and <code>Employee</code>; therefore, B is valid.</p></div></div></div></div><div class="sect2"><h3 id="_domain_range_constraints"><a class="link" href="#_domain_range_constraints">Domain-Range Constraints</a></h3><div class="paragraph"><p>These constraints control the types of subjects and objects used with a property.</p></div><div class="sect3"><h4 id="_only_project_leaders_can_be_responsible_for_projects"><a class="link" href="#_only_project_leaders_can_be_responsible_for_projects">Only project leaders can be responsible for projects.</a></h4><div class="sect4"><h5 id="_constraint_2"><a class="link" href="#_constraint_2">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:is_responsible_for rdfs:domain :Project_Leader ;
                    rdfs:range :Project .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_invalid_2"><a class="link" href="#_database_a_invalid_2">Database A (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Alice :is_responsible_for :MyProject .

:MyProject a :Project .</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_invalid"><a class="link" href="#_database_b_invalid">Database B (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Alice a :Project_Leader ;
	:is_responsible_for :MyProject .</code></pre></div></div></div><div class="sect4"><h5 id="_database_c_valid"><a class="link" href="#_database_c_valid">Database C (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Alice a :Project_Leader ;
	:is_responsible_for :MyProject .

:MyProject a :Project .</code></pre></div></div><div class="paragraph"><p>This constraint says that if two RDF instances are related to each other via the property <code>is_responsible_for</code>, then the subject must be an instance of <code>Project_Leader</code> and the object must be an instance of <code>Project</code>. In Database A, there is only one pair of individuals related via <code>is_responsible_for</code>, namely <code>(Alice, MyProject)</code>, and <code>MyProject</code> is an instance of <code>Project</code>; but <code>Alice</code> is not an instance of <code>Project_Leader</code>. Therefore, A is invalid. In B, <code>Alice</code> is an instance of <code>Project_Leader</code>, but <code>MyProject</code> is not an instance of <code>Project</code>; therefore, B is not valid. In C, <code>Alice</code> is an instance of <code>Project_Leader</code>, and <code>MyProject</code> is an instance of <code>Project</code>; therefore, C is valid.</p></div></div></div><div class="sect3"><h4 id="_only_employees_can_have_an_ssn"><a class="link" href="#_only_employees_can_have_an_ssn">Only employees can have an SSN.</a></h4><div class="sect4"><h5 id="_constraint_3"><a class="link" href="#_constraint_3">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:ssn rdfs:domain :Employee</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_invalid_3"><a class="link" href="#_database_a_invalid_3">Database A (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Bob :ssn "123-45-6789" .</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_valid_2"><a class="link" href="#_database_b_valid_2">Database B (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Bob a :Employee ;
	:ssn "123-45-6789" .</code></pre></div></div><div class="paragraph"><p>This constraint says that if an RDF instance <code>i</code> has a data assertion via the the property <code>SSN</code>, then <code>i</code> must be an instance of <code>Employee</code>. In A, <code>Bob</code> is not an instance of <code>Employee</code> but has <code>SSN</code>; therefore, A is invalid. In B, <code>Bob</code> is an instance of <code>Employee</code>; therefore, B is valid.</p></div></div></div><div class="sect3"><h4 id="_a_date_of_birth_must_be_a_date"><a class="link" href="#_a_date_of_birth_must_be_a_date">A date of birth must be a date.</a></h4><div class="sect4"><h5 id="_constraint_4"><a class="link" href="#_constraint_4">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:dob rdfs:range xsd:date</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_invalid_4"><a class="link" href="#_database_a_invalid_4">Database A (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Bob :dob "1970-01-01" .</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_valid_3"><a class="link" href="#_database_b_valid_3">Database B (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Bob :dob "1970-01-01"^^xsd:date</code></pre></div></div><div class="paragraph"><p>This constraint says that if an RDF instance <code>i</code> is related to a literal <code>l</code> via the data property <code>DOB</code>, then <code>l</code> must have the XML Schema type <code>xsd:date</code>. In A, <code>Bob</code> is related to the untyped literal <code>"1970-01-01"</code> via <code>DOB</code> so A is invalid. In B, the literal <code>"1970-01-01"</code> is properly typed so it&#8217;s valid.</p></div></div></div></div><div class="sect2"><h3 id="_participation_constraints"><a class="link" href="#_participation_constraints">Participation Constraints</a></h3><div class="paragraph"><p>These constraints control whether or not an RDF instance participates in some specified relationship.</p></div><div class="sect3"><h4 id="_each_supervisor_must_supervise_at_least_one_employee"><a class="link" href="#_each_supervisor_must_supervise_at_least_one_employee">Each supervisor must supervise at least one employee.</a></h4><div class="sect4"><h5 id="_constraint_5"><a class="link" href="#_constraint_5">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">#this constraint is very concise in Terp syntax:
#:Supervisor rdfs:subClassOf (:supervises some :Employee)

:Supervisor rdfs:subClassOf
              [ a owl:Restriction ;
                owl:onProperty :supervises ;
                owl:someValuesFrom :Employee
              ] .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_valid"><a class="link" href="#_database_a_valid">Database A (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Alice a owl:Thing .</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_invalid_2"><a class="link" href="#_database_b_invalid_2">Database B (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Alice a :Supervisor .</code></pre></div></div></div><div class="sect4"><h5 id="_database_c_invalid"><a class="link" href="#_database_c_invalid">Database C (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Alice a :Supervisor ;
	:supervises :Bob .</code></pre></div></div></div><div class="sect4"><h5 id="_database_d_valid"><a class="link" href="#_database_d_valid">Database D (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Alice a :Supervisor ;
	:supervises :Bob .

:Bob a :Employee</code></pre></div></div><div class="paragraph"><p>This constraint says that if an RDF instance <code>i</code> is of type <code>Supervisor</code>, then <code>i</code> must be related to an individual <code>j</code> via the property <code>supervises</code> and also that <code>j</code> must be an instance of <code>Employee</code>. In A, <code>Supervisor</code> has no instances; therefore, A is trivially valid. In B, the only instance of <code>Supervisor</code>, namely <code>Alice</code>, is related to no individual; therefore, B is invalid. In C, <code>Alice</code> is related to <code>Bob</code> via <code>supervises</code>, but <code>Bob</code> is not an instance of <code>Employee</code>; therefore, C is invalid. In D, <code>Alice</code> is related to <code>Bob</code> via <code>supervises</code>, and <code>Bob</code> is an instance of <code>Employee</code>; hence, D is valid.</p></div></div></div><div class="sect3"><h4 id="_each_project_must_have_a_valid_project_number"><a class="link" href="#_each_project_must_have_a_valid_project_number">Each project must have a valid project number.</a></h4><div class="sect4"><h5 id="_constraint_6"><a class="link" href="#_constraint_6">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">#Again, this constraint in Terp syntax rocks the hizzous:
#:Project rdfs:subClassOf (:number some xsd:integer[&gt;= 0, &lt; 5000])

:Project rdfs:subClassOf
              [ a owl:Restriction ;
                owl:onProperty :number ;
                owl:someValuesFrom
                        [ a rdfs:Datatype ;
                          owl:onDatatype xsd:integer ;
                          owl:withRestrictions ([xsd:minInclusive 0] [ xsd:maxExclusive 5000])
                        ]
              ] .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_valid_2"><a class="link" href="#_database_a_valid_2">Database A (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyProject a owl:Thing .</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_invalid_3"><a class="link" href="#_database_b_invalid_3">Database B (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyProject a :Project</code></pre></div></div></div><div class="sect4"><h5 id="_database_c_invalid_2"><a class="link" href="#_database_c_invalid_2">Database C (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyProject a :Project ;
	:number "23" .</code></pre></div></div></div><div class="sect4"><h5 id="_database_d_invalid"><a class="link" href="#_database_d_invalid">Database D (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyProject a :Project ;
	:number "6000"^^xsd:integer .</code></pre></div></div></div><div class="sect4"><h5 id="_database_e_valid"><a class="link" href="#_database_e_valid">Database E (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyProject a :Project ;
	:number "23"^^xsd:integer .</code></pre></div></div><div class="paragraph"><p>This constraint says that if an RDF instance <code>i</code> is of type <code>Project</code>, then <code>i</code> must be related via the property <code>number</code> to an integer between <code>0</code> and <code>5000</code> (inclusive)—that is, projects have project numbers in a certain range. In A, the individual <code>MyProject</code> is not known to be an instance of <code>Project</code> so the constraint does not apply at all and A is valid. In B, <code>MyProject</code> is an instance of <code>Project</code> but doesn&#8217;t have any data assertions via <code>number</code> so A is invalid. In C, <code>MyProject</code> does have a data property assertion via <code>number</code> but the literal <code>"23"</code> is untyped&#8212;&#8203;that is, it&#8217;s not an integer&#8212;&#8203;therefore, C is invalid. In D, <code>MyProject</code> is related to an integer via <code>number</code> but it is out of the range: D is invalid. Finally, in E, <code>MyProject</code> is related to the integer <code>23</code> which is in the range of <code>[0,5000]</code> so E is valid.</p></div></div></div></div><div class="sect2"><h3 id="_cardinality_constraints"><a class="link" href="#_cardinality_constraints">Cardinality Constraints</a></h3><div class="paragraph"><p>These constraints control the number of various relationships or property values.</p></div><div class="sect3"><h4 id="_employees_must_not_work_on_more_than_3_projects"><a class="link" href="#_employees_must_not_work_on_more_than_3_projects">Employees must not work on more than 3 projects.</a></h4><div class="sect4"><h5 id="_constraint_7"><a class="link" href="#_constraint_7">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">#Constraint in Terp syntax:
#:Employee rdfs:subClassOf (:works_on max 3 :Project)

:Employee rdfs:subClassOf
              [ a owl:Restriction ;
                owl:onProperty :works_on;
                owl:maxQualifiedCardinality "3"^^xsd:nonNegativeInteger ;
                owl:onClass :Project
              ] .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_valid_3"><a class="link" href="#_database_a_valid_3">Database A (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Bob a owl:Thing.</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_valid_4"><a class="link" href="#_database_b_valid_4">Database B (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Bob a :Employee ;
	:works_on :MyProject .

:MyProject a :Project .</code></pre></div></div></div><div class="sect4"><h5 id="_database_c_invalid_3"><a class="link" href="#_database_c_invalid_3">Database C (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Bob a :Employee ;
	:works_on :MyProject , :MyProjectFoo , :MyProjectBar , :MyProjectBaz .

:MyProject a :Project .

:MyProjectFoo a :Project .

:MyProjectBar a :Project .

:MyProjectBaz a :Project .</code></pre></div></div><div class="paragraph"><p>If an RDF instance <code>i</code> is an <code>Employee</code>, then <code>i</code> must not be related via the property <code>works_on</code> to more than 3 instances of <code>Project</code>. In A, <code>Bob</code> is not known to be an instance of <code>Employee</code> so the constraint does not apply and the A is valid. In B, <code>Bob</code> is an instance of <code>Employee</code> but is known to work on only a single project, namely <code>MyProject</code>, so B is valid. In C, <code>Bob</code> is related to 4 instances of <code>Project</code> via <code>works_on</code>.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Stardog ICV implements a weak form of the <strong>unique name assumption</strong>, that is, it assumes that things which have different names are, in fact, different things.<span class="footnote">[<a id="_footnoteref_34" class="footnote" href="#_footnote_34" title="View footnote.">34</a>]</span></td></tr></table></div><div class="paragraph"><p>Since Stardog ICV uses closed world (instead of open world) semantics,<span class="footnote">[<a id="_footnoteref_35" class="footnote" href="#_footnote_35" title="View footnote.">35</a>]</span> it assumes that the different projects with different names are, in fact, separate projects, which (<strong>in this case</strong>) violates the constraint and makes C invalid.</p></div></div></div><div class="sect3"><h4 id="_departments_must_have_at_least_2_employees"><a class="link" href="#_departments_must_have_at_least_2_employees">Departments must have at least 2 employees.</a></h4><div class="sect4"><h5 id="_constraint_8"><a class="link" href="#_constraint_8">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">#Constraint in Terp syntax:
#:Department rdfs:subClassOf (inverse :works_in min 2 :Employee)

:Department rdfs:subClassOf
              [ a owl:Restriction ;
                owl:onProperty [owl:inverseOf :works_in] ;
                owl:minQualifiedCardinality "2"^^xsd:nonNegativeInteger ;
                owl:onClass :Employee
              ] .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_valid_4"><a class="link" href="#_database_a_valid_4">Database A (valid)</a></h5><div class="listingblock"><div class="content"><pre>[source,sparql]
:MyDepartment a owl:NamedIndividual .</pre></div></div></div><div class="sect4"><h5 id="_database_b_invalid_4"><a class="link" href="#_database_b_invalid_4">Database B (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyDepartment a :Department .

:Bob a :Employee ;
	:works_in :MyDepartment .</code></pre></div></div></div><div class="sect4"><h5 id="_database_c_valid_2"><a class="link" href="#_database_c_valid_2">Database C (valid)</a></h5><div class="listingblock"><div class="content"><pre>[source,sparql]
:MyDepartment a :Department .

:Alice a :Employee ;
	:works_in :MyDepartment .

:Bob a :Employee ;
	:works_in :MyDepartment .</pre></div></div><div class="paragraph"><p>This constraint says that if an RDF instance <code>i</code> is a <code>Department</code>, then there should exist at least 2 instances <code>j</code> and <code>k</code> of class <code>Employee</code> which are related to <code>i</code> via the property <code>works_in</code> (or, equivalently, <code>i</code> should be related to them via the inverse of <code>works_in</code>). In A, <code>MyDepartment</code> is not known to be an instance of <code>Department</code> so the constraint does not apply. In B, <code>MyDepartment</code> is an instance of <code>Department</code> but only one instance of <code>Employee</code>, namely <code>Bob</code>, is known to work in it, so B is invalid. In C, <code>MyDepartment</code> is related to the individuals <code>Bob</code> and <code>Alice</code>, which are both instances of <code>Employee</code> and (again, due to weak Unique Name Assumption in Stardog ICV), are assumed to be distinct, so C is valid.</p></div></div></div><div class="sect3"><h4 id="_managers_must_manage_exactly_1_department"><a class="link" href="#_managers_must_manage_exactly_1_department">Managers must manage exactly 1 department.</a></h4><div class="sect4"><h5 id="_constraint_9"><a class="link" href="#_constraint_9">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">#Constraint in Terp syntax:
#:Manager rdfs:subClassOf (:manages exactly 1 :Department)

:Manager rdfs:subClassOf
              [ a owl:Restriction ;
                owl:onProperty :manages ;
                owl:qualifiedCardinality "1"^^xsd:nonNegativeInteger ;
                owl:onClass :Department
              ] .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_valid_5"><a class="link" href="#_database_a_valid_5">Database A (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">    Individual: Isabella</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_invalid_5"><a class="link" href="#_database_b_invalid_5">Database B (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Isabella a :Manager .</code></pre></div></div></div><div class="sect4"><h5 id="_database_c_invalid_4"><a class="link" href="#_database_c_invalid_4">Database C (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Isabella a :Manager ;
	:manages :MyDepartment .</code></pre></div></div></div><div class="sect4"><h5 id="_database_d_valid_2"><a class="link" href="#_database_d_valid_2">Database D (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Isabella a :Manager ;
	:manages :MyDepartment .

:MyDepartment a :Department .</code></pre></div></div></div><div class="sect4"><h5 id="_database_e_invalid"><a class="link" href="#_database_e_invalid">Database E (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Isabella a :Manager ;
	:manages :MyDepartment , :MyDepartment1 .

:MyDepartment a :Department .

:MyDepartment1 a :Department .</code></pre></div></div><div class="paragraph"><p>This constraint says that if an RDF instance <code>i</code> is a <code>Manager</code>, then it must be related to exactly 1 instance of <code>Department</code> via the property <code>manages</code>. In A, the individual <code>Isabella</code> is not known to be an instance of <code>Manager</code> so the constraint does not apply and A is valid. In B, <code>Isabella</code> is an instance of <code>Manager</code> but is not related to any instances of <code>Department</code>, so B is invalid. In C, <code>Isabella</code> is related to the individual <code>MyDepartment</code> via the property <code>manages</code> but <code>MyDepartment</code> is not known to be an instance of <code>Department</code>, so C is invalid. In D, <code>Isabella</code> is related to exactly one instance of <code>Department</code>, namely <code>MyDepartment</code>, so D is valid. Finally, in E, <code>Isabella</code> is related to two (assumed to be) distinct (again, because of weak UNA) instances of <code>Department</code>, namely <code>MyDepartment</code> and <code>MyDepartment1</code>, so E is invalid.</p></div></div></div><div class="sect3"><h4 id="_entities_may_have_no_more_than_one_name"><a class="link" href="#_entities_may_have_no_more_than_one_name">Entities may have no more than one name.</a></h4><div class="sect4"><h5 id="_constraint_10"><a class="link" href="#_constraint_10">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:name a owl:FunctionalProperty .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_valid_6"><a class="link" href="#_database_a_valid_6">Database A (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyDepartment a owl:Thing .</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_valid_5"><a class="link" href="#_database_b_valid_5">Database B (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyDepartment :name "Human Resources" .</code></pre></div></div></div><div class="sect4"><h5 id="_database_c_invalid_5"><a class="link" href="#_database_c_invalid_5">Database C (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyDepartment :name "Human Resources" , "Legal" .</code></pre></div></div><div class="paragraph"><p>This constraint says that no RDF instance <code>i</code> can have more than one assertion via the data property <code>name</code>. In A, <code>MyDepartment</code> does not have any data property assertions so A is valid. In B, <code>MyDepartment</code> has a single assertion via <code>name</code>, so the ontology is also valid. In C, <code>MyDepartment</code> is related to 2 literals, namely <code>"Human Resources"</code> and <code>"Legal"</code>, via <code>name</code>, so C is invalid.</p></div></div></div></div><div class="sect2"><h3 id="_property_constraints"><a class="link" href="#_property_constraints">Property Constraints</a></h3><div class="paragraph"><p>These constraints control how instances are related to one another via properties.</p></div><div class="sect3"><h4 id="_the_manager_of_a_department_must_work_in_that_department"><a class="link" href="#_the_manager_of_a_department_must_work_in_that_department">The manager of a department must work in that department.</a></h4><div class="sect4"><h5 id="_constraint_11"><a class="link" href="#_constraint_11">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:manages rdfs:subPropertyOf :works_in .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_invalid_5"><a class="link" href="#_database_a_invalid_5">Database A (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Bob :manages :MyDepartment</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_valid_6"><a class="link" href="#_database_b_valid_6">Database B (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Bob :works_in :MyDepartment ;
	:manages :MyDepartment .</code></pre></div></div><div class="paragraph"><p>This constraint says that if an RDF instance <code>i</code> is related to <code>j</code> via the property <code>manages</code>, then <code>i</code> must also be related to <code>j</code> via the property <code>works_in</code>. In A, <code>Bob</code> is related to <code>MyDepartment</code> via <code>manages</code>, but not via <code>works_in</code>, so A is invalid. In B, <code>Bob</code> is related to <code>MyDepartment</code> via both <code>manages</code> and <code>works_in</code>, so B is valid.</p></div></div></div><div class="sect3"><h4 id="_department_managers_must_supervise_all_the_department_s_employees"><a class="link" href="#_department_managers_must_supervise_all_the_department_s_employees">Department managers must supervise all the department&#8217;s employees.</a></h4><div class="sect4"><h5 id="_constraint_12"><a class="link" href="#_constraint_12">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:is_supervisor_of owl:propertyChainAxiom (:manages [owl:inverseOf :works_in]) .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_invalid_6"><a class="link" href="#_database_a_invalid_6">Database A (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Jose :manages :MyDepartment ;
	:is_supervisor_of :Maria .

:Maria :works_in :MyDepartment .

:Diego :works_in :MyDepartment .</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_valid_7"><a class="link" href="#_database_b_valid_7">Database B (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Jose :manages :MyDepartment ;
	:is_supervisor_of :Maria , :Diego .

:Maria :works_in :MyDepartment .

:Diego :works_in :MyDepartment .</code></pre></div></div><div class="paragraph"><p>This constraint says that if an RDF instance <code>i</code> is related to <code>j</code> via the property <code>manages</code> and <code>k</code> is related to <code>j</code> via the property <code>works_in</code>, then <code>i</code> must be related to <code>k</code> via the property <code>is_supervisor_of</code>. In A, <code>Jose</code> is related to <code>MyDepartment</code> via <code>manages</code>, <code>Diego</code> is related to <code>MyDepartment</code> via <code>works_in</code>, but <code>Jose</code> is not related to <code>Diego</code> via any property, so A is invalid. In B, <code>Jose</code> is related to <code>Maria</code> and <code>Diego</code>--who are both related to <code>MyDepartment</code> by way of <code>works_in</code>--via the property <code>is_supervisor_of</code>, so B is valid.</p></div></div></div></div><div class="sect2"><h3 id="_complex_constraints"><a class="link" href="#_complex_constraints">Complex Constraints</a></h3><div class="paragraph"><p>Constrains may be arbitrarily complex and include many conditions.</p></div><div class="sect3"><h4 id="_employee_constraints"><a class="link" href="#_employee_constraints">Employee Constraints</a></h4><div class="paragraph"><p>Each employee works on at least one project, or supervises at least one employee that works on at least one project, or manages at least one department.</p></div><div class="sect4"><h5 id="_constraint_13"><a class="link" href="#_constraint_13">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">#Constraint in Terp syntax:
#how are you not loving Terp by now?!
#:Employee rdfs:subClassOf (:works_on some (:Project or
#(:supervises some (:Employee and (:works_on some :Project))) or (:manages some :Department)))

:Employee rdfs:subClassOf
              [ a owl:Restriction ;
                owl:onProperty :works_on ;
                owl:someValuesFrom
                        [ owl:unionOf (:Project
                                      [ a owl:Restriction ;
                                        owl:onProperty :supervises ;
                                        owl:someValuesFrom
                                              [ owl:intersectionOf (:Employee
                                                                    [ a owl:Restriction ;
                                                                      owl:onProperty :works_on ;
                                                                      owl:someValuesFrom :Project
                                                                    ])
                                              ]
                                      ]
                                      [ a owl:Restriction ;
                                        owl:onProperty :manages ;
                                        owl:someValuesFrom :Department
                                      ])
                        ]
              ] .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_invalid_7"><a class="link" href="#_database_a_invalid_7">Database A (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Esteban a :Employee .</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_invalid_6"><a class="link" href="#_database_b_invalid_6">Database B (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Esteban a :Employee ;
	:supervises :Lucinda .

:Lucinda a :Employee .</code></pre></div></div></div><div class="sect4"><h5 id="_database_c_valid_3"><a class="link" href="#_database_c_valid_3">Database C (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Esteban a :Employee ;
	:supervises :Lucinda .

:Lucinda a :Employee ;
	:works_on :MyProject .

:MyProject a :Project .</code></pre></div></div></div><div class="sect4"><h5 id="_database_d_valid_3"><a class="link" href="#_database_d_valid_3">Database D (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Esteban a :Employee ;
	:manages :MyDepartment .

:MyDepartment a :Department .</code></pre></div></div></div><div class="sect4"><h5 id="_database_e_valid_2"><a class="link" href="#_database_e_valid_2">Database E (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:Esteban a :Employee ;
	:manages :MyDepartment ;
	:works_on :MyProject .

:MyDepartment a :Department .

:MyProject a :Project .</code></pre></div></div><div class="paragraph"><p>This constraint says that if an individual <code>i</code> is an instance of <code>Employee</code>, then at least one of three conditions must be met:</p></div><div class="ulist"><ul><li><p>it is related to an instance of <code>Project</code> via the property <code>works_on</code></p></li><li><p>it is related to an instance <code>j</code> via the property <code>supervises</code> and <code>j</code> is an instance of <code>Employee</code> and is also related to some instance of <code>Project</code> via the property <code>works_on</code></p></li><li><p>it is related to an instance of <code>Department</code> via the property <code>manages</code>.</p></li></ul></div><div class="paragraph"><p>A and B are invalid because none of the conditions are met. C meets the second condition: <code>Esteban</code> (who is an <code>Employee</code>) is related to <code>Lucinda</code> via the property <code>supervises</code> whereas <code>Lucinda</code> is both an <code>Employee</code> and related to <code>MyProject</code>, which is a <code>Project</code>, via the property <code>works_on</code>. D meets the third condition: <code>Esteban</code> is related to an instance of <code>Department</code>, namely <code>MyDepartment</code>, via the property <code>manages</code>. Finally, E meets the first and the third conditions because in addition to managing a department <code>Esteban</code> is also related an instance of <code>Project</code>, namely <code>MyProject</code>, via the property <code>works_on</code>.</p></div></div></div><div class="sect3"><h4 id="_employees_and_us_government_funding"><a class="link" href="#_employees_and_us_government_funding">Employees and US government funding</a></h4><div class="paragraph"><p>Only employees who are American citizens can work on a project that receives funds from a US government agency.</p></div><div class="sect4"><h5 id="_constraint_14"><a class="link" href="#_constraint_14">Constraint</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">#Constraint in Terp syntax:
#:Project and (:receives_funds_from some :US_Government_Agency)) rdfs:subClassOf
#(inverse :works_on only (:Employee and (:nationality value "US")))

[ owl:intersectionOf (:Project
                       [ a owl:Restriction ;
                         owl:onProperty :receives_funds_from ;
                         owl:someValuesFrom :US_Government_Agency
                       ]) .
] rdfs:subClassOf
              [ a owl:Restriction ;
                owl:onProperty [owl:inverseOf :works_on] ;
                owl:allValuesFrom [ owl:intersectionOf (:Employee
                                                        [ a owl:Restriction ;
                                                          owl:hasValue "US" ;
                                                          owl:onProperty :nationality
                                                        ])
                                  ]
              ] .</code></pre></div></div></div><div class="sect4"><h5 id="_database_a_valid_7"><a class="link" href="#_database_a_valid_7">Database A (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyProject a :Project ;
	:receives_funds_from :NASA .

:NASA a :US_Government_Agency</code></pre></div></div></div><div class="sect4"><h5 id="_database_b_invalid_7"><a class="link" href="#_database_b_invalid_7">Database B (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyProject a :Project ;
	:receives_funds_from :NASA .

:NASA a :US_Government_Agency .

:Andy a :Employee ;
	:works_on :MyProject .</code></pre></div></div></div><div class="sect4"><h5 id="_database_c_valid_4"><a class="link" href="#_database_c_valid_4">Database C (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyProject a :Project ;
	:receives_funds_from :NASA .

:NASA a :US_Government_Agency .

:Andy a :Employee ;
	:works_on :MyProject ;
	:nationality "US" .</code></pre></div></div></div><div class="sect4"><h5 id="_database_d_invalid_2"><a class="link" href="#_database_d_invalid_2">Database D (invalid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyProject a :Project ;
	:receives_funds_from :NASA .

:NASA a :US_Government_Agency .

:Andy a :Employee ;
	:works_on :MyProject ;
	:nationality "US" .

:Heidi a :Supervisor ;
	:works_on :MyProject ;
	:nationality "US" .</code></pre></div></div></div><div class="sect4"><h5 id="_database_e_valid_3"><a class="link" href="#_database_e_valid_3">Database E (valid)</a></h5><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">:MyProject a :Project ;
	:receives_funds_from :NASA .

:NASA a :US_Government_Agency .

:Andy a :Employee ;
	:works_on :MyProject ;
	:nationality "US" .

:Heidi a :Supervisor ;
	:works_on :MyProject ;
	:nationality "US" .

:Supervisor rdfs:subClassOf :Employee .
    SubClassOf: Employee</code></pre></div></div><div class="paragraph"><p>This constraint says that if an individual <code>i</code> is an instance of <code>Project</code> and is related to an instance of <code>US_Government_Agency</code> via the property <code>receives_funds_from</code>, then any individual <code>j</code> which is related to <code>i</code> via the property <code>works_on</code> must satisfy two conditions:</p></div><div class="ulist"><ul><li><p>it must be an instance of <code>Employee</code></p></li><li><p>it must not be related to any literal other than <code>"US"</code> via the data property <code>nationality</code>.</p></li></ul></div><div class="paragraph"><p>A is valid because there is no individual related to <code>MyProject</code> via <code>works_on</code>, so the constraint is trivially satisfied. B is invalid since <code>Andy</code> is related to <code>MyProject</code> via <code>works_on</code>, <code>MyProject</code> is an instance of <code>Project</code> and is related to an instance of <code>US_Government_Agency</code>, that is, <code>NASA</code>, via <code>receives_funds_from</code>, but <code>Andy</code> does not have any data property assertions. C is valid because both conditions are met. D is not valid because <code>Heidi</code> violated the first condition: she is related to <code>MyProject</code> via <code>works_on</code> but is not known to be an instance of <code>Employee</code>. Finally, this is fixed in E&#8212;&#8203;by way of a handy OWL axiom&#8212;&#8203;which states that every instance of <code>Supervisor</code> is an instance of <code>Employee</code>, so <code>Heidi</code> is inferred to be an instance of <code>Employee</code> and, consequently, E is valid.<span class="footnote">[<a id="_footnoteref_36" class="footnote" href="#_footnote_36" title="View footnote.">36</a>]</span></p></div><div class="paragraph"><p>If you made it this far, you deserve a drink!</p></div></div></div></div><div class="sect2"><h3 id="_constraints_formats"><a class="link" href="#_constraints_formats">Constraints Formats</a></h3><div class="paragraph"><p>In addition to OWL, ICV constraints can be expressed in SPARQL and Stardog Rules. In both cases, the constraints define queries and rules to find violations. These constraints can be added individually, or defined together in a file as shown below:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">@prefix rule: &lt;tag:stardog:api:rule:&gt; .
@prefix icv: &lt;tag:stardog:api:icv:&gt; .

# Rule Constraint
[] a rule:SPARQLRule ;

   rule:content """

    prefix : &lt;http://example.org/&gt;

	IF {
	    ?x a :Employee .
	}
	THEN {
		?x :employeeNum ?number .
	}

   """ .


# SPARQL Constraint
[] a icv:Constraint ;

   icv:query """
    prefix : &lt;http://example.org/&gt;

   	select * {

        ?x a :Employee .

	    FILTER NOT EXISTS {
	        ?x :employeeNum ?number .
	    }
	}

   """ .</code></pre></div></div></div></div></div><div class="sect1"><h2 id="_using_icv_programmatically"><a class="link" href="#_using_icv_programmatically">Using ICV Programmatically</a></h2><div class="sectionbody"><div class="paragraph"><p>Here we describe how to use Stardog ICV via the SNARL APIs. For more information on using SNARL in general, please refer to the chapter on <a href="/java">programming Stardog with Java</a>.</p></div><div class="paragraph"><p>There is command-line interface support for many of the operations necessary to using ICV with a Stardog database; please see <a href="#_administering_stardog">Administering Stardog</a> for details.</p></div><div class="paragraph"><p>To use ICV in Stardog, one must:</p></div><div class="olist arabic"><ol class="arabic"><li><p>create some constraints</p></li><li><p>associate those constraints with a Stardog database</p></li></ol></div><div class="sect2"><h3 id="_creating_constraints"><a class="link" href="#_creating_constraints">Creating Constraints</a></h3><div class="paragraph"><p><a href="../java/snarl/com/complexible/stardog/icv/Constraint.html"><code>Constraints</code></a> can be created using the <a href="../java/snarl/com/complexible/stardog/icv/ConstraintFactory.html"><code>ConstraintFactory</code></a> which provides methods for creating integrity constraints. <code>ConstraintFactory</code> expects your constraints, if they are defined as OWL axioms, as RDF triples (or graph). To aid in authoring constraints in OWL, <a href="../java/snarl/com/complexible/common/openrdf/util/ExpressionFactory.html"><code>ExpressionFactory</code></a> is provided for building the <a href="http://www.w3.org/TR/owl2-mapping-to-rdf/">RDF equivalent</a> of the OWL axioms of your constraint.</p></div><div class="paragraph"><p>You can also write your constraints in OWL in your favorite editor and load them into the database from your OWL file.</p></div><div class="paragraph"><p>We recommend defining your constraints as OWL axioms, but you are free to define them using SPARQL <code>SELECT</code> queries. If you choose to define a constraint using a SPARQL <code>SELECT</code> query, please keep in mind that if your query returns results, those are interpreted as the violations of the integrity constraint.</p></div><div class="paragraph"><p>An example of creating a simple constraint using <code>ExpressionFactory</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">IRI Product = Values.iri("urn:Product");
IRI Manufacturer = Values.iri("urn:Manufacturer");
IRI manufacturedBy = Values.iri("urn:manufacturedBy");

// we want to say that a product should be manufactured by a Manufacturer:
Constraint aConstraint = ConstraintFactory.constraint(subClassOf(Product,
                                                                 some(manufacturedBy, Manufacturer)));</code></pre></div></div></div><div class="sect2"><h3 id="_adding_constraints_to_stardog"><a class="link" href="#_adding_constraints_to_stardog">Adding Constraints to Stardog</a></h3><div class="paragraph"><p>The <a href="../java/snarl/com/complexible/stardog/icv/api/ICVConnection.html">ICVConnection</a> interface provides programmatic access to the ICV support in Stardog. It provides support for adding, removing and clearing integrity constraints in your database as well as methods for checking whether or not the data is valid; and when it&#8217;s not, retrieving the list of violations.</p></div><div class="paragraph"><p>This example shows how to add an integrity constraint to a Stardog database.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">// We'll start out by creating a validator from our SNARL Connection
ICVConnection aValidator = aConn.as(ICVConnection.class);

// add add a constraint, which must be done in a transaction.
aValidator.addConstraint(aConstraint);</code></pre></div></div><div class="paragraph"><p>Here we show how to add a set of constraints as defined in a local OWL ontology.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">// We'll start out by creating a validator from our SNARL Connection
ICVConnection aValidator = aConn.as(ICVConnection.class);

// add add a constraint
aValidator.addConstraints()
	  .format(RDFFormat.RDFXML)
 	  .file(Paths.get("myConstraints.owl"));</code></pre></div></div></div><div class="sect2"><h3 id="_ic_validation"><a class="link" href="#_ic_validation">IC Validation</a></h3><div class="paragraph"><p>Checking whether or not the contents of a database are valid is easy. Once you have an <a href="../java/snarl/com/complexible/stardog/icv/api/ICVConnection.html"><code>ICVConnection</code></a> you can simply call its <a href="../java/snarl/com/complexible/stardog/icv/api/ICVConnection.html#isValid(&#41;"><code>isValid()</code></a> method which will return whether or not the contents of the database are valid with respect to the constraints associated with that database. Similarly, you can provide some <a href="../java/snarl/com/complexible/stardog/icv/Constraint.html"><code>constraints</code></a> to the <code>isValid()</code> method to see if the data in the database is invalid for those specific constraints; which can be a subset of the constraints associated with the database, or they can be new constraints you are working on.</p></div><div class="paragraph"><p>If the data is invalid for some constraints—either the explicit constraints in your database or a new set of constraints you have authored—you can get some information about what the violation was from the SNARL IC Connection. <a href="../java/snarl/com/complexible/stardog/icv/api/ICVConnection.html#getViolationBindings(&#41;"><code>ICVConnection.getViolationBindings()</code></a> will return the constraints which are violated, and for each constraint, you can get the violations as the set of bindings that satisfied the constraint query. You can turn the bindings into the individuals which are in the violation using <a href="../java/snarl/com/complexible/stardog/icv/ICV.html#asIndividuals(&#41;"><code>ICV.asIndividuals()</code></a>.</p></div></div><div class="sect2"><h3 id="_icv_and_transactions"><a class="link" href="#_icv_and_transactions">ICV and Transactions</a></h3><div class="paragraph"><p>In addition to using the ICConnection as a data oracle to tell whether or not your data is valid with respect to some constraints, you can also use Stardog&#8217;s ICV support to protect your database from invalid data by using ICV as a guard within transactions.</p></div><div class="paragraph"><p>When guard mode for ICV is enabled in Stardog, each commit is inspected to ensure that the contents of the database are valid for the set of constraints that have been associated with it. Should someone attempt to commit data which violates one or more of the constraints defined for the database, the commit will fail and the data will not be added/removed from your database.</p></div><div class="paragraph"><p>By default, reasoning is not used when you enable guard mode, however you are free to specify any of the reasoning types supported by Stardog when enabling guard mode. If you have provided a specific reasoning type for guard mode it will be used during validation of the integrity constraints. This means you can author your constraints with the expectation of inference results satisfying a constraint.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">try (AdminConnection dbms = AdminConnectionConfiguration.toEmbeddedServer().credentials("admin", "admin").connect()) {
  dbms.disk("icvWithGuard")			// disk db named 'icvWithGuard'
      .set(ICVOptions.ICV_ENABLED, true)	// enable icv guard mode
      .set(ICVOptions.ICV_REASONING_ENABLED, true)	// specify that guard mode should use reasoning
      .create(new File("data/sp2b_10k.n3"));	// create the db, bulk loading the file(s) to start
}</code></pre></div></div><div class="paragraph"><p>This illustrates how to create a persistent disk database with ICV guard mode and reasoning enabled. Guard mode can also be enabled when the database is created on the <a href="#_command_line_interface">CLI</a>.</p></div></div></div></div><div class="sect1"><h2 id="_terminology_2"><a class="link" href="#_terminology_2">Terminology</a></h2><div class="sectionbody"><div class="paragraph"><p>This chapter may make more sense if you read this section on terminology a few times.</p></div><div class="sect2"><h3 id="_icv_integrity_constraint_validation"><a class="link" href="#_icv_integrity_constraint_validation">ICV, Integrity Constraint Validation</a></h3><div class="paragraph"><p>The process of checking whether some Stardog database is valid with respect to some integrity constraints. The result of ICV is a boolean value (true if valid, false if invalid) and, optionally, an <code>explanation of constraint violations</code>.</p></div></div><div class="sect2"><h3 id="_schema_tbox"><a class="link" href="#_schema_tbox">Schema, TBox</a></h3><div class="paragraph"><p>A schema (or "terminology box" a.k.a., TBox) is a set of statements that define the relationships between data elements, including property and class names, their relationships, etc. In practical terms, schema statements for a Stardog database are RDF Schema and OWL 2 terms, axioms, and definitions.</p></div></div><div class="sect2"><h3 id="_data_abox"><a class="link" href="#_data_abox">Data, ABox</a></h3><div class="paragraph"><p>All of the triples in a Stardog database that aren&#8217;t part of the schema are part of the data (or "assertional box" a.k.a. ABox).</p></div></div><div class="sect2"><h3 id="_integrity_constraint"><a class="link" href="#_integrity_constraint">Integrity Constraint</a></h3><div class="paragraph"><p>A declarative expression of some rule or constraint which data must conform to in order to be valid. Integrity Constraints are typically domain and application specific. They can be expressed in OWL 2 (any legal syntax), SWRL rules, or (a restricted form of) SPARQL queries.</p></div></div><div class="sect2"><h3 id="_constraints"><a class="link" href="#_constraints">Constraints</a></h3><div class="paragraph"><p>Constraints that have been associated with a Stardog database and which are used to validate the data it contains. Each Stardog may optionally have one and only one set of constraints associated with it.</p></div></div><div class="sect2"><h3 id="_closed_world_assumption_closed_world_reasoning"><a class="link" href="#_closed_world_assumption_closed_world_reasoning">Closed World Assumption, Closed World Reasoning</a></h3><div class="paragraph"><p>Stardog ICV assumes a closed world with respect to data and constraints: that is, it assumes that all relevant data is known to it and included in a database to be validated. It interprets the meaning of Integrity Constraints in light of this assumption; if a constraint says a value <code>must</code> be present, the absence of that value is interpreted as a constraint violation and, hence, as invalid data.</p></div></div><div class="sect2"><h3 id="_open_world_assumption_open_world_reasoning"><a class="link" href="#_open_world_assumption_open_world_reasoning">Open World Assumption, Open World Reasoning</a></h3><div class="paragraph"><p>A legal OWL 2 inference may violate or satisfy an Integrity Constraint in Stardog. In other words, you get to have your cake (OWL as a constraint language) and eat it, too (OWL as modeling or inference language). This means that constraints are applied to a Stardog database <code>with respect to an OWL 2 profile</code>.</p></div></div><div class="sect2"><h3 id="_monotonicity"><a class="link" href="#_monotonicity">Monotonicity</a></h3><div class="paragraph"><p>OWL is a monotonic language: that means you can never <code>add</code> anything to a Stardog database that causes there to be <code>fewer</code> legal inferences. Or, put another way, the only way to decrease the number of legal inferences is to <code>delete</code> something.</p></div><div class="paragraph"><p>Monotonicity interacts with ICV in the following ways:</p></div><div class="olist arabic"><ol class="arabic"><li><p>Adding data to or removing it from a Stardog database may make it invalid.</p></li><li><p>Adding schema statements to or removing them from a Stardog database may make it invalid.</p></li><li><p>Adding new constraints to a Stardog database may make it invalid.</p></li><li><p>Deleting constraints from a Stardog database <code>cannot make it invalid</code>.</p></li></ol></div></div></div></div><h1 id="_geospatial_query" class="sect0"><a class="link" href="#_geospatial_query">Geospatial Query</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/geospatial.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>Stardog supports geospatial queries over data encoded using <a href="http://www.w3.org/2003/01/geo/">WGS 84</a> or the <a href="http://www.opengeospatial.org/standards/geosparql">OGC&#8217;s GeoSPARQL vocabulary</a>. Any RDF data stored in Stardog using one or both of these vocabularies will be automatically indexed for geospatial queries.</p></div></div></div><div class="sect1"><h2 id="_enabling_geospatial_support"><a class="link" href="#_enabling_geospatial_support">Enabling Geospatial Support</a></h2><div class="sectionbody"><div class="paragraph"><p>To get started using Stardog&#8217;s geospatial support, you&#8217;ll need to create a database with geospatial support enabled. You can do this by setting the option <code>spatial.enabled</code> to <code>true</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">stardog-admin db create -o spatial.enabled=true -n mySpatialDb</code></pre></div></div><div class="paragraph"><p>Similarly, you can set the option using <code>GeospatialOptions#SPATIAL_ENABLED</code> when creating the database programmatically:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">aAdminConnection.disk("mySpatialDb")
				.set(GeospatialOptions.SPATIAL_ENABLED, true)
				.create()</code></pre></div></div><div class="sect2"><h3 id="_precision_accuracy"><a class="link" href="#_precision_accuracy">Precision &amp; Accuracy</a></h3><div class="paragraph"><p>When creating a database with geospatial support, you can specify the precision with which the features are indexed. The database property <code>spatial.precision</code> or programmatically via <code>GeospatialOptions#SPATIAL_PRECISION</code>, which can only be specified when the database is created, can control the index precision. The default value is <code>11</code> which yields sub-meter precision; a value of <code>8</code> will give a precision +/- 50m. Setting the precision value lower than the default can <strong>improve the performance of spatial queries at the cost of accuracy</strong>.</p></div></div></div></div><div class="sect1"><h2 id="_geospatial_data"><a class="link" href="#_geospatial_data">Geospatial Data</a></h2><div class="sectionbody"><div class="paragraph"><p>The WGS84 or OGC vocabularies can be used to encode geospatial features within your dataset. When data is committed, Stardog will look for these vocabularies and automatically extract all features and insert them into the geospatial index. Here is an example of using WKT to define the location of the White House:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">:whiteHouse a geo:Feature ;
    rdfs:label "White House";
    geo:hasGeometry [
        a geo:Geometry ;
        geo:asWKT "Point(-77.03653 38.897676 )"^^geo:wktLiteral
    ] .</code></pre></div></div><div class="paragraph"><p>Note that for WKT formatted points, the location is <code>&lt;long, lat&gt;</code>. The location of the White House can also be encoded using the WGS 84 vocabulary:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ttl" data-lang="ttl">:whiteHouse a :Location ;
    rdfs:label "White House" ;
    wgs:lat "38.897676"^^xsd:float ;
    wgs:long "-77.03653"^^xsd:float .</code></pre></div></div></div></div><div class="sect1"><h2 id="_sparql_integration"><a class="link" href="#_sparql_integration">SPARQL Integration</a></h2><div class="sectionbody"><div class="paragraph"><p>Once your data has been indexed, you can perform several type of geospatial queries on the data. These are seamlessly integrated into SPARQL so you can query for non-spatial information about features in your dataset alongside the geospatial queries.</p></div><div class="paragraph"><p>The operators supported by Stardog are <code>geof:relate</code>, <code>geof:distance</code>, <code>geof:within</code>, <code>geof:nearby</code> and <code>geof:area</code>. The <code>geof</code> namespace is <code><a href="http://www.opengis.net/def/function/geosparql/" class="bare">http://www.opengis.net/def/function/geosparql/</a></code>.</p></div><div class="paragraph"><p>This query gets all features within 2km of Complexible HQ in DC:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">select ?name where {
  ?loc rdfs:label ?name .
  ?loc geo:hasGeometry ?feature .
  ?hq geo:hasGeometry ?hqGeo ; rdfs:label "Complexible Headquarters" .
  ?feature geof:nearby (?hqGeo 2 &lt;http://qudt.org/vocab/unit#Kilometer&gt;).
}</code></pre></div></div><div class="sect2"><h3 id="_geospatial_datatypes"><a class="link" href="#_geospatial_datatypes">Geospatial Datatypes</a></h3><div class="paragraph"><p>The <a href="http://www.qudt.org/">QUDT</a> ontology, namespace <code><a href="http://qudt.org/vocab/unit#" class="bare">http://qudt.org/vocab/unit#</a></code>, is used to specify units for distances; <code>Kilometer</code>, <code>Meter</code>, <code>Centimeter</code>, <code>MileUSStatute</code>, <code>Yard</code>, <code>Foot</code>, <code>Inch</code>. Additionally, the OGC units vocabulary <code><a href="http://www.opengis.net/def/uom/OGC/1.0/" class="bare">http://www.opengis.net/def/uom/OGC/1.0/</a></code> defines <code>degree</code>, <code>radian</code> and <code>metre</code>.</p></div></div></div></div><div class="sect1"><h2 id="_enhanced_polygons"><a class="link" href="#_enhanced_polygons">Enhanced Polygons</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog&#8217;s geospatial support covers the use of basic WKT formatted shapes; specifically points and rectangles. However, WKT can encode more complex spatial structures, most notably, polygons.</p></div><div class="paragraph"><p>To enable support for these more complex shapes, download <a href="http://central.maven.org/maven2/com/vividsolutions/jts-core/1.14.0/jts-core-1.14.0.jar">JTS</a> and include the JAR in Stardog&#8217;s <strong>server</strong> classpath. Then set <code>spatial.use.jts=true</code> in your <code>stardog.properties</code> file. When you restart Stardog, it will pick up JTS and you&#8217;ll be able to use more complex WKT formatted shapes.</p></div></div></div><h1 id="_property_graphs" class="sect0"><a class="link" href="#_property_graphs">Property Graphs</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/property-graph.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>In addition to RDF, SPARQL, OWL, and SNARL, Stardog supports the non-semantic <a href="http://tinkerpop.incubator.apache.org/docs/3.0.2-incubating/#intro">property graph model</a>, Gremlin graph traversal language, and <a href="http://tinkerpop.com/">Apache TinkerPop 3</a> APIs. For information on how to use the TinkerPop 3, please refer to its <a href="http://tinkerpop.incubator.apache.org/docs/3.0.2-incubating">documentation</a>. Details about Stardog&#8217;s support for <a href="http://tinkerpop.incubator.apache.org/docs/3.0.2-incubating/#_features">TinkerPop 3 Features</a> can be found in <a href="/java/snarl/com/complexible/stardog/gremlin/features/StardogFeatureSet.html">Stardog Feature Set</a>.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Stardog <code>5.0.0beta</code> supports TinkerPop <code>3.0.2-incubating</code>.</td></tr></table></div></div></div><div class="sect1"><h2 id="_motivation_implementation"><a class="link" href="#_motivation_implementation">Motivation &amp; Implementation</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog&#8217;s implementation of TinkerPop 3 is based ultimately on a (seamless and opaque) translation to and from RDF, in which Stardog persists all vertices, edges and properties. In order to support edge properties in the RDF model, Stardog includes a reification function which allows statement identifiers to be used as the subject of an RDF quad; this extends the RDF Quad model used in Stardog to have a notion of virtual "quints".</p></div><div class="paragraph"><p>Having virtual quints in Stardog lets us manipulate existing RDF content as a property graph; but, most importantly, it lets us use Stardog capabilities (reasoning, ICV, etc) with property graphs. Reification extends existing Stardog graph database and let users add edge properties if required via the TinkerPop 3 or even SPARQL.</p></div><div class="paragraph"><p>Okay, so why add property graph support to Stardog? A few reasons:</p></div><div class="olist arabic"><ol class="arabic"><li><p>sometimes you need to traverse, rather than query, a graph</p></li><li><p>sometimes you need to traverse a <strong>semantic</strong> graph</p></li></ol></div><div class="sect2"><h3 id="_example_2"><a class="link" href="#_example_2">Example</a></h3><div class="paragraph"><p>Loading the <a href="http://tinkerpop.incubator.apache.org/docs/3.0.2-incubating/#intro">TinkerGraph Modern</a> graph via TinkerPop 3 (using Gremlin Console), using the described <a href="#_graph_configuration">Graph Configuration</a>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">Graph graph = StardogGraphFactory.open(...)  <b class="conum">(1)</b>
graph.io(graphml()).readGraph('data/tinkerpop-modern.xml')  <b class="conum">(2)</b></code></pre></div></div><div class="colist arabic"><ol><li><p>Get the Graph from the <code>StardogGraphFactory</code></p></li><li><p>Load the graph <code>tinkerpop-modern</code> included in Gremlin Console distribution at <code>data/tinkerpop-modern.xml</code>.</p></li></ol></div><div class="paragraph"><p>That produces the following internal representation in Stardog:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-turtle" data-lang="turtle">@prefix : &lt;http://api.stardog.com/&gt; .
@prefix owl: &lt;http://www.w3.org/2002/07/owl#&gt; .
@prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
@prefix stardog: &lt;tag:stardog:api:&gt; .
@prefix tp: &lt;https://www.tinkerpop.com/&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .

tp:software-bd37dbca-b8d5-4989-abb7-58b82e14411e tp:name "ripple" ;
    rdfs:label "software" ;
    tp:lang "java" .

tp:person-5c8001e5-2bfa-4816-9a76-c69d77e19b62 tp:name "josh" ;
    tp:age "32"^^xsd:int ;
    rdfs:label "person" ;
    tp:created-aac3d5b1-e5ff-460f-aaf3-267b3d11b710 tp:software-5964a0af-1bb4-4469-b362-6b7db5e617e2 ;
    tp:created-33504b11-6393-4ab8-a762-280bf5914e0b tp:software-bd37dbca-b8d5-4989-abb7-58b82e14411e .

tp:software-5964a0af-1bb4-4469-b362-6b7db5e617e2 tp:name "lop" ;
    rdfs:label "software" ;
    tp:lang "java" .

&lt;tag:stardog:api:id:21115cc5c645c6d35b7571acb4ff3756&gt; rdfs:label "created" ;
    tp:weight 4.0E-1 .

&lt;tag:stardog:api:id:83775dcbec39e9ef064557f9e7fdee47&gt; rdfs:label "created" ;
    tp:weight 1.0E0 .

tp:person-c56860db-505d-4805-abd0-eecd7698149a tp:name "peter" ;
    tp:age "35"^^xsd:int ;
    rdfs:label "person" ;
    tp:created-6d0837a6-c891-4419-b320-80136651a645 tp:software-5964a0af-1bb4-4469-b362-6b7db5e617e2 .

&lt;tag:stardog:api:id:b751315c74567c781eb95dba9be6ba94&gt; rdfs:label "created" ;
    tp:weight 2.0E-1 .

tp:person-344dd010-dfc4-4356-aca8-f580c07f52d7 tp:name "vadas" ;
    tp:age "27"^^xsd:int ;
    rdfs:label "person" .

tp:person-adb00b0b-7912-4308-8be2-158af3d7879a tp:name "marko" ;
    tp:age "29"^^xsd:int ;
    rdfs:label "person" ;
    tp:created-640f018f-a2ef-4486-9dea-a7add6b26ce8 tp:software-5964a0af-1bb4-4469-b362-6b7db5e617e2 ;
    tp:knows-463a4473-6a1f-46df-a893-de0f4236ee83 tp:person-344dd010-dfc4-4356-aca8-f580c07f52d7 ;
    tp:knows-22569d6b-b7bb-47c5-b0c4-71a2c78ef900 tp:person-5c8001e5-2bfa-4816-9a76-c69d77e19b62 .

&lt;tag:stardog:api:id:b46d0155b1c5558598e8c3425432ab81&gt; rdfs:label "created" ;
    tp:weight 4.0E-1 .

&lt;tag:stardog:api:id:19f7ef4ca398cf79850e3b6463f776bd&gt; rdfs:label "knows" ;
    tp:weight 5.0E-1 .

&lt;tag:stardog:api:id:f1ed3591ab20391a1b169d85dc74be5a&gt; rdfs:label "knows" ;
    tp:weight 1.0E0 .</code></pre></div></div><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">This translation between RDF and property graph models is transparent to the user. It just works. But, of course, since in the end it&#8217;s just RDF, you can always query or interact with it as RDF directly using SPARQL, Jena, Sesame, or SNARL code, etc. However, the mapping between Property Graphs and RDF is <strong>not</strong> considered part of Stardog&#8217;s <a href="#_compatibility_policies">contract</a> so it may change without notice. You&#8217;ve been warned!</td></tr></table></div><div class="paragraph"><p>Getting properties for in-edges for a vertex from the previous graph, using the TinkerPop 3 API:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">g = graph.traversal()                        <b class="conum">(1)</b>
g.V('https://www.tinkerpop.com/software-5964a0af-1bb4-4469-b362-6b7db5e617e2').inE().properties()  <b class="conum">(2)</b>
g.V().has('name','lop').inE().properties()  <b class="conum">(3)</b></code></pre></div></div><div class="colist arabic"><ol><li><p>Get a traversal that can be reused</p></li><li><p>Get a vertex using its IRI Id and list in-edge properties</p></li><li><p>Get a vertex filtering by name and list in-edge properties</p></li></ol></div></div><div class="sect2"><h3 id="_integration_with_sparql_2"><a class="link" href="#_integration_with_sparql_2">Integration with SPARQL</a></h3><div class="paragraph"><p>Access to the reification function is available via SPARQL in order to be able to query edge properties created via the TinkerPop 3 API, e.g. query to find the first 10 edge properties, excluding the label:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sparql" data-lang="sparql">select ?srcName ?edgeLabel ?destName ?edgeProp ?val where {
  ?src ?pred ?dest .
  ?src tp:name ?srcName .
  ?dest tp:name ?destName .
  BIND(stardog:identifier(?src, ?pred, ?dest) as ?edgeId) . <b class="conum">(1)</b>
  ?edgeId rdfs:label ?edgeLabel .
  ?edgeId ?edgeProp ?val .
  FILTER (?edgeProp != rdfs:label) .
} limit 10</code></pre></div></div><div class="colist arabic"><ol><li><p>Using the <code>stardog:identifier()</code> (aka "reification") function.</p></li></ol></div></div><div class="sect2"><h3 id="_database_configuration"><a class="link" href="#_database_configuration">Database Configuration</a></h3><div class="paragraph"><p>Any Stardog database should work out-of-the-box with the Stardog TinkerPop 3 implementation, but given that Stardog enables by default <a href="http://docs.stardog.com/java/snarl/com/complexible/stardog/index/IndexOptions.html#CANONICAL_LITERALS">RDF literal canonicalization</a>, some property value types may not be as expected when fetching them from the TinkerPop 3 graph. To allow for better compatibility between TinkerPop 3 and Stardog, the setting <code>index.literals.canonical</code> must be disabled in the database at creation time, using the following command:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin db create -o index.literals.canonical=false -n &lt;dbname&gt;</code></pre></div></div></div><div class="sect2"><h3 id="_graph_configuration"><a class="link" href="#_graph_configuration">Graph Configuration</a></h3><div class="paragraph"><p>In order to create TinkerPop 3 graphs, a configuration object must be created to set up the graph. The TinkerPop 3 implementation for Stardog contains a tool for creating this configuration easily, supporting many of the features available in Stardog, such as reasoning and named-graphs. The <a href="http://docs.stardog.com/java/snarl/com/complexible/stardog/gremlin/StardogGraphConfiguration.html">StardogGraphConfiguration</a>, is available via the API or the Gremlin Console in Groovy.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">gremlin&gt; graphConf = StardogGraphConfiguration.builder()
...
gremlin&gt; graphConf.connectionString("snarl://localhost:5820/mygraph").credentials("admin", "admin")
...
gremlin&gt; graphConf.baseIRI("http://tinkerpop.incubator.apache.org/").reasoning(false)
==&gt;gremlin.graph=tag:stardog:api:context:default
stardog.computer.cache_size=5000
stardog.label_iri=http://www.w3.org/2000/01/rdf-schema#label
stardog.connection=snarl://localhost:5820/mygraph
stardog.user=admin
stardog.password=admin
stardog.base_iri=http://tinkerpop.incubator.apache.org/
stardog.reasoning_enabled=false
gremlin&gt; graph = StardogGraphFactory.open(graphConf.build())
==&gt;cachedstardoggraph[cachedstardoggraph]</code></pre></div></div></div></div></div><div class="sect1"><h2 id="_stardog_gremlin_console"><a class="link" href="#_stardog_gremlin_console">Stardog &amp; Gremlin Console</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog&#8217;s TinkerPop 3 implementation includes a plugin for <a href="http://tinkerpop.incubator.apache.org/docs/3.0.2-incubating/#gremlin-console" target="_blank">Gremlin Console</a>.</p></div><div class="sect2"><h3 id="_installation_2"><a class="link" href="#_installation_2">Installation</a></h3><div class="paragraph"><p>The following steps describe how to install the Stardog plugin into the Gremlin console:</p></div><div class="olist arabic"><ol class="arabic" start="1"><li><p>Create <code>stardog-gremlin/plugin</code> directory within the <code>ext/</code> directory in the Gremlin console directory.</p></li></ol></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">~/gremlin-console/ext/$ mkdir -p stardog-gremlin/plugin</code></pre></div></div><div class="olist arabic"><ol class="arabic" start="2"><li><p>Flat-copy all Stardog client jar files to the directory created in the previous step.</p></li></ol></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">~/gremlin-console/ext/stardog-gremlin/plugin$ find stardog/client -iname '*.jar' -exec cp \{\} . \;</code></pre></div></div><div class="olist arabic"><ol class="arabic" start="3"><li><p>Make sure the jar file <code>stardog-gremlin-X.X.X.jar</code> is contained in the <code>stardog-gremlin/plugin</code> directory along with all other Stardog jars; copy the jar if it doesn&#8217;t exist.</p></li><li><p>Start the Gremlin Console and make sure the <code>complexible.stardog</code> plugin has been loaded.</p></li></ol></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">~/gremlin-console$ bin/gremlin.sh
         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin activated: tinkerpop.server
plugin activated: tinkerpop.utilities
plugin activated: tinkerpop.tinkergraph
gremlin&gt; :plugin list
==&gt;tinkerpop.server[active]
==&gt;tinkerpop.gephi
==&gt;tinkerpop.utilities[active]
==&gt;tinkerpop.sugar
==&gt;complexible.stardog
==&gt;tinkerpop.tinkergraph[active]</code></pre></div></div><div class="olist arabic"><ol class="arabic" start="5"><li><p>Activate the <code>complexible.stardog</code> plugin in Gremlin Console</p></li></ol></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">gremlin&gt; :plugin use complexible.stardog
==&gt;complexible.stardog activated</code></pre></div></div><div class="olist arabic"><ol class="arabic" start="6"><li><p>You&#8217;re done installing the stardog-gremlin plugin for Gremlin Console. Now you can create a <code>StardogGraph</code> and start exploring the TinkerPop 3 API with Stardog.</p></li></ol></div></div><div class="sect2"><h3 id="_using_a_stardog_graph"><a class="link" href="#_using_a_stardog_graph">Using a Stardog Graph</a></h3><div class="paragraph"><p>The following describes the process to create a <code>StardogGraph</code> and explore data in Stardog using the TinkerPop 3 API via the Gremlin Console.</p></div><div class="paragraph"><p>The only requirement is that you have an existent database in Stardog as directed in <a href="#_database_configuration">Database Configuration</a>, which could be in-memory or disk based. Assuming you already installed the Stardog plugin for the Gremlin Console and it is active, start the Gremlin Console.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">gremlin-console$ bin/gremlin.sh</code></pre></div></div><div class="paragraph"><p>In the Gremlin Console, create the configuration settings for opening the <code>StardogGraph</code>. Assuming the Stardog server is running in <code>localhost:5820</code>, the user is <code>admin</code> and password <code>admin</code>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">gremlin&gt; graphConf = StardogGraphConfiguration.builder()
...
gremlin&gt; graphConf.connectionString("snarl://localhost:5820/mygraph").credentials("admin", "admin").baseIRI("http://tinkerpop.incubator.apache.org/")
==&gt;gremlin.graph=tag:stardog:api:context:default
stardog.computer.cache_size=5000
stardog.label_iri=http://www.w3.org/2000/01/rdf-schema#label
stardog.connection=snarl://localhost:5820/mygraph
stardog.user=admin
stardog.password=admin
stardog.base_iri=http://tinkerpop.incubator.apache.org/
gremlin&gt; graph = StardogGraphFactory.open(graphConf.build())
==&gt;cachedstardoggraph[cachedstardoggraph]</code></pre></div></div><div class="sect3"><h4 id="_named_graphs"><a class="link" href="#_named_graphs">Named Graphs</a></h4><div class="paragraph"><p>The previous commands will create a Graph within the <code>default</code> graph of the Stardog database <code>mygraph</code>. A database can contain multiple graphs, which would be the equivalent to <code>named-graphs</code> in Stardog.</p></div><div class="paragraph"><p>To create a <code>StardogGraph</code> over a specific named-graph, just set the named-graph URI in the <a href="#_graph_configuration">Graph Configuration</a> for the <code>StardogGraph</code> to create:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">gremlin&gt; graphConf.namedGraph("tag:graph1")
==&gt;gremlin.graph=tag:stardog:api:context:default
...
stardog.named_graph=tag:graph1
...</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">by default, the property <code>gremlin.graph</code> is set to the default graph in a Stardog database; setting the <code>stardog.named_graph</code> configuration option will override the graph option.</td></tr></table></div></div></div></div></div><div class="sect1"><h2 id="_stardog_gremlin_server"><a class="link" href="#_stardog_gremlin_server">Stardog &amp; Gremlin Server</a></h2><div class="sectionbody"><div class="paragraph"><p>The TinkerPop 3 implementation for Stardog includes a plugin for <a href="http://tinkerpop.incubator.apache.org/docs/3.0.0.M9-incubating/#gremlin-server" target="_blank">Gremlin Server</a>.</p></div><div class="sect2"><h3 id="_installation_3"><a class="link" href="#_installation_3">Installation</a></h3><div class="paragraph"><p>The following steps describe how to install the Stardog plugin into the gremlin server:</p></div><div class="olist arabic"><ol class="arabic" start="1"><li><p>Create <code>stardog-gremlin/plugin</code> directory within the <code>ext/</code> directory in the gremlin server directory.</p></li></ol></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">~/gremlin-server/ext/$ mkdir -p stardog-gremlin/plugin</code></pre></div></div><div class="olist arabic"><ol class="arabic" start="2"><li><p>Flat-copy all Stardog client jar files to the directory created in the previous step.</p></li></ol></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">~/gremlin-server/ext/stardog-gremlin/plugin$ find ~/stardog/client -iname '*.jar' -exec cp \{\} . \;</code></pre></div></div><div class="olist arabic"><ol class="arabic" start="3"><li><p>Make sure the jar file <code>stardog-gremlin-X.X.X.jar</code> is contained in the <code>stardog-gremlin/plugin</code> directory along with all other Stardog jars; copy the jar if it doesn&#8217;t exist.</p></li></ol></div></div><div class="sect2"><h3 id="_configure_stardog_graphs"><a class="link" href="#_configure_stardog_graphs">Configure Stardog Graphs</a></h3><div class="paragraph"><p>To setup a graph for use with the Gremlin Server you need to create a configuration file in <code>conf/</code> with the Stardog graph properties. The following example file, <code>stardoggraph-mygraph.properties</code>, contains the required properties to use a Stardog graph, described in <a href="#_graph_configuration">Graph Configuration</a>:</p></div><div class="listingblock"><div class="content"><pre># Properties for creating a StardogGraph in Gremlin Server
gremlin.graph=com.complexible.stardog.gremlin.structure.StardogGraph
stardog.connection=snarl://localhost:5820/mygraph
stardog.user=admin
stardog.password=admin
stardog.named_graph=tag:stardog:api:graph:default
stardog.reasoning_enabled=false</pre></div></div><div class="paragraph"><p>In the previous example, <code>gremlin.graph</code> defines the TinkerPop Class implementation to use, in this case is the <code>StardogGraph</code>. The property <code>gremlin.stardog.named_graph</code> is required when configuring a graph in Gremlin Server, if the graph is contained in the Stardog DB&#8217;s default graph, the value to use is: <code>tag:stardog:api:graph:default</code> as shown in the example; if other named-graph is used, just set the value to the named-graph&#8217;s <code>URI</code>. The rest of the properties are just connection settings to the Stardog server.</p></div><div class="paragraph"><p>Now you need to point to the Stardog graph properties file from the server configuration file, <code>conf/gremlin-server.yaml</code>, and enable the Stardog plugin. the following are the relevant parts of the configuration file that need to be set:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">graphs: {
  graph: conf/stardoggraph-mygraph.properties      <b class="conum">(1)</b>
}
plugins:
  - complexible.stardog                            <b class="conum">(2)</b>
...</code></pre></div></div><div class="colist arabic"><ol><li><p>set the stardog graph properties</p></li><li><p>enable the stardog gremlin plugin</p></li></ol></div></div><div class="sect2"><h3 id="_running_the_gremlin_server"><a class="link" href="#_running_the_gremlin_server">Running the Gremlin Server</a></h3><div class="paragraph"><p>Having a Stardog server running, at this point you&#8217;re ready to start the Gremlin Server.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">~/gremlin-server$ bin/gremlin-server.sh</code></pre></div></div><div class="paragraph"><p>You should see that the Gremlin Server creates an instance of the <code>StardogGraph</code>, named <code>graph</code>, based on the properties file configured.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">[INFO] Graphs - Graph [graph] was successfully configured via [conf/stardoggraph-mygraph.properties].</code></pre></div></div></div></div></div><h1 id="_security" class="sect0"><a class="link" href="#_security">Security</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/security.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>Stardog&#8217;s security model is based on standard role-based access control: users have <strong>permissions</strong> over <strong>resources</strong> during <strong>sessions</strong>; permissions can be grouped into <strong>roles</strong>; and roles can be assigned to <strong>users</strong>.</p></div><div class="paragraph"><p>Stardog uses <a href="http://shiro.apache.org/">Apache Shiro</a> for authentication, authorization, and session management and <a href="http://www.mindrot.org/projects/jBCrypt/">jBCrypt</a> for password hashing.</p></div></div></div><div class="sect1"><h2 id="_resources"><a class="link" href="#_resources">Resources</a></h2><div class="sectionbody"><div class="paragraph"><p>A resource is some Stardog entity or service to which access is controlled. Resources are identified by their <strong>type</strong> and their <strong>name</strong>. A particular resource is denoted as <code>type_prefix:name</code>. The valid resource types with their prefixes are shown below.</p></div><table class="tableblock frame-all grid-all spread"><caption class="title">6. Table of System Resources</caption><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Resource</th><th class="tableblock halign-left valign-top">Prefix</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A user (e.g., <code>user:admin</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Role</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>role</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A role assigned to a user (<code>role:reader</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Database</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>db</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A database (<code>db:myDB</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Named Graph</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>named-graph</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">A named graph (graph subset) (<code>named-graph:myDb\named-graph-id</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Database Metadata</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Metadata of a database (<code>metadata:myDB</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Database Admin</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Database admin tasks (e.g., <code>admin:myDB</code>)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Integrity Constraints</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>icv-constraints</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Integrity constraints associated with a database (e.g., <code>icv-constraints:myDB</code>)</p></td></tr></tbody></table></div></div><div class="sect1"><h2 id="_permissions"><a class="link" href="#_permissions">Permissions</a></h2><div class="sectionbody"><div class="paragraph"><p>Permissions are composed of a <strong>permission subject</strong>, an <strong>action</strong>, and a <strong>permission object</strong>, which is interpreted as <strong>the subject resource can perform the specified action over the object resource</strong>.</p></div><div class="paragraph"><p>Permission subjects can be of type <code>user</code> or <code>role</code> only. Permission objects can be of any valid type.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content"><code>write</code> permission in Stardog refers to graph contents, including mutative operations performed via SPARQL Update (i.e., <code>INSERT</code>, <code>DELETE</code>, etc.). The other permissions, i.e., <code>create</code> and <code>delete</code>, apply to resources of the system itself, i.e., users, databases, database metadata, etc.</td></tr></table></div><div class="paragraph"><p>Valid actions include the following:</p></div><div class="dlist"><dl><dt class="hdlist1"><code>read</code></dt><dd><p>Permits reading the resource properties</p></dd><dt class="hdlist1"><code>write</code></dt><dd><p>Permits changing the resource properties</p></dd><dt class="hdlist1"><code>create</code></dt><dd><p>Permits creating new resources</p></dd><dt class="hdlist1"><code>delete</code></dt><dd><p>Permits deleting a resource</p></dd><dt class="hdlist1"><code>grant</code></dt><dd><p>Permits granting permissions over a resource</p></dd><dt class="hdlist1"><code>revoke</code></dt><dd><p>Permits revoking permissions over a resource</p></dd><dt class="hdlist1"><code>execute</code></dt><dd><p>Permits executing administration actions over a database</p></dd><dt class="hdlist1"><code>all</code></dt><dd><p>Special action type that permits all previous actions over a resource</p></dd></dl></div><div class="sect2"><h3 id="_wildcards"><a class="link" href="#_wildcards">Wildcards</a></h3><div class="paragraph"><p>Stardog understands the use of wildcards to represent sets of resources. A wildcard is denoted with the character <code>*</code>. Wildcards can be used to create complex permissions; for instance, we can give a user the ability to create any database by granting it a <code>create</code> permission over <code>db:*</code>. Similarly, wildcards can be used in order to revoke multiple permissions simultaneously.</p></div></div><div class="sect2"><h3 id="_superusers"><a class="link" href="#_superusers">Superusers</a></h3><div class="paragraph"><p>It is possible at user-creation time to specify that a given user is a superuser. Being a superuser is equivalent to having been granted an <code>all</code> permission over every resource, i.e., <code>*:*</code>. Therefore, as expected, superusers are allowed to perform any valid action over any existing (or future) resource.</p></div></div><div class="sect2"><h3 id="_database_owner_default_permissions"><a class="link" href="#_database_owner_default_permissions">Database Owner Default Permissions</a></h3><div class="paragraph"><p>When a user creates a resource, it is automatically granted <code>delete</code>, <code>write</code>, <code>read</code>, <code>grant</code>, and <code>revoke</code> permissions over the new resource. If the new resource is a database, then the user is additionally granted <code>write</code>, <code>read</code>, <code>grant</code>, and <code>revoke</code> permissions over <code>icv-constraints:theDatabase</code> and <code>execute</code> permission over <code>admin:theDatabase</code>. These latter two permissions give the owner of the database the ability to administer the ICV constraints for the database and to administer the database itself.</p></div></div></div></div><div class="sect1"><h2 id="_default_security_configuration"><a class="link" href="#_default_security_configuration">Default Security Configuration</a></h2><div class="sectionbody"><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">Out of the box, the Stardog security setup is minimal and <strong>insecure</strong>: <code>user:admin</code> with password set to "admin" is a superuser; <code>user:anonymous</code> with password "anonymous" has the "reader" role; <code>role:reader</code> allows <code>read</code> of any resource.</td></tr></table></div><div class="paragraph"><p><strong>Do not deploy Stardog in production or in hostile environments with the default security settings.</strong></p></div><div class="sect2"><h3 id="_setting_password_constraints"><a class="link" href="#_setting_password_constraints">Setting Password Constraints</a></h3><div class="paragraph"><p>To setup the constraints used to validate passwords when adding new users, configure the following settings in the <code>stardog.properties</code> configuration file.</p></div><div class="ulist"><ul><li><p><code>password.length.min</code>: Sets the password policy for the minimum length of user passwords, the value can&#8217;t be less than 1 or greater than <code>password.length.max</code>. Default: <code>4</code>.</p></li><li><p><code>password.length.max</code>: Sets the password policy for the maximum length of user passwords, the value can&#8217;t be greater than 1024 or less than 1. Default: <code>20</code>.</p></li><li><p><code>password.regex</code>: Sets the password policy of accepted chars in user passwords, via a Java regular expression. Default: <code>[\\w@#$%]+</code></p></li></ul></div></div><div class="sect2"><h3 id="_using_a_password_file"><a class="link" href="#_using_a_password_file">Using a Password File</a></h3><div class="paragraph"><p>To avoid putting passwords into scripts or environment variables, you can put them into a suitably secured password file. If no credentials are passed explicitly in CLI invocations, or you do not ask Stardog to prompt you for credentials interactively, then it will look for credentials in a password file.</p></div><div class="paragraph"><p>On a Unix system, Stardog will look for a file called <code>.sdpass</code> in the home directory of the user Stardog is running as; on a Windows system, it will look for <code>sdpass.conf</code> in <code>Application Data\stardog</code> in the home directory of the user Stardog is running as. If the file is not found in these locations, Stardog will look in the location provided by the <code>stardog.passwd.file</code> system property.</p></div><div class="sect3"><h4 id="_password_file_format"><a class="link" href="#_password_file_format">Password File Format</a></h4><div class="paragraph"><p>The format of the password file is as follows:</p></div><div class="ulist"><ul><li><p>any line that starts with a <code>#</code> is ignored</p></li><li><p>each line contains a single password in the format: <code>hostname:port:database:username:password</code>.</p></li><li><p>wildcards, <code>*</code>, are permitted for any field but the password field; colons and backslashes in fields are escaped with <code>\</code>.</p></li></ul></div><div class="paragraph"><p>For example,</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">#this is my password file; there are no others like it and this one is mine anyway...
*:*:*:flannery:aNahthu8
*:*:summercamp:jemima:foh9Moaz</code></pre></div></div><div class="paragraph"><p>Of course you should secure this file carefully, making sure that only the user that Stardog runs as can read it.</p></div></div></div></div></div><div class="sect1"><h2 id="_named_graph_security"><a class="link" href="#_named_graph_security">Named Graph Security</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog&#8217;s security model is based on standard RBAC notions: users have permissions over resources during sessions; permissions can be grouped into roles; and roles can be assigned to users. Stardog defines a database resource type so that users and roles can be given read or write access to a database. With Named Graph Security added in Stardog 3.1, Stardog lets you specify which named graphs a user can read from or write to; that is, named graphs are now an explicit resource type in Stardog&#8217;s security model.</p></div><div class="sect2"><h3 id="_example_3"><a class="link" href="#_example_3">Example</a></h3><div class="paragraph"><p>To grant a user permissions to a named graph,</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog-admin user grant -a read -o named-graph:myDB\http://example.org/g1 myUser
$ stardog-admin user grant -a write -o named-graph:myDB\http://example.org/g2 myUser</code></pre></div></div><div class="paragraph"><p>Note the use of "\" to separate the name of the database ("myDB") from the named graph identifier ("http://example.org/g1").</p></div><div class="admonitionblock important"><table><tr><td class="icon"><div class="title">Important</div></td><td class="content">Named Graph Security is <strong>disabled</strong> by default (for backwards compatibility with the installed base). It can be enabled globally (or per database) by setting <code>security.named.graphs=true</code>, in <code>stardog.properties</code> globally, or per database.</td></tr></table></div></div><div class="sect2"><h3 id="_named_graph_operations"><a class="link" href="#_named_graph_operations">Named Graph Operations</a></h3><div class="paragraph"><p>Stardog does not support the notion of an empty named graph; thus, there is no operation to create a named graph. Deleting a named graph is simply removing all the triples in that named graph; so it&#8217;s also not a special operation. For this reason, only <strong>read</strong> and <strong>write</strong> permissions can be used with named graphs and <strong>create</strong> and <strong>delete</strong> permissions cannot be used with named graphs.</p></div></div><div class="sect2"><h3 id="_how_named_graph_permissions_work"><a class="link" href="#_how_named_graph_permissions_work">How Named Graph Permissions Work</a></h3><div class="paragraph"><p>The set of named graphs to which a user has read or write access is <strong>the union of named graphs for which it has been given explicit access plus the named graphs for which the user&#8217;s roles have been given access</strong>.</p></div><div class="sect3"><h4 id="_querying_2"><a class="link" href="#_querying_2">Querying</a></h4><div class="paragraph"><p>An effect of named graph permissions is changing the RDF Dataset associated with a query. The default and named graphs specified for an RDF Dataset will be filtered to match the named graphs that a user has read access to.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">A read query never triggers a security exception due to named graph permissions. The graphs that a user cannot read from would be <strong>silently dropped from the RDF dataset for the query</strong>, which may cause the query to return no answers, despite there being matching triples in the database.</td></tr></table></div><div class="paragraph"><p>The RDF dataset for SPARQL update queries will be modified similarly based on read permissions.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">The RDF dataset for an update query affects only the <code>WHERE</code> clause.</td></tr></table></div></div><div class="sect3"><h4 id="_writing"><a class="link" href="#_writing">Writing</a></h4><div class="paragraph"><p>Write permissions are enforced by throwing a security exception whenever a named graph is being updated by a user that does not have write access to the graph. Adding a triple to an unauthorized named graph will raise an exception even if that triple already exists in the named graph. Similarly trying to remove a non-existent triple from an unauthorized graph raises an error.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">The unauthorized graph may not exist in the database; any graph that is not explicitly listed in a user&#8217;s permissions is unauthorized.</td></tr></table></div><div class="paragraph"><p>Updates either succeed as a whole or fail. If an update request tries to modify both an authorized graph an unauthorized graph, it would fail without making any modifications.</p></div></div><div class="sect3"><h4 id="_reasoning_2"><a class="link" href="#_reasoning_2">Reasoning</a></h4><div class="paragraph"><p>Stardog allows a set of named graphs to be used as the schema for reasoning. The OWL axioms and rules defined in these graphs are extracted and used in the reasoning process. The schema graphs are specified in the database configuration and affect all users running reasoning queries.</p></div><div class="paragraph"><p>Named graph permissions do <strong>not</strong> affect the schema axioms used in reasoning and every reasoning query will use the same schema axioms even though some users might <strong>not</strong> have been granted explicit read access to schema graphs. But non-schema axioms in those named graphs would <strong>not</strong> be visible to users without authorization.</p></div></div></div></div></div><div class="sect1"><h2 id="_enterprise_authentication"><a class="link" href="#_enterprise_authentication">Enterprise Authentication</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog can use an LDAP server to authenticate enterprise users. Stardog assumes the existence of two different groups to identify regular and superusers, respectively. Groups must be identified with the <code>cn</code> attribute and be instances of the <code>groupOfNames</code> object class. Users must be specified using the <code>member</code> attribute.</p></div><div class="paragraph"><p>For example,</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ldap" data-lang="ldap">dn: cn=stardogSuperUsers,ou=group,dc=example,dc=com
cn: stardogSuperUsers
objectclass: groupOfNames
member: uid=superuser,ou=people,dc=example,dc=com

dn: cn=stardogUsers,ou=group,dc=example,dc=com
cn: stardogUsers
objectclass: groupOfNames
member: uid=regularuser,ou=people,dc=example,dc=com
member: uid=anotherregularuser,ou=people,dc=example,dc=com</code></pre></div></div><div class="paragraph"><p>Credentials and other user information are stored as usual:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ldap" data-lang="ldap">dn: uid=superuser,ou=people,dc=example,dc=com
objectClass: inetOrgPerson
cn: superuser
sn: superuser
uid: superuser
userPassword: superpassword</code></pre></div></div><div class="sect2"><h3 id="_configuring_stardog"><a class="link" href="#_configuring_stardog">Configuring Stardog</a></h3><div class="paragraph"><p>In order to enable LDAP authentication in Stardog, we need to include the following <strong>mandatory</strong> properties in <code>stardog.properties</code>:</p></div><div class="ulist"><ul><li><p><code>security.realms</code>: with a value of <code>ldap</code></p></li><li><p><code>ldap.provider.url</code>: The URL of the LDAP server</p></li><li><p><code>ldap.security.principal</code>: An LDAP user allowed to retrieve group members from the LDAP server</p></li><li><p><code>ldap.security.credentials</code>: The principal&#8217;s password</p></li><li><p><code>ldap.user.dn.template</code>: A template to form LDAP names from Stardog usernames</p></li><li><p><code>ldap.group.lookup.string</code>: A string to lookup the Stardog user groups</p></li><li><p><code>ldap.users.cn</code>: The <code>cn</code> of the group identifying regular Stardog users</p></li><li><p><code>ldap.superusers.cn</code>: The <code>cn</code> of the group identifying Stardog super users</p></li><li><p><code>ldap.cache.invalidate.time</code>: The time duration to invalidate cache entries, default to <code>24h</code>.</p></li></ul></div><div class="paragraph"><p>Here&#8217;s another example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-ini" data-lang="ini">security.realms = ldap
ldap.provider.url = ldap://localhost:5860
ldap.security.principal = uid=admin,ou=people,dc=example,dc=com
ldap.security.credentials = secret
ldap.user.dn.template = uid={0},ou=people,dc=example,dc=com
ldap.group.lookup.string = ou=group,dc=example,dc=com
ldap.users.cn = stardogUsers
ldap.superusers.cn = stardogSuperUsers
ldap.cache.invalidate.time = 1h</code></pre></div></div></div><div class="sect2"><h3 id="_user_management"><a class="link" href="#_user_management">User Management</a></h3><div class="paragraph"><p>Users can no longer be added/removed/modified via Stardog. User management is delegated to the LDAP server.</p></div><div class="sect3"><h4 id="_an_ldap_quirk"><a class="link" href="#_an_ldap_quirk">An LDAP Quirk</a></h4><div class="paragraph"><p>When Stardog manages users, instead of delegating to LDAP, when a user is created, they are assigned the permission <code>read:user:$NEW_USER</code>. But when user management is delegated to LDAP, this permission is not automatically created at new user creation time in Stardog and, therefore, it should be added manually to Stardog. If this doesn&#8217;t happen, users won&#8217;t be able to&#8212;&#8203;among other things&#8212;&#8203;log into the Web Console.</p></div></div></div><div class="sect2"><h3 id="_authenticated_user_cache"><a class="link" href="#_authenticated_user_cache">Authenticated User Cache</a></h3><div class="paragraph"><p>Stardog includes a time constrained cache with a configurable time for eviction, default to 24 hours. To disable the cache, the eviction time must be set to <code>0ms</code>.</p></div></div><div class="sect2"><h3 id="_authorization"><a class="link" href="#_authorization">Authorization</a></h3><div class="paragraph"><p>The LDAP server is used for <strong>authentication only</strong>. Permissions and roles are assigned in Stardog.</p></div><div class="sect3"><h4 id="_stale_permissions_roles"><a class="link" href="#_stale_permissions_roles">Stale Permissions/Roles</a></h4><div class="paragraph"><p>Permissions and roles in Stardog might refer to users that no long exist, i.e., those that were deleted from the LDAP server. This is safe as these users will not be able to authenticate (see above). It is possible to configure Stardog to periodically clean up the list of permissions and roles according to the latest users in the LDAP server. In order to do this, we pass a <a href="http://www.quartz-scheduler.org/documentation/quartz-1.x/tutorials/crontrigger">Quartz cron expression</a> using the <code>ldap.consistency.scheduler.expression</code> property:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">## Execute the consistency cleanup at 6pm every day
ldap.consistency.scheduler.expression = 0 0 18 * * ?</code></pre></div></div></div></div></div></div><div class="sect1"><h2 id="_managing_stardog_securely"><a class="link" href="#_managing_stardog_securely">Managing Stardog Securely</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog resources can be managed securely by using the tools included in the admin CLI or by programming against Stardog APIs. In this section we describe the permissions required to manage various Stardog resources either by CLI or API.</p></div><div class="sect2"><h3 id="_users"><a class="link" href="#_users">Users</a></h3><div class="dlist"><dl><dt class="hdlist1">Create a user</dt><dd><p><code>create</code> permission over <code>user:*</code>. Only superusers can create other superusers.</p></dd><dt class="hdlist1">Delete a user</dt><dd><p><code>delete</code> permission over the user.</p></dd><dt class="hdlist1">Enable/Disable a user</dt><dd><p>User must be a superuser.</p></dd><dt class="hdlist1">Change password of a user</dt><dd><p>User must be a superuser or user must be trying to change its own password.</p></dd><dt class="hdlist1">Check if a user is a superuser</dt><dd><p><code>read</code> permission over the user or user must be trying to get its own info.</p></dd><dt class="hdlist1">Check if a user is enabled</dt><dd><p><code>read</code> permission over the user or user must be trying to get its own info.</p></dd><dt class="hdlist1">List users</dt><dd><p>Superusers can see all users. Other users can see only users over which they have a permission.</p></dd></dl></div></div><div class="sect2"><h3 id="_roles"><a class="link" href="#_roles">Roles</a></h3><div class="dlist"><dl><dt class="hdlist1">Create a role</dt><dd><p><code>create</code> permission over <code>role:*</code>.</p></dd><dt class="hdlist1">Delete a role</dt><dd><p><code>delete</code> permission over the role.</p></dd><dt class="hdlist1">Assign a role to a user</dt><dd><p><code>grant</code> permission over the role <strong>and</strong> user must have all the permissions associated to the role.</p></dd><dt class="hdlist1">Unassign a role from a user</dt><dd><p><code>revoke</code> permission over the role <strong>and</strong> user must have all the permissions associated to the role.</p></dd><dt class="hdlist1">List roles</dt><dd><p>Superusers can see all roles. Other users can see only roles they have been assigned or over which they have a permission.</p></dd></dl></div></div><div class="sect2"><h3 id="_databases_2"><a class="link" href="#_databases_2">Databases</a></h3><div class="dlist"><dl><dt class="hdlist1">Create a database</dt><dd><p><code>create</code> permission over <code>db:*</code>.</p></dd><dt class="hdlist1">Delete a database</dt><dd><p><code>delete</code> permission over <code>db:theDatabase</code>.</p></dd><dt class="hdlist1">Add/Remove integrity constraints to a database</dt><dd><p><code>write</code> permission over <code>icv-constraints:theDatabase</code>.</p></dd><dt class="hdlist1">Verify a database is valid</dt><dd><p><code>read</code> permission over <code>icv-constraints:theDatabase</code>.</p></dd><dt class="hdlist1">Online/Offline a database</dt><dd><p><code>execute</code> permission over <code>admin:theDatabase</code>.</p></dd><dt class="hdlist1">Migrate a database</dt><dd><p><code>execute</code> permission over <code>admin:theDatabase</code>.</p></dd><dt class="hdlist1">Optimize a database</dt><dd><p><code>execute</code> permission over <code>admin:theDatabase</code>.</p></dd><dt class="hdlist1">List databases</dt><dd><p>Superusers can see all databases. Regular users can see only databases over which they have a permission.</p></dd></dl></div></div><div class="sect2"><h3 id="_permissions_2"><a class="link" href="#_permissions_2">Permissions</a></h3><div class="dlist"><dl><dt class="hdlist1">Grant a permission</dt><dd><p><code>grant</code> permission over the permission object <strong>and</strong> user must have the permission that it is trying to grant.</p></dd><dt class="hdlist1">Revoke a permission from a user or role over an object resource</dt><dd><p><code>revoke</code> permission over the permission object <strong>and</strong> user must have the permission that it is trying to revoke.</p></dd><dt class="hdlist1">List user permissions</dt><dd><p>User must be a superuser or user must be trying to get its own info.</p></dd><dt class="hdlist1">List role permissions</dt><dd><p>User must be a superuser or user must have been assigned the role.</p></dd></dl></div></div></div></div><div class="sect1"><h2 id="_deploying_stardog_securely"><a class="link" href="#_deploying_stardog_securely">Deploying Stardog Securely</a></h2><div class="sectionbody"><div class="paragraph"><p>To ensure that Stardog&#8217;s RBAC access control implementation will be effective, all non-administrator access to Stardog databases should occur over network (i.e., non-native) database connections.<span class="footnote">[<a id="_footnoteref_37" class="footnote" href="#_footnote_37" title="View footnote.">37</a>]</span></p></div><div class="paragraph"><p>To ensure the confidentiality of user authentication credentials when using remote connections, the Stardog server should only accept connections that are encrypted with SSL.</p></div><div class="sect2"><h3 id="_configuring_stardog_to_use_ssl"><a class="link" href="#_configuring_stardog_to_use_ssl">Configuring Stardog to use SSL</a></h3><div class="paragraph"><p>Stardog HTTP server includes native support for SSL. The SNARL server (via <code>snarls://</code>) also supports SSL. To enable Stardog to optionally support SSL connections, just pass <code>--enable-ssl</code> to the server start command. If you want to require the server to use SSL only, that is, to reject any non-SSL connections, then use <code>--require-ssl</code>.</p></div><div class="paragraph"><p>When starting from the command line, Stardog will use the standard Java properties for specifying keystore information:</p></div><div class="ulist"><ul><li><p><code>javax.net.ssl.keyStorePassword</code> (the password)</p></li><li><p><code>javax.net.ssl.keyStore</code> (location of the keystore)</p></li><li><p><code>javax.net.ssl.keyStoreType</code> (type of keystore, defaults to JKS)</p></li></ul></div><div class="paragraph"><p>These properties are checked first in <code>stardog.properties</code>; then in JVM args passed in from the command line, e.g. <code>-Djavax.net.ssl.keyStorePassword=mypwd</code>. If you&#8217;re creating a Server programmatically via <code>ServerBuilder</code>, you can specify values for these properties using the appropriate <code>ServerOptions</code> when creating the server. These values will override anything specified in <code>stardog.properties</code> or via normal JVM args.</p></div></div><div class="sect2"><h3 id="_configuring_stardog_client_to_use_ssl"><a class="link" href="#_configuring_stardog_client_to_use_ssl">Configuring Stardog Client to use SSL</a></h3><div class="paragraph"><p>Stardog HTTP client supports SSL when the <code>https:</code> scheme is used in the database connection string; likewise, it uses SSL for SNARL when the connection string uses the <code>snarls:</code> scheme. For example, the following invocation of the Stardog command line utility will initiate an SSL connection to a remote database:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ stardog query https://stardog.example.org/sp2b_10k "ask { ?s ?p ?o }"</code></pre></div></div><div class="paragraph"><p>If the client is unable to authenticate to the server, then the connection will fail and an error message like the following will be generated.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">Error during connect.  Cause was SSLPeerUnverifiedException: peer not authenticated</code></pre></div></div><div class="paragraph"><p>The most common cause of this error is that the server presented a certificate that was not issued by an authority that the client trusts. The Stardog client uses standard Java security components to access a store of trusted certificates. By default, it trusts a list of certificates installed with the Java runtime environment, but it can be configured to use a custom trust store.<span class="footnote">[<a id="_footnoteref_38" class="footnote" href="#_footnote_38" title="View footnote.">38</a>]</span></p></div><div class="paragraph"><p>The client can be directed to use a specific Java KeyStore file as a trust store by setting the <code>javax.net.ssl.trustStore</code> system property. To address the authentication error above, that trust store should contain the issuer of the server’s certificate. Standard Java tools can create such a file. The following invocation of the <code>keytool</code> utility creates a new trust store named <code>my-truststore.jks</code> and initializes it with the certificate in <code>my-trusted-server.crt</code>. The tool will prompt for a passphrase to associate with the trust store. This is not used to encrypt its contents, but can be used to ensure its integrity.<span class="footnote">[<a id="_footnoteref_39" class="footnote" href="#_footnote_39" title="View footnote.">39</a>]</span></p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ keytool -importcert  -keystore my-truststore.jks -alias stardog-server -file my-trusted-server.crt</code></pre></div></div><div class="paragraph"><p>The following Stardog command line invocation uses the newly created truststore.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ STARDOG_JAVA_ARGS=”-Djavax.net.ssl.trustStore=my-truststore.jks”
$ stardog query https://stardog.example.org/sp2b_10k "ask { ?s ?p ?o }"</code></pre></div></div><div class="paragraph"><p>For custom Java applications that use the Stardog client, the system property can be set programmatically or when the JVM is initialized.</p></div><div class="paragraph"><p>The most common deployment approach requiring a custom trust store is when a self-signed certificate is presented by the Stardog server. For connections to succeed, the Stardog client must trust the self-signed certificate. To accomplish this with the examples given above, the self-signed certificate should be in the <code>my-trusted-server.crt</code> file in the keytool invocation.</p></div><div class="paragraph"><p>A client may also fail to authenticate to the server if the hostname in the Stardog database connection string does not match a name contained in the server certificate.<span class="footnote">[<a id="_footnoteref_40" class="footnote" href="#_footnote_40" title="View footnote.">40</a>]</span></p></div><div class="paragraph"><p>This will cause an error message like the following</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">Error during connect.  Cause was SSLException: hostname in certificate didn't match</code></pre></div></div><div class="paragraph"><p>The client does not support connecting when there&#8217;s a mismatch; therefore, the only workarounds are to replace the server’s certificate or modify the connection string to use an alias for the same server that matches the certificate.</p></div></div></div></div><h1 id="_programming_stardog" class="sect0"><a class="link" href="#_programming_stardog">Programming Stardog</a></h1><div class="openblock partintro"><div class="content">You can program Stardog in Java, over HTTP, JavaScript, Clojure, Groovy, Spring, and .Net.</div></div><div class="sect1"><h2 id="_sample_code"><a class="link" href="#_sample_code">Sample Code</a></h2><div class="sectionbody"><div class="paragraph"><p>There&#8217;s a <a href="https://github.com/complexible/stardog-examples">Github repo of example Java code</a> that you can fork and use as the starting point for your Stardog projects. Feel free to add new examples using pull requests in Github.</p></div></div></div><h1 id="_java_programming" class="sect0"><a class="link" href="#_java_programming">Java Programming</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/java.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>In the <a href="#_network_programming">Network Programming</a> section, we look at how to interact with Stardog over a network via HTTP and SNARL protocol. In this chapter we describe how to program Stardog from Java using SNARL Stardog Native API for the RDF Language, Sesame, and Jena. We prefer SNARL to Sesame to Jena and recommend them&#8212;&#8203;all other things being equal&#8212;&#8203;in that order.</p></div><div class="paragraph"><p>If you&#8217;re a Spring developer, you might want to read <a href="#_spring_programming">Spring Programming</a> or if you prefer a ORM-style approach, you might want to checkout <a href="https://github.com/mhgrove/Empire">Empire</a>, an implementation of <a href="http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html">JPA</a> for RDF that works with Stardog.</p></div></div></div><div class="sect1"><h2 id="_snarl_protocol_buffers"><a class="link" href="#_snarl_protocol_buffers">SNARL Protocol Buffers</a></h2><div class="sectionbody"><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">SNARL is deprecated in Stardog 4.2 and will be removed in Stardog 5.</td></tr></table></div><div class="paragraph"><p>The native Stardog protocol, SNARL, is based on Google Protocol Buffers. The definitions for the various parts of SNARL are</p></div><div class="olist arabic"><ol class="arabic"><li><p><a href="https://github.com/mhgrove/cp-common-utils/blob/master/protobuf/core.proto">core.proto</a>: defines core types</p></li><li><p><a href="/snarl/admin.proto">admin.proto</a>: defines SNARL</p></li><li><p><a href="/snarl/snarl.proto">snarl.proto</a>: defines SNARL</p></li><li><p><a href="/snarl/bigpacket.proto">bigpacket.proto</a>: defines RPC transport</p></li><li><p><a href="/snarl/rdf.proto">rdf.proto</a>: defines binary RDF on-the-wire format</p></li><li><p><a href="/snarl/proof.proto">proof.proto</a>: defines proof trees</p></li></ol></div></div></div><div class="sect1"><h2 id="_examples_3"><a class="link" href="#_examples_3">Examples</a></h2><div class="sectionbody"><div class="paragraph"><p>The <strong>best</strong> way to learn to program Stardog with Java is to study the examples:</p></div><div class="olist arabic"><ol class="arabic"><li><p><a href="https://gist.github.com/1045573">SNARL</a></p></li><li><p><a href="https://gist.github.com/1045568">Sesame bindings</a></p></li><li><p><a href="https://gist.github.com/1045572">Jena bindings</a></p></li><li><p><a href="https://gist.github.com/1045578">SNARL and OWL 2 reasoning</a></p></li><li><p><a href="https://gist.github.com/1070230">SNARL and Connection Pooling</a></p></li><li><p><a href="https://gist.github.com/1085116">SNARL and Searching</a></p></li></ol></div><div class="paragraph"><p>We offer some commentary on the interesting parts of these examples below.</p></div><div class="sect2"><h3 id="_creating_administering_databases"><a class="link" href="#_creating_administering_databases">Creating &amp; Administering Databases</a></h3><div class="paragraph"><p><code>AdminConnection</code> provides simple programmatic access to all administrative functions available in Stardog.</p></div><div class="sect3"><h4 id="_creating_a_database_2"><a class="link" href="#_creating_a_database_2">Creating a Database</a></h4><div class="paragraph"><p>You can create a basic temporary memory database with Stardog with one line of code:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">try (AdminConnection dbms = AdminConnectionConfiguration.toEmbeddedServer().credentials("admin", "admin").connect()) {
  aAdminConnection.createMemory("testConnectionAPI");
}</code></pre></div></div><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">It&#8217;s <strong>crucially important to always clean up connections to the database</strong> by calling `AdminConnection#close().</td></tr></table></div><div class="paragraph"><p>You can also use the <a href="java/snarl/com/complexible/stardog/api/admin/AdminConnection.html#memory"><code>memory</code></a> and <a href="java/snarl/com/complexible/stardog/api/admin/AdminConnection.html#disk"><code>disk</code></a> functions to configure and create a database in any way you prefer. These methods return <a href="java/snarl/com/complexible/stardog/api/admin/DatabaseBuilder.html"><code>DatabaseBuilder</code></a> objects which you can use to configure the options of the database you&#8217;d like to create. Finally, the <a href="java/snarl/com/complexible/stardog/api/admin/DatabaseBuilder.html#create"><code>create</code></a> method takes the list of files to bulk load into the database when you create it and returns a valid <a href="java/snarl/com/complexible/stardog/api/ConnectionConfiguration.html"><code>ConnectionConfiguration</code></a> which can be used to create new <a href="java/snarl/com/complexible/stardog/api/Connection.html"><code>Connections</code></a> to your database.</p></div><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">It is important to note that you <strong>must</strong> take care to always log out of the server when you are done working with <code>AdminConnection</code>.</td></tr></table></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">try (AdminConnection dbms = AdminConnectionConfiguration.toEmbeddedServer().credentials("admin", "admin").connect()) {
  dbms.memory("waldoTest")
      .set(SearchOptions.SEARCH_ENABLED, true)
      .create();
}</code></pre></div></div><div class="paragraph"><p>This illustrates how to create a temporary memory database named <code>test</code> which supports full text search via <a href="#_searching">Searching</a>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">try (AdminConnection dbms = AdminConnectionConfiguration.toEmbeddedServer().credentials("admin", "admin").connect()) {
  dbms.disk("icvWithGuard")			// disk db named 'icvWithGuard'
      .set(ICVOptions.ICV_ENABLED, true)	// enable icv guard mode
      .set(ICVOptions.ICV_REASONING_ENABLED, true)	// specify that guard mode should use reasoning
      .create(new File("data/sp2b_10k.n3"));	// create the db, bulk loading the file(s) to start
}</code></pre></div></div><div class="paragraph"><p>This illustrates how to create a persistent disk database with ICV guard mode and reasoning enabled. For more information on what the available options for <code>set</code> are and what they mean, see the <a href="#_database_admin">Database Admin</a> section. Also note, Stardog database administration can be performed from the <a href="#_command_line_interface">CLI</a>.</p></div></div></div><div class="sect2"><h3 id="_creating_a_connection_string"><a class="link" href="#_creating_a_connection_string">Creating a Connection String</a></h3><div class="paragraph"><p>As you can see, the <a href="java/snarl/com/complexible/stardog/api/ConnectionConfiguration.html"><code>ConnectionConfiguration</code></a> in <a href="java/snarl/com/complexible/stardog/api/package-summary.html"><code>com.complexible.stardog.api</code></a> package class is where the initial action takes place:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">Connection aConn = ConnectionConfiguration
	.to("noReasoningExampleTest")		    // the name of the db to connect to
	.credentials("admin", "admin")              // credentials to use while connecting
	.connect();</code></pre></div></div><div class="paragraph"><p>The <a href="java/snarl/com/complexible/stardog/api/ConnectionConfiguration.html#to"><code>to</code></a> method takes a <code>Database Name</code> as a string; and then <a href="java/snarl/com/complexible/stardog/api/ConnectionConfiguration.html#connect"><code>connect</code></a> connects to the database using all specified properties on the configuration. This class and its constructor methods are used for <strong>all</strong> of Stardog&#8217;s Java APIs: SNARL native Stardog API, Sesame, Jena, as well as HTTP and SNARL protocol. In the latter cases, you must also call <a href="java/snarl/com/complexible/stardog/api/ConnectionConfiguration.html#serverjava.lang.String"><code>server</code></a> and pass it a valid URL to the Stardog server using the HTTP or SNARL protocols.</p></div><div class="paragraph"><p>Without the call to <code>server</code>, <code>ConnectionConfiguration</code> will attempt to connect to a local, embedded version of the Stardog server. The <code>Connection</code> still operates in the standard client-server mode, the only difference is that the server is running in the <strong>same</strong> JVM as your application.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Whether using SNARL, Sesame, or Jena, most perhaps all Stardog Java code will use <code>ConnectionConfiguration</code> to get a handle on a Stardog database&#8212;&#8203;whether embedded or remote&#8212;&#8203;and, after getting that handle, can use the appropriate API.</td></tr></table></div><div class="paragraph"><p>See the <a href="java/snarl/com/complexible/stardog/api/ConnectionConfiguration.html"><code>ConnectionConfiguration</code></a> API docs or <a href="#_how_to_make_a_connection_string">How to Make a Connection String</a> for more information.</p></div></div><div class="sect2"><h3 id="_managing_security"><a class="link" href="#_managing_security">Managing Security</a></h3><div class="paragraph"><p>We discuss the security system in Stardog in <a href="#_security">Security</a>. When logged into the Stardog <a href="java/snarl/com/complexible/stardog/api/admin/AdminConnection.html">DBMS</a> you can access all security related features detailed in the security section using any of the core security interfaces for <a href="java/snarl/com/complexible/stardog/security/UserManager.html">managing users</a>, <a href="java/snarl/com/complexible/stardog/security/RoleManager.html">roles</a>, and <a href="java/snarl/com/complexible/stardog/security/PermissionManager.html">permissions</a>.</p></div></div><div class="sect2"><h3 id="_using_snarl"><a class="link" href="#_using_snarl">Using SNARL</a></h3><div class="paragraph"><p>In examples 1 and 4 above, you can see how to use SNARL in Java to interact with Stardog. <em>The SNARL API will give the best performance overall and is the native Stardog API</em>. It uses some Sesame domain classes but is otherwise a clean-sheet API and implementation.</p></div><div class="paragraph"><p>The SNARL API is fluent with the aim of making code written for Stardog easier to write and easier to maintain. Most objects are easily re-used to make basic tasks with SNARL as simple as possible. We are always interested in feedback on the API, so if you have suggestions or comments, please send them to the mailing list.</p></div><div class="paragraph"><p>Let&#8217;s take a closer look at some of the interesting parts of SNARL.</p></div></div><div class="sect2"><h3 id="_adding_data"><a class="link" href="#_adding_data">Adding Data</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">aConn.begin();

aConn.add().io()
	.format(RDFFormat.N3)
	.stream(new FileInputStream("data/sp2b_10k.n3"));

Model aGraph = Models2.newModel(Values.statement(Values.iri("urn:subj"),
		 		 		 Values.iri("urn:pred"),
		                 		 Values.iri("urn:obj")));

Resource aContext = Values.iri("urn:test:context");

aConn.add().graph(aGraph, aContext);

aConn.commit();</code></pre></div></div><div class="paragraph"><p>You must always enclose changes to a database within a transaction begin and commit or rollback. Changes are local until the transaction is committed or until you try and perform a query operation to inspect the state of the database within the transaction.</p></div><div class="paragraph"><p>By default, RDF added will go into the default context unless specified otherwise. As shown, you can use <a href="java/snarl/com/complexible/stardog/api/Adder.html">Adder</a> directly to add statements and graphs to the database; and if you want to add data from a file or input stream, you use the <a href="java/snarl/com/complexible/stardog/api/IO.html"><code>io</code></a>, <code>format</code>, and <code>stream</code> chain of method invocations.</p></div><div class="paragraph"><p>See the <a href="java/snarl">SNARL API</a> Javadocs for all the gory details.</p></div></div><div class="sect2"><h3 id="_removing_data"><a class="link" href="#_removing_data">Removing Data</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">// first start a transaction
aConn.begin();

aConn.remove().io()
	.format(RDFFormat.N3)
	.file(Paths.get("data/remove_data.nt"));

// and commit the change
aConn.commit();</code></pre></div></div><div class="paragraph"><p>Let&#8217;s look at <a href="java/snarl/com/complexible/stardog/api/Remover.html">removing</a> data via SNARL; in the example above, you can see that file or stream-based removal is symmetric to file or stream-based addition, i.e., calling <code>remove</code> in an <code>io</code> chain with a file or stream call. See the SNARL API docs for more details about finer-grained deletes, etc.</p></div></div><div class="sect2"><h3 id="_parameterized_sparql_queries"><a class="link" href="#_parameterized_sparql_queries">Parameterized SPARQL Queries</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">SelectQuery aQuery = aConn.select("select * where { ?s ?p ?o }");

// But getting *all* the statements is kind of silly, so let's actually specify a limit, we only want 10 results.
aQuery.limit(10);

// We can go ahead and execute this query which will give us a result set.  Once we have our result set, we can do
// something interesting with the results.
TupleQueryResult aResult = aQuery.execute();

try {
	System.out.println("The first ten results...");

	QueryResultIO.write(aResult, TextTableQueryResultWriter.FORMAT, System.out);
}
finally {
	// *Always* close your result sets, they hold resources which need to be released.
	aResult.close();
}

// `Query` objects are easily parameterized; so we can bind the "s" variable in the previous query with a specific value.
// Queries should be managed via the parameterized methods, rather than created by concatenating strings together,
// because that is not only more readable, it helps avoid SPARQL injection attacks.
IRI aURI = Values.iri("http://localhost/publications/articles/Journal1/1940/Article1");
aQuery.parameter("s", aURI);

// Now that we've bound 's' to a specific value, we're not going to pull down the entire database with our query
// so we can go head and remove the limit and get all the results.
aQuery.limit(SelectQuery.NO_LIMIT);

// We've made our modifications, so we can re-run the query to get a new result set and see the difference in the results.
aResult = aQuery.execute();

System.out.println("\nNow a particular slice...");

try {
	QueryResultIO.write(aResult, TextTableQueryResultWriter.FORMAT, System.out);
}
finally {
	// Again, *close* your result sets.
	aResult.close();
}</code></pre></div></div><div class="paragraph"><p>SNARL also lets us parameterize SPARQL queries. We can make a <code>Query</code> object by passing a SPARQL query in the constructor. Simple. Obvious.</p></div><div class="paragraph"><p>Next, let&#8217;s set a limit for the results: <code>aQuery.limit10</code>; or if we want no limit, <code>aQuery.limitQuery.NO_LIMIT</code>. By default, there is no limit imposed on the query object; we&#8217;ll use whatever is specified in the query. But you can use limit to override any limit specified in the query, however specifying NO_LIMIT will not remove a limit specified in a query, it will only remove any limit override you&#8217;ve specified, restoring the state to the default of using whatever is in the query.</p></div><div class="paragraph"><p>We can execute that query with <code>executeSelect</code> and iterate over the results. We can also rebind the "?s" variable easily: <code>aQuery.parameter"s", aURI</code>, which will work for all instances of "?s" in any BGP in the query, and you can specify <code>null</code> to remove the binding.</p></div><div class="paragraph"><p>Query objects are re-usable, so you can create one from your original query string and alter bindings, limit, and offset in any way you see fit and re-execute the query to get the updated results.</p></div><div class="paragraph"><p>We <strong>strongly</strong> recommend the use of SNARL&#8217;s parameterized queries over concatenating strings together in order to build your SPARQL query. This latter approach opens up the possibility for SPARQL injection attacks unless you are very careful in scrubbing your input.<span class="footnote">[<a id="_footnoteref_41" class="footnote" href="#_footnote_41" title="View footnote.">41</a>]</span></p></div></div><div class="sect2"><h3 id="_getter_interface"><a class="link" href="#_getter_interface">Getter Interface</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">aConn.get().subject(aURI)
     .statements()
     .forEach(System.out::println);

// `Getter` objects are parameterizable just like `Query`, so you can easily modify and re-use them to change
// what slice of the database you'll retrieve.
Getter aGetter = aConn.get();

// We created a new `Getter`, if we iterated over its results now, we'd iterate over the whole database; not ideal.  So
// we will bind the predicate to `rdf:type` and now if we call any of the iteration methods on the `Getter` we'd only
// pull back statements whose predicate is `rdf:type`
aGetter.predicate(RDF.TYPE);

// We can also bind the subject and get a specific type statement, in this case, we'll get all the type triples
// for *this* individual.  In our example, that'll be a single triple.
aGetter.subject(aURI);

System.out.println("\nJust a single statement now...");

aGetter.statements()
       .forEach(System.out::println);

// `Getter` objects are stateful, so we can remove the filter on the predicate position by setting it back to null.
aGetter.predicate(null);

// Subject is still bound to the value of `aURI` so we can use the `graph` method of `Getter` to get a graph of all
// the triples where `aURI` is the subject, effectively performing a basic describe query.
aGraph = aGetter.statements().collect(Models2.toModel());

System.out.println("\nFinally, the same results as earlier, but as a graph...");

ModelIO.write(aGraph, new OutputStreamWriter(System.out), RDFFormat.TURTLE);</code></pre></div></div><div class="paragraph"><p>SNARL also supports some sugar for the classic statement-level <code>getSPO</code>--scars, anyone?--interactions. We ask in the first line of the snippet above for an iterator over the Stardog connection, based on <code>aURI</code> in the subject position. Then a while-loop, as one might expect&#8230;&#8203;You can also parameterize <code>Getter`s by binding different positions of the `Getter</code> which acts like a kind of RDF statement filter&#8212;&#8203;and then iterating as usual.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">the <code>aIter.close</code> which is important for Stardog databases to avoid memory leaks. If you need to materialize the iterator as a graph, you can do that by calling <code>graph</code>.</td></tr></table></div><div class="paragraph"><p>The snippet doesn&#8217;t show <code>object</code> or <code>context</code> parameters on a <code>Getter</code>, but those work, too, in the obvious way.</p></div></div><div class="sect2"><h3 id="_reasoning_3"><a class="link" href="#_reasoning_3">Reasoning</a></h3><div class="paragraph"><p>Stardog supports query-time <a href="#_owl_rule_reasoning">reasoning</a> using a query rewriting technique. In short, when reasoning is requested, a query is automatically rewritten to <strong>n</strong> queries, which are then executed. As we discuss below in Connection Pooling, reasoning is enabled at the <code>Connection</code> layer and then any queries executed over that connection are executed with reasoning enabled; you don&#8217;t need to do anything up front when you create your database if you want to use reasoning.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">ReasoningConnection aReasoningConn = ConnectionConfiguration
	.to("reasoningExampleTest")
	.credentials("admin", "admin")
	.reasoning(true)
	.connect()
	.as(ReasoningConnection.class);</code></pre></div></div><div class="paragraph"><p>In this code example, you can see that it&#8217;s trivial to enable reasoning for a <code>Connection</code>: simply call <code>reasoning</code> with <code>true</code> passed in.</p></div></div><div class="sect2"><h3 id="_search_2"><a class="link" href="#_search_2">Search</a></h3><div class="paragraph"><p>Stardog&#8217;s <a href="#_searching">search</a> system can be used from Java. The fluent Java API for searching in SNARL looks a lot like the other search interfaces: We create a <code>Searcher</code> instance with a fluent constructor: <code>limit</code> sets a limit on the results; <code>query</code> contains the search query, and <code>threshold</code> sets a minimum threshold for the results.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">Searcher aSearch = aSearchConn.search()
	                   .limit(50)
	                   .query("mac")
	                   .threshold(0.5);

// We can run the search and then iterate over the results
SearchResults aSearchResults = aSearch.search();

try (CloseableIterator&lt;SearchResult&gt; resultIt = aSearchResults.iterator()) {
	System.out.println("\nAPI results: ");
	while (resultIt.hasNext()) {
		SearchResult aHit = resultIt.next();

		System.out.println(aHit.getHit() + " with a score of: " + aHit.getScore());
	}
}

// The `Searcher` can be re-used if we want to find the next set of results.  We already found the
// first fifty, so lets grab the next page.
aSearch.offset(50);

aSearchResults = aSearch.search();</code></pre></div></div><div class="paragraph"><p>Then we call the <code>search</code> method of our <code>Searcher</code> instance and iterate over the results i.e., <code>SearchResults</code>. Last, we can use <code>offset</code> on an existing <code>Searcher</code> to grab another page of results.</p></div><div class="paragraph"><p>Stardog also supports performing searches over the full-text index <strong>within</strong> a SPARQL query via the <a href="http://jena.apache.org/documentation/larq/">LARQ SPARQL syntax</a>. This provides a powerful mechanism for querying both your RDF index and full-text index at the same time while also giving you a more performant option to the SPARQL <code>regex</code> filter.</p></div></div><div class="sect2"><h3 id="_user_defined_lucene_analyzer"><a class="link" href="#_user_defined_lucene_analyzer">User-defined Lucene Analyzer</a></h3><div class="paragraph"><p>Stardog&#8217;s <a href="#_searching">Semantic Search</a> capability uses Lucene&#8217;s <a href="https://lucene.apache.org/core/4_7_2/analyzers-common/org/apache/lucene/analysis/standard/StandardAnalyzer.html">default text analyzer</a>, which may not be ideal for your data or application. You can implement a custom analyzer that Stardog will use by implementing <code>org.apache.lucene.analysis.Analyzer</code>. That lets you customize Stardog to support different natural languages, domain-specific stop word lists, etc.</p></div><div class="paragraph"><p>See <a href="https://github.com/complexible/stardog-examples/tree/master/examples/analyzer">Custom Analyzers</a> in the stardog-examples Github repo for a complete description of the API, registry, sample code, etc.</p></div></div><div class="sect2"><h3 id="_user_defined_functions_and_aggregates"><a class="link" href="#_user_defined_functions_and_aggregates">User-defined Functions and Aggregates</a></h3><div class="paragraph"><p>Stardog may be extended via Function and Aggregate extensibility APIs, which are fully documented, including sample code, in the <a href="https://github.com/complexible/stardog-examples/blob/master/examples/function/readme.md">stardog-examples Github repo</a> section about function extensibility.</p></div><div class="paragraph"><p>In short you can extend Stardog&#8217;s SPARQL query evaluation with custom functions and aggregates easily. Function extensibility corresponds to built-in expressions used in <code>FILTER</code>, <code>BIND</code> and <code>SELECT</code> expressions, as well as aggregate operators in a SPARQL query like <code>COUNT</code> or <code>SAMPLE</code>.</p></div></div><div class="sect2"><h3 id="_snarl_connection_views"><a class="link" href="#_snarl_connection_views">SNARL Connection Views</a></h3><div class="paragraph"><p>SNARL <a href="java/snarl/com/complexible/stardog/api/Connection.html#"><code>Connections</code></a> support obtaining a specified type of <code>Connection</code>. This lets you extend and enhance the features available to a <code>Connection</code> while maintaining the standard, simple Connection API. The Connection <a href="java/snarl/com/complexible/stardog/api/Connection.html#as"><code>as</code></a> method takes as a parameter the interface, which must be a sub-type of a <code>Connection</code>, that you would like to use. <code>as</code> will either return the <code>Connection</code> as the view you&#8217;ve specified, or it will throw an exception if the view could not be obtained for some reason.</p></div><div class="paragraph"><p>An example of obtaining an instance of a <a href="java/snarl/com/complexible/stardog/api/search/SearchConnection.html"><code>SearchConnection</code></a> to use Stardog&#8217;s full-text search support would look like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">SearchConnection aSearchConn = aConn.as(SearchConnection.class);</code></pre></div></div></div><div class="sect2"><h3 id="_snarl_api_docs"><a class="link" href="#_snarl_api_docs">SNARL API Docs</a></h3><div class="paragraph"><p>Please see <a href="java/snarl/">SNARL API</a> docs for more information.</p></div></div></div></div><div class="sect1"><h2 id="_using_sesame"><a class="link" href="#_using_sesame">Using Sesame</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog supports the <a href="http://www.openrdf.org/doc/sesame/users/ch07.html">Sesame API</a>; thus, for the most part, using Stardog and Sesame is not much different from using Sesame with other RDF databases. There are, however, at least two differences worth pointing out.</p></div><div class="sect2"><h3 id="_wrapping_connections_with_stardogrepository"><a class="link" href="#_wrapping_connections_with_stardogrepository">Wrapping connections with StardogRepository</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">// Create a Sesame Repository from a Stardog ConnectionConfiguration.  The configuration will be used
// when creating new RepositoryConnections
Repository aRepo = new StardogRepository(ConnectionConfiguration
                                                 .to("testSesame")
                                                 .credentials("admin", "admin"));

// init the repo
aRepo.initialize();

// now you can use it like a normal Sesame Repository
RepositoryConnection aRepoConn = aRepo.getConnection();

// always best to turn off auto commit
aRepoConn.setAutoCommit(false);</code></pre></div></div><div class="paragraph"><p>As you can see from the code snippet, once you&#8217;ve created a <code>ConnectionConfiguration</code> with all the details for connecting to a Stardog database, you can wrap that in a <code>StardogRepository</code> which is a Stardog-specific implementation of the Sesame <code>Repository</code> interface. At this point, you can use the resulting <code>Repository</code> like any other Sesame <code>Repository</code> implementation. Each time you call <code>Repository.getConnection</code>, your original <code>ConnectionConfiguration</code> will be used to spawn a new connection to the database.</p></div></div><div class="sect2"><h3 id="_autocommit"><a class="link" href="#_autocommit">Autocommit</a></h3><div class="paragraph"><p>Stardog&#8217;s <code>RepositoryConnection</code> implementation will, by default, disable <code>autoCommit</code> status. When enabled, every single statement added or deleted via the <code>Connection</code> will incur the cost of a transaction, which is too heavyweight for most use cases. You can enable <code>autoCommit</code> and it will work as expected; but <strong>we recommend leaving it disabled</strong>.</p></div></div></div></div><div class="sect1"><h2 id="_using_jena"><a class="link" href="#_using_jena">Using Jena</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog supports Jena via a Sesame-Jena bridge, so it&#8217;s got more overhead than Sesame or SNARL. YMMV. There two points in the Jena example to emphasize.</p></div><div class="sect2"><h3 id="_init_in_jena"><a class="link" href="#_init_in_jena">Init in Jena</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">// obtain a Jena model for the specified stardog database connection.  Just creating an in-memory
// database; this is roughly equivalent to ModelFactory.createDefaultModel.
Model aModel = SDJenaFactory.createModel(aConn);</code></pre></div></div><div class="paragraph"><p>The initialization in Jena is a bit different from either SNARL or Sesame; you can get a Jena <code>Model</code> instance by passing the <code>Connection</code> instance returned by <code>ConnectionConfiguration</code> to the Stardog factory, <code>SDJenaFactory</code>.</p></div></div><div class="sect2"><h3 id="_add_in_jena"><a class="link" href="#_add_in_jena">Add in Jena</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">// start a transaction before adding the data.  This is not required,
// but it is faster to group the entire add into a single transaction rather
// than rely on the auto commit of the underlying stardog connection.
aModel.begin();

// read data into the model.  note, this will add statement at a time.
// Bulk loading needs to be performed directly with the BulkUpdateHandler provided
// by the underlying graph, or by reading in files in RDF/XML format, which uses the
// bulk loader natively.  Alternatively, you can load data into the Stardog
// database using SNARL, or via the command line client.
aModel.getReader("N3").read(aModel, new FileInputStream("data/sp2b_10k.n3"), "");

// done!
aModel.commit();</code></pre></div></div><div class="paragraph"><p>Jena also wants to add data to a <code>Model</code> one statement at a time, which can be less than ideal. To work around this restriction, we recommend adding data to a <code>Model</code> in a single Stardog transaction, which is initiated with <code>aModel.begin</code>. Then to read data into the model, we recommend using RDF/XML, since that triggers the <code>BulkUpdateHandler</code> in Jena or grab a <code>BulkUpdateHandler</code> directly from the underlying Jena graph.</p></div><div class="paragraph"><p>The other options include using the Stardog <a href="#_command_line_interface">CLI</a> client to bulk load a Stardog database or to use SNARL for loading and then switch to Jena for other operations, processing, query, etc.</p></div></div></div></div><div class="sect1"><h2 id="_client_server_stardog"><a class="link" href="#_client_server_stardog">Client-Server Stardog</a></h2><div class="sectionbody"><div class="paragraph"><p>Using Stardog from Java in either embedded or client-server mode is <strong>very similar</strong>--the only visible difference is the use of <code>url</code> in a <code>ConnectionConfiguration</code>: when it&#8217;s present, we&#8217;re in client-server model; else, we&#8217;re in embedded mode.</p></div><div class="paragraph"><p>That&#8217;s a good and a bad thing: it&#8217;s good because the code is symmetric and uniform. It&#8217;s bad because it can make reasoning about performance difficult, i.e., it&#8217;s not entirely clear in client-server mode which operations trigger or don&#8217;t trigger a round trip with the server and, thus, which may be more expensive than they are in embedded mode.</p></div><div class="paragraph"><p>In client-server mode, <strong>everything triggers a round trip</strong> with these exceptions:</p></div><div class="ulist"><ul><li><p>closing a connection outside a transaction</p></li><li><p>any parameterizations or other of a query or getter instance</p></li><li><p>any database state mutations in a transaction that don&#8217;t need to be immediately visible to the transaction; that is, changes are sent to the server only when they are required, on commit, or on any query or read operation that needs to have the accurate up-to-date state of the data within the transaction.</p></li></ul></div><div class="paragraph"><p>Stardog generally tries to be as lazy as possible; but in client-server mode, since state is maintained on the client, there are fewer chances to be lazy and more interactions with the server.</p></div></div></div><div class="sect1"><h2 id="_connection_pooling"><a class="link" href="#_connection_pooling">Connection Pooling</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog supports connection pools for SNARL <code>Connection</code> objects for efficiency and programmer sanity. Here&#8217;s how they work:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">Server aServer = Stardog
        .buildServer()
        .bind(SNARLProtocolConstants.EMBEDDED_ADDRESS)
	.start();

// First create a temporary database to use (if there is one already, drop it first)
try (AdminConnection aAdminConnection = AdminConnectionConfiguration.toEmbeddedServer().credentials("admin", "admin").connect()) {
  if (aAdminConnection.list().contains("testConnectionPool")) {
	aAdminConnection.drop("testConnectionPool");
  }
  aAdminConnection.createMemory("testConnectionPool");
}

// Now, we need a configuration object for our connections, this is all the information about
// the database that we want to connect to.
ConnectionConfiguration aConnConfig = ConnectionConfiguration
	.to("testConnectionPool")
	.credentials("admin", "admin");

// We want to create a pool over these objects.  See the javadoc for ConnectionPoolConfig for
// more information on the options and information on the defaults.
ConnectionPoolConfig aConfig = ConnectionPoolConfig
	.using(aConnConfig)				// use my connection configuration to spawn new connections
	.minPool(10)					// the number of objects to start my pool with
	.maxPool(1000)					// the maximum number of objects that can be in the pool (leased or idle)
	.expiration(1, TimeUnit.HOURS)			// Connections can expire after being idle for 1 hr.
	.blockAtCapacity(1, TimeUnit.MINUTES);		// I want obtain to block for at most 1 min while trying to obtain a connection.

// now i can create my actual connection pool
ConnectionPool aPool = aConfig.create();

// if I want a connection object...
Connection aConn = aPool.obtain();

// now I can feel free to use the connection object as usual...

// and when I'm done with it, instead of closing the connection, I want to return it to the pool instead.
aPool.release(aConn);

// and when I'm done with the pool, shut it down!
aPool.shutdown();

// you MUST stop the server if you've started it!
aServer.stop();</code></pre></div></div><div class="paragraph"><p>Per standard practice, we first initialize security and grab a connection, in this case to the <code>testConnectionPool</code> database. Then we setup a <code>ConnectionPoolConfig</code>, using its fluent API, which establishes the parameters of the pool:</p></div><div class="hdlist"><table><tr><td class="hdlist1"><code>using</code></td><td class="hdlist2"><p>Sets which ConnectionConfiguration we want to pool; this is what is used to actually create the connections.</p></td></tr><tr><td class="hdlist1"><code>minPool</code>, <code>maxPool</code></td><td class="hdlist2"><p>Establishes min and max pooled objects; max pooled objects includes both leased and idled objects.</p></td></tr><tr><td class="hdlist1"><code>expiration</code></td><td class="hdlist2"><p>Sets the idle life of objects; in this case, the pool reclaims objects idled for 1 hour.</p></td></tr><tr><td class="hdlist1"><code>blockAtCapacity</code></td><td class="hdlist2"><p>Sets the max time in minutes that we&#8217;ll block waiting for an object when there aren&#8217;t any idle ones in the pool.</p></td></tr></table></div><div class="paragraph"><p>Whew! Next we can <code>create</code> the pool using this <code>ConnectionPoolConfig</code> thing.</p></div><div class="paragraph"><p>Finally, we call <code>obtain</code> on the <code>ConnectionPool</code> when we need a new one. And when we&#8217;re done with it, we return it to the pool so it can be re-used, by calling <code>release</code>. When we&#8217;re done, we <code>shutdown</code> the pool.</p></div><div class="paragraph"><p>Since <a href="#_owl_rule_reasoning">reasoning</a> in Stardog is enabled per <code>Connection</code>, you can create two pools: one with reasoning connections, one with non-reasoning connections; and then use the one you need to have reasoning <strong>per query</strong>; never pay for more than you need.</p></div></div></div><div class="sect1"><h2 id="_api_deprecation"><a class="link" href="#_api_deprecation">API Deprecation</a></h2><div class="sectionbody"><div class="paragraph"><p>Methods and classes in SNARL API that are marked with the <code>com.google.common.annotations.Beta</code> are subject to change or removal in any release. We are using this annotation to denote new or experimental features, the behavior or signature of which may change significantly before it&#8217;s out of "beta".</p></div><div class="paragraph"><p>We will otherwise attempt to keep the public APIs as stable as possible, and methods will be marked with the standard <code>@Deprecated</code> annotation for a least one full revision cycle before their removal from the SNARL API. See <a href="#_compatibility_policies">Compatibility Policies</a> for more information about API stability.</p></div><div class="paragraph"><p>Anything marked <code>@VisibleForTesting</code> is just that, visible as a consequence of test case requirements; don&#8217;t write any important code that depends on functions with this annotation.</p></div></div></div><div class="sect1"><h2 id="_using_maven"><a class="link" href="#_using_maven">Using Maven</a></h2><div class="sectionbody"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/maven.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>As of Stardog 3.0, we support Maven for both client and server JARs. The following table summarizes the type of dependencies that you will have to include in your project, depending on whether the project is a Stardog client, or server, or both. Additionally, you can also include the Jena or Sesame bindings if you would like to use them in your project. The Stardog dependency list below follows the <a href="http://www.gradle.org">Gradle</a> convention and is of the form: <code>groupId:artifactId:VERSION</code>. Versions 3.0 and higher are supported.</p></div><table class="tableblock frame-all grid-all spread"><caption class="title">7. Table of client type dependencies</caption><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Stardog Dependency</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type</strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">snarl client</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.complexible.stardog:client-snarl:VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>pom</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">http client</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.complexible.stardog:client-http:VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>pom</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">server</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.complexible.stardog:server:VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>pom</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sesame</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.complexible.stardog.sesame:stardog-sesame-core:VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>jar</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">jena</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.complexible.stardog.jena:stardog-jena:VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>jar</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">gremlin</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.complexible.stardog.gremlin:stardog-gremlin:VERSION</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>jar</code></p></td></tr></tbody></table><div class="paragraph"><p>You can see an example of their usage in our examples <a href="https://github.com/complexible/stardog-examples/blob/628cf3dab2/examples/api/build.gradle#L3-L14">repository on Github</a>.</p></div><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">If you&#8217;re using Maven as your build tool, then <code>client-snarl</code>, <code>client-http</code>, and <code>server</code> dependencies require that you specify the packaging type <strong>as POM</strong> (<code>pom</code>):</td></tr></table></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.complexible.stardog&lt;/groupId&gt;
  &lt;artifactId&gt;client-snarl&lt;/artifactId&gt;
  &lt;version&gt;$VERSION&lt;/version&gt;
  &lt;type&gt;pom&lt;/type&gt; <b class="conum">(1)</b>
&lt;/dependency&gt;</code></pre></div></div><div class="colist arabic"><ol><li><p><strong>The dependency type must be set to <code>pom</code>.</strong></p></li></ol></div><div class="paragraph"><p>Note: Though Gradle may still work without doing this, it is still best practice to specify the dependency type there as well:</p></div><div class="listingblock"><div class="content"><pre>compile "com.complexible.stardog:client-snarl:${VERSION}@pom"</pre></div></div><div class="sect2"><h3 id="_public_maven_repo"><a class="link" href="#_public_maven_repo">Public Maven Repo</a></h3><div class="paragraph"><p>The public Maven repository for the current Stardog release is <a href="http://maven.stardog.com" class="bare">http://maven.stardog.com</a>. To get started, you need to add the following endpoint to your preferred build system, e.g. in your Gradle build script:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">repositories {
  maven {
    url "http://maven.stardog.com"
  }
}</code></pre></div></div><div class="paragraph"><p>Similarly, if you&#8217;re using Maven you&#8217;ll need to add the following to your Maven <code>pom.xml</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml" data-lang="xml">&lt;repositories&gt;
   &lt;repository&gt;
     &lt;id&gt;stardog-public&lt;/id&gt;
     &lt;url&gt;http://maven.stardog.com&lt;/url&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</code></pre></div></div></div><div class="sect2"><h3 id="_private_maven_repo"><a class="link" href="#_private_maven_repo">Private Maven Repo</a></h3><div class="sidebarblock"><div class="content"><div class="title"><span class="tease">Customer Access</span></div><div class="paragraph"><p>This feature or service is available to Stardog customers. For information about licensing, please <a href="mailto:sales@complexible.com">email</a> us.</p></div></div></div><div class="paragraph"><p>For access to nightly builds, priority bug fixes, priority feature access, hot fixes, etc. Enterprise Premium Support customers have access to their own private Maven repository that is linked to our internal development repository. We provide a private repository which you can either proxy from your preferred Maven repository manager&#8212;&#8203;e.g. Artifactory or Nexus&#8212;&#8203;or add the private endpoint to your build script.</p></div></div><div class="sect2"><h3 id="_connecting_to_your_private_maven_repo"><a class="link" href="#_connecting_to_your_private_maven_repo">Connecting to Your Private Maven Repo</a></h3><div class="paragraph"><p>Similar to our public Maven repo, we will provide you with a private URL and credentials to your private repo, which you will refer to in your Gradle build script like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">repositories {
  maven {
    url $yourPrivateUrl
       credentials {
          username $yourUsername
          password $yourPassword
        }
    }
}</code></pre></div></div><div class="paragraph"><p>Or if you&#8217;re using Maven, add the following to your <code>pom.xml</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml" data-lang="xml">&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;stardog-private&lt;/id&gt;
      &lt;url&gt;$yourPrivateUrl&lt;/url&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</code></pre></div></div><div class="paragraph"><p>Then in your <code>~./m2/settings.xml</code> add:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-xml" data-lang="xml">&lt;settings&gt;
  &lt;servers&gt;
    &lt;server&gt;
      &lt;id&gt;stardog-private&lt;/id&gt;
      &lt;username&gt;$yourUsername&lt;/username&gt;
      &lt;password&gt;$yourPassword&lt;/password&gt;
    &lt;/server&gt;
  &lt;/servers&gt;
&lt;/settings&gt;</code></pre></div></div></div></div></div><h1 id="_network_programming" class="sect0"><a class="link" href="#_network_programming">Network Programming</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/http.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>In the <a href="#_java_programming">Java Programming</a> section, we consider interacting with Stardog programmatically from a Java program. In this section we consider interacting with Stardog over HTTP. In some use cases or deployment scenarios, it may be necessary to interact with or control Stardog remotely over an IP-based network.</p></div><div class="paragraph"><p>Stardog supports <a href="http://www.w3.org/TR/rdf-sparql-protocol/">SPARQL 1.0 HTTP Protocol</a>; the <a href="http://www.w3.org/TR/sparql11-http-rdf-update/">SPARQL 1.1 Graph Store HTTP Protocol</a>; the Stardog HTTP Protocol; and SNARL, an RPC-style protocol based on <a href="http://code.google.com/apis/protocolbuffers/">Google Protocol Buffers</a>.</p></div></div></div><div class="sect1"><h2 id="_sparql_protocol"><a class="link" href="#_sparql_protocol">SPARQL Protocol</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog supports the standard SPARQL Protocol HTTP bindings, as well as additional functionality via HTTP. Stardog also supports SPARQL 1.1&#8217;s Service Description format. See the <a href="http://www.w3.org/TR/2013/REC-sparql11-service-description-20130321/">spec</a> if you want details.</p></div><div class="sect2"><h3 id="_stardog_http_protocol"><a class="link" href="#_stardog_http_protocol">Stardog HTTP Protocol</a></h3><div class="paragraph"><p>The Stardog HTTP Protocol supports SPARQL Protocol 1.1 and additional resource representations and capabilities. The Stardog HTTP API v4 is also available on Apiary: <a href="http://docs.stardog.apiary.io/" class="bare">http://docs.stardog.apiary.io/</a>. The Stardog Linked Data API (aka "Annex") is also documented on Apiary: <a href="http://docs.annex.apiary.io/" class="bare">http://docs.annex.apiary.io/</a>.</p></div><div class="sect3"><h4 id="_generating_urls"><a class="link" href="#_generating_urls">Generating URLs</a></h4><div class="paragraph"><p>If you are running the HTTP server at</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">http://localhost:12345/</code></pre></div></div><div class="paragraph"><p>To form the URI of a particular Stardog Database, the Database Short Name is the first URL path segment appended to the deployment URI. For example, for the Database called <code>cytwombly</code>, deployed in the above example HTTP server, the Database Network Name might be</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">http://localhost:12345/cytwombly</code></pre></div></div><div class="paragraph"><p>All the resources related to this database are identified by URL path segments relative to the Database Network Name; hence:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">http://localhost:12345/cytwombly/size</code></pre></div></div><div class="paragraph"><p>In what follows, we use <a href="http://code.google.com/p/uri-templates/)">URI Template</a> notation to parameterize the actual request URLs, thus: <code>/{db}/size</code>.</p></div><div class="paragraph"><p>We also abuse notation to show the permissible HTTP request types and default MIME types in the following way: <code>REQ | REQ /resource/identifier → mime_type | mime_type</code>. In a few cases, we use <code>void</code> as short hand for the case where there is a response code but the response body may be empty.</p></div></div></div><div class="sect2"><h3 id="_http_headers_content_type_accept"><a class="link" href="#_http_headers_content_type_accept">HTTP Headers: Content-Type &amp; Accept</a></h3><div class="paragraph"><p>All HTTP requests that are mutative (add or remove) must include a valid <code>Content-Type</code> header set to the MIME type of the request body, where "valid" is a valid MIME type for N-Triples, Trig, Trix, Turtle, NQuads, JSON-LD, or RDF/XML:</p></div><div class="hdlist"><table><tr><td class="hdlist1">RDF/XML</td><td class="hdlist2"><p><code>application/rdf+xml</code></p></td></tr><tr><td class="hdlist1">Turtle</td><td class="hdlist2"><p><code>application/x-turtle</code> or <code>text/turtle</code></p></td></tr><tr><td class="hdlist1">N-Triples</td><td class="hdlist2"><p><code>text/plain</code></p></td></tr><tr><td class="hdlist1">TriG</td><td class="hdlist2"><p><code>application/trig</code></p></td></tr><tr><td class="hdlist1">TriX</td><td class="hdlist2"><p><code>application/trix</code></p></td></tr><tr><td class="hdlist1">NQuads</td><td class="hdlist2"><p><code>text/x-nquads</code></p></td></tr><tr><td class="hdlist1">JSON-LD</td><td class="hdlist2"><p><code>application/ld+json</code></p></td></tr></table></div><div class="paragraph"><p>SPARQL <code>CONSTRUCT</code> queries must also include a <code>Accept</code> header set to one of these RDF serialization types.</p></div><div class="paragraph"><p>When issuing a <code>SELECT</code> query the <code>Accept</code> header should be set to one of the valid MIME types for <code>SELECT</code> results:</p></div><div class="hdlist"><table><tr><td class="hdlist1">SPARQL XML Results Format</td><td class="hdlist2"><p><code>application/sparql-results+xml</code></p></td></tr><tr><td class="hdlist1">SPARQL JSON Results Format</td><td class="hdlist2"><p><code>application/sparql-results+json</code></p></td></tr><tr><td class="hdlist1">SPARQL Boolean Results</td><td class="hdlist2"><p><code>text/boolean</code></p></td></tr><tr><td class="hdlist1">SPARQL Binary Results</td><td class="hdlist2"><p><code>application/x-binary-rdf-results-table</code></p></td></tr></table></div></div><div class="sect2"><h3 id="_response_codes"><a class="link" href="#_response_codes">Response Codes</a></h3><div class="paragraph"><p>Stardog uses the following HTTP response codes:</p></div><div class="hdlist"><table><tr><td class="hdlist1"><code>200</code></td><td class="hdlist2"><p>Operation has succeeded.</p></td></tr><tr><td class="hdlist1"><code>202</code></td><td class="hdlist2"><p>Operation was received successfully and will be processed shortly.</p></td></tr><tr><td class="hdlist1"><code>400</code></td><td class="hdlist2"><p>Indicates parse errors or that the transaction identifier specified for an operation is invalid or does not correspond to a known transaction.</p></td></tr><tr><td class="hdlist1"><code>401</code></td><td class="hdlist2"><p>Request is unauthorized.</p></td></tr><tr><td class="hdlist1"><code>403</code></td><td class="hdlist2"><p>User attempting to perform the operation does not exist, their username or password is invalid, or they do not have the proper credentials to perform the action.</p></td></tr><tr><td class="hdlist1"><code>404</code></td><td class="hdlist2"><p>A resource involved in the request&#8212;&#8203;for example the database or transaction&#8212;&#8203;does not exist.</p></td></tr><tr><td class="hdlist1"><code>409</code></td><td class="hdlist2"><p>A conflict for some database operations; for example, creating a database that already exists.</p></td></tr><tr><td class="hdlist1"><code>500</code></td><td class="hdlist2"><p>A unspecified failure in some internal operation&#8230;&#8203;Call your office, Senator!</p></td></tr></table></div><div class="paragraph"><p>There are also Stardog-specific error codes in the <code>SD-Error-Code</code> header in the response from the server. These can be used to further clarify the reason for the failure on the server, especially in cases where it could be ambiguous. For example, if you received a <code>404</code> from the server trying to commit a transaction denoted by the path <code>/myDb/transaction/commit/293845klf9f934</code>&#8230;&#8203;it&#8217;s probably not clear what is missing: it&#8217;s either the transaction or the database. In this case, the value of the <code>SD-Error-Code</code> header will clarify.</p></div><div class="paragraph"><p>The enumeration of <code>SD-Error-Code</code> values and their meanings are as follows:</p></div><div class="hdlist"><table><tr><td class="hdlist1"><code>0</code></td><td class="hdlist2"><p>Authentication error</p></td></tr><tr><td class="hdlist1"><code>1</code></td><td class="hdlist2"><p>Authorization error</p></td></tr><tr><td class="hdlist1"><code>2</code></td><td class="hdlist2"><p>Query evaluation error</p></td></tr><tr><td class="hdlist1"><code>3</code></td><td class="hdlist2"><p>Query contained parse errors</p></td></tr><tr><td class="hdlist1"><code>4</code></td><td class="hdlist2"><p>Query is unknown</p></td></tr><tr><td class="hdlist1"><code>5</code></td><td class="hdlist2"><p>Transaction not found</p></td></tr><tr><td class="hdlist1"><code>6</code></td><td class="hdlist2"><p>Database not found</p></td></tr><tr><td class="hdlist1"><code>7</code></td><td class="hdlist2"><p>Database already exists</p></td></tr><tr><td class="hdlist1"><code>8</code></td><td class="hdlist2"><p>Database name is invalid</p></td></tr><tr><td class="hdlist1"><code>9</code></td><td class="hdlist2"><p>Resource (user, role, etc) already exists</p></td></tr><tr><td class="hdlist1"><code>10</code></td><td class="hdlist2"><p>Invalid connection parameter(s)</p></td></tr><tr><td class="hdlist1"><code>11</code></td><td class="hdlist2"><p>Invalid database state for the request</p></td></tr><tr><td class="hdlist1"><code>12</code></td><td class="hdlist2"><p>Resource in use</p></td></tr><tr><td class="hdlist1"><code>13</code></td><td class="hdlist2"><p>Resource not found</p></td></tr><tr><td class="hdlist1"><code>14</code></td><td class="hdlist2"><p>Operation not supported by the server</p></td></tr><tr><td class="hdlist1"><code>15</code></td><td class="hdlist2"><p>Password specified in the request was invalid</p></td></tr></table></div><div class="paragraph"><p>In cases of error, the message body of the result will include any error information provided by the server to indicate the cause of the error.</p></div></div></div></div><div class="sect1"><h2 id="_stardog_resources"><a class="link" href="#_stardog_resources">Stardog Resources</a></h2><div class="sectionbody"><div class="paragraph"><p>To interact with Stardog over HTTP, use the following resource representations, HTTP response codes, and resource identifiers.</p></div><div class="sect2"><h3 id="_a_stardog_database"><a class="link" href="#_a_stardog_database">A Stardog Database</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /{db} → void</code></pre></div></div><div class="paragraph"><p>Returns a representation of the database. As of Stardog 5.0.0beta, this is merely a placeholder; in a later release, this resource will serve the web console where the database can be interacted with in a browser.</p></div></div><div class="sect2"><h3 id="_database_size"><a class="link" href="#_database_size">Database Size</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /{db}/size → text/plain</code></pre></div></div><div class="paragraph"><p>Returns the number of RDF triples in the database.</p></div></div><div class="sect2"><h3 id="_query_evaluation"><a class="link" href="#_query_evaluation">Query Evaluation</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET | POST /{db}/query</code></pre></div></div><div class="paragraph"><p>The SPARQL endpoint for the database. The valid Accept types are listed above in the <a href="#_http_headers_content_type_accept">HTTP Headers</a> section.</p></div><div class="paragraph"><p>To issue SPARQL queries with reasoning over HTTP, see <a href="#_using_reasoning">Using Reasoning</a>.</p></div></div><div class="sect2"><h3 id="_sparql_update_2"><a class="link" href="#_sparql_update_2">SPARQL update</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET | POST /{db}/update → text/boolean</code></pre></div></div><div class="paragraph"><p>The SPARQL endpoint for updating the database with SPARQL Update. The valid Accept types are <code>application/sparql-update</code> <code>or application/x-www-form-urlencoded</code>. Response is the result of the update operation as text, eg <code>true</code> or <code>false</code>.</p></div></div><div class="sect2"><h3 id="_query_plan"><a class="link" href="#_query_plan">Query Plan</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET | POST /{db}/explain → text/plain</code></pre></div></div><div class="paragraph"><p>Returns the explanation for the execution of a query, i.e., a query plan. All the same arguments as for Query Evaluation are legal here; but the only MIME type for the Query Plan resource is <code>text/plain</code>.</p></div></div><div class="sect2"><h3 id="_transaction_begin"><a class="link" href="#_transaction_begin">Transaction Begin</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/transaction/begin → text/plain</code></pre></div></div><div class="paragraph"><p>Returns a transaction identifier resource as <code>text/plain</code>, which is likely to be deprecated in a future release in favor of a hypertext format. <code>POST</code> to begin a transaction accepts neither body nor arguments.</p></div><div class="sect3"><h4 id="_transaction_security_considerations"><a class="link" href="#_transaction_security_considerations">Transaction Security Considerations</a></h4><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">Stardog&#8217;s implementation of transactions with HTTP is vulnerable to man-in-the-middle attacks, which could be used to violate Stardog&#8217;s isolation guarantee (among other nasty side effects).</td></tr></table></div><div class="paragraph"><p>Stardog&#8217;s transaction identifiers are 64-bit GUIDs and, thus, pretty hard to <strong>guess</strong>; but if you can grab a response in-flight, you can steal the transaction identifier if basic access auth or RFC 2069 digest auth is in use. <strong>You&#8217;ve been warned.</strong></p></div><div class="paragraph"><p>In a future release, Stardog will use <a href="http://tools.ietf.org/html/rfc2617">RFC 2617 HTTP Digest Authentication</a>, which is less vulnerable to various attacks and will never ask a client to use a different authentication type, which should lessen the likelihood of MitM attacks for properly restricted Stardog clients&#8212;&#8203;that is, a Stardog client that treats any request by a proxy server or origin server (i.e., Stardog) to use basic access auth or RFC 2069 digest auth as a MitM attack. See <a href="http://tools.ietf.org/html/rfc2617">RFC 2617</a> for more information.</p></div></div></div><div class="sect2"><h3 id="_transaction_commit"><a class="link" href="#_transaction_commit">Transaction Commit</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/transaction/commit/{txId} → void | text/plain</code></pre></div></div><div class="paragraph"><p>Returns a representation of the committed transaction; <code>200</code> means the commit was successful. Otherwise a <code>500</code> error indicates the commit failed and the text returned in the result is the failure message.</p></div><div class="paragraph"><p>As you might expect, failed commits exit cleanly, rolling back any changes that were made to the database.</p></div></div><div class="sect2"><h3 id="_transaction_rollback"><a class="link" href="#_transaction_rollback">Transaction Rollback</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/transaction/rollback/{txId} → void | text/plain</code></pre></div></div><div class="paragraph"><p>Returns a representation of the transaction after it&#8217;s been rolled back. <code>200</code> means the rollback was successful, otherwise <code>500</code> indicates the rollback failed and the text returned in the result is the failure message.</p></div></div><div class="sect2"><h3 id="_querying_transactionally"><a class="link" href="#_querying_transactionally">Querying (Transactionally)</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET | POST /{db}/{txId}/query</code></pre></div></div><div class="paragraph"><p>Returns a representation of a query executed within the <code>txId</code> transaction. Queries within transactions will be slower as extra processing is required to make the changes visible to the query. Again, the valid Accept types are listed above in the <code>HTTP Headers</code> section.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET | POST /{db}/{txId}/update → text/boolean</code></pre></div></div><div class="paragraph"><p>The SPARQL endpoint for updating the database with SPARQL Update. Update queries are executed within the specified transaction <code>txId</code> and are <strong>not</strong> atomic operations as with the normal SPARQL update endpoint. The updates are executed when the transaction is committed like any other change. The valid Accept types are <code>application/sparql-update</code> <code>or application/x-www-form-urlencoded</code>. Response is the result of the update operation as text, eg <code>true</code> or <code>false</code>.</p></div></div><div class="sect2"><h3 id="_adding_data_transactionally"><a class="link" href="#_adding_data_transactionally">Adding Data (Transactionally)</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/{txId}/add → void | text/plain</code></pre></div></div><div class="paragraph"><p>Returns a representation of data added to the database of the specified transaction. Accepts an optional parameter, <code>graph-uri</code>, which specifies the named graph the data should be added to. If a named graph is not specified, the data is added to the default (i.e., unnamed) context. The response codes are <code>200</code> for success and <code>500</code> for failure.</p></div></div><div class="sect2"><h3 id="_deleting_data_transactionally"><a class="link" href="#_deleting_data_transactionally">Deleting Data (Transactionally)</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/{txId}/remove → void | text/plain</code></pre></div></div><div class="paragraph"><p>Returns a representation of data removed from the database within the specified transaction. Also accepts <code>graph-uri</code> with the analogous meaning as above--<a href="#_adding_data_transactionally">Adding Data (Transactionally)</a>. Response codes are also the same.</p></div></div><div class="sect2"><h3 id="_clear_database"><a class="link" href="#_clear_database">Clear Database</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/{txId}/clear → void | text/plain</code></pre></div></div><div class="paragraph"><p>Removes all data from the database within the context of the transaction. <code>200</code> indicates success; <code>500</code> indicates an error. Also takes an optional parameter, <code>graph-uri</code>, which removes data from a named graph. To clear only the default graph, pass <code>DEFAULT</code> as the value of <code>graph-uri</code>.</p></div></div><div class="sect2"><h3 id="_export_database"><a class="link" href="#_export_database">Export Database</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /{db}/export → RDF</code></pre></div></div><div class="paragraph"><p>Exports the default graph in the database in Turtle format. Also takes an optional parameter, <code>graph-uri</code>, which selects a named graph to export. The valid Accept types are the ones defined above in <a href="#_http_headers_content_type_accept">HTTP Headers</a> for RDF Formats.</p></div></div><div class="sect2"><h3 id="_explanation_of_inferences"><a class="link" href="#_explanation_of_inferences">Explanation of Inferences</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/reasoning/explain → RDF
POST /{db}/reasoning/{txId}/explain → RDF</code></pre></div></div><div class="paragraph"><p>Returns the explanation of the axiom which is in the body of the <code>POST</code> request. The request takes the axioms in any supported RDF format and returns the explanation for why that axiom was inferred as Turtle.</p></div></div><div class="sect2"><h3 id="_explanation_of_inconsistency"><a class="link" href="#_explanation_of_inconsistency">Explanation of Inconsistency</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET | POST /{db}/reasoning/explain/inconsistency → RDF</code></pre></div></div><div class="paragraph"><p>If the database is logically inconsistent, this returns an explanation for the inconsistency.</p></div></div><div class="sect2"><h3 id="_consistency_2"><a class="link" href="#_consistency_2">Consistency</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET | POST /{db}/reasoning/consistency → text/boolean</code></pre></div></div><div class="paragraph"><p>Returns whether or not the database is consistent w.r.t to the TBox.</p></div></div><div class="sect2"><h3 id="_listing_integrity_constraints"><a class="link" href="#_listing_integrity_constraints">Listing Integrity Constraints</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /{db}/icv → RDF</code></pre></div></div><div class="paragraph"><p>Returns the integrity constraints for the specified database serialized in any supported RDF format.</p></div></div><div class="sect2"><h3 id="_adding_integrity_constraints"><a class="link" href="#_adding_integrity_constraints">Adding Integrity Constraints</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/icv/add</code></pre></div></div><div class="paragraph"><p>Accepts a set of valid Integrity constraints serialized in any RDF format supported by Stardog and adds them to the database in an atomic action. 200 return code indicates the constraints were added successfully, 500 indicates that the constraints were not valid or unable to be added.</p></div></div><div class="sect2"><h3 id="_removing_integrity_constraints"><a class="link" href="#_removing_integrity_constraints">Removing Integrity Constraints</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/icv/remove</code></pre></div></div><div class="paragraph"><p>Accepts a set of valid Integrity constraints serialized in any RDF format supported by Stardog and removes them from the database in a single atomic action. <code>200</code> indicates the constraints were successfully remove; <code>500</code> indicates an error.</p></div></div><div class="sect2"><h3 id="_clearing_integrity_constraints"><a class="link" href="#_clearing_integrity_constraints">Clearing Integrity Constraints</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/icv/clear</code></pre></div></div><div class="paragraph"><p>Drops <strong>all</strong> integrity constraints for a database. <code>200</code> indicates all constraints were successfully dropped; <code>500</code> indicates an error.</p></div></div><div class="sect2"><h3 id="_converting_constraints_to_sparql_queries"><a class="link" href="#_converting_constraints_to_sparql_queries">Converting Constraints to SPARQL Queries</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/icv/convert</code></pre></div></div><div class="paragraph"><p>The body of the <code>POST</code> is a single integrity constraint, serialized in any supported RDF format, with <code>Content-type</code> set appropriately. Returns either a <code>text/plain</code> result containing a single SPARQL query; or it returns <code>400</code> if more than one constraint was included in the input.</p></div></div></div></div><div class="sect1"><h2 id="_admin_resources"><a class="link" href="#_admin_resources">Admin Resources</a></h2><div class="sectionbody"><div class="paragraph"><p>To administer Stardog over HTTP, use the following resource representations, HTTP response codes, and resource identifiers.</p></div><div class="sect2"><h3 id="_list_databases"><a class="link" href="#_list_databases">List databases</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/databases → application/json</code></pre></div></div><div class="paragraph"><p>Lists all the databases available.</p></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{ "databases" : ["testdb", "exampledb"] }</code></pre></div></div></div><div class="sect2"><h3 id="_copy_a_database"><a class="link" href="#_copy_a_database">Copy a database</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/databases/{db}/copy?to={db_copy}</code></pre></div></div><div class="paragraph"><p>Copies a database <code>db</code> to another specified <code>db_copy</code>.</p></div></div><div class="sect2"><h3 id="_create_a_new_database"><a class="link" href="#_create_a_new_database">Create a new database</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /admin/databases</code></pre></div></div><div class="paragraph"><p>Creates a new database; expects a multipart request with a JSON specifying database name, options and filenames followed by (optional) file contents as a multipart <code>POST</code> request.</p></div><div class="paragraph"><p>Expected input (<code>application/json</code>):</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "dbname" : "testDb",
  "options" : {
    "icv.active.graphs" : "http://graph, http://another",
    "search.enabled" : true,
    ...
  },
  "files" : [{ "filename":"fileX.ttl", "context":"some:context" }, ...]
}</code></pre></div></div></div><div class="sect2"><h3 id="_drop_an_existing_database"><a class="link" href="#_drop_an_existing_database">Drop an existing database</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">DELETE /admin/databases/{db}</code></pre></div></div><div class="paragraph"><p>Drops an existing database <code>db</code> and all the information that it contains. Goodbye Callahan!</p></div></div><div class="sect2"><h3 id="_migrate_an_existing_database"><a class="link" href="#_migrate_an_existing_database">Migrate an existing database</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/databases/{db}/migrate</code></pre></div></div><div class="paragraph"><p>Migrates the existing content of a legacy database to new format.</p></div></div><div class="sect2"><h3 id="_optimize_an_existing_database"><a class="link" href="#_optimize_an_existing_database">Optimize an existing database</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/databases/{db}/optimize</code></pre></div></div><div class="paragraph"><p>Optimize an existing database.</p></div></div><div class="sect2"><h3 id="_sets_an_existing_database_online"><a class="link" href="#_sets_an_existing_database_online">Sets an existing database online.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/databases/{db}/online</code></pre></div></div><div class="paragraph"><p>Request message to set an existing database database online.</p></div></div><div class="sect2"><h3 id="_sets_an_existing_database_offline"><a class="link" href="#_sets_an_existing_database_offline">Sets an existing database offline.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/databases/{db}/offline</code></pre></div></div><div class="paragraph"><p>Request message to set an existing database offline; receives optionally a JSON input to specify a timeout for the offline operation. When not specified, defaults to 3 minutes as the timeout; the timeout should be provided in <strong>milliseconds</strong>. The timeout is the amount of time the database will wait for existing connections to complete before going offline. This will allow open transaction to commit/rollback, open queries to complete, etc. After the timeout has expired, all remaining open connections are closed and the database goes offline.</p></div><div class="paragraph"><p>Optional input (<code>application/json</code>):</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{ "timeout" : timeout_in_ms}</code></pre></div></div></div><div class="sect2"><h3 id="_set_option_values_to_an_existing_database"><a class="link" href="#_set_option_values_to_an_existing_database">Set option values to an existing database.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /admin/databases/{kb}/options</code></pre></div></div><div class="paragraph"><p>Set options in the database passed through a JSON object specification, i.e. JSON Request for option values. Database options can be found <a href="#_configuring_a_database">here</a>.</p></div><div class="paragraph"><p>Expected input (<code>application/json</code>):</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "database.name" : "DB_NAME",
  "icv.enabled" : true | false,
  "search.enabled" : true | false,
  ...
}</code></pre></div></div></div><div class="sect2"><h3 id="_get_option_values_of_an_existing_database"><a class="link" href="#_get_option_values_of_an_existing_database">Get option values of an existing database.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/databases/{kb}/options → application/json</code></pre></div></div><div class="paragraph"><p>Retrieves a set of options passed via a JSON object. The JSON input has empty values for each key, but will be filled with the option values in the database in the output.</p></div><div class="paragraph"><p>Expected input:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "database.name" : ...,
  "icv.enabled" : ...,
  "search.enabled" : ...,
  ...
}</code></pre></div></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "database.name" : "testdb",
  "icv.enabled" : true,
  "search.enabled" : true,
  ...
}</code></pre></div></div></div><div class="sect2"><h3 id="_add_a_new_user_to_the_system"><a class="link" href="#_add_a_new_user_to_the_system">Add a new user to the system.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /admin/users</code></pre></div></div><div class="paragraph"><p>Adds a new user to the system; allows a configuration option for superuser as a JSON object. Superuser configuration is set as default to false. The password <strong>must</strong> be provided for the user.</p></div><div class="paragraph"><p>Expected input:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "username"  : "bob",
  "superuser" : true | false
  "password"  : "passwd"
}</code></pre></div></div></div><div class="sect2"><h3 id="_change_user_password"><a class="link" href="#_change_user_password">Change user password.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/users/{user}/pwd</code></pre></div></div><div class="paragraph"><p>Changes user&#8217;s password in the system. Receives input of new password as a JSON Object.</p></div><div class="paragraph"><p>Expected input:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{"password" : "xxxxx"}</code></pre></div></div></div><div class="sect2"><h3 id="_check_if_user_is_enabled"><a class="link" href="#_check_if_user_is_enabled">Check if user is enabled.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/users/{user}/enabled → application/json</code></pre></div></div><div class="paragraph"><p>Verifies if user is enabled in the system.</p></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "enabled": true
}</code></pre></div></div></div><div class="sect2"><h3 id="_check_if_user_is_superuser"><a class="link" href="#_check_if_user_is_superuser">Check if user is superuser.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/users/{user}/superuser → application/json</code></pre></div></div><div class="paragraph"><p>Verifies if the user is a superuser:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "superuser": true
}</code></pre></div></div></div><div class="sect2"><h3 id="_listing_users"><a class="link" href="#_listing_users">Listing users.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/users → application/json</code></pre></div></div><div class="paragraph"><p>Retrieves a list of users.</p></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "users": ["anonymous", "admin"]
}</code></pre></div></div></div><div class="sect2"><h3 id="_listing_user_roles"><a class="link" href="#_listing_user_roles">Listing user roles.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/users/{user}/roles → application/json</code></pre></div></div><div class="paragraph"><p>Retrieves the list of the roles assigned to user.</p></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "roles": ["reader"]
}</code></pre></div></div></div><div class="sect2"><h3 id="_deleting_users"><a class="link" href="#_deleting_users">Deleting users.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">DELETE /admin/users/{user}</code></pre></div></div><div class="paragraph"><p>Removes a user from the system.</p></div></div><div class="sect2"><h3 id="_enabling_users"><a class="link" href="#_enabling_users">Enabling users.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/users/{user}/enabled</code></pre></div></div><div class="paragraph"><p>Enables a user in the system; expects a JSON object in the following format:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "enabled" : true
}</code></pre></div></div></div><div class="sect2"><h3 id="_setting_user_roles"><a class="link" href="#_setting_user_roles">Setting user roles.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/users/{user}/roles</code></pre></div></div><div class="paragraph"><p>Sets roles for a given user; expects a JSON object specifying the roles for the user in the following format:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "roles" : ["reader","secTestDb-full"]
}</code></pre></div></div></div><div class="sect2"><h3 id="_adding_new_roles"><a class="link" href="#_adding_new_roles">Adding new roles.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /admin/roles</code></pre></div></div><div class="paragraph"><p>Adds the new role to the system.</p></div><div class="paragraph"><p>Expected input:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "rolename" : ""
}</code></pre></div></div></div><div class="sect2"><h3 id="_listing_roles"><a class="link" href="#_listing_roles">Listing roles.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/roles → application/json</code></pre></div></div><div class="paragraph"><p>Retrieves the list of roles registered in the system.</p></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "roles": ["reader"]
}</code></pre></div></div></div><div class="sect2"><h3 id="_listing_users_with_a_specified_role"><a class="link" href="#_listing_users_with_a_specified_role">Listing users with a specified role.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/roles/{role}/users → application/json</code></pre></div></div><div class="paragraph"><p>Retrieves users that have the role assigned.</p></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "users": ["anonymous"]
}</code></pre></div></div></div><div class="sect2"><h3 id="_deleting_roles"><a class="link" href="#_deleting_roles">Deleting roles.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">DELETE /admin/roles/{role}?force={force}</code></pre></div></div><div class="paragraph"><p>Deletes an existing role from the system; the force parameter is a boolean flag which indicates if the delete call for the role must be forced.</p></div></div><div class="sect2"><h3 id="_assigning_permissions_to_roles"><a class="link" href="#_assigning_permissions_to_roles">Assigning permissions to roles.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/permissions/role/{role}</code></pre></div></div><div class="paragraph"><p>Creates a new permission for a given role over a specified resource; expects input JSON Object in the following format:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "action" : "read" | "write" | "create" | "delete" | "revoke" | "execute" | "grant" | "*",
  "resource_type" : "user" | "role" | "db" | "named-graph" | "metadata" | "admin" | "icv-constraints" | "*",
  "resource" : ""
}</code></pre></div></div></div><div class="sect2"><h3 id="_assigning_permissions_to_users"><a class="link" href="#_assigning_permissions_to_users">Assigning permissions to users.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">PUT /admin/permissions/user/{user}</code></pre></div></div><div class="paragraph"><p>Creates a new permission for a given user over a specified resource; expects input JSON Object in the following format:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "action" : "read" | "write" | "create" | "delete" | "revoke" | "execute" | "grant" | "*",
  "resource_type" : "user" | "role" | "db" | "named-graph" | "metadata" | "admin" | "icv-constraints" | "*",
  "resource" : ""
}</code></pre></div></div></div><div class="sect2"><h3 id="_deleting_permissions_from_roles"><a class="link" href="#_deleting_permissions_from_roles">Deleting permissions from roles.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /admin/permissions/role/{role}/delete</code></pre></div></div><div class="paragraph"><p>Deletes a permission for a given role over a specified resource; expects input JSON Object in the following format:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "action" : "read" | "write" | "create" | "delete" | "revoke" | "execute" | "grant" | "*",
  "resource_type" : "user" | "role" | "db" | "named-graph" | "metadata" | "admin" | "icv-constraints" | "*",
  "resource" : ""
}</code></pre></div></div></div><div class="sect2"><h3 id="_deleting_permissions_from_users"><a class="link" href="#_deleting_permissions_from_users">Deleting permissions from users.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /admin/permissions/user/{user}/delete</code></pre></div></div><div class="paragraph"><p>Deletes a permission for a given user over a specified resource; expects input JSON Object in the following format:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "action" : "read" | "write" | "create" | "delete" | "revoke" | "execute" | "grant" | "*",
  "resource_type" : "user" | "role" | "db" | "named-graph" | "metadata" | "admin" | "icv-constraints" | "*",
  "resource" : ""
}</code></pre></div></div></div><div class="sect2"><h3 id="_listing_role_permissions"><a class="link" href="#_listing_role_permissions">Listing role permissions.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/permissions/role/{role} → application/json</code></pre></div></div><div class="paragraph"><p>Retrieves permissions assigned to the role.</p></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "permissions": ["stardog:read:*"]
}</code></pre></div></div></div><div class="sect2"><h3 id="_listing_user_permissions"><a class="link" href="#_listing_user_permissions">Listing user permissions.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/permissions/user/{user} → application/json</code></pre></div></div><div class="paragraph"><p>Retrieves permissions assigned to the user.</p></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "permissions": ["stardog:read:*"]
}</code></pre></div></div></div><div class="sect2"><h3 id="_listing_user_effective_permissions"><a class="link" href="#_listing_user_effective_permissions">Listing user effective permissions.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/permissions/effective/user/{user} → application/json</code></pre></div></div><div class="paragraph"><p>Retrieves effective permissions assigned to the user.</p></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "permissions": ["stardog:*"]
}</code></pre></div></div></div><div class="sect2"><h3 id="_get_nodes_in_cluster"><a class="link" href="#_get_nodes_in_cluster">Get nodes in cluster</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET /admin/cluster</code></pre></div></div><div class="paragraph"><p>Retrieves the list of nodes in the cluster; the elected cluster coordinator is the first element in the array. This route is only available when Stardog is running within a cluster setup.</p></div><div class="paragraph"><p>Output JSON example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
  "nodes": [
    "192.168.69.1:5820 (Available)",
    "192.168.69.2:5820 (Available)",
    "192.168.69.3:5820 (Available)"
  ]
}</code></pre></div></div></div><div class="sect2"><h3 id="_shutdown_server"><a class="link" href="#_shutdown_server">Shutdown server.</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /admin/shutdown</code></pre></div></div><div class="paragraph"><p>Shuts down the Stardog Server. If successful, returns a <code>202</code> to indicate that the request was received and that the server will be shut down shortly.</p></div></div><div class="sect2"><h3 id="_query_version_metadata"><a class="link" href="#_query_version_metadata">Query Version Metadata</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">GET | POST /{db}/vcs/query</code></pre></div></div><div class="paragraph"><p>Issue a query over the version history metadata using SPARQL. Method has the same arguments and outputs as the normal query method of a database.</p></div></div><div class="sect2"><h3 id="_versioned_commit"><a class="link" href="#_versioned_commit">Versioned Commit</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/vcs/{tid}/commit_msg</code></pre></div></div><div class="paragraph"><p>Input example:</p></div><div class="listingblock"><div class="content"><pre>This is the commit message</pre></div></div><div class="paragraph"><p>Accepts a commit message in the body of the request and performs a VCS commit of the specified transaction</p></div></div><div class="sect2"><h3 id="_create_tag"><a class="link" href="#_create_tag">Create Tag</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/vcs/tags/create</code></pre></div></div><div class="paragraph"><p>Input example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-csv" data-lang="csv">"f09c0e02350627480839da4661b8e9cbd70f6372", "This is the commit message"</code></pre></div></div><div class="paragraph"><p>Create a tag from the given revision id with the specified commit message.</p></div></div><div class="sect2"><h3 id="_delete_tag"><a class="link" href="#_delete_tag">Delete Tag</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/vcs/tags/delete</code></pre></div></div><div class="paragraph"><p>Input example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-csv" data-lang="csv">"f09c0e02350627480839da4661b8e9cbd70f6372"</code></pre></div></div><div class="paragraph"><p>Delete the tag with the given revision.</p></div></div><div class="sect2"><h3 id="_revert_to_tag"><a class="link" href="#_revert_to_tag">Revert to Tag</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-http" data-lang="http">POST /{db}/vcs/revert</code></pre></div></div><div class="paragraph"><p>Input example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-csv" data-lang="csv">"f09c0e02350627480839da4661b8e9cbd70f6372", "893220fba7910792084dd85207db94292886c4d7", "This is the revert message"</code></pre></div></div><div class="paragraph"><p>Perform a revert of a revision to the specified revision with the given commit message.</p></div></div></div></div><h1 id="_javascript_programming" class="sect0"><a class="link" href="#_javascript_programming">Javascript Programming</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/js.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>The <a href="http://stardog-union.github.io/stardog.js/docs/stardog.html">documentation</a> for stardog.js is available at the <a href="http://stardog-union.github.io/stardog.js/">stardog.js</a> site; source code is available on <a href="https://github.com/stardog-union/stardog.js">Github</a> and <a href="https://npmjs.org/package/stardog">npm</a>.</p></div></div></div><div class="sect1"><h2 id="_stardog_js"><a class="link" href="#_stardog_js">stardog.js</a></h2><div class="sectionbody"><div class="paragraph"><p>This framework wraps all the functionality of a client for the Stardog DBMS and provides access to a full set of functions such as executing SPARQL Queries, administration tasks on Stardog, and the use of the Reasoning API.</p></div><div class="paragraph"><p>The implementation uses the HTTP protocol, since most of Stardog functionality is available using this protocol. For more information, see <a href="#_network_programming">Network Programming</a>.</p></div><div class="paragraph"><p>The framework is currently supported for node.js and the browser, including test cases for both environments. You&#8217;ll also need npm and bower to run the test cases and install the dependencies in node.js &amp; the browser respectively.</p></div></div></div><h1 id="_clojure_programming" class="sect0"><a class="link" href="#_clojure_programming">Clojure Programming</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/clojure.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>The stardog-clj <a href="http://github.com/complexible/stardog-clj">source code</a> is available as Apache 2.0 licensed code.</p></div></div></div><div class="sect1"><h2 id="_installation_4"><a class="link" href="#_installation_4">Installation</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog-clj is available from Clojars. To use, just include the following dependency:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">[stardog-clj "2.2.2"]</code></pre></div></div><div class="paragraph"><p>Starting with Stardog 2.2.2, the stardog-clj version always matches the latest release of Stardog.</p></div></div></div><div class="sect1"><h2 id="_overview"><a class="link" href="#_overview">Overview</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog-clj provides a set of functions as API wrappers to the native SNARL API. These functions provide the basis for working with Stardog, starting with connection management, connection pooling, and the core parts of the API, such as executing a SPARQL query or adding and removing RDF from the Stardog database. Over time, other parts of the Stardog API will be appropriately wrapped with Clojure functions and idiomatic Clojure data structures.</p></div><div class="paragraph"><p>Stardog-clj provides the following features:</p></div><div class="olist arabic"><ol class="arabic"><li><p>Specification based descriptions for connections, and corresponding "connection" and "with-connection-pool" functions and macros</p></li><li><p>Functions for query, ask, graph, and update to execute <code>SELECT</code>, <code>ASK</code>, <code>CONSTRUCT</code>, and SPARQL Update queries respectively</p></li><li><p>Functions for insert and remove, for orchestrating the Adder and Remover APIs in SNARL</p></li><li><p>Macros for resource handling, including with-connection-tx, with-connection-pool, and with-transaction</p></li><li><p>Support for programming Stardog applications with either the connection pool or direct handling of the connection</p></li><li><p>Idiomatic clojure handling of data structures, with converters that can be passed to query functions</p></li></ol></div><div class="paragraph"><p>The API with source docs can be found in the <code>stardog.core</code> and <code>stardog.values</code> namespaces.</p></div></div></div><div class="sect1"><h2 id="_api_overview"><a class="link" href="#_api_overview">API Overview</a></h2><div class="sectionbody"><div class="paragraph"><p>The API provides a natural progression of functions for interacting with Stardog</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">(create-db-spec "testdb" "snarl://localhost:5820/" "admin" "admin" "none")</code></pre></div></div><div class="paragraph"><p>This creates a connection space for use in <code>connect</code> or <code>make-datasource</code> with the potential parameters:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">{:url "snarl://localhost:5820/" :db "testdb" :pass "admin" :user "admin" :max-idle 100 :max-pool 200 :min-pool 10 :reasoning false}</code></pre></div></div><div class="paragraph"><p>Create a single Connection using the database spec. Can be used with <code>with-open</code>, <code>with-transaction</code>, and <code>with-connection-tx</code> macros.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">(connect db-spec)</code></pre></div></div><div class="paragraph"><p>Creates a data source, i.e. <code>ConnectionPool</code>, using the database spec. Best used within the <code>with-connection-pool</code> macro.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">(make-datasource db-spec)</code></pre></div></div><div class="paragraph"><p>Executes the body with a transaction on each of the connections. Or establishes a connection and a transaction to execute the body within.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">(with-transaction [connection...] body)
(with-connection-tx binding-forms body)</code></pre></div></div><div class="paragraph"><p>Evaluates body in the context of an active connection obtained from the connection pool.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">(with-connection-pool [con pool] .. con, body ..)</code></pre></div></div></div></div><div class="sect1"><h2 id="_examples_4"><a class="link" href="#_examples_4">Examples</a></h2><div class="sectionbody"><div class="paragraph"><p>Here are some examples of using stardog-clj</p></div><div class="sect2"><h3 id="_create_a_connection_and_run_a_query"><a class="link" href="#_create_a_connection_and_run_a_query">Create a connection and run a query</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">=&gt; (use 'stardog.core)
=&gt; (def c (connect {:db "testdb" :url "snarl://localhost"}))
=&gt; (def results (query c "select ?n { .... }"))
=&gt; (take 5 results)
({:n #&lt;StardogURI http://example.org/math#2&gt;} {:n #&lt;StardogURI http://example.org/math#3&gt;} {:n #&lt;StardogURI http://example.org/math#5&gt;} {:n #&lt;StardogURI http://example.org/math#7&gt;} {:n #&lt;StardogURI http://example.org/math#11&gt;})

=&gt; (def string-results (query c "select ?n { .... }" {:converter str}))
=&gt; (take 5 string-results)
({:n "http://example.org/math#2"} {:n "http://example.org/math#3"} {:n "http://example.org/math#5"} {:n "http://example.org/math#7"} {:n "http://example.org/math#11"})</code></pre></div></div></div><div class="sect2"><h3 id="_insert_data"><a class="link" href="#_insert_data">Insert data</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">(let [c (connect test-db-spec)]
               (with-transaction [c]
                 (insert! c ["urn:test" "urn:test:clj:prop2" "Hello World"])
                 (insert! c ["urn:test" "urn:test:clj:prop2" "Hello World2"]))</code></pre></div></div></div><div class="sect2"><h3 id="_run_a_query_with_a_connection_pool"><a class="link" href="#_run_a_query_with_a_connection_pool">Run a query with a connection pool</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">myapp.core=&gt; (use 'stardog.core)
nil
myapp.core=&gt; (def db-spec (create-db-spec "testdb" "snarl://localhost:5820/" "admin" "admin" "none"))
#'myapp.core/db-spec
myapp.core=&gt; (def ds (make-datasource db-spec))
myapp.core=&gt; (with-connection-pool [conn ds]
        #_=&gt;   (query conn "SELECT ?s ?p ?o WHERE { ?s ?p ?o } LIMIT 2"))
({:s #&lt;URI urn:test1&gt;, :p #&lt;URI urn:test:predicate&gt;, :o "hello world"} {:s #&lt;URI urn:test1&gt;, :p #&lt;URI urn:test:predicate&gt;, :o "hello world2"})</code></pre></div></div></div><div class="sect2"><h3 id="_sparql_update_3"><a class="link" href="#_sparql_update_3">SPARQL Update</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">;; First, add a triple
;; Then run an udpate query, which is its own transaction
;; Finally, confirm via ask
 (with-open [c (connect test-db-spec)]
               (with-transaction [c]
                 (insert! c ["urn:testUpdate:a1" "urn:testUpdate:b" "aloha world"]))
               (update c "DELETE { ?a ?b \"aloha world\" } INSERT { ?a ?b \"shalom world\" } WHERE { ?a ?b \"aloha world\"  }"
                         {:parameters {"?a" "urn:testUpdate:a1" "?b" "urn:testUpdate:b"}})
               (ask c "ask { ?s ?p \"shalom world\" }") =&gt; truthy)</code></pre></div></div></div><div class="sect2"><h3 id="_graph_function_for_construct_queries"><a class="link" href="#_graph_function_for_construct_queries">Graph function for Construct queries</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">;; Graph results converted into Clojure data using the values methods
(with-open [c (connect test-db-spec)]
               (let [g (graph c "CONSTRUCT { &lt;urn:test&gt; ?p ?o } WHERE { &lt;urn:test&gt; ?p ?o } ")]
                 g) =&gt; (list [(as-uri "urn:test") (as-uri "urn:test:clj:prop3") "Hello World"]))</code></pre></div></div></div><div class="sect2"><h3 id="_ask_function_for_ask_queries"><a class="link" href="#_ask_function_for_ask_queries">Ask function for ASK queries</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-clojure" data-lang="clojure">;; Ask returns a Boolean
(with-open [c (connect test-db-spec)]
               (ask c "ask { ?s &lt;http://www.lehigh.edu/~zhp2/2004/0401/univ-bench.owl#teacherOf&gt; ?o }")) =&gt; truthy)</code></pre></div></div></div></div></div><h1 id="__net_programming" class="sect0"><a class="link" href="#__net_programming">.Net Programming</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/dotnet.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>In the <a href="#_network_programming">Network Programming</a> section, we looked at how to interact with Stardog over a network via HTTP and SNARL protocols. In this chapter we describe how to program Stardog from .Net using <a href="http://www.dotnetrdf.org" class="bare">http://www.dotnetrdf.org</a>.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">.dotNetRDF is an open source library developed and supported by third parties; questions or issues with the .Net API should be directed to <a href="http://www.dotnetrdf.org" class="bare">http://www.dotnetrdf.org</a>.</td></tr></table></div><div class="paragraph"><p>You should also be aware that dotNetRDF uses the HTTP API for all communication with Stardog so you <strong>must</strong> enable the HTTP server to use Stardog from .Net. It&#8217;s enabled by default so most users should not need to do anything to fulfill this requirement.</p></div></div></div><div class="sect1"><h2 id="_dotnetrdf_documentation"><a class="link" href="#_dotnetrdf_documentation">dotNetRDF Documentation</a></h2><div class="sectionbody"><div class="paragraph"><p>See <a href="https://bitbucket.org/dotnetrdf/dotnetrdf/wiki/Home">the documentation</a> for using dotNetRDF with Stardog.</p></div></div></div><h1 id="_spring_programming" class="sect0"><a class="link" href="#_spring_programming">Spring Programming</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/spring.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>The Spring for Stardog <a href="http://github.com/complexible/stardog-spring">source code</a> is available on Github. Binary releases are available on the <a href="https://github.com/complexible/stardog-spring/releases">Github release page</a>.</p></div><div class="paragraph"><p>As of 2.1.3, Stardog-Spring and Stardog-Spring-Batch can both be retrieved from Maven central:</p></div><div class="ulist"><ul><li><p><code>com.complexible.stardog:stardog-spring:2.1.3</code></p></li><li><p><code>com.complexible.stardog:stardog-spring-batch:2.1.3</code></p></li></ul></div><div class="paragraph"><p>The corresponding Stardog Spring version will match the Stardog release, e.g. stardog-spring-2.2.2 for Stardog 2.2.2.</p></div></div></div><div class="sect1"><h2 id="_overview_2"><a class="link" href="#_overview_2">Overview</a></h2><div class="sectionbody"><div class="paragraph"><p>Spring for Stardog makes it possible to rapidly build Stardog-backed applications with the Spring Framework. As with many other parts of Spring, Stardog&#8217;s Spring integration uses the template design pattern for abstracting standard boilerplate away from application developers.</p></div><div class="paragraph"><p>Stardog Spring can be included via Maven with <code>com.complexible.stardog:stardog-spring:version</code> and <code>com.complexible.stardog:stardog-spring-batch</code> for Spring Batch support. Both of these dependencies require the public Stardog repository to be included in your build script, and the Stardog Spring packages installed in Maven. Embedded server is still supported, but via providing an implementatino of the Provider interface. This enables users of the embedded server to have full control over how to use the embedded server.</p></div><div class="paragraph"><p>At the lowest level, Spring for Stardog includes</p></div><div class="olist arabic"><ol class="arabic"><li><p><code>DataSouce</code> and <code>DataSourceFactoryBean</code> for managing Stardog connections</p></li><li><p><code>SnarlTemplate</code> for transaction- and connection-pool safe Stardog programming</p></li><li><p><code>DataImporter</code> for easy bootstrapping of input data into Stardog</p></li></ol></div><div class="paragraph"><p>In addition to the core capabilities, Spring for Stardog also integrates with the Spring Batch framework. Spring Batch enables complex batch processing jobs to be created to accomplish tasks such as ETL or legacy data migration. The standard <code>ItemReader</code> and <code>ItemWriter</code> interfaces are implemented with a separate callback writing records using the SNARL Adder API.</p></div></div></div><div class="sect1"><h2 id="_basic_spring"><a class="link" href="#_basic_spring">Basic Spring</a></h2><div class="sectionbody"><div class="paragraph"><p>There are three Beans to add to a Spring application context:</p></div><div class="ulist"><ul><li><p><code>DataSourceFactoryBean</code>: <code>com.complexible.stardog.ext.spring.DataSourceFactoryBean</code></p></li><li><p><code>SnarlTemplate</code>: <code>com.complexible.stardog.ext.spring.SnarlTemplate</code></p></li><li><p><code>DataImporter</code>: <code>com.complexible.stardog.ext.spring.DataImporter</code></p></li></ul></div><div class="paragraph"><p><code>DataSourceFactoryBean</code> is a Spring <code>FactoryBean</code> that configures and produces a <code>DataSource</code>. All of the Stardog <code>ConnectionConfiguration</code> and <code>ConnectionPoolConfig</code> methods are also property names of the <code>DataSourceFactoryBean</code>--for example, "to", "url", "createIfNotPresent". If you are interested in running an embedded server, use the <code>Provider</code> interface and inject it into the <code>DataSourceFactoryBean</code>. Note: all of the server jars must be added to your classpath for using the embedded server.</p></div><div class="paragraph"><p><code>javax.sql.DataSource</code>, that can be used to retrieve a <code>Connection</code> from the <code>ConnectionPool</code>. This additional abstraction serves as place to add Spring-specific capabilities (e.g. <code>spring-tx</code> support in the future) without directly requiring Spring in Stardog.</p></div><div class="paragraph"><p><code>SnarlTemplate</code> provides a template abstraction over much of Stardog&#8217;s native API, <a href="#_java_programming">SNARL</a>, and follows the same approach of other Spring template, i.e., <code>JdbcTemplate</code>, <code>JmsTemplate</code>, and so on.</p></div><div class="paragraph"><p>Spring for Stardog also comes with convenience mappers, for automatically mapping result set bindings into common data types. The <code>SimpleRowMapper</code> projects the <code>BindingSet</code> as a <code>List&gt;</code> and a <code>SingleMapper</code> that accepts a constructor parameter for binding a single parameter for a single result set.</p></div><div class="paragraph"><p>The key methods on <code>SnarlTemplate</code> include the following:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">query(String sparqlQuery, Map args, RowMapper)</code></pre></div></div><div class="paragraph"><p><code>query()</code> executes the SELECT query with provided argument list, and invokes the mapper for result rows.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">doWithAdder(AdderCallback)</code></pre></div></div><div class="paragraph"><p><code>doWithAdder()</code> is a transaction- and connection-pool safe adder call.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">doWithGetter(String subject, String predicate, GetterCallback)</code></pre></div></div><div class="paragraph"><p><code>doWithGetter()</code> is the connection pool boilerplate method for the <code>Getter</code> interface, including the programmatic filters.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">doWithRemover(RemoverCallback)</code></pre></div></div><div class="paragraph"><p><code>doWithRemover()</code> As above, the remover method that is transaction and pool safe.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">execute(ConnectionCallback)</code></pre></div></div><div class="paragraph"><p><code>execute()</code> lets you work with a connection directly; again, transaction and pool safe.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java" data-lang="java">construct(String constructSparql, Map args, GraphMapper)</code></pre></div></div><div class="paragraph"><p><code>construct()</code> executes a SPARQL CONSTRUCT query with provided argument list, and invokes the <code>GraphMapper</code> for the result set.</p></div><div class="paragraph"><p><code>DataImporter</code> is a new class that automates the loading of RDF files into Stardog at initialization time.</p></div><div class="paragraph"><p>It uses the Spring Resource API, so files can be loaded anywhere that is resolvable by the Resource API: classpath, file, url, etc. It has a single load method for further run-time loading and can load a list of files at initialization time. The list assumes a uniform set of file formats, so if there are many different types of files to load with different RDF formats, there would be different <code>DataImporter</code> beans configured in Spring.</p></div></div></div><div class="sect1"><h2 id="_spring_batch"><a class="link" href="#_spring_batch">Spring Batch</a></h2><div class="sectionbody"><div class="paragraph"><p>In addition to the base <code>DataSource</code> and <code>SnarlTemplate</code>, Spring Batch support adds the following:</p></div><div class="ulist"><ul><li><p><code>SnarlItemReader</code>: <code>com.complexible.stardog.ext.spring.batch.SnarlItemReader</code></p></li><li><p><code>SnarlItemWriter</code>: <code>com.complexible.stardog.ext.spring.batch.SnarlItemWriter</code></p></li><li><p><code>BatchAdderCallback</code>: <code>com.complexible.stardog.ext.spring.batch.BatchAdderCallback</code></p></li></ul></div></div></div><h1 id="_groovy_programming" class="sect0"><a class="link" href="#_groovy_programming">Groovy Programming</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/groovy.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p><a href="http://http://groovy.codehaus.org/">Groovy</a> is an agile and dynamic programming language for the JVM, making popular programming features such as closures available to Java developers. Stardog&#8217;s Groovy support makes life easier for developers who need to work with RDF, SPARQL, and OWL by way of Stardog.</p></div><div class="paragraph"><p>The Groovy for Stardog <a href="http://github.com/complexible/stardog-groovy">source code</a> is available on Github.</p></div><div class="paragraph"><p>Binary releases are available on the <a href="https://github.com/complexible/stardog-groovy/releases">Github release page</a> and via Maven central as of version 2.1.3 and beyond using the following dependency declaration (Gradle style) <code>com.complexible.stardog:stardog-groovy:2.1.3</code>.</p></div><div class="paragraph"><p>As of version 2.1.3, Stardog-Groovy can be included via "com.complexible.stardog:stardog-groovy:2.1.3" from Maven central.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">You must include our public repository in your build script to get the Stardog client dependencies into your local repository.</td></tr></table></div><div class="paragraph"><p>Using the embedded server with Stardog Groovy is not supported in 2.1.2, due to conflicts of the asm library for various third party dependencies. If you wish to use the embedded server with similar convenience APIs, please try <a href="#_spring_programming">Stardog with Spring</a>. Also 2.1.3 and beyond of Stardog-Groovy no longer requires the use of the Spring framework.</p></div><div class="paragraph"><p>The Stardog-Groovy version always matches the Stardog release, e.g. for Stardog 2.2.2 use stardog-groovy-2.2.2.</p></div></div></div><div class="sect1"><h2 id="_overview_3"><a class="link" href="#_overview_3">Overview</a></h2><div class="sectionbody"><div class="paragraph"><p>Groovy for Stardog provides a set of Groovy API wrappers for developers to build applications with Stardog and take advantage of native Groovy features. For example, you can create a Stardog connection pool in a single line, much like Groovy SQL support. In Groovy for Stardog, queries can be iterated over using closures and transaction safe closures can be executed over a connection.</p></div><div class="paragraph"><p>For the first release, Groovy for Stardog includes <code>com.complexible.stardog.ext.groovy.Stardog</code> with the following methods:</p></div><div class="olist arabic"><ol class="arabic"><li><p><code>Stardog(map)</code> constructor for managing Stardog connection pools</p></li><li><p><code>each(String, Closure)</code> for executing a closure over a query&#8217;s results, including projecting SPARQL result variables into the closure.</p></li><li><p><code>query(String, Closure)</code> for executing a closure over a query&#8217;s results, passing the BindingSet to the closure</p></li><li><p><code>insert(List)</code> for inserting a list of vars as a triple, or a list of list of triples for insertion</p></li><li><p><code>remove(List)</code> for removing a triple from the database</p></li><li><p><code>withConnection</code> for executing a closure with a transaction safe instance of <a href="http://stardog.com/docs/java/snarl/com/complexible/stardog/api/Connection.html"><code>Connection</code></a></p></li></ol></div></div></div><div class="sect1"><h2 id="_examples_5"><a class="link" href="#_examples_5">Examples</a></h2><div class="sectionbody"><div class="paragraph"><p>Here are some examples of the more interesting parts of Stardog Groovy.</p></div><div class="sect2"><h3 id="_create_a_connection"><a class="link" href="#_create_a_connection">Create a Connection</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">def stardog = new Stardog([url: "snarl://localhost:5820/", to:"testdb", username:"admin", password:"admin"])
stardog.query("select ?x ?y ?z WHERE { ?x ?y ?z } LIMIT 2", { println it } )
// in this case, it is a BindingSet, ie TupleQueryResult.next() called until exhausted and closure executed</code></pre></div></div></div><div class="sect2"><h3 id="_sparql_vars_projected_into_groovy_closures"><a class="link" href="#_sparql_vars_projected_into_groovy_closures">SPARQL Vars Projected into Groovy Closures</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">// there is also a projection of the results into the closure's binding
// if x, y, or z are not populated in the answer, then they are still valid binidng but are null
stardog.each("select ?x ?y ?z WHERE { ?x ?y ?z } LIMIT 2", {
  println x
  println y
  println z // may be a LiteralImpl, so you get full access to manipulate Value objects
  }
)</code></pre></div></div></div><div class="sect2"><h3 id="_add_remove_triples"><a class="link" href="#_add_remove_triples">Add &amp; Remove Triples</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">// insert and remove
stardog.insert([["urn:test3", "urn:test:predicate", "hello world"],
  	["urn:test4", "urn:test:predicate", "hello world2"]])
stardog.remove(["urn:test3", "urn:test:predicate", "hello world"])
stardog.remove(["urn:test4", "urn:test:predicate", "hello world2"])</code></pre></div></div></div><div class="sect2"><h3 id="_withconnection_closure"><a class="link" href="#_withconnection_closure">withConnection Closure</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">// withConnection, tx safe
stardog.withConnection { con -&gt;
    def queryString = """
		SELECT ?s ?p ?o
		{
		  ?s ?p ?o
		}
	"""
	TupleQueryResult result = null;
	try {
		Query query = con.query(queryString);
		result = query.executeSelect();
		while (result.hasNext()) {
			println result.next();
		}

		result.close();

	} catch (Exception e) {
		println "Caught exception ${e}"
	}
}</code></pre></div></div></div><div class="sect2"><h3 id="_sparql_update_support"><a class="link" href="#_sparql_update_support">SPARQL Update Support</a></h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">// Accepts the SPARQL Update queries
stardog.update("DELETE { ?a ?b \"hello world2\" } INSERT { ?a ?b \"aloha world2\" } WHERE { ?a ?b \"hello world2\" }")

def list = []
stardog.query("SELECT ?x ?y ?z WHERE { ?x ?y \"aloha world2\" } LIMIT 2", { list &lt;&lt; it } )
assertTrue(list.size == 1)</code></pre></div></div></div></div></div><h1 id="_snarl_migration_guide" class="sect0"><a class="link" href="#_snarl_migration_guide">SNARL Migration Guide</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/migration.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div></div></div><div class="sect1"><h2 id="_stardog_4"><a class="link" href="#_stardog_4">Stardog 4</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog 4 introduces significant changes; this section provides an overview of those changes and how they affect users.</p></div><div class="paragraph"><p>Migration of existing, persisted information, RDF, search, spatial, etc, is <strong>required</strong>. Particularly, pre-4.0 RDF indexes are not RDF 1.1 compatible and executing queries over these older indexes could yield unexpected results, including queries which return no results, but should. Thus migration of persisted information can be performed automatically the first time Stardog is started. However, because these migrations are <strong>NOT</strong> backward compatible and cannot be reversed, you cannot revert to an earlier version of Stardog once they have been updated.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Automatic migration is disabled <strong>by default</strong>; this means the first time you start Stardog 4 with an existing <code>$STARDOG_HOME</code>, <strong>Stardog will not run</strong>. You must opt-in to the migration of your existing data. This can be done by setting the Stardog configuration option <code>upgrade.automatic</code> in the <code>stardog.properties</code> to <code>true</code>. Migration can also be allowed by using the flag <code>--upgrade</code> to <code>server start</code>.</td></tr></table></div><div class="sect2"><h3 id="_java_8"><a class="link" href="#_java_8">Java 8</a></h3><div class="paragraph"><p>Java 8 is now required. The public Stardog APIs have been updated to take advantage of new additions to the JDK. Anywhere we previously accepted a <code>java.io.File</code> as an argument, we now expect a <code>java.nio.file.Path</code>.</p></div><div class="paragraph"><p>Within the <code>Getter</code> class, <code>Iteration</code> is no longer returned as a result, <code>Stream</code> is instead used. Some of the utility methods, such as <code>Getter#iterator(Function)</code> have been removed in favor of using the resulting <code>Stream</code> and, in this example, using its <code>map</code> method.</p></div><div class="paragraph"><p>We have updated libraries, most notably Jena 3 and Sesame 4. In particular, the change to Sesame 4 impacts our APIs. Anywhere <code>URI</code> was used has been changed to <code>IRI</code>. Similarly, anything expecting or returning a <code>Graph</code> now uses <code>Model</code>.</p></div><div class="paragraph"><p>The default base URI used for RDF parsing changed from <code>tag:stardog:api:</code> to <code><a href="http://api.stardog.com/" class="bare">http://api.stardog.com/</a></code>.</p></div><div class="paragraph"><p>Optional migration has been removed from the API and CLI.</p></div><div class="paragraph"><p>Finally, <code>StardogException</code> and all other exceptions used by the Stardog APIs have been made unchecked and are now subclasses of <code>RuntimeException</code>.</p></div></div><div class="sect2"><h3 id="_libraries"><a class="link" href="#_libraries">Libraries</a></h3><div class="paragraph"><p>Most notably, Stardog now only supports Jena 3 and Sesame 4 and our bindings have been updated accordingly. For those using these libraries to work with Stardog, <a href="http://jena.apache.org/documentation/migrate_jena2_jena3.html">Jena</a> and <a href="http://rdf4j.org/doc/4/programming.docbook?view#Changes_in_Sesame_4">Sesame</a> have posted their own migration guides.</p></div><div class="paragraph"><p>If you&#8217;re using Jena, we recommend running with <code>JenaRuntime.isRDF11 = true</code> for maximal compatibility between the libraries.</p></div></div><div class="sect2"><h3 id="_rdf_1_1"><a class="link" href="#_rdf_1_1">RDF 1.1</a></h3><div class="paragraph"><p>Stardog 4 now supports the RDF 1.1 specification. To learn more about the changes in RDF 1.1, <a href="http://www.w3.org/TR/rdf11-new/">see here</a>.</p></div></div><div class="sect2"><h3 id="_configuration_2"><a class="link" href="#_configuration_2">Configuration</a></h3><div class="paragraph"><p>The database option <code>transactions.durable</code> has been renamed <code>transaction.logged</code> for clarity. Transactions in Stardog are always durable without additional changes to the system. Transactions can be optionally logged, primarily for use with the cluster&#8217;s log shipping capabilities.</p></div><div class="paragraph"><p><code>waldo.default.limit</code> is now <code>search.default.limit</code>. Additionally, the default has changed from <code>50</code> to <code>100</code>. <code>leading.wildcard.search.enabled</code> is now <code>search.leading.wildcard.search.enabled</code>; the default value is still <code>false</code>. These options are also available as database options of the same names for controlling this behavior on a per-database basis.</p></div></div><div class="sect2"><h3 id="_cluster"><a class="link" href="#_cluster">Cluster</a></h3><div class="paragraph"><p>The proxy component is no longer in the cluster. Nodes will forward write requests to the master and service any reads that directly come to them.</p></div><div class="paragraph"><p>It is suggested now that deployments use a load balancer and proxy to provide a single address for a cluster.</p></div><div class="paragraph"><p>For an example of an external proxy configuration see <a href="#_high_availability_cluster">High Availability Cluster</a> section.</p></div><div class="paragraph"><p>The configuration property <code>pack.cluster.address</code>, deprecated in 3.1, is no longer used. Use <code>pack.zookeeper.address</code> instead.</p></div><div class="paragraph"><p>In Stardog 4, you don&#8217;t have to shut down the Stardog nodes independently, you only need to issue one shutdown request which will be forwarded to all nodes in the cluster. The ZooKeeper ensemble still has to be shut down independently.</p></div></div><div class="sect2"><h3 id="_logging"><a class="link" href="#_logging">Logging</a></h3><div class="paragraph"><p>We no longer use JUL for logging; we use <a href="http://logging.apache.org/log4j/2.x/">Log4j 2</a>.</p></div><div class="paragraph"><p>The entire logging configuration is managed by log4j; therefore, <code>server start</code> and <code>cluster zkstart</code> no longer take a <code>--logfile</code> option. Instead, the default logging behavior is overridden by placing a log4j2 configuration file in <code>$STARDOG_HOME</code>.</p></div><div class="paragraph"><p>The default behavior is to log to <code>$STARDOG_HOME/stardog.log</code> using a buffered, synchronous file appender. This means that it will write to a buffer first but every log record is flushed to disk once the entire record is finished writing.</p></div></div></div></div><div class="sect1"><h2 id="_stardog_3"><a class="link" href="#_stardog_3">Stardog 3</a></h2><div class="sectionbody"><div class="paragraph"><p>This section guides migration from Stardog 2.x to Stardog 3.</p></div><div class="sect2"><h3 id="_reasoning_4"><a class="link" href="#_reasoning_4">Reasoning</a></h3><div class="paragraph"><p><code>ReasoningType</code> is no longer a <code>Connection</code> client option. Reasoning is now enabled, or disabled; the database will determine the appropriate OWL profile to use given the TBox associated with the database. Therefore, the CLI commands that optionally accept <code>-r, --reasoning</code> argument does not need a level value. The commands that required a reasoning level in 2.x does not need a <code>-r, --reasoning</code> argument anymore as they enable reasoning automatically.</p></div><div class="paragraph"><p>The default value of <code>reasoning.schema.graphs</code> has been changed to <code>ALL</code> from <code>DEFAULT</code>.</p></div></div><div class="sect2"><h3 id="_custom_functions_and_aggregates"><a class="link" href="#_custom_functions_and_aggregates">Custom Functions and Aggregates</a></h3><div class="paragraph"><p>The API for custom SPARQL functions has changed in Stardog 3 to accommodate the addition of custom SPARQL aggregates. A discussion on how to create custom functions and aggregates can be found <a href="https://github.com/complexible/stardog-examples/tree/master/examples/function">in the examples</a>.</p></div></div><div class="sect2"><h3 id="_database_properties"><a class="link" href="#_database_properties">Database Properties</a></h3><div class="paragraph"><p>In Stardog 3, <code>DatabaseOptions</code> no longer serves as a single collection of all options for the system. Module-specific options have been split into their respective modules. For example, all options dealing with configuration of the reasoner in Stardog&#8212;&#8203;those whose names are prefixed with <code>reasoning</code>, such as <code>SCHEMA_GRAPHS</code>--have been moved to <code>ReasoningOptions</code>. Similar changes were made for <code>ICVOptions</code> and <code>SearchOptions</code>.</p></div><div class="paragraph"><p><code>query.all.graphs</code> can now be set as a database option too. If there is no value set for this option in the database metadata, the default value specified in the <code>stardog.properties</code> file will be used.</p></div><div class="paragraph"><p>The database connection timeout option is now called <code>database.connection.timeout</code> and it accepts duration strings such as <code>1h</code> or <code>10m</code>. This option can be set either in <code>stardog.properties</code> or in the database metadata.</p></div></div><div class="sect2"><h3 id="_empire"><a class="link" href="#_empire">Empire</a></h3><div class="paragraph"><p>The <a href="https://github.com/mhgrove/Empire">Empire</a> bindings for Stardog have been released under Apache license and are no longer part of the Stardog distribution. They are now available in the Empire code base in the <code>stardog</code> module.</p></div></div><div class="sect2"><h3 id="_api"><a class="link" href="#_api">API</a></h3><div class="paragraph"><p>The following methods were added to the SNARL API:</p></div><div class="ulist"><ul><li><p><code>Getter#ask</code></p></li><li><p><code>ConnectionConfiguration#setAll</code></p></li></ul></div><div class="paragraph"><p>Additionally, the Search API now exposes the ability to execute searches over named graphs, which was previously only available via SPARQL.</p></div></div></div></div><div class="sect1"><h2 id="_stardog_2"><a class="link" href="#_stardog_2">Stardog 2</a></h2><div class="sectionbody"><div class="paragraph"><p>This document guides migration of code from SNARL 1.0 to SNARL 2.0 API.</p></div><div class="sect2"><h3 id="_deprecating_and_renaming"><a class="link" href="#_deprecating_and_renaming">Deprecating and Renaming</a></h3><div class="ulist"><ul><li><p>All deprecated methods have been removed.</p></li><li><p>All <code>com.clarkparsia</code> packages have been moved to <code>com.complexible</code>.</p></li><li><p><code>com.clarkparsia.stardog.reasoning.ReasoningType</code> has been moved to <code>com.complexible.stardog.reasoning.api.ReasoningType</code>.</p></li><li><p><code>com.clarkparsia.openrdf.query</code> has been moved to <code>org.openrdf.queryrender</code>.</p></li><li><p>Everything else in <code>com.clarkparsia.openrdf</code> has been moved to <code>com.complexible.common.openrdf</code>.</p></li><li><p>All methods marked @Beta have been promoted.</p></li></ul></div></div><div class="sect2"><h3 id="_queries_2"><a class="link" href="#_queries_2">Queries</a></h3><div class="paragraph"><p>We introduced a new hierarchy for the class <code>com.complexible.stardog.api.Query</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-Java" data-lang="Java">+ com.complexible.stardog.api.Query
	+ com.complexible.stardog.api.ReadQuery
		+ com.complexible.stardog.api.BooleanQuery
		+ com.complexible.stardog.api.GraphQuery
		+ com.complexible.stardog.api.SelectQuery
	+ com.complexible.stardog.api.UpdateQuery</code></pre></div></div><div class="paragraph"><p>Queries can be created from a <code>com.complexible.stardog.api.Connection</code> object using the suitable method according to desired type of query: <code>select</code>, <code>ask</code>, <code>graph</code>, or <code>update</code>.</p></div><div class="paragraph"><p>Now you can specify the reasoning type with which a particular <code>com.complexible.stardog.api.ReadQuery</code> is to be executed via the method <code>reasoning(ReasoningType)</code>. The query reasoning type overrides the reasoning type of the parent connection. Note that setting the reasoning type to <code>ReasoningType.NONE</code> will disable reasoning for that particular query, it does not affect the default reasoning specified by the <code>Connection</code>.</p></div><div class="paragraph"><p>The methods <code>executeAsk()</code>, <code>executeSelect()</code>, and <code>executeGraph()</code> on <code>com.complexible.stardog.api.Query</code> have been removed. Queries can be executed by using the <code>execute()</code> method which will return a value appropriate for the type of query being executed.</p></div></div><div class="sect2"><h3 id="_connections"><a class="link" href="#_connections">Connections</a></h3><div class="paragraph"><p>The class <code>com.complexible.stardog.api.admin.StardogDBMS</code> was removed. It has been replaced by <code>com.complexible.stardog.api.admin.AdminConnectionConfiguration</code> for creating connections to the Stardog DBMS and <code>com.complexible.stardog.api.admin.AdminConnection</code> for the actual connection.</p></div><div class="paragraph"><p>The method <code>login</code> on <code>com.complexible.stardog.api.admin.StardogDBMS</code> (now <code>com.complexible.stardog.api.admin.AdminConnectionConfiguration</code>) has been renamed <code>connect</code> to align with usage of the standard <code>com.complexible.stardog.api.ConnectionConfiguration</code></p></div><div class="paragraph"><p>The method <code>connect(ReasoningType)</code> on <code>com.complexible.stardog.api.ConnectionConfiguration</code> has been removed.</p></div><div class="paragraph"><p>The method <code>getBaseConnection()</code> on <code>com.complexible.stardog.api.reasoning.ReasoningConnection</code> has been removed. To obtain a <code>ReasoningConnection</code> from a base connection, simply use <code>Connection.as(ReasoningConnection.class)</code>.</p></div></div><div class="sect2"><h3 id="_explanations"><a class="link" href="#_explanations">Explanations</a></h3><div class="paragraph"><p>The explain functions of <code>com.complexible.stardog.api.reasoning.ReasoningConnection</code> now return <code>com.complexible.stardog.reasoning.Proof</code> objects. The <code>com.complexible.stardog.reasoning.Proof.getStatements()</code> function can be used to get only the asserted statements which is equivalent to what explain functions returned in 1.x.</p></div></div><div class="sect2"><h3 id="_starting_the_server"><a class="link" href="#_starting_the_server">Starting the server</a></h3><div class="paragraph"><p>In order to create a new server we use a <code>ServerBuilder</code> obtained via the method <code>buildServer()</code> on <code>com.complexible.stardog.Stardog</code>; configuration options can be <code>set(Option&lt;T&gt;, T)</code> and the server is created for a particular address with <code>bind</code>. The following example shows how to create a new embedded SNARL server.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-Java" data-lang="Java">Server aServer = Stardog
            		.buildServer()
            		.bind(SNARLProtocol.EMBEDDED_ADDRESS)
            		.start();</code></pre></div></div><div class="paragraph"><p>When programmatically starting a Stardog server in your application, you <strong>must</strong> stop the server when you&#8217;re done with it, otherwise it can prevent the JVM from exiting.</p></div></div><div class="sect2"><h3 id="_protocols"><a class="link" href="#_protocols">Protocols</a></h3><div class="paragraph"><p>As of Stardog 2.0, Stardog&#8217;s supported protocols, SNARL &amp; HTTP, now run on the <strong>same</strong> port. There is no need to start separate servers or specify different ports. The new unified Stardog server will automatically detect what protocol you are using and forward the traffic appropriately. The default port for the server remains <code>5820</code>.</p></div></div><div class="sect2"><h3 id="_command_line_2"><a class="link" href="#_command_line_2">Command line</a></h3><div class="paragraph"><p>The global options <code>--home</code>, <code>--logfile</code>, <code>--disable-security</code> for <code>server start</code> command have been turned into regular options. See the <code>stardog-admin help server start</code> for details.</p></div></div></div></div><h1 id="_understanding_stardog" class="sect0"><a class="link" href="#_understanding_stardog">Understanding Stardog</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/understand.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>Background information on performance, testing, terminology, known issues, compatibility policies, etc.</p></div></div></div><div class="sect1"><h2 id="_faq"><a class="link" href="#_faq">FAQ</a></h2><div class="sectionbody"><div class="paragraph"><p>Some frequently asked questions for which we have answers.</p></div><div class="sect2"><h3 id="_how_do_i_report_a_bug_what_information_should_i_include"><a class="link" href="#_how_do_i_report_a_bug_what_information_should_i_include">How do I report a bug? What information should I include?</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>Something isn&#8217;t working and I don&#8217;t know what to do&#8230;&#8203;</p></dd><dt class="hdlist1">Answer</dt><dd><p>A bug report seems prudent in this case; customers should use their dedicated support channel. Others may use the <a href="https://community.stardog.com">support forum</a>. You should include, at a minimum:</p><div class="olist arabic"><ol class="arabic"><li><p>which release and version of Stardog you are using 4.x? 5.x? Community? Enterprise?</p></li><li><p>which JVM you are using</p></li><li><p>anything from <code>stardog.log</code> (in <code>STARDOG_HOME</code>) that seems relevant</p></li></ol></div></dd></dl></div></div><div class="sect2"><h3 id="_why_can_t_i_load_dbpedia_or_other_rdf_data"><a class="link" href="#_why_can_t_i_load_dbpedia_or_other_rdf_data">Why can&#8217;t I load Dbpedia (or other RDF) data?</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>I get a parsing error when loading Dbpedia or some other RDF. What can I do?</p></dd><dt class="hdlist1">Answer</dt><dd><p>First, it&#8217;s not a bad thing to expect data providers to publish valid data. Second, it is, apparently, a very naive thing to expect data providers to publish valid data&#8230;&#8203;</p><div class="paragraph"><p>Stardog supports a loose parsing mode which will ignore certain kinds of data invalidity and may allow you to load invalid data. See <code>strict.parsing</code> in <a href="#_configuration_options">Configuration Options</a>.</p></div></dd></dl></div></div><div class="sect2"><h3 id="_why_doesn_t_search_work"><a class="link" href="#_why_doesn_t_search_work">Why doesn&#8217;t search work?</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>I created a database but search doesn&#8217;t work.</p></dd><dt class="hdlist1">Answer</dt><dd><p>Search is disabled by default; you can enable it at database creation time, or at any subsequent time, using the Web Console or by using <a href="/man/metadata-set.html"><code>metadata set</code></a> CLI. It can be enabled using <a href="/man/db-create.html"><code>db create</code></a> too.</p></dd></dl></div></div><div class="sect2"><h3 id="_why_don_t_my_queries_work"><a class="link" href="#_why_don_t_my_queries_work">Why don&#8217;t my queries work?!</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>I&#8217;ve got some named graphs and blah blah my queries don&#8217;t work blah blah.</p></dd><dt class="hdlist1">Answer</dt><dd><p>Queries with FROM NAMED with a named graph that is not <strong>in</strong> Stardog will not cause Stardog to download the data from an arbitrary HTTP URL and include it in the query. <em>Stardog will only evaluate queries over data that has been loaded into it</em>.</p><div class="paragraph"><p>SPARQL queries without a context or named graph are executed against <strong>the default, unnamed graph</strong>. In Stardog, <strong>the default graph is not the union of all the named graphs and the default graph</strong>. This behavior is configurable via the <code>query.all.graphs</code> configuration parameter.</p></div></dd></dl></div></div><div class="sect2"><h3 id="_why_is_stardog_cluster_acting_weird_or_running_slowly"><a class="link" href="#_why_is_stardog_cluster_acting_weird_or_running_slowly">Why is Stardog Cluster acting weird or running slowly?</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>Should I put Stardog HA and Zookeeper on the same hard drives?</p></dd><dt class="hdlist1">Answer</dt><dd><p>Never never never do this. Zookeeper is a very disk-chatty system and displays bad IO contention with Stardog query evaluation. Running both Zk and Stardog on the same disks will result in bad performance and, in some cases, intermittent failures.</p></dd></dl></div></div><div class="sect2"><h3 id="_sparql_1_1"><a class="link" href="#_sparql_1_1">SPARQL 1.1</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>Does Stardog support SPARQL 1.1?</p></dd><dt class="hdlist1">Answer</dt><dd><p>Yes.</p></dd></dl></div></div><div class="sect2"><h3 id="_deadlocks_and_slowdowns"><a class="link" href="#_deadlocks_and_slowdowns">Deadlocks and Slowdowns</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>Stardog slows down or deadlocks?! I don&#8217;t understand why, I&#8217;m just trying to send some queries and do something with the results&#8230;&#8203;in a tight inner loop of doom!</p></dd><dt class="hdlist1">Answer</dt><dd><p>Make sure you are closing result sets (<code>TupleQueryResult</code> and <code>GraphQueryResult</code>; or the Jena equivalents) when you are done with them. These hold open resources both on the client and on the server and failing to close them when you are done will cause files, streams, lions, tigers, and bears to be held open. If you do that enough, then you&#8217;ll eventually exhaust all of the resources in their respective pools, which can cause slowness or, in some cases, deadlocks waiting for resources to be returned.</p><div class="paragraph"><p>Similarly close your connections when you are done with them. Failing to close <code>Connections</code>, <code>Iterations</code>, <code>QueryResults</code>, and other <strong>closeable</strong> objects will lead to undesirable behavior.</p></div></dd></dl></div></div><div class="sect2"><h3 id="_bulk_update_performance"><a class="link" href="#_bulk_update_performance">Bulk Update Performance</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>I&#8217;m adding one triple at a time, in a tight loop, to Stardog; is this the ideal strategy with respect to performance?</p></dd><dt class="hdlist1">Question</dt><dd><p>I&#8217;m adding millions of triples to Stardog and I&#8217;m wondering if that&#8217;s the best approach?</p></dd><dt class="hdlist1">Answer</dt><dd><p>The answer to both questions is "not really"&#8230;&#8203;Generally overall update performance is best if you write between 1k and 100k triples at a time. You may need to experiment to find the sweet spot with respect to your data, database size, the size of the differential index, and update frequency.</p></dd></dl></div></div><div class="sect2"><h3 id="_public_endpoint"><a class="link" href="#_public_endpoint">Public Endpoint</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>I want to use Stardog to serve a public SPARQL endpoint; is there some way I can do this without publishing user account information?</p></dd><dt class="hdlist1">Answer</dt><dd><p>We don&#8217;t necessarily recommend this, but it&#8217;s possible. Simply pass <code>--disable-security</code> to <code>stardog-admin</code> when you start the Stardog Server. This <strong>completely</strong> disables security in Stardog which will let users access the SPARQL endpoint, and all other functionality, without needing authorization.</p></dd></dl></div></div><div class="sect2"><h3 id="_remote_bulk_loading"><a class="link" href="#_remote_bulk_loading">Remote Bulk Loading</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>I&#8217;m trying to create a database and bulk load files from my machine to the server and it&#8217;s not working, the files don&#8217;t seem to load, what gives?</p></dd><dt class="hdlist1">Answer</dt><dd><p>Stardog does not transfer files during database creation to the server, sending big files over a network kind of defeats the purpose of blazing fast bulk loading. If you want to bulk load files from your machine to a remote server, copy them to the server and bulk load them.</p></dd></dl></div></div><div class="sect2"><h3 id="_canonicalized_literals"><a class="link" href="#_canonicalized_literals">Canonicalized Literals</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>Why doesn&#8217;t my literal look the same as I when I added it to Stardog?</p></dd><dt class="hdlist1">Answer</dt><dd><p>Stardog performs <a href="http://docs.stardog.com/java/snarl/com/complexible/stardog/index/IndexOptions.html#CANONICAL_LITERALS">literal canonicalization</a> by default. This can be turned off by setting <code>index.literals.canonical</code> to <code>false</code>. See <a href="#_configuration_options">Configuration Options</a> for the details.</p></dd></dl></div></div><div class="sect2"><h3 id="_cluster_isn_t_working"><a class="link" href="#_cluster_isn_t_working">Cluster Isn&#8217;t Working</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>I&#8217;ve setup Stardog Cluster, but it isn&#8217;t working and I have <code>NoRouteToHostException</code> exceptions all over my Zookeeper log.</p></dd><dt class="hdlist1">Answer</dt><dd><p>Typically&#8212;&#8203;but especially on Red Hat Linux and its variants&#8212;&#8203;this means that <code>iptables</code> is blocking one, some, or all of the ports that the Cluster is trying to use. You can disable <code>iptables</code> or, better yet, configure it to unblock the ports Cluster is using.</p></dd></dl></div></div><div class="sect2"><h3 id="_client_connection_isn_t_working"><a class="link" href="#_client_connection_isn_t_working">Client Connection Isn&#8217;t Working</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>I&#8217;m getting a <code>ServiceConfigurationError</code> saying that <code>SNARLDriver</code> could not be instantiated.</p></dd><dt class="hdlist1">Answer</dt><dd><p>Make sure that your classpath includes all Stardog JARs and that the user executing your code has access to them.</p></dd></dl></div></div><div class="sect2"><h3 id="_logging_2"><a class="link" href="#_logging_2">Logging</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>Why doesn&#8217;t Stardog implement our (byzantine and proprietary!) corporate logging scheme?</p></dd><dt class="hdlist1">Answer</dt><dd><p>Stardog 4 will log to <code>$STARDOG_HOME/stardog.log</code> by <a href="#_logging">default</a>, but you can use a log4j 2 config file in <code>$STARDOG_HOME</code> so that Stardog will log wherever &amp; however you want.</p></dd></dl></div></div><div class="sect2"><h3 id="_loading_compressed_data_2"><a class="link" href="#_loading_compressed_data_2">Loading Compressed Data</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>How can I load data from a compressed format that Stardog doesn&#8217;t support without decompressing the file?</p></dd><dt class="hdlist1">Answer</dt><dd><p>Stardog supports several compression formats by default (zip, gzip, bzip2) so files compressed with those formats can be passed as input directly without decompression. Files compressed with other formats can also be loaded to Stardog by decompressing them on-the-fly using <a href="http://en.wikipedia.org/wiki/Named_pipe">named pipes</a> in Unix-like systems. The following example shows using a named pipe where the decompressed data is sent directly to Stardog without being writing to disk.</p></dd></dl></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ mkfifo some-data.rdf
$ xz -dc some-data.rdf.xz &gt; some-data.rdf &amp;
$ stardog-admin db create -n test some-data.rdf</code></pre></div></div></div><div class="sect2"><h3 id="_snarl_protocol"><a class="link" href="#_snarl_protocol">SNARL Protocol</a></h3><div class="dlist"><dl><dt class="hdlist1">Question</dt><dd><p>I&#8217;m using Stardog and I&#8217;m seeing messages about SNARL deprecation, what&#8217;s that about?</p></dd><dt class="hdlist1">Answer</dt><dd><p>As of Stardog 4.2, the SNARL protocol is no longer the default protocol for Stardog and is deprecated. Support for the SNARL protocol will be removed in the Stardog 5 release. The HTTP protocol is now the default protocol and is recommended for all users. If you&#8217;re seeing the deprecation warnings it&#8217;s because you&#8217;re explicitly using the SNARL protocol somewhere in your application.</p></dd></dl></div><div class="paragraph"><p>All you have to do to migrate these usages is change <code>snarl</code>/<code>snarls</code> to <code>http</code>/<code>https</code> and you&#8217;re done. You can no longer disable support for HTTP when starting the server; the <code>--no-http</code> option does noting, and the SNARL protocol is not enabled by default anymore and has to be explicitly enabled by using <code>--snarl</code>.</p></div><div class="paragraph"><p>Please note, the SNARL <em>protocol</em> has been deprecated. The SNARL API is still supported and the recommended Java API for Stardog.</p></div></div></div></div><div class="sect1"><h2 id="_benchmark_results"><a class="link" href="#_benchmark_results">Benchmark Results</a></h2><div class="sectionbody"><div class="paragraph"><p><a href="https://docs.google.com/spreadsheets/d/1oHSWX_0ChZ61ofipZ1CMsW7OhyujioR28AfHzU9d56k/pubhtml">Live, dynamically updated performance data</a> from BSBM, SP2B, LUBM benchmarks against the latest Stardog release.</p></div></div></div><div class="sect1"><h2 id="_compatibility_policies"><a class="link" href="#_compatibility_policies">Compatibility Policies</a></h2><div class="sectionbody"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/compatibility.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>The Stardog 4.x release ("Stardog" for short) is a major milestone in the development of the system. Stardog is a stable platform for the growth of projects and programs written for Stardog.</p></div><div class="paragraph"><p>Stardog provides (and defines) several user-visible things:</p></div><div class="olist arabic"><ol class="arabic"><li><p>SNARL API</p></li><li><p>BigPacket Message Format</p></li><li><p>Stardog Extended HTTP Protocol</p></li><li><p>a command-line interface</p></li></ol></div><div class="paragraph"><p>It is intended that programs—as well as SPARQL queries—written to Stardog APIs, protocols, and interfaces will continue to run correctly, unchanged, over the lifetime of Stardog. That is, over all releases identified by version <code>4.x.y</code>. At some indefinite point, Stardog 5.x may be released; but, until that time, Stardog programs that work today should continue to work even as future releases of Stardog occur. APIs, protocols, and interfaces may grow, acquiring new parts and features, but not in a way that breaks existing Stardog programs.</p></div><div class="sect2"><h3 id="_expectations"><a class="link" href="#_expectations">Expectations</a></h3><div class="paragraph"><p>Although we expect that nearly all Stardog programs will maintain this compatibility over time, it is impossible to guarantee that no future change will break any program. This document sets expectations for the compatibility of Stardog programs in the future. The main, foreseeable reasons for which this compatibility may be broken in the future include:</p></div><div class="olist arabic"><ol class="arabic"><li><p><strong>Security</strong>: We reserve the right to break compatibility if doing so is required to address a security problem in Stardog.</p></li><li><p><strong>Unspecified behavior</strong>: Programs that depend on unspecified<span class="footnote">[<a id="_footnoteref_42" class="footnote" href="#_footnote_42" title="View footnote.">42</a>]</span> behaviors may not work in the future if those behaviors are modified.</p></li><li><p><strong>3rd Party Specification Errors</strong>: It may become necessary to break compatibility of Stardog programs in order to address problems in some 3rd party specification.</p></li><li><p><strong>Bugs</strong>: It will not always be possible to fix bugs found in Stardog&#8212;&#8203;or in its 3rd party dependencies&#8212;&#8203;while also preserving compatibility. With that proviso, we will endeavor to only break compatibility when repairing critical bugs.</p></li></ol></div><div class="paragraph"><p>It is always possible that the performance of a Stardog program may be (adversely) affected by changes in the implementation of Stardog. No guarantee can be made about the performance of a given program between releases, except to say that our expectation is that performance will generally trend in the appropriate direction.</p></div></div><div class="sect2"><h3 id="_data_migration_safety"><a class="link" href="#_data_migration_safety">Data Migration &amp; Safety</a></h3><div class="paragraph"><p>We expect that data safety will always be given greater weight than any other consideration. But since Stardog stores a user&#8217;s data differently from the form in which data is input to Stardog, we may from time to time change the way it is stored such that explicit data migration will be necessary.</p></div><div class="paragraph"><p>Stardog provides for two data migration strategies:</p></div><div class="olist arabic"><ol class="arabic"><li><p>Command-line migration tool(s)</p></li><li><p>Dump and reload</p></li></ol></div><div class="paragraph"><p>We expect that explicit migrations may be required from time to time between different releases of Stardog. We will endeavor to minimize the need for such migrations. We will only require the "dump and reload" strategy between <strong>major</strong> releases of Stardog (that is, from 1.x to 2.x, etc.), unless that strategy of migration is required to repair a security or other data safety bug.</p></div></div></div></div><div class="sect1"><h2 id="_known_issues_2"><a class="link" href="#_known_issues_2">Known Issues</a></h2><div class="sectionbody"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/known-issues.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>The known issues in Stardog 5.0.0beta:</p></div><div class="olist arabic"><ol class="arabic"><li><p>Our implementation of <code>CONSTRUCT</code> slightly deviates from the <a href="http://www.w3.org/TR/sparql11-query/#construct">SPARQL 1.1 specification</a>: it does not implicitly <code>DISTINCT</code> query results; rather, it implicitly applies <code>REDUCED</code> semantics to <code>CONSTRUCT</code> query results.<span class="footnote">[<a id="_footnoteref_43" class="footnote" href="#_footnote_43" title="View footnote.">43</a>]</span></p></li><li><p>Asking for all individuals with reasoning via the query <code>{?s a owl:Thing}</code> might also retrieve some classes and properties. <strong>WILLFIX</strong></p></li><li><p>Schema queries do not bind graph variables.</p></li><li><p>Dropping a database deletes all of the data files in Stardog Home associated with that database. If you want to keep the data files and remove the database from the system catalog, then you need to manually copy these files to another location before dropping the database.</p></li><li><p>If relative URIs exist in the data files passed to create, add, or remove commands, then they will be resolved using the constant base URI <code><a href="http://api.stardog.com/" class="bare">http://api.stardog.com/</a></code> if, but only if, the format of the file allows base URIs. Turtle and RDF/XML formats allows base URIs but N-Triples format doesn&#8217;t allow base URIs and relative URIs in N-Triples data will cause errors.</p></li><li><p>Queries with <code>FROM NAMED</code> with a named graph that is <strong>not</strong> in Stardog will <strong>not</strong> cause Stardog to download the data from an arbitrary HTTP URL and include it in the query.</p></li><li><p>SPARQL queries without a context or named graph are executed against the default, unnamed graph. In Stardog, the default graph is <strong>not</strong> the union of all the named graphs and the default graph. Note: this behavior is configurable via the <code>query.all.graphs</code> configuration parameter.</p></li><li><p>RDF literals are limited to 8MB (after compression) in Stardog. Input data with literals larger than 8MB (after compression) will raise an exception.</p></li></ol></div></div></div><div class="sect1"><h2 id="_glossary"><a class="link" href="#_glossary">Glossary</a></h2><div class="sectionbody"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/glossary.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>In the Stardog documentation, the following terms have a specific technical meaning.</p></div><div class="hdlist"><table><tr><td class="hdlist1">Stardog Database Management System, aka Stardog Server</td><td class="hdlist2"><p>An instance of Stardog; only one Stardog Server may run per JVM. A computer may run multiple Stardog Servers by running one per multiple JVMs.</p></td></tr><tr><td class="hdlist1">Stardog Home, aka <code>STARDOG_HOME</code></td><td class="hdlist2"><p>A directory in a filesystem in which Stardog stores files and other information; established either in a Stardog configuration file or by environment variable. Only one Stardog Server may run simultaneously from a <code>STARDOG_HOME</code>.</p></td></tr><tr><td class="hdlist1">Stardog Network Home</td><td class="hdlist2"><p>A URL (HTTP or SNARL) which identifies a Stardog Server running on the network.</p></td></tr><tr><td class="hdlist1">Database</td><td class="hdlist2"><p>A Stardog database is a graph of RDF data under management of a Stardog Server. It may contain zero or more RDF Named Graphs. A Stardog Server may manage more than one Database; there is no hard limit, and the practical limit is disk space.</p></td></tr><tr><td class="hdlist1">Database Short Name, aka Database Name</td><td class="hdlist2"><p>An identifier used to name a database, provided as input when a database is created.</p></td></tr><tr><td class="hdlist1">Database Network Name</td><td class="hdlist2"><p>A Database Short Name is part of the URI of a Database addressed over some network protocol.</p></td></tr><tr><td class="hdlist1">Index</td><td class="hdlist2"><p>The unit of persistence for a Database. We sometimes (sloppily) use Database and Index interchangeably in the manual.</p></td></tr><tr><td class="hdlist1">Memory Database</td><td class="hdlist2"><p>A Database may be stored in-memory or on disk; a Memory Database is read entirely into system memory but can be (optionally) persisted to disk.</p></td></tr><tr><td class="hdlist1">Disk Database</td><td class="hdlist2"><p>A Disk Database is only paged into system memory as needed and is persisted using one or more indexes.</p></td></tr><tr><td class="hdlist1">Connection String</td><td class="hdlist2"><p>An identifier (a restricted subset of legal URLs, actually) that is used to connect to a Stardog database to send queries or perform other operations.</p></td></tr><tr><td class="hdlist1">Named Graph</td><td class="hdlist2"><p>A Named Graph is an explicitly named unit of data within a Database. Named Graphs are queries explicitly by specifying them in SPARQL queries. There is no practical limit on the number of Named Graphs in a Database.</p></td></tr><tr><td class="hdlist1">Default Graph</td><td class="hdlist2"><p>The Default Graph in a Database is the context into which RDF triples are stored when a Named Graph is not explicitly specified. A SPARQL query executed by Stardog that does not contain any Named Graph statements is executed against the data in the Default Graph only.</p></td></tr><tr><td class="hdlist1">Security Realm</td><td class="hdlist2"><p>A Security Realm defines the users and their permissions for each Database in an Stardog Server. There is only one Security Realm per Stardog Server.</p></td></tr></table></div></div></div><h1 id="_appendix" class="sect0"><a class="link" href="#_appendix">Appendix</a></h1><div class="openblock partintro"><div class="content"><div class="paragraph etp"><p><a href="https://github.com/stardog-union/stardog-docs/edit/develop/src/doc/appendix-a.ad">Edit This Section</a>&nbsp;<span class="image"><img src="optimized-img//e1.png" alt="Edit" width="16" height="16"></span></p></div><div style="clear: both"></div><div class="paragraph"><p>Just move it to the Appendix for a great good!</p></div></div></div><div class="sect1"><h2 id="_sparql_query_functions"><a class="link" href="#_sparql_query_functions">SPARQL Query Functions</a></h2><div class="sectionbody"><div class="paragraph"><p>Stardog supports all of the functions in SPARQL, as well as some others from XPath and SWRL. Any of these functions can be used in queries or rules. Some functions appear in multiple namespaces, but all of the namespaces will work:</p></div><table class="tableblock frame-all grid-all spread"><caption class="title">8. Table of Stardog Function Namespaces</caption><colgroup><col style="width: 20%"><col style="width: 80%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Prefix</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">stardog</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag:stardog:api:functions:</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">fn</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://www.w3.org/2005/xpath-functions#" class="bare">http://www.w3.org/2005/xpath-functions#</a></code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">math</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://www.w3.org/2005/xpath-functions/math#" class="bare">http://www.w3.org/2005/xpath-functions/math#</a></code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">swrlb</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://www.w3.org/2003/11/swrlb#" class="bare">http://www.w3.org/2003/11/swrlb#</a></code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">leviathan</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://www.dotnetrdf.org/leviathan#" class="bare">http://www.dotnetrdf.org/leviathan#</a></code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">afn</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://jena.hpl.hp.com/ARQ/function#" class="bare">http://jena.hpl.hp.com/ARQ/function#</a></code></p></td></tr></tbody></table><div class="paragraph"><p>The function names and URIs supported by Stardog are included below. Some of these functions exist in SPARQL natively, which just means they can be used without an explicit namespace. Some of the functions have a URI that can be used but they are also overloaded arithmetic operators. For example, if you want to add two day time durations you can simply use the expression <code>?duration1 + ?duration2</code> instead of <code>swrlb:addDayTimeDurations(?duration1 + ?duration2)</code>.</p></div><table class="tableblock frame-all grid-all spread"><caption class="title">9. Table of Stardog Function Names &amp; URIs</caption><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Function name</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Recognized URIs and Symbols</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">abs</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-abs">ABS</a>, <a href="http://www.w3.org/2005/xpath-functions#numeric-abs">fn:numeric-abs</a>, <a href="http://www.w3.org/2003/11/swrlb#abs">swrlb:abs</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">acos</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#acos">math:acos</a>, <a href="http://www.dotnetrdf.org/leviathan#cos-1">leviathan:cos-1</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">addDayTimeDurations</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>, <a href="http://www.w3.org/2003/11/swrlb#addDayTimeDurations">swrlb:addDayTimeDurations</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">addDayTimeDurationToDate</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>, <a href="http://www.w3.org/2003/11/swrlb#addDayTimeDurationToDate">swrlb:addDayTimeDurationToDate</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">addDayTimeDurationToDateTime</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>, <a href="http://www.w3.org/2003/11/swrlb#addDayTimeDurationToDateTime">swrlb:addDayTimeDurationToDateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">addDayTimeDurationToTime</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>, <a href="http://www.w3.org/2003/11/swrlb#addDayTimeDurationToTime">swrlb:addDayTimeDurationToTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">addYearMonthDurations</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>, <a href="http://www.w3.org/2003/11/swrlb#addYearMonthDurations">swrlb:addYearMonthDurations</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">addYearMonthDurationToDate</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>, <a href="http://www.w3.org/2003/11/swrlb#addYearMonthDurationToDate">swrlb:addYearMonthDurationToDate</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">addYearMonthDurationToDateTime</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>, <a href="http://www.w3.org/2003/11/swrlb#addYearMonthDurationToDateTime">swrlb:addYearMonthDurationToDateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">asin</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#asin">math:asin</a>, <a href="http://www.dotnetrdf.org/leviathan#sin-1">leviathan:sin-1</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">atan</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#atan">math:atan</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">bnode</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-bnode">BNODE</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2001/XMLSchema#boolean">xsd:boolean</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">cartesian</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#cartesian">leviathan:cartesian</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">ceil</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-ceil">CEIL</a>, <a href="http://www.w3.org/2005/xpath-functions#numeric-ceil">fn:numeric-ceil</a>, <a href="http://www.w3.org/2003/11/swrlb#ceiling">swrlb:ceiling</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">concat</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-concat">CONCAT</a>, <a href="http://www.w3.org/2005/xpath-functions#concat">fn:concat</a>, <a href="http://www.w3.org/2003/11/swrlb#stringConcat">swrlb:stringConcat</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">contains</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-contains">CONTAINS</a>, <a href="http://www.w3.org/2005/xpath-functions#contains">fn:contains</a>, <a href="http://www.w3.org/2003/11/swrlb#contains">swrlb:contains</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">containsIgnoreCase</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2003/11/swrlb#containsIgnoreCase">swrlb:containsIgnoreCase</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">cos</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#cos">math:cos</a>, <a href="http://www.w3.org/2003/11/swrlb#cos">swrlb:cos</a>, <a href="http://www.dotnetrdf.org/leviathan#cos">leviathan:cos</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">cosec</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#cosec">leviathan:cosec</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">cosec-1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#cosec-1">leviathan:cosec-1</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">cosh</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>stardog:cosh</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">cotan</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#cotan">leviathan:cotan</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">cotan-1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#cotan-1">leviathan:cotan-1</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">cube</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#cube">leviathan:cube</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">datatype</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-datatype">Datatype</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2003/11/swrlb#date">swrlb:date</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">dateTime</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2001/XMLSchema#dateTime">xsd:dateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">day</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-day">DAY</a>, <a href="http://www.w3.org/2005/xpath-functions#day-from-dateTime">fn:day-from-dateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">dayTimeDuration</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2003/11/swrlb#dayTimeDuration">swrlb:dayTimeDuration</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">decimal</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2001/XMLSchema#decimal">xsd:decimal</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">divideDayTimeDuration</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code>, <a href="http://www.w3.org/2003/11/swrlb#divideDayTimeDuration">swrlb:divideDayTimeDuration</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">divideYearMonthDuration</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code>, <a href="http://www.w3.org/2003/11/swrlb#divideYearMonthDuration">swrlb:divideYearMonthDuration</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2001/XMLSchema#double">xsd:double</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">e</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#e">leviathan:e</a>, <a href="http://www.w3.org/2005/xpath-functions/math#exp">math:exp</a>, <a href="http://jena.hpl.hp.com/ARQ/function#e">afn:e</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">encode_for_uri</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-encode_for_uri">ENCODE_FOR_URI</a>, <a href="http://www.w3.org/2005/xpath-functions#encode-for-uri">fn:encode-for-uri</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">factorial</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#factorial">leviathan:factorial</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2001/XMLSchema#float">xsd:float</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">floor</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-floor">FLOOR</a>, <a href="http://www.w3.org/2005/xpath-functions#numeric-floor">fn:numeric-floor</a>, <a href="http://www.w3.org/2003/11/swrlb#floor">swrlb:floor</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">gmean</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag:stardog:api:gmean</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">hours</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-hours">HOURS</a>, <a href="http://www.w3.org/2005/xpath-functions#hours-from-dateTime">fn:hours-from-dateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">identifier</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag:stardog:api:identifier</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2001/XMLSchema#integer">xsd:integer</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">iri</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-iri">IRI</a>, <a href="https://www.w3.org/TR/sparql11-query/#func-irifunction">IRIFunction</a>, <a href="https://www.w3.org/TR/sparql11-query/#func-uri">URI</a>, <a href="https://www.w3.org/TR/sparql11-query/#func-urifunction">URIFunction</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">isbnode</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-isbnode">IsBNode</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">isiri</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-isiri">IsIRI</a>, <a href="https://www.w3.org/TR/sparql11-query/#func-isuri">IsURI</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">isliteral</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-isliteral">IsLiteral</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">isnumeric</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-isnumeric">IsNumeric</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">isresource</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-isresource">IsResource</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-label">Label</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">lang</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-lang">Lang</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">langmatches</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-langmatches">LangMatches</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">lcase</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-lcase">LCASE</a>, <a href="http://www.w3.org/2005/xpath-functions#lower-case">fn:lower-case</a>, <a href="http://www.w3.org/2003/11/swrlb#lowerCase">swrlb:lowerCase</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">localname</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>stardog:localname</code>, <a href="http://jena.hpl.hp.com/ARQ/function#localname">afn:localname</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">log</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#log">math:log</a>, <a href="http://www.dotnetrdf.org/leviathan#ln">leviathan:ln</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">log10</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#log10">math:log10</a>, <a href="http://www.dotnetrdf.org/leviathan#log">leviathan:log</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">max</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions#max">fn:max</a>, <a href="http://jena.hpl.hp.com/ARQ/function#max">afn:max</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">md5</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-md5">MD5</a>, <a href="http://www.dotnetrdf.org/leviathan#md5hash">leviathan:md5hash</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">min</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions#min">fn:min</a>, <a href="http://jena.hpl.hp.com/ARQ/function#min">afn:min</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">minutes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-minutes">MINUTES</a>, <a href="http://www.w3.org/2005/xpath-functions#minutes-from-dateTime">fn:minutes-from-dateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">mod</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2003/11/swrlb#mod">swrlb:mod</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">month</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-month">MONTH</a>, <a href="http://www.w3.org/2005/xpath-functions#month-from-dateTime">fn:month-from-dateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>stardog:namespace</code>, <a href="http://jena.hpl.hp.com/ARQ/function#namespace">afn:namespace</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">normalizeSpace</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-normalizespace">normalizeSpace</a>, <a href="http://www.w3.org/2005/xpath-functions#normalize-space">fn:normalize-space</a>, <a href="http://www.w3.org/2003/11/swrlb#normalizeSpace">swrlb:normalizeSpace</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">now</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-now">NOW</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">numeric-add</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions#numeric-add">fn:numeric-add</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">numeric-divide</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions#numeric-divide">fn:numeric-divide</a>, <a href="http://www.w3.org/2003/11/swrlb#divide">swrlb:divide</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">numeric-integer-divide</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions#numeric-integer-divide">fn:numeric-integer-divide</a>, <a href="http://www.w3.org/2003/11/swrlb#integerDivide">swrlb:integerDivide</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">numeric-multiply</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions#numeric-multiply">fn:numeric-multiply</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">numeric-round-half-to-even</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions#numeric-round-half-to-even">fn:numeric-round-half-to-even</a>, <a href="http://www.w3.org/2003/11/swrlb#roundHalfToEven">swrlb:roundHalfToEven</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">numeric-subtract</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions#numeric-subtract">fn:numeric-subtract</a>, <a href="http://www.w3.org/2003/11/swrlb#subtract">swrlb:subtract</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">numeric-unary-minus</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions#numeric-unary-minus">fn:numeric-unary-minus</a>, <a href="http://www.w3.org/2003/11/swrlb#unaryMinus">swrlb:unaryMinus</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">numeric-unary-plus</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions#numeric-unary-plus">fn:numeric-unary-plus</a>, <a href="http://www.w3.org/2003/11/swrlb#unaryPlus">swrlb:unaryPlus</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">pi</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#pi">math:pi</a>, <a href="http://jena.hpl.hp.com/ARQ/function#pi">afn:pi</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">pow</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#pow">math:pow</a>, <a href="http://www.w3.org/2003/11/swrlb#pow">swrlb:pow</a>, <a href="http://www.dotnetrdf.org/leviathan#pow">leviathan:pow</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">pythagoras</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#pythagoras">leviathan:pythagoras</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">rand</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-rand">RAND</a>, <a href="http://www.dotnetrdf.org/leviathan#rnd">leviathan:rnd</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">reciprocal</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#reciprocal">leviathan:reciprocal</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">regex</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-regex">Regex</a>, <a href="http://www.w3.org/2005/xpath-functions#matches">fn:matches</a>, <a href="http://www.w3.org/2003/11/swrlb#matches">swrlb:matches</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">replace</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-replace">REPLACE</a>, <a href="http://www.w3.org/2005/xpath-functions#replace">fn:replace</a>, <a href="http://www.w3.org/2003/11/swrlb#replace">swrlb:replace</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#root">leviathan:root</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">round</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-round">ROUND</a>, <a href="http://www.w3.org/2005/xpath-functions#numeric-round">fn:numeric-round</a>, <a href="http://www.w3.org/2003/11/swrlb#round">swrlb:round</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sec</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#sec">leviathan:sec</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sec-1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#sec-1">leviathan:sec-1</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-seconds">SECONDS</a>, <a href="http://www.w3.org/2005/xpath-functions#seconds-from-dateTime">fn:seconds-from-dateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sha1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-sha1">SHA1</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sha256</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-sha256">SHA256</a>, <a href="http://www.dotnetrdf.org/leviathan#sha256hash">leviathan:sha256hash</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sha384</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-sha384">SHA384</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sha512</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-sha512">SHA512</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sin</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#sin">math:sin</a>, <a href="http://www.w3.org/2003/11/swrlb#sin">swrlb:sin</a>, <a href="http://www.dotnetrdf.org/leviathan#sin">leviathan:sin</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sinh</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>stardog:sinh</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sq</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#sq">leviathan:sq</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">sqrt</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#sqrt">math:sqrt</a>, <a href="http://jena.hpl.hp.com/ARQ/function#sqrt">afn:sqrt</a>, <a href="http://www.dotnetrdf.org/leviathan#sqrt">leviathan:sqrt</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">str</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-str">Str</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">strafter</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-strafter">STRAFTER</a>, <a href="http://www.w3.org/2005/xpath-functions#substring-after">fn:substring-after</a>, <a href="http://www.w3.org/2003/11/swrlb#substringAfter">swrlb:substringAfter</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">strbefore</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-strbefore">STRBEFORE</a>, <a href="http://www.w3.org/2005/xpath-functions#substring-before">fn:substring-before</a>, <a href="http://www.w3.org/2003/11/swrlb#substringBefore">swrlb:substringBefore</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">strdt</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-strdt">STRDT</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">strends</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-strends">STRENDS</a>, <a href="http://www.w3.org/2005/xpath-functions#ends-with">fn:ends-with</a>, <a href="http://www.w3.org/2003/11/swrlb#endsWith">swrlb:endsWith</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2001/XMLSchema#string">xsd:string</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">stringEqualIgnoreCase</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2003/11/swrlb#stringEqualIgnoreCase">swrlb:stringEqualIgnoreCase</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">strlang</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-strlang">STRLANG</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">strlen</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-strlen">STRLEN</a>, <a href="http://www.w3.org/2005/xpath-functions#string-length">fn:string-length</a>, <a href="http://www.w3.org/2003/11/swrlb#stringLength">swrlb:stringLength</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">strstarts</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-strstarts">STRSTARTS</a>, <a href="http://www.w3.org/2005/xpath-functions#starts-with">fn:starts-with</a>, <a href="http://www.w3.org/2003/11/swrlb#startsWith">swrlb:startsWith</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">struuid</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-struuid">STRUUID</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">substr</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-substr">SUBSTR</a>, <a href="http://www.w3.org/2005/xpath-functions#substring">fn:substring</a>, <a href="http://www.w3.org/2003/11/swrlb#substring">swrlb:substring</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">subtractDates</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code>, <a href="http://www.w3.org/2003/11/swrlb#subtractDates">swrlb:subtractDates</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">subtractDayTimeDurationFromDate</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code>, <a href="http://www.w3.org/2003/11/swrlb#subtractDayTimeDurationFromDate">swrlb:subtractDayTimeDurationFromDate</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">subtractDayTimeDurationFromDateTime</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code>, <a href="http://www.w3.org/2003/11/swrlb#subtractDayTimeDurationFromDateTime">swrlb:subtractDayTimeDurationFromDateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">subtractDayTimeDurationFromTime</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code>, <a href="http://www.w3.org/2003/11/swrlb#subtractDayTimeDurationFromTime">swrlb:subtractDayTimeDurationFromTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">subtractDayTimeDurations</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code>, <a href="http://www.w3.org/2003/11/swrlb#subtractDayTimeDurations">swrlb:subtractDayTimeDurations</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">subtractTimes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code>, <a href="http://www.w3.org/2003/11/swrlb#subtractTimes">swrlb:subtractTimes</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">subtractYearMonthDurationFromDate</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code>, <a href="http://www.w3.org/2003/11/swrlb#subtractYearMonthDurationFromDate">swrlb:subtractYearMonthDurationFromDate</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">subtractYearMonthDurationFromDateTime</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code>, <a href="http://www.w3.org/2003/11/swrlb#subtractYearMonthDurationFromDateTime">swrlb:subtractYearMonthDurationFromDateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">subtractYearMonthDurations</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code>, <a href="http://www.w3.org/2003/11/swrlb#subtractYearMonthDurations">swrlb:subtractYearMonthDurations</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">tan</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2005/xpath-functions/math#tan">math:tan</a>, <a href="http://www.w3.org/2003/11/swrlb#tan">swrlb:tan</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">tanh</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>stardog:tanh</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">ten</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.dotnetrdf.org/leviathan#ten">leviathan:ten</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2003/11/swrlb#time">swrlb:time</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">timezone</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-timezone">TIMEZONE</a>, <a href="http://www.w3.org/2005/xpath-functions#timezone-from-dateTime">fn:timezone-from-dateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">toDegrees</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>stardog:toDegrees</code>, <a href="http://www.dotnetrdf.org/leviathan#radians-to-degrees">leviathan:radians-to-degrees</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">toRadians</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>stardog:toRadians</code>, <a href="http://www.dotnetrdf.org/leviathan#degrees-to-radians">leviathan:degrees-to-radians</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">translate</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-translate">TRANSLATE</a>, <a href="http://www.w3.org/2005/xpath-functions#translate">fn:translate</a>, <a href="http://www.w3.org/2003/11/swrlb#translate">swrlb:translate</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">tz</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-tz">TZ</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">ucase</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-ucase">UCASE</a>, <a href="http://www.w3.org/2005/xpath-functions#upper-case">fn:upper-case</a>, <a href="http://www.w3.org/2003/11/swrlb#upperCase">swrlb:upperCase</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-uuid">UUID</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">year</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.w3.org/TR/sparql11-query/#func-year">YEAR</a>, <a href="http://www.w3.org/2005/xpath-functions#year-from-dateTime">fn:year-from-dateTime</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">yearMonthDuration</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.w3.org/2003/11/swrlb#yearMonthDuration">swrlb:yearMonthDuration</a></p></td></tr></tbody></table></div></div><div class="sect1"><h2 id="_milestones"><a class="link" href="#_milestones">Milestones</a></h2><div class="sectionbody"><div class="paragraph"><p>This timeline describes major features and other notable changes to Stardog starting at 1.0; it will be updated for each notable new release. For a complete list of changes, including notable bug fixes, see the <a href="http://docs.stardog.com/release-notes/">release notes</a>.</p></div><div class="hdlist"><table><tr><td class="hdlist1">4.1</td><td class="hdlist2"><div class="ulist"><ul><li><p>Multi-coordinator Cluster</p></li><li><p>Cluster stability &amp; performance improvements</p></li><li><p>Query graph &amp; revision history simultaneously</p></li><li><p>New, faster SPARQL parser</p></li></ul></div></td></tr><tr><td class="hdlist1">4.0</td><td class="hdlist2"><div class="ulist"><ul><li><p>TinkerPop3 and property graphs</p></li><li><p>virtual graphs</p></li><li><p>RDF 1.1</p></li><li><p>Java 8</p></li><li><p>Geospatial query answering</p></li></ul></div></td></tr><tr><td class="hdlist1">3.1</td><td class="hdlist2"><div class="ulist"><ul><li><p>Named Graph security</p></li><li><p>BOSH-based cluster management tool</p></li><li><p>proper logshipping in the Cluster</p></li></ul></div></td></tr><tr><td class="hdlist1">3.0</td><td class="hdlist2"><div class="ulist"><ul><li><p>Equality reasoning via hybrid materialization</p></li><li><p>Improved incremental write performance</p></li><li><p>HA Cluster production ready</p></li><li><p>Integrity constraint violation repair plans</p></li><li><p>Improved query performance</p></li></ul></div></td></tr><tr><td class="hdlist1">2.2.1</td><td class="hdlist2"><div class="ulist"><ul><li><p>Stardog HA Cluster (beta)</p></li></ul></div></td></tr><tr><td class="hdlist1">2.2</td><td class="hdlist2"><div class="ulist"><ul><li><p>Support for RDF versioning</p></li><li><p>Admin support for Web Console</p></li></ul></div></td></tr><tr><td class="hdlist1">2.1</td><td class="hdlist2"><div class="ulist"><ul><li><p>Database repair, backup &amp; restore utilities</p></li><li><p>Improved query scalability by flowing intermediate results off-heap or onto disk; requires a JDK that supports <code>sun.misc.Unsafe</code></p></li><li><p><a href="#Performance Benchmark Results">Performance</a>: significant improvement in performance of bulk loading and total scalability of a database</p></li><li><p>Generation of multiple proofs for inferences &amp; inconsistencies; proofs for integrity constraint violations</p></li><li><p>Reduced memory footprint of queries while being executed</p></li></ul></div></td></tr><tr><td class="hdlist1">2.0</td><td class="hdlist2"><div class="ulist"><ul><li><p><a href="#_using_stardog">SPARQL 1.1 Update</a>: the most requested feature ever!</p></li><li><p><a href="#_browsing">Stardog Web Console</a>: a Stardog Web app for managing Stardog Databases; includes Linked Data Server, etc.</p></li><li><p><a href="#_server_monitoring_with_watchdog_jmx">JMX monitoring</a>: includes graphical monitoring via Web Console</p></li><li><p>HTTP &amp; SNARL servers unified into a single server (default port 5820)</p></li><li><p><a href="#_database_archetypes">Database Archetypes</a> for PROV, SKOS; extensible for user-defined ontologies, schemas, etc.</p></li><li><p><a href="#_stardog_rules_syntax">Stardog Rules Syntax</a>: new syntax for user-defined rules</p></li><li><p>Performance improvements for SPARQL query evaluation</p></li><li><p><a href="#_proof_trees">Hierarchical explanations</a> of inferences using proof trees</p></li><li><p><a href="#Reasoning Levels">SL</a> reasoning profile</p></li><li><p>Client and server dependencies cleanly separated</p></li><li><p>Evaluation of non-recursive datalog queries to improve reasoning performance</p></li></ul></div></td></tr><tr><td class="hdlist1">1.2</td><td class="hdlist2"><div class="ulist"><ul><li><p>Query management: slow query log, kill-able queries, etc.</p></li><li><p>new CLI</p></li><li><p>new transaction layer</p></li><li><p>SPARQL Service Description</p></li><li><p>new security layer</p></li><li><p>Query rewrite cache</p></li><li><p>Removed Stardog Shell</p></li></ul></div></td></tr><tr><td class="hdlist1">1.1.2</td><td class="hdlist2"><div class="ulist"><ul><li><p>New optimizer for subqueries</p></li></ul></div></td></tr><tr><td class="hdlist1">1.1</td><td class="hdlist2"><div class="ulist"><ul><li><p>SPARQL 1.1 Query</p></li><li><p>Transitive reasoning</p></li><li><p>User-defined rules in SWRL</p></li><li><p>new SWRL builtins and syntactic sugar for schema-queries</p></li><li><p>Improved performance of reasoning queries involving rdf:type</p></li><li><p>Improved performance of search indexing</p></li><li><p>Deprecated Stardog Shell</p></li></ul></div></td></tr><tr><td class="hdlist1">1.0.4</td><td class="hdlist2"><div class="ulist"><ul><li><p>Convert ICVs to SPARQL queries in the CLI or Java API</p></li><li><p>Running as a Windows Service</p></li><li><p>Parametric queries in CLI</p></li></ul></div></td></tr><tr><td class="hdlist1">1.0.2</td><td class="hdlist2"><div class="ulist"><ul><li><p>Stardog Community edition introduced</p></li><li><p>ICV in SNARL and HTTP</p></li><li><p>HTTP Admin protocol extensions</p></li><li><p>SPARQL 1.1 Graph Store Protocol</p></li></ul></div></td></tr><tr><td class="hdlist1">1.0.1</td><td class="hdlist2"><div class="ulist"><ul><li><p>Self-hosting Stardog documentation</p></li><li><p>Prefix mappings per database</p></li><li><p>Access and audit logging</p></li></ul></div></td></tr><tr><td class="hdlist1">1.0</td><td class="hdlist2"><div class="ulist"><ul><li><p>Execute <code>DESCRIBE</code> queries against multiple resources</p></li><li><p>Database consistency checking from CLI</p></li><li><p>Inference explanations from CLI</p></li></ul></div></td></tr></table></div></div></div><div class="sect1"><h2 id="_previous_versions_of_docs"><a class="link" href="#_previous_versions_of_docs">Previous Versions of Docs</a></h2><div class="sectionbody"><table class="tableblock frame-all grid-all spread"><caption class="title">10. Table of Historical Docs</caption><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Stardog Version</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">HTML</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">PDF</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">5.0.0beta</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/5.0.0beta#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-5.0.0beta.pdf">✓</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4.2</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/4.2/#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-4.2.pdf">✓</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4.1.3</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/4.1.3/#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-4.1.3.pdf">✓</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4.1.2</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/4.1.2/#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-4.1.2.pdf">✓</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4.1.1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/4.1.1/#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-4.1.1.pdf">✓</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4.1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/4.1#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-4.1.pdf">✓</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4.0.5</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/4.0.5#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-4.0.5.pdf">✓</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4.0.3</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/4.0.3#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-4.0.3.pdf">✓</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4.0.2</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/4.0.2#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-4.0.2.pdf">✓</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4.0.1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/4.0.1#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-4.0.1.pdf">✓</a></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4.0</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/4.0#">✓</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="/stardog-manual-4.0.pdf">✓</a></p></td></tr></tbody></table></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnote_1"><a href="#_footnoteref_1">1</a>. Robert Butler, Marko A. Rodriguez, Brian Sletten, Alin Dreghiciu, Rob Vesse, Stephane Fallah, John Goodwin, José Devezas, Chris Halaschek-Wiener, Gavin Carothers, Brian Panulla, Ryan Kohl, Morton Swimmer, Quentin Reul, Paul Dlug, James Leigh, Alex Tucker, Ron Zettlemoyer, Jim Rhyne, Andrea Westerinen, Huy Phan, Zach Whitley, Maurice Rabb, Grant Pax, Conrad Leonard, John Shearer, Ryan Hohimer, and the crew at XSB.</div><div class="footnote" id="_footnote_2"><a href="#_footnoteref_2">2</a>. That is, the server listens to one port (5820) and handles both protocols.</div><div class="footnote" id="_footnote_3"><a href="#_footnoteref_3">3</a>. That is, the server listens to one port (5820) and handles both protocols.</div><div class="footnote" id="_footnote_4"><a href="#_footnoteref_4">4</a>. The last SPARQL 1.1 feature that we didn&#8217;t support.</div><div class="footnote" id="_footnote_5"><a href="#_footnoteref_5">5</a>. See the <a href="http://www.w3.org/TR/r2rml/">R2RML spec</a> for more information about R2RML.</div><div class="footnote" id="_footnote_6"><a href="#_footnoteref_6">6</a>. User feedback about this limitation is welcomed.</div><div class="footnote" id="_footnote_7"><a href="#_footnoteref_7">7</a>. Find another database that can do that!</div><div class="footnote" id="_footnote_8"><a href="#_footnoteref_8">8</a>. In other words, if there is a conflict between this documentation and the output of the CLI tools' <code>help</code> command, the CLI output is correct.</div><div class="footnote" id="_footnote_9"><a href="#_footnoteref_9">9</a>. It&#8217;s very unlikely you&#8217;ll need this.</div><div class="footnote" id="_footnote_10"><a href="#_footnoteref_10">10</a>. We&#8217;re big fans of /opt/stardog/{$version} and setting <code>STARDOG_HOME</code> to /var/stardog` but YMMV.</div><div class="footnote" id="_footnote_11"><a href="#_footnoteref_11">11</a>. This is equally true, when using Stardog HA Cluster, of Zookeeper&#8217;s access to free disk space. Very bad things happen to the Stardog Cluster if Zookeeper cannot write to disk.</div><div class="footnote" id="_footnote_12"><a href="#_footnoteref_12">12</a>. For more details about configuring these values, see <a href="https://github.com/Complexible/stardog-examples/blob/master/config/stardog.properties" class="bare">https://github.com/Complexible/stardog-examples/blob/master/config/stardog.properties</a>.</div><div class="footnote" id="_footnote_13"><a href="#_footnoteref_13">13</a>. However, there may be some delay since Stardog only periodically checks the <code>query.timeout</code> value against internal query evaluation timers.</div><div class="footnote" id="_footnote_14"><a href="#_footnoteref_14">14</a>. A good general purpose discussion of these issues in context of J2EE is <a href="http://vladmihalcea.com/2014/12/23/a-beginners-guide-to-transaction-isolation-levels-in-enterprise-java/">this beginner&#8217;s guide</a>.</div><div class="footnote" id="_footnote_15"><a href="#_footnoteref_15">15</a>. As discussed in <a href="#_sparql_update">SPARQL Update</a>, since Update queries are implicitly atomic transactional operations, which means you shouldn&#8217;t issue an Update query within an open transaction.</div><div class="footnote" id="_footnote_16"><a href="#_footnoteref_16">16</a>. The probability of recovering from a catastrophic transaction failure is inversely proportional to the number of subsequent write attempts; hence, Stardog offlines the database to prevent subsequent write attempts and to increase the likelihood of recovery.</div><div class="footnote" id="_footnote_17"><a href="#_footnoteref_17">17</a>. Stardog also uses file handles and sockets, but we don&#8217;t discuss those here.</div><div class="footnote" id="_footnote_18"><a href="#_footnoteref_18">18</a>. These are conservative values and are somewhat dataset specific. Your data may require less memory..or more!</div><div class="footnote" id="_footnote_19"><a href="#_footnoteref_19">19</a>. Blob Indexing and Text Enrichment with Semantics</div><div class="footnote" id="_footnote_20"><a href="#_footnoteref_20">20</a>. "Client" here means the client of Stardog APIs.</div><div class="footnote" id="_footnote_21"><a href="#_footnoteref_21">21</a>. "Because ZooKeeper requires a majority, it is best to use an odd number of machines. For example, with four machines ZooKeeper can only handle the failure of a single machine; if two machines fail, the remaining two machines do not constitute a majority. However, with five machines ZooKeeper can handle the failure of two machines." See <a href="https://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html">Zk Admin</a> for more.</div><div class="footnote" id="_footnote_22"><a href="#_footnoteref_22">22</a>. Based on customer feedback we may relax these consistency guarantees in some future release. Please get in touch if you think an eventually consistent approach is more appropriate for your use of Stardog.</div><div class="footnote" id="_footnote_23"><a href="#_footnoteref_23">23</a>. There&#8217;s nothing special about HAProxy here; you could implement this proxy functionality in many different ways. We use HAProxy because it&#8217;s relatively easy and ubiquitous. YMMV.</div><div class="footnote" id="_footnote_24"><a href="#_footnoteref_24">24</a>. This point is especially true of Cluster but may be relevant for some workloads on a single Stardog database, that is, non-Cluster configuration, too.</div><div class="footnote" id="_footnote_25"><a href="#_footnoteref_25">25</a>. You only pay for the reasoning that you use; no more and no less. Eager materialization is mostly a great strategy for hard disk manufacturers.</div><div class="footnote" id="_footnote_26"><a href="#_footnoteref_26">26</a>. Sometimes called a "TBox".</div><div class="footnote" id="_footnote_27"><a href="#_footnoteref_27">27</a>. Find another database, any other database anywhere, that can do that! We&#8217;ll wait&#8230;&#8203;</div><div class="footnote" id="_footnote_28"><a href="#_footnoteref_28">28</a>. Triggered using the <code>--format tree</code> option of the <code>reasoning explain</code> CLI command.</div><div class="footnote" id="_footnote_29"><a href="#_footnoteref_29">29</a>. Quick refresher: the <code>IF</code> clause defines the conditions to match in the data; if they match, then the contents of the <code>THEN</code> clause "fire", that is, they are inferred and, thus, available for other queries, rules, or axioms, etc.</div><div class="footnote" id="_footnote_30"><a href="#_footnoteref_30">30</a>. Of course if you&#8217;ve tweaked <code>reasoning.schema.graphs</code>, then you should put the rules into the named graph(s) that are specified in that configuration parameter.</div><div class="footnote" id="_footnote_31"><a href="#_footnoteref_31">31</a>. Built-in URIs such as <code>rdfs:subClassOf</code> or <code>owl:TransitiveProperty</code> are not allowed in rules</div><div class="footnote" id="_footnote_32"><a href="#_footnoteref_32">32</a>. This is effectively the only setting for Stardog prior to 3.0.</div><div class="footnote" id="_footnote_33"><a href="#_footnoteref_33">33</a>. These are harmless and won&#8217;t otherwise affect query evaluation; they can also be added to the data, instead of to queries, if that fits your use case better.</div><div class="footnote" id="_footnote_34"><a href="#_footnoteref_34">34</a>. The standard inference semantics of OWL 2 do not adopt the unique name assumption because, in information integration scenarios, things often have more than one name but that doesn&#8217;t mean they are different things. For example, when several databases or other data sources all contain some partial information about, say, an employee, but they each name or identify the employee in different ways. OWL 2 won&#8217;t assume these are different employees just because there are several names.</div><div class="footnote" id="_footnote_35"><a href="#_footnoteref_35">35</a>. Strictly speaking, this is a bit misleading. Stardog ICV uses both open and closed world semantics: since inferences can violate or satisfy constraints, and Stardog uses open world semantics to calculate inferences, then the ICV process is compatible with open world reasoning, to which it then applies a form of closed world validation, as described in this chapter.</div><div class="footnote" id="_footnote_36"><a href="#_footnoteref_36">36</a>. This is a good example of open world and closed world reasoning interacting for the win.</div><div class="footnote" id="_footnote_37"><a href="#_footnoteref_37">37</a>. In other words, embedded Stardog access is inherently <strong>insecure</strong> and should be used accordingly.</div><div class="footnote" id="_footnote_38"><a href="#_footnoteref_38">38</a>. The Stardog client uses an <code>X509TrustManager</code>. The details of how a trust store is selected to initialize the trust manager are <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#X509TrustManager" class="bare">http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#X509TrustManager</a>.</div><div class="footnote" id="_footnote_39"><a href="#_footnoteref_39">39</a>. See the <code>javax.net.ssl.trustStorePassword</code> system property docs: <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#X509TrustManager" class="bare">http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#X509TrustManager</a>.</div><div class="footnote" id="_footnote_40"><a href="#_footnoteref_40">40</a>. The matching algorithm used is described&#8212;&#8203;<a href="http://hc.apache.org/httpcomponents-client-ga/tutorial/html/connmgmt.html--" class="bare">http://hc.apache.org/httpcomponents-client-ga/tutorial/html/connmgmt.html--</a> in the Apache docs about <code>BrowserCompatHostnameVerifier</code>.</div><div class="footnote" id="_footnote_41"><a href="#_footnoteref_41">41</a>. You won&#8217;t be careful enough.</div><div class="footnote" id="_footnote_42"><a href="#_footnoteref_42">42</a>. The relevant specs include the Stardog-specific specifications documented on this site, but also W3C (and other) specifications of various languages, including SPARQL, RDF, RDFS, OWL 2, HTTP, Google Protocol Buffers, as well as others.</div><div class="footnote" id="_footnote_43"><a href="#_footnoteref_43">43</a>. Strictly speaking, this is a Sesame parser deviation from the SPARQL 1.1 spec with which we happen to agree.</div></div><div id="footer"><div id="footer-text">Version 5.0.0beta<br></div><p><a href="#">&#11014;</a> For comments, questions, or to report problems with this page, visit the <a href="https://groups.google.com/a/clarkparsia.com/group/stardog/about">Stardog Support Forum</a>.</p><p>©2012&ndash;2017 Stardog Union <a href="http://creativecommons.org/licenses/by-sa/3.0/">Some rights reserved</a>.</p><p align="center"><a href="http://stardog.com/"><img width="" height="" src="../doc/optimized-img/su.png" border="0"></a></p></div><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script><script>hljs.initHighlightingOnLoad()</script></body></html>